<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Sub-Document Operations | Couchbase Docs (Staging)</title>
    <link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-4463/nodejs-sdk/2.6/subdocument-operations.html">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="schema.dcterms" href="https://purl.org/dc/terms/">
    <meta name="dcterms.subject" content="nodejs-sdk">
    <meta name="dcterms.identifier" content="2.5">
    <meta name="generator" content="Antora 1.1.1">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" id="topbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://www.couchbase.com"><img src="../../_/img/logo.svg" alt="Couchbase"></a>
        <button class="navbar-burger" data-target="topbar-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="topbar-menu" class="navbar-menu">
        <div class="navbar-start">
          <div class="navbar-item has-dropdown">
            <a class="navbar-link" href="https://simon-dew.github.io/docs-site/DOC-4463">Docs</a>
            <div class="navbar-dropdown explore">
              <div class="title">Couchbase Documentation Overview</div>
              <div class="cols">
                <ul>
                  <li class="heading"><a href="../../server/6.0/introduction/intro.html">Server</a></li>
                  <li><a href="../../server/6.0/n1ql/n1ql-language-reference/index.html">N1QL</a></li>
                  <li><a href="../../server/6.0/fts/full-text-intro.html">Full Text Search</a></li>
                  <li><a href="../../server/6.0/analytics/introduction.html">Analytics</a></li>
                  <li><a href="../../server/6.0/eventing/eventing-overview.html">Eventing</a></li>
                  <li><a href="../../operator/1.2/overview.html">Autonomous Operator</a></li>
                </ul>
                <ul>
                  <li class="heading">Mobile</li>
                  <li><a href="../../couchbase-lite/2.5/index.html">Lite</a></li>
                  <li><a href="../../sync-gateway/2.5/index.html">Sync Gateway</a></li>
                </ul>
                <ul class="two-cols">
                  <li class="heading"><a href="../../server/6.0/sdk/overview.html">SDKs</a></li>
                  <li><a href="../../c-sdk/2.10/start-using-sdk.html">C</a></li>
                  <li><a href="../../dotnet-sdk/2.7/start-using-sdk.html">.NET</a></li>
                  <li><a href="../../go-sdk/1.5/start-using-sdk.html">Go</a></li>
                  <li><a href="../../java-sdk/2.7/start-using-sdk.html">Java</a></li>
                  <li><a href="../../nodejs-sdk/2.6/start-using-sdk.html">Node.js</a></li>
                  <li><a href="../../php-sdk/2.6/start-using-sdk.html">PHP</a></li>
                  <li><a href="../../python-sdk/2.5/start-using-sdk.html">Python</a></li>
                </ul>
                <ul>
                  <li class="heading"><a href="../../server/6.0/connectors/intro.html">Connectors</a></li>
                  <li><a href="../../elasticsearch-connector/4.0/index.html">Elasticsearch</a></li>
                  <li><a href="../../server/6.0/connectors/hadoop-1.2/hadoop.html">Hadoop</a></li>
                  <li><a href="../../kafka-connector/3.4/index.html">Kafka</a></li>
                  <li><a href="../../spark-connector/2.2/index.html">Spark</a></li>
                  <li><a href="../../talend-connector/index.html">Talend</a></li>
                  <li><a href="../../server/6.0/connectors/odbc-jdbc-drivers.html">ODBC/JDBC</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="navbar-item has-dropdown">
            <a class="navbar-link component" href="start-using-sdk.html"><span class="title">Node.js SDK</span> <span class="version">2.5</span></a>
            <div class="navbar-dropdown versions">
              <div class="cols">
                <ul>
                  <li><a class="navbar-item" href="../2.6/subdocument-operations.html">Node.js SDK 2.6</a></li>
                  <li><a class="navbar-item" href="../2.4/subdocument-operations.html">Node.js SDK 2.4</a></li>
                  <li><a class="navbar-item" href="../2.3/subdocument-operations.html">Node.js SDK 2.3</a></li>
                  <li><a class="navbar-item" href="../2.2/subdocument-operations.html">Node.js SDK 2.2</a></li>
                  <li><a class="navbar-item" href="../2.1/introduction.html">Node.js SDK 2.1</a></li>
                </ul>
                <ul class="related">
                  <li><a class="navbar-item" href="../../c-sdk/2.10/subdocument-operations.html">C SDK</a></li>
                  <li><a class="navbar-item" href="../../dotnet-sdk/2.7/subdocument-operations.html">.NET SDK</a></li>
                  <li><a class="navbar-item" href="../../go-sdk/1.5/subdocument-operations.html">Go SDK</a></li>
                  <li><a class="navbar-item" href="../../java-sdk/2.7/subdocument-operations.html">Java SDK</a></li>
                  <li><a class="navbar-item" href="../../php-sdk/2.6/subdocument-operations.html">PHP SDK</a></li>
                  <li><a class="navbar-item" href="../../python-sdk/2.5/subdocument-operations.html">Python SDK</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <a class="btn red-btn" href="https://www.couchbase.com/downloads">Downloads</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body container">
<nav class="nav">
<div class="nav-menu">
<ul class="nav-list">
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Hello World!</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="start-using-sdk.html">Start Using the SDK</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="sample-application.html">Sample Application</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="sample-app-backend.html">Sample App Backend</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="webui-cli-access.html">Browser and CLI Access</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Users and Security</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="sdk-authentication-overview.html">Authentication</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="sdk-user-management-overview.html">User Management</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="sdk-user-management-example.html">Sample Code</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="encryption.html">Field Level Encryption</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="encrypting-using-sdk.html">Field Level Encryption from the Java SDK</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-path is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Working with Data</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="core-operations.html">Core Operations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="document-operations.html">Document Operations</a>
    </span>
  </li>
  <li class="nav-item is-current-page is-active" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="subdocument-operations.html">Sub-Document Operations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="datastructures.html">Data Structures</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="n1ql-query.html">Querying with N1QL</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="n1ql-queries-with-sdk.html">N1QL from the SDK</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="full-text-search-overview.html">Full Text Search</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="full-text-searching-with-sdk.html">Searching from the SDK</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="view-queries-with-sdk.html">MapReduce Views</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="async-programming.html">Asynchronous Programming</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="batching-operations.html">Batching Operations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="durability.html">Durability</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="concurrent-mutations-cluster.html">Concurrent Document Mutations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="sdk-xattr-overview.html">Extended Attributes</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="sdk-xattr-example.html">Sample Code</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="nonjson.html">Non-JSON Documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="compression-intro.html">Compression</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Deployment Environments</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="managing-connections.html">Managing Connections</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="managing-clusters.html">Managing Clusters</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="compatibility-versions-features.html">Compatibility</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Settings, Error Handling &amp; Diagnostics</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="client-settings.html">Client Settings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="handling-error-conditions.html">Handling Errors</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="failure-considerations.html">Failure Considerations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="collecting-information-and-logging.html">Collecting Information</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="threshold-logging.html">Threshold Logging</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="tracing-from-the-sdk.html">Tracing from the SDK</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Project Docs</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="relnotes-nodejs-sdk.html#version-2-5-1-27-july-2018">Release Notes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="compatibility-versions-features.html">Compatibility</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="sdk-licenses.html">Licenses</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="get-involved.html">Get involved</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="https://docs.couchbase.com/home/contribute/index.html">Improve the Docs</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
</div>
</nav>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
<main class="article" data-ceiling="topbar">
  <div class="article-banner">
    <p>A newer version of this documentation is available.</p>
    <a class="btn" href="../2.6/subdocument-operations.html">View Latest</a>
  </div>
  <div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="start-using-sdk.html">Node.js SDK</a></li>
    <li class="crumb">Working with Data</li>
    <li class="crumb"><a href="subdocument-operations.html">Sub-Document Operations</a></li>
  </ul>
</nav>
<div class="tools" role="navigation">
  <ul>
    <li class="tool edit"><a href="https://github.com/couchbase/docs-sdk-nodejs/edit/release/2.5/modules/ROOT/pages/subdocument-operations.adoc" title="Edit Page" target="_blank" rel="noopener">Edit</a></li>
  </ul>
</div>
  </div>
<article class="doc">
<h1 class="page">Sub-Document Operations</h1>
<div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<em>Sub-document</em> operations can be used to efficiently access <em>parts</em> of documents.
Sub-document operations may be quicker and more network-efficient than <em>full-document</em> operations such as <em>upsert</em>, <em>update</em> and <em>get</em> because they only transmit the accessed sections of the document over the network.
Sub-document operations are also atomic, allowing safe modifications to documents with built-in concurrency control.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sub-documents"><a class="anchor" href="#sub-documents"></a>Sub-documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Starting with Couchbase Server 4.5 you can atomically and efficiently update and retrieve <em>parts</em> of a document.
These parts are called <em>sub-documents</em>.
While full-document retrievals retrieve the entire document and full document updates require sending the entire document, sub-document retrievals only retrieve relevant parts of a document and sub-document updates only require sending the updated portions of a document.
You should use sub-document operations when you are modifying only portions of a document, and full-document operations when the contents of a document is to change significantly.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Attention"></i>
</td>
<td class="content">
The sub-document operations described on this page are for <em>Key-Value</em> requests only: they are not related to sub-document N1QL queries.
(Sub-document N1QL queries are explained in the section <a href="n1ql-query.html" class="page">Querying with N1QL</a>.)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to use sub-document operations you need to specify a <em>path</em> indicating the location of the sub-document.
The <em>path</em> follows N1QL syntax (see <a href="https://developer.couchbase.com/documentation/server/current/sdk/subdocument-operations.html#story-h2-12" target="_blank" rel="noopener">below</a>, and <a href="../../server/6.0/n1ql/n1ql-intro/queriesandresults.html" class="page">N1QL Queries and Results</a>).
Considering the document:</p>
</div>
<div class="listingblock">
<div class="title">customer123.json</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "Douglas Reynholm",
  "email": "douglas@reynholmindustries.com",
  "addresses": {
    "billing": {
      "line1": "123 Any Street",
      "line2": "Anytown",
      "country": "United Kingdom"
    },
    "delivery": {
      "line1": "123 Any Street",
      "line2": "Anytown",
      "country": "United Kingdom"
    }
  },
  "purchases": {
    "complete": [
      339, 976, 442, 666
    ],
    "abandoned": [
      157, 42, 999
    ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The paths <code>name</code>, <code>addresses.billing.country</code> and <code>purchases.complete[0]</code> are all valid paths.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="retrieving"><a class="anchor" href="#retrieving"></a>Retrieving</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>lookup-in</em> operations queries the document for a certain path(s) and returns that/those path(s).
You have a choice of actually retrieving the document path using the <em>subdoc-get</em> sub-document operation, or simply querying the existence of the path using the <em>subdoc-exists</em> sub-document operation.
The latter saves even more bandwidth by not retrieving the contents of the path if it is not needed.</p>
</div>
<div class="listingblock">
<div class="title">Retrieve sub-document value</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">import couchbase.subdocument as SD  # Use SD alias for brevity
rv = bucket.lookup_in('customer123', SD.get('addresses.delivery.country'))
country = rv[0] # =&gt; 'United Kingdom'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Check existence of sub-document path</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">bucket.lookupIn('customer123').exists('purchases.pending[-1]').execute(
    function(err, result) {
        console.log('Path exists? %j', result.exists('purchases.pending[-1]'));
    }
);
# Path exists? false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple operations can be combined as well:</p>
</div>
<div class="listingblock">
<div class="title">Combine multiple lookup operations</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">$frags = $bucket-&gt;lookupIn('customer123')
    -&gt;get('addresses.delivery.country')
    -&gt;exists('purchases.pending[-1]')
    -&gt;execute();

echo $frags-&gt;value[0]['value'] . ", Code=" . $frags-&gt;value[0]['code'] . "\n";
echo $frags-&gt;value[1]['value'] . ", Code=" . $frags-&gt;value[1]['code'] . "\n";
# United Kingdom, 0 (No error)
# , 63 (COUCHBASE_SUBDOC_PATH_ENOENT)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mutating"><a class="anchor" href="#mutating"></a>Mutating</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mutation operations modify one or more paths in the document.
The simplest of these operations is <em>subdoc-upsert</em>, which, just like the fulldoc-level <em>upsert</em>, this will either modify the value of an existing path or create it if it does not exist:</p>
</div>
<div class="listingblock">
<div class="title">Upserting a new sub-document</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.mutate_in('customer123', SD.upsert('fax', '311-555-0151'))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Likewise, the <em>subdoc-insert</em> operation will only add the new value to the path if it does not exist:</p>
</div>
<div class="listingblock">
<div class="title">Inserting a sub-document</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.mutate_in('customer123', SD.insert('purchases.complete', [42, True, None]))
# SubdocPathExistsError</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dictionary values can also be replaced or removed, and you may combine any number of mutation operations within the same general <em>mutate-in</em> API.
Here&#8217;s an example of one which replaces one path and removes another.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.mutate_in('customer123',
                 SD.remove('addresses.billing'),
                 SD.replace('email', 'dougr96@hotmail.com'))</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="array-append-and-prepend"><a class="anchor" href="#array-append-and-prepend"></a>Array append and prepend</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>subdoc-array-prepend</em> and <em>subdoc-array-append</em> operations are true array prepend and append operations.
Unlike fulldoc <em>append</em>/<em>prepend</em> operations (which simply concatenate bytes to the existing value), <em>subdoc-array-append</em> and <em>subdoc-array-prepend</em> are JSON-aware:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.mutate_in('customer123', SD.array_append('purchases.complete', 777))
# purchases.complete is now [339, 976, 442, 666, 777]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.mutate_in('customer123', SD.array_prepend('purchases.abandoned', 18))
# purchases.abandoned in now [18, 157, 49, 999]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your document only needs to contain an array, you do not have to create a top-level object wrapper to contain it.
Simply initialize the document with an empty array and then use the empty path for subsequent sub-document array operations:</p>
</div>
<div class="listingblock">
<div class="title">Creating and populating an array document</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.upsert('my_array', [])
bucket.mutate_in('my_array', SD.array_append('', 'some element'))
# the document my_array is now ["some element"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wish to add multiple values to an array, you may do so by passing multiple values to the <em>array-append</em>, <em>array-prepend</em>, or <em>array-insert</em> operations.
Be sure to know the difference between passing a collection of multiple elements (in which case the collection is inserted as a single element in the array, as a sub-array) and passing multiple elements (in which case the elements are appended individually to the array):</p>
</div>
<div class="listingblock">
<div class="title">Add multiple elements to an array</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.mutate_in('my_array', SD.array_append('', 'elem1', 'elem2', 'elem3')
# the document my_array is now ["some_element", "elem1", "elem2", "elem3"]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Add single array as element to existing array</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.mutate_in('my_array', SD.array_append('', ['elem1', 'elem2', 'elem3'])
# the document my_array is now ["some_element", ["elem1", "elem2", "elem3"]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that passing multiple values to a single <em>array-append</em> operation results in greater performance increase and bandwidth savings than simply specifying a single <em>array-append</em> for each element.</p>
</div>
<div class="listingblock">
<div class="title">Adding multiple elements to array (slow)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.mutate_in('my_array',
                  SD.array_append('', 'elem1'),
                  SD.array_append('', 'elem2'),
                  SD.array_append('', 'elem3'))</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wish to create an array if it does not exist and also push elements to it within the same operation you may use the&lt;&lt; subdoc-create-parents,<em>create-parents</em>&gt;&gt; option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.mutate_in('some_doc',
                  SD.array_append('some.array', 'Hello', 'World',
                                  create_parents=True))</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="arrays-as-unique-sets"><a class="anchor" href="#arrays-as-unique-sets"></a>Arrays as unique sets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Limited support also exists for treating arrays like unique sets, using the <em>subdoc-array-addunique</em> command.
This will do a check to determine if the given value exists or not before actually adding the item to the array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.mutate_in('customer123', SD.push_unique('purchases.complete', 95))
# =&gt; Success
bucket.mutate_in('customer123', SD.push_unique('purchases.abandoned', 42))
# =&gt; SubdocPathExists exception!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that currently the <em>addunique</em> will fail with a <em>Path Mismatch</em> error if the array contains JSON <em>floats</em>, <em>objects</em>, or <em>arrays</em>.
The <em>addunique</em> operation will also fail with <em>Cannot Insert</em> if the value to be added is one of those types as well.</p>
</div>
<div class="paragraph">
<p>Note that the actual position of the new element is undefined, and that the array is not ordered.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="array-insertion"><a class="anchor" href="#array-insertion"></a>Array insertion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>New elements can also be <em>inserted</em> into an array.
While <em>append</em> will place a new item at the <em>end</em> of an array and <em>prepend</em> will place it at the beginning, <em>insert</em> allows an element to be inserted at a specific <em>position</em>.
The position is indicated by the last path component, which should be an array index.
For example, to insert <code>"cruel"</code> as the second element in the array <code>["Hello", "world"]</code>, the code would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.mutate_in('array', SD.arrayinsert('[1]', 'cruel'))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the array must already exist and that the index must be valid (i.e.
it must not point to an element which is out of bounds).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="counters-and-numeric-fields"><a class="anchor" href="#counters-and-numeric-fields"></a>Counters and numeric fields</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Counter operations allow the manipulation of a <em>numeric</em> value inside a document.
These operations are logically similar to the <em>counter</em> operation on an entire document:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">rv = bucket.mutate_in('customer123', SD.counter('logins', 1))
cur_count = rv[0] # =&gt; 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>subdoc-counter</em> operation peforms simple arithmetic against a numeric value, either incrementing or decrementing the existing value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.upsert('player432', {'gold': 1000})
rv = bucket.mutate_in('player432', SD.counter('gold', -150))
print('player432 now has {0} gold remaining'.format(rv[0]))
# =&gt; player 432 now has 850 gold remaining</code></pre>
</div>
</div>
<div class="paragraph">
<p>The existing value for <em>subdoc-counter</em> operations must be within range of a 64 bit signed integer.
If the value does not exist, the <em>subdoc-counter</em> operation will create it (and its parents, if <em>create-parents</em> is enabled).</p>
</div>
<div class="paragraph">
<p>Note that there are several differences between <em>subdoc-counter</em> and the full-document <em>counter</em> operations:</p>
</div>
<div id="ul_fp2_2yw_mv" class="ulist">
<ul>
<li>
<p>Sub-document counters have a range of -9223372036854775807 to 9223372036854775807 (i.e.
<code>INT64_MIN</code> and <code>INT64_MAX</code>), whereas full-document counters have a range of 0 to 18446744073709551615 (<code>UINT64_MAX</code>)</p>
</li>
<li>
<p>Sub-document counter operations protect against overflow and underflow, returning an error if the operation would exceed the range.
Full-document counters will use normal C semantics for overflow (in which the overflow value is carried over above 0), and will silently fail on underflow, setting the value to 0 instead.</p>
</li>
<li>
<p>Sub-document counter operations can operate on any numeric value within a document, while full-document counter operations require a specially formatted counter document with only the counter value.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="executing-multiple-operations"><a class="anchor" href="#executing-multiple-operations"></a>Executing multiple operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Multiple sub-document operations can be executed at once on the same document, allowing you to retrieve or modify several sub-documents at once.
When multiple operations are submitted within the context of a single <em>lookup-in</em> or <em>mutate-in</em> command, the server will execute all the operations with the same version of the document.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Unlike <em>batched operations</em> which is simply a way of sending multiple individual operations efficiently on the network, multiple subdoc operations are formed into a single command packet, which is then executed atomically on the server.
You can submit up to 16 operations at a time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When submitting multiple <em>mutation</em> operations within a single <em>mutate-in</em> command, those operations are considered to be part of a single transaction: if any of the mutation operations fail, the server will logically roll-back any other mutation operations performed within the <em>mutate-in</em>, even if those commands would have been successful had another command not failed.</p>
</div>
<div class="paragraph">
<p>When submitting multiple <em>retrieval</em> operations within a single <em>lookup-in</em> command, the status of each command does not affect any other command.
This means that it is possible for some retrieval operations to succeed and some others to fail.
While their statuses are independent of each other, you should note that operations submitted within a single <em>lookup-in</em> are all executed against the same <em>version</em> of the document.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="subdoc-create-parents"><a class="anchor" href="#subdoc-create-parents"></a>Creating parents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sub-document mutation operations such as <em>subdoc-upsert</em> or <em>subdoc-insert</em> will fail if the <em>immediate parent</em> is not present in the document.
Consider:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "level_0": {
        "level_1": {
            "level_2": {
                "level_3": {
                    "some_field": "some_value"
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Looking at the <code>some_field</code> field (which is really <code>level_0.level_1.level_2.level_3.some_field</code>), its <em>immediate</em> parent is <code>level_3</code>.
If we were to attempt to insert another field, <code>level_0.level_1.level_2.level_3.another_field</code>, it would succeed because the immediate parent is present.
However if we were to attempt to <em>subdoc-insert</em> to <code>level_1.level_2.foo.bar</code> it would fail, because <code>level_1.level_2.foo</code> (which would be the immediate parent) does not exist.
Attempting to perform such an operation would result in a Path Not Found error.</p>
</div>
<div class="paragraph">
<p>By default the automatic creation of parents is disabled, as a simple typo in application code can result in a rather confusing document structure.
Sometimes it is necessary to have the server create the hierarchy however.
In this case, the <em>create-parents</em> or <em>create-intermediates</em> option may be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.mutate_in('customer123',
                 SD.upsert('level_0.level_1.foo.bar.phone',
                           {'num': '311-555-0101', 'ext': 16},
                           create_parents=True))</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cas-semantics"><a class="anchor" href="#cas-semantics"></a>CAS Semantics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Subdoc mostly eliminates the need for tracking the <a href="concurrent-mutations-cluster.html" class="page">CAS</a> value.
Subdoc operations are atomic and therefore if two different threads access two different sub-documents then no conflict will arise.
For example the following two blocks can execute concurrently without any risk of conflict:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.mutate_in('customer123', SD.array_append('purchases.complete', 999))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">bucket.mutate_in('customer123', SD.array_append('purchases.abandoned', 998))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even when modifying the <em>same</em> part of the document, operations will not necessarily conflict.
For example, two concurrent <em>subdoc-array-append</em> operations to the same array will both succeed, never overwriting the other.</p>
</div>
<div class="paragraph">
<p>While CAS is no longer required to ensure document updates are preserved, it may still be needed to ensure document state remains consistent over multiple invocations of <em>mutate-in</em>: Sometimes it&#8217;s important to ensure the entire document didn&#8217;t change state since the last operation, such as in the case <em>subdoc-remove</em> operations to ensure that the element being removed was not already replaced by something else.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="error-handling"><a class="anchor" href="#error-handling"></a>Error handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Subdoc operations have their own set of errors.
When programming with subdoc, be prepared for any of the full-document errors (such as <em>Document Not Found</em>) as well as special sub-document errors which are received when certain constraints are not satisfied.
Some of the errors include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Path does not exist</strong>: When retrieving a path, this means the path does not exist in the document.
When inserting or upserting a path, this means the <em>immediate parent</em> does not exist.</p>
</li>
<li>
<p><strong>Path already exists</strong>: In the context of an <em>insert</em>, it means the given path already exists.
In the context of <em>array-add-unique</em>, it means the given value already exists.</p>
</li>
<li>
<p><strong>Path mismatch</strong>: This means the path may exist in the document, but that there is a type conflict between the path in the document and the path in the command.
Consider the document:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{ "tags": ["reno", "nevada", "west", "sierra"] }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The path <code>tags.sierra</code> is a mismatch, since <code>tags</code> is actually an array, while the path assumes it is a JSON object (dictionary).</p>
</div>
</li>
<li>
<p><strong>Document not JSON</strong>: This means you are attempting to modify a binary document using sub-document operations.</p>
</li>
<li>
<p><strong>Invalid path</strong>: This means the path is invalid for the command.
Certain commands such as <em>subdoc-array-insert</em> expect array elements as their final component, while others such as <em>subdoc-upsert</em> and <em>subdoc-insert</em> expect dictionary (object) keys.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because sub-document operations are executed using either <em>mutate-in</em> or <em>replace-in</em>, if a command fails a top-level error is reported (<em>Multi Command Failure</em>), rather than an individual error code (e.g.
<em>Path Not Found</em>).
When receiving a top-level error code, you should traverse the results of the command to see which individual code failed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="path-syntax"><a class="anchor" href="#path-syntax"></a>Path syntax</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Path syntax largely follows N1QL conventions: A path is divided into components, with each component referencing a specific <em>level</em> in a document hierarchy.
Components are separated by dots (<code>.</code>) in the case where the element left of the dot is a dictionary, or by brackets (<code>[n]</code>) where the element left of the bracket is an array and <code>n</code> is the index within the array.</p>
</div>
<div class="paragraph">
<p>As a special extension, you can indicate the <em>last element</em> of an array by using an index of <code>-1</code>, for example to get the last element of the array in the document</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"some":{"array":[1,2,3,4,5,6,7,8,9,0]}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>some.array[-1]</code> as the path, which will return the element <code>0</code>.</p>
</div>
<div class="paragraph">
<p>Each path component must conform as a JSON string, as if it were surrounded by quotes, and any character in the path which may invalidate it as a JSON string must be escaped by a backslash (<code>\</code>).
In other words, the path component must match exactly the path inside the document itself.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"literal\"quote": {"array": []}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>must be referenced as <code>literal\"quote.array</code>.</p>
</div>
<div class="paragraph">
<p>If the path also has special path characters (i.e.
a dot or brackets) it may be escaped using N1QL escapes.
Considering the document</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"literal[]bracket": {"literal.dot": true}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A path such as
 `literal[]bracket`.`literal.dot`.
You can use double-backticks (``) to reference a literal backtick.</p>
</div>
<div class="paragraph">
<p>If you need to combine both JSON <em>and</em> path-syntax literals you can do so by escaping the component from any JSON string characters (e.g.
a quote or backslash) and then encapsulating it in backticks (<code>`path`</code>).
Here is such an example in Python:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">import json
def escape_component(component):
    component = json.dumps(component)[1:-1]
    return '`' + component + '`'

print escape_component("Hello!") # `Hello!`
print escape_component("backtick[]") # `backtick[]`
print escape_component("[\"mixed\\") # `[\"mixed\\`</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, paths cannot exceed 1024 characters, and cannot be more than 32 levels deep.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xdcr"><a class="anchor" href="#xdcr"></a>XDCR</h2>
<div class="sectionbody">
<div class="paragraph">
<p>XDCR only replicates full documents.
Sub-documents are only replicated as part of the full document.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/logo.svg" alt="Couchbase">
          </a>
        </div>
        <div class="contact">
          <p class="address">3250 Olcott Street
Santa Clara, CA 95054
United States</p>
          <a href="https://www.couchbase.com/contact" class="btn white-btn">Contact Us</a>
          <a class="tel" href="tel:1-650-417-7500">1-650-417-7500</a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Company</span></li>
          <li><a href="https://www.couchbase.com/about">About</a></li>
          <li><a href="https://www.couchbase.com/leadership">Leadership</a></li>
          <li><a href="https://www.couchbase.com/news-and-press-releases">News &amp; Press</a></li>
          <li><a href="https://www.couchbase.com/careers">Careers</a></li>
          <li><a href="https://www.couchbase.com/resources/events">Events</a></li>
          <li><a href="https://www.couchbase.com/contact">Contact Us</a></li>
          <li><a href="https://www.couchbase.com/request-pricing">Pricing</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Support</span></li>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://www.couchbase.com/services">Professional Services</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support Login</a></li>
          <li><a href="https://learn.couchbase.com/store" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Quicklinks</span></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Online Training</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
          <li><a href="https://www.couchbase.com/nosql-resources/why-nosql">Why NoSQL</a></li>
          <li><a href="https://www.couchbase.com/resources/security">Security</a></li>
          <li><a href="https://www.couchbase.com/resources/gdpr">GDPR</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://plus.google.com/+CouchbaseServer" class="icon">
              <svg width="50px" height="50px" viewBox="36.72 225.573 542.326 343.67"><path d="m209.02 363.05v68.732h93.212c-15.065 44.252-37.662 68.732-93.212 68.732-56.492 0-100.74-46.135-100.74-102.63s44.252-102.63 100.74-102.63c30.129 0 48.96 10.357 66.849 25.422 14.123-14.123 13.182-16.006 48.96-49.902-31.071-28.246-71.557-45.194-115.81-45.194-95.096-0.94-172.3 76.266-172.3 171.36s77.206 172.3 172.3 172.3c142.17 0 177.01-124.28 165.71-206.2-33.896-1e-3 -165.71-1e-3 -165.71-1e-3zm310.71 3.766v-59.317h-42.369v59.317h-61.2v42.369h61.2v61.2h42.369v-61.2h59.317v-42.369h-59.317z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2018 COUCHBASE All rights reserved.</span>
      <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
      <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
      <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
      <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
