<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>Appendix 3: Variable Bindings and Name Resolution | Couchbase Docs (Preview)</title>
<link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-11527/server/current/analytics/appendix_3_resolution.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="A description of variable bindings and name resolution.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/analytics/appendix_3_resolution.html">
<meta name="page-nav-header-levels" content="0">
<meta name="generator" content="Antora 3.1.4">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://simon-dew.github.io/docs-site/DOC-11527/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://simon-dew.github.io/docs-site/DOC-11527/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="https://github.com/simon-dew/docs-analytics/edit/release/7.2/modules/analytics/pages/appendix_3_resolution.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Develop</li>
<li class="crumb">Analytics</li>
<li class="crumb">SQL++ for Analytics Language Reference</li>
<li class="crumb"><a href="appendix_3_resolution.html">Appendix 3: Variable Bindings and Name Resolution</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Appendix 3: Variable Bindings and Name Resolution</h1>
<div class="labels">
<ul></ul>
</div>
<div class="labels">
<ul>
<li class="edition"><a href="https://www.couchbase.com/products/editions">Enterprise Edition</a></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this Appendix, we&#8217;ll look at how variables are bound and how names are resolved.
Names can appear in every clause of a query.
Sometimes a name consists of just a single identifier, e.g., <code>region</code> or <code>revenue</code>.
More often a name will consist of two identifiers separated by a dot, e.g., <code>customer.address</code>.
Occasionally a name may have more than two identifiers, e.g., <code>policy.owner.address.zipcode</code>.
<em>Resolving</em> a name means determining exactly what the (possibly multi-part) name refers to.
It is necessary to have well-defined rules for how to resolve a name in cases of ambiguity.
(In the absence of schemas, such cases arise more commonly, and also differently, than they do in SQL.)</p>
</div>
<div class="paragraph">
<p>The basic job of each clause in a query block is to bind variables.
Each clause sees the variables bound by previous clauses and may bind additional variables.
Names are always resolved with respect to the variables that are bound ("in scope") at the place where the name use in question occurs.
It is possible that the name resolution process will fail, which may lead to an empty result or an error message.</p>
</div>
<div class="paragraph">
<p>One important bit of background: When the system is reading a query and resolving its names, it has a list of all the available dataverses and datasets.
As a result, it knows whether <code>a.b</code> is a valid name for dataset <code>b</code> in dataverse <code>a</code>.
However, the system does not in general have knowledge of the schemas of the data inside the datasets; remember that this is a much more open world.
As a result, in general the system cannot know whether any object in a particular dataset will have a field named <code>c</code>.
These assumptions affect how errors are handled.
If you try to access dataset <code>a.b</code> and no dataset by that name exists, you will get an error and your query will not run.
However, if you try to access a field <code>c</code> in a collection of objects, your query will run and return <code>missing</code> for each object that doesn&#8217;t have a field named <code>c</code> - this is because it&#8217;s possible that some object (someday) could have such a field.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Binding_variables"><a class="anchor" href="#Binding_variables"></a>Binding Variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Variables can be bound in the following ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>WITH</code> and <code>LET</code> clauses bind a variable to the result of an expression in a straightforward way</p>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="paragraph">
<p><code>WITH cheap_parts AS (SELECT partno FROM parts WHERE price &lt; 100)</code>
binds the variable <code>cheap_parts</code> to the result of the subquery.</p>
</div>
<div class="paragraph">
<p><code>LET pay = salary + bonus</code>
binds the variable <code>pay</code> to the result of evaluating the expression <code>salary + bonus</code>.</p>
</div>
</li>
<li>
<p><code>FROM</code>, <code>GROUP BY</code>, and <code>SELECT</code> clauses have optional <code>AS</code> subclauses that contain an expression and a name (called an <em>iteration variable</em> in a <code>FROM</code> clause, or an alias in <code>GROUP BY</code> or <code>SELECT</code>).</p>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="paragraph">
<p><code>FROM customer AS c, order AS o</code></p>
</div>
<div class="paragraph">
<p><code>GROUP BY salary + bonus AS total_pay</code></p>
</div>
<div class="paragraph">
<p><code>SELECT MAX(price) AS highest_price</code></p>
</div>
<div class="paragraph">
<p>An <code>AS</code> subclause always binds the name (as a variable) to the result of the expression (or, in the case of a <code>FROM</code> clause, to the <em>individual members</em> of the collection identified by the expression).</p>
</div>
<div class="paragraph">
<p>It&#8217;s always a good practice to use the keyword <code>AS</code> when defining an alias or iteration variable.
However, as in SQL, the syntax allows the keyword <code>AS</code> to be omitted.
For example, the <code>FROM</code> clause above could have been written like this:</p>
</div>
<div class="paragraph">
<p><code>FROM customer c, order o</code></p>
</div>
<div class="paragraph">
<p>Omitting the keyword <code>AS</code> does not affect the binding of variables.
The FROM clause in this example binds variables c and o whether the keyword AS is used or not.</p>
</div>
<div class="paragraph">
<p>In certain cases, a variable is automatically bound even if no alias or variable-name is specified.
Whenever an expression could have been followed by an AS subclause, if the expression consists of a simple name or a path expression, that expression binds a variable whose name is the same as the simple name or the last step in the path expression.
Here are some examples:</p>
</div>
<div class="paragraph">
<p><code>FROM customer, order</code> binds iteration variables named <code>customer</code> and <code>order</code></p>
</div>
<div class="paragraph">
<p><code>GROUP BY address.zipcode</code> binds a variable named <code>zipcode</code></p>
</div>
<div class="paragraph">
<p><code>SELECT item[0].price</code> binds a variable named <code>price</code></p>
</div>
<div class="paragraph">
<p>Note that a <code>FROM</code> clause iterates over a collection (usually a dataset), binding a variable to each member of the collection in turn.
The name of the collection remains in scope, but it is not a variable.
For example, consider this <code>FROM</code> clause used in a self-join:</p>
</div>
<div class="paragraph">
<p><code>FROM customer AS c1, customer AS c2</code></p>
</div>
<div class="paragraph">
<p>This <code>FROM</code> clause joins the customer dataset to itself, binding the iteration variables <code>c1</code> and <code>c2</code> to objects in the left-hand-side and right-hand-side of the join, respectively.
After the <code>FROM</code> clause, <code>c1</code> and <code>c2</code> are in scope as variables, and customer remains accessible as a dataset name but not as a variable.</p>
</div>
</li>
<li>
<p>Special rules for <code>GROUP BY</code>:</p>
<div class="ulist">
<ul>
<li>
<p>(3A): If a <code>GROUP BY</code> clause specifies an expression that has no explicit alias, it binds a pseudo-variable that is lexicographically identical to the expression itself.
For example:</p>
<div class="paragraph">
<p><code>GROUP BY salary + bonus</code> binds a pseudo-variable named <code>salary + bonus</code>.</p>
</div>
<div class="paragraph">
<p>This rule allows subsequent clauses to refer to the grouping expression (salary + bonus) even though its constituent variables (salary and bonus) are no longer in scope.
  For example, the following query is valid:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM employee
GROUP BY salary + bonus
HAVING salary + bonus &gt; 1000
SELECT salary + bonus, COUNT(*) AS how_many</pre>
</div>
</div>
<div class="paragraph">
<p>While it might have been more elegant to explicitly require an alias in cases like this, the pseudo-variable rule is retained for SQL compatibility.
  Note that the expression <code>salary + bonus</code> is not <em>actually</em> evaluated in the <code>HAVING</code> and <code>SELECT</code> clauses (and could not be since <code>salary</code> and <code>bonus</code> are no longer individually in scope).
  Instead, the expression <code>salary + bonus</code> is treated as a reference to the pseudo-variable defined in the <code>GROUP BY</code> clause.</p>
</div>
</li>
<li>
<p>(3B): The <code>GROUP BY</code> clause may be followed by a <code>GROUP AS</code> clause that binds a variable to the group.
The purpose of this variable is to make the individual objects inside the group visible to subqueries that may need to iterate over them.</p>
<div class="paragraph">
<p>The <code>GROUP AS</code> variable is bound to a multiset of objects.
  Each object represents one of the members of the group.
  Since the group may have been formed from a join, each of the member-objects contains a nested object for each variable bound by the nearest <code>FROM</code> clause (and its <code>LET</code> subclause, if any).
  These nested objects, in turn, contain the actual fields of the group-member.
  To understand this process, consider the following query fragment:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM parts AS p, suppliers AS s
WHERE p.suppno = s.suppno
GROUP BY p.color GROUP AS g</pre>
</div>
</div>
<div class="paragraph">
<p>Suppose that the objects in <code>parts</code> have fields <code>partno</code>, <code>color</code>, and <code>suppno</code>.
  Suppose that the objects in suppliers have fields <code>suppno</code> and <code>location</code>.</p>
</div>
<div class="paragraph">
<p>Then, for each group formed by the <code>GROUP BY</code>, the variable g will be bound to a multiset with the following structure:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[ { "p": { "partno": "p1", "color": "red", "suppno": "s1" },
    "s": { "suppno": "s1", "location": "Denver" } },
  { "p": { "partno": "p2", "color": "red", "suppno": "s2" },
    "s": { "suppno": "s2", "location": "Atlanta" } },
  ...
]</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Scoping"><a class="anchor" href="#Scoping"></a>Scoping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In general, the variables that are in scope at a particular position are those variables that were bound earlier in the current query block, in outer (enclosing) query blocks, or in a <code>WITH</code> clause at the beginning of the query.
More specific rules follow.</p>
</div>
<div class="paragraph">
<p>The clauses in a query block are conceptually processed in the following order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FROM</code> (followed by LET subclause, if any)</p>
</li>
<li>
<p><code>WHERE</code></p>
</li>
<li>
<p><code>GROUP BY</code> (followed by LET subclause, if any)</p>
</li>
<li>
<p><code>HAVING</code></p>
</li>
<li>
<p><code>SELECT</code> or <code>SELECT VALUE</code></p>
</li>
<li>
<p><code>ORDER BY</code></p>
</li>
<li>
<p><code>OFFSET</code></p>
</li>
<li>
<p><code>LIMIT</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>During processing of each clause, the variables that are in scope are those variables that are bound in the following places:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In earlier clauses of the same query block (as defined by the ordering given above).</p>
<div class="paragraph">
<p>Example: <code>FROM orders AS o SELECT o.date</code>
The variable <code>o</code> in the <code>SELECT</code> clause is bound, in turn, to each object in the dataset <code>orders</code>.</p>
</div>
</li>
<li>
<p>In outer query blocks in which the current query block is nested.
In case of duplication, the innermost binding wins.</p>
</li>
<li>
<p>In the <code>WITH</code> clause (if any) at the beginning of the query.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>However, in a query block where a <code>GROUP BY</code> clause is present:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In clauses processed before <code>GROUP BY</code>, scoping rules are the same as though no GROUP BY were present.</p>
</li>
<li>
<p>In clauses processed after <code>GROUP BY</code>, the variables bound in the nearest <code>FROM</code>-clause (and its <code>LET</code> subclause, if any) are removed from scope and replaced by the variables bound in the <code>GROUP BY</code> clause (and its <code>LET</code> subclause, if any).
However, this replacement does not apply inside the arguments of the five SQL special aggregating functions (<code>MIN</code>, <code>MAX</code>, <code>AVG</code>, <code>SUM</code>, and <code>COUNT</code>).
These functions still need to see the individual data items over which they are computing an aggregation.
For example, after <code>FROM employee AS e GROUP BY deptno</code>, it would not be valid to reference <code>e.salary</code>, but <code>AVG(e.salary)</code> would be valid.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Special case: In an expression inside a <code>FROM</code> clause, a variable is in scope if it was bound in an earlier expression in the same <code>FROM</code> clause.
Example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM orders AS o, o.items AS i</pre>
</div>
</div>
<div class="paragraph">
<p>The reason for this special case is to support iteration over nested collections.</p>
</div>
<div class="paragraph">
<p>Note that, since the <code>SELECT</code> clause comes <em>after</em> the <code>WHERE</code> and <code>GROUP BY</code> clauses in conceptual processing order, any variables defined in <code>SELECT</code> are not visible in <code>WHERE</code> or <code>GROUP BY</code>.
Therefore the following query will not return what might be the expected result (since in the WHERE clause, <code>pay</code> will be interpreted as a field in the <code>emp</code> object rather than as the computed value <code>salary + bonus</code>):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT name, salary + bonus AS pay
FROM emp
WHERE pay &gt; 1000
ORDER BY pay</pre>
</div>
</div>
<div class="paragraph">
<p>The likely intent of the query above can be accomplished as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM emp AS e
LET pay = e.salary + e.bonus
WHERE pay &gt; 1000
SELECT e.name, pay
ORDER BY pay</pre>
</div>
</div>
<div class="paragraph">
<p>Note that in the phrase <em>expr1</em> <code>JOIN</code> <em>expr2</em> <code>ON</code> <em>expr3</em>, variables defined in <em>expr1</em> are visible in <em>expr3</em> but not in <em>expr2</em>. Here&#8217;s an example that will not work:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM orders AS o JOIN o.items AS i ON 1 = 1</pre>
</div>
</div>
<div class="paragraph">
<p>The variable <code>o</code>, defined in the phrase before <code>JOIN</code>, cannot be used in the phrase immediately following <code>JOIN</code>. The probable intent of this example could be accomplished in either of the following ways:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM orders AS o UNNEST o.items AS i

FROM orders AS o, o.items AS i</pre>
</div>
</div>
<div class="paragraph">
<p>To summarize this rule: You may not use left-correlation in an explicit <code>JOIN</code> clause.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Resolving_names"><a class="anchor" href="#Resolving_names"></a>Resolving Names</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The process of name resolution begins with the leftmost identifier in the name.
The rules for resolving the leftmost identifier are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>In a <code>FROM</code> clause</em>: Names in a <code>FROM</code> clause identify the collections over which the query block will iterate.
These collections may be stored datasets, views, synonyms, or may be the results of nested query blocks.
A stored dataset may be in a named dataverse or in the default dataverse.
Thus, if the two-part name <code>a.b</code> is in a <code>FROM</code> clause, a might represent a dataverse and <code>b</code> might represent a dataset in that dataverse.
Another example of a two-part name in a <code>FROM</code> clause is <code>FROM orders AS o, o.items AS i</code>.
In <code>o.items</code>, <code>o</code> represents an order object bound earlier in the <code>FROM</code> clause, and items represents the items object inside that order.</p>
<div class="paragraph">
<p>The rules for resolving the leftmost identifier in a <code>FROM</code> clause (including a <code>JOIN</code> subclause), or in the expression following <code>IN</code> in a quantified predicate, are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(1A):  If the identifier matches a variable-name that is in scope, it resolves to the binding of that variable.
(Note that in the case of a subquery, an in-scope variable might have been bound in an outer query block; this is called a correlated subquery).</p>
</li>
<li>
<p>(1B):  Otherwise, if the identifier is the first part of a two-part name like <code>a.b</code>, the name is treated as <code>dataverse.dataset</code>.
If the identifier stands alone as a one-part name, it is treated as the name of a dataset in the default dataverse.
If the designated dataset exists then the identifier is resolved to that dataset,
othwerise if a view with given name exists then the identifier is resolved to that view,
otherwise if a synonym with given name exists then the identifier is resolved to the target dataset or the target view of that
synonym (potentially recursively if this synonym points to another synonym). An error will result if the designated
dataset, view, or a synonym with this name does not exist.</p>
<div class="paragraph">
<p>Datasets and views take precedence over synonyms, so if both a dataset (or a view) and a synonym have the same name then the
  resolution is to the dataset. Note that there cannot be a dataset and a view with the same name.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><em>Elsewhere in a query block</em>: In clauses other than <code>FROM</code>, a name typically identifies a field of some object.
For example, if the expression <code>a.b</code> is in a <code>SELECT</code> or <code>WHERE</code> clause, it&#8217;s likely that <code>a</code> represents an object and <code>b</code> represents a field in that object.</p>
<div class="paragraph">
<p>The rules for resolving the leftmost identifier in clauses other than the ones listed in Rule 1 are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(2A):  If the identifier matches a variable-name that is in scope, it resolves to the binding of that variable.
(In the case of a correlated subquery, the in-scope variable might have been bound in an outer query block).</p>
</li>
<li>
<p>(2B):  (The "Single Variable Rule"): Otherwise, if the <code>FROM</code> clause in the current query block binds exactly one variable, the identifier is treated as a field access on the object bound to that variable.
For example, in the query <code>FROM customer SELECT address</code>, the identifier address is treated as a field in the object bound to the variable <code>customer</code>.
At runtime, if the object bound to <code>customer</code> has no <code>address</code> field, the <code>address</code> expression will return <code>missing</code>.
If the <code>FROM</code> clause in the current query block binds multiple variables, name resolution fails with an "ambiguous name" error.
If there&#8217;s no <code>FROM</code> clause in the current query block, name resolution fails with an "undefined identifier" error.
Note that the Single Variable Rule searches for bound variables only in the current query block, not in outer (containing) blocks.
The purpose of this rule is to permit the compiler to resolve field-references unambiguously without relying on any schema information.
Also note that variables defined by <code>LET</code> clauses do not participate in the resolution process performed by this rule.</p>
<div class="paragraph">
<p>Exception: In a query that has a <code>GROUP BY</code> clause, the Single Variable Rule does not apply in any clauses that occur after the <code>GROUP BY</code> because, in these clauses, the variables bound by the <code>FROM</code> clause are no longer in scope.
  In clauses after <code>GROUP BY</code>, only Rule (2A) applies.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>In an <code>ORDER BY</code> clause following a <code>UNION ALL</code> expression:</p>
<div class="paragraph">
<p>The leftmost identifier is treated as a field-access on the objects that are generated by the <code>UNION ALL</code>.
For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>query-block-1
UNION ALL
query-block-2
ORDER BY salary</pre>
</div>
</div>
<div class="paragraph">
<p>In the result of this query, objects that have a foo field will be ordered by the value of this field; objects that have no foo field will appear at at the beginning of the query result (in ascending order) or at the end (in descending order.)</p>
</div>
</li>
<li>
<p><em>In a standalone expression</em>: If a query consists of a standalone expression then identifiers inside that
expression are resolved according to Rule 1.
For example, if the whole query is <code>ARRAY_COUNT(a.b)</code> then <code>a.b</code> will be treated as dataset <code>b</code> contained in
dataverse <code>a</code>.
Note that this rule only applies to identifiers which are located directly inside a standalone expression.
Identifiers inside <code>SELECT</code> statements in a standalone expression are still resolved according to Rules 1-3.
For example, if the whole query is <code>ARRAY_SUM( (FROM employee AS e SELECT VALUE salary) )</code> then <code>salary</code> is resolved
as <code>e.salary</code> following the "Single Variable Rule" (Rule (2B)).</p>
</li>
<li>
<p>Once the leftmost identifier has been resolved, the following dots and identifiers in the name (if any) are treated as a path expression that navigates to a field nested inside that object.
The name resolves to the field at the end of the path.
If this field does not exist, the value <code>missing</code> is returned.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Resolving_database_entities"><a class="anchor" href="#Resolving_database_entities"></a>Resolving Database Entities</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains how Couchbase Analytics resolves database entity references in the FROM clause&#8201;&#8212;&#8201;that is, when the first identifier is not a variable reference.
This explanation also applies to resolving database entity references in DDL statements.</p>
</div>
<div class="paragraph">
<p>A database entity reference (or <em>qualified name</em>) may consist of an optional Analytics scope name,
and the database entity&#8217;s local name, separated by a dot.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Analytics scope name may consist of one or two identifiers, separated by a dot.</p>
</li>
<li>
<p>The local name consists of a single identifier.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Analytics uses the following three resources to resolve database entity references:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(Optional) The preceding USE statement.</p>
</li>
<li>
<p>(Optional) The <code>query_context</code> parameter.</p>
</li>
<li>
<p>The database entity reference provided in the query.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="Use_statement"><a class="anchor" href="#Use_statement"></a>The USE Statement</h3>
<div class="paragraph">
<p>The USE statement enables you to specify the Analytics scope for the statement immediately following.</p>
</div>
<div class="paragraph">
<p>For more details, refer to <a href="#5_dll.adoc#Use_statements" class="xref unresolved">Use Statements</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Query_context"><a class="anchor" href="#Query_context"></a>The Query Context Parameter</h3>
<div class="paragraph">
<p>The <code>query_context</code> parameter enables you to specify the Analytics scope for a statement.
You can set the <code>query_context</code> parameter using the <a href="run-query.html#Using_command_line" class="xref page">cbq shell</a>
or the <a href="rest-service.html" class="xref page">Analytics Service REST API</a>.</p>
</div>
<div class="paragraph">
<p>The value of the <code>query_context</code> parameter must start with <code>default:</code>,
followed by an Analytics scope name.
The <code>default:</code> prefix is a dummy and is ignored when resolving a collection name or synonym name.
The default value of the <code>query_context</code> parameter is <code>default:Default</code>, meaning the <code>Default</code> Analytics scope.</p>
</div>
<div class="paragraph">
<p>For more details, refer to <a href="query-params.html" class="xref page">Analytics Query Parameters</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also set the query context in the Analytics workbench using the query context drop-down menu.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Database_entity_reference"><a class="anchor" href="#Database_entity_reference"></a>The Database Entity Reference</h3>
<div class="paragraph">
<p>The database entity reference is resolved according to the following rules:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the database entity reference contains multiple identifiers,
all identifiers except the last are assumed to refer to the Analytics scope,
and the last identifier is assumed to be the database entity&#8217;s local name.
Analytics attempts to find the database entity using the specified scope and local name.
If the database entity is not found, an error is generated.</p>
</li>
<li>
<p>If the database entity reference only contains one identifier,
this is assumed to be the database entity&#8217;s local name.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the USE statement has been used to specify an Analytics scope,
Analytics attempts to find the database entity using the scope provided by the USE statement
and the specified local name.</p>
</li>
<li>
<p>Otherwise, if the <code>query_context</code> parameter has been set,
Analytics attempts to find the database entity using the scope provided by the query context
and the specified local name.</p>
</li>
<li>
<p>Otherwise, Analytics attempts to find the database entity using the <code>Default</code> Analytics scope
and the specified local name.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the database entity is not found, an error is generated.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the database entity is an Analytics synonym, the synonym is then resolved to find the Analytics collection.</p>
</div>
</div>
<div class="sect2">
<h3 id="Default_scope_collection"><a class="anchor" href="#Default_scope_collection"></a>Default Scopes and Collections</h3>
<div class="paragraph">
<p>In the Data service, each bucket may contain a default scope called <code>_default</code>,
which in turn may contain a default collection also called <code>_default</code>.
The Query service enables you to refer to the default scope within the default collection using just the bucket name.
However, Analytics does not support this type of reference.</p>
</div>
<div class="paragraph">
<p>To simulate this behavior in Analytics,
you can create an Analytics synonym in the <code>Default</code> scope whose name represents the bucket name.
So for example, you could create an Analytics synonym <code>travel-sample</code> in the <code>Default</code> Analytics scope,
which points to the <code>_default</code> Analytics collection in the <code>`travel-sample`._default</code> Analytics scope.
This is the approach taken by the ALTER COLLECTION statement.</p>
</div>
<div class="paragraph">
<p>Unlike the Query service,  Analytics does not enable you to resolve individual missing elements
in the middle of a database entity reference.
For example, you cannot use <code>analytics..customers</code> to refer to the the <code>customers</code> Analytics collection in the
<code>`analytics`._default</code> Analytics scope.</p>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
