<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>Analytics Views | Couchbase Docs (Preview)</title>
<link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-11527/server/current/analytics/5a_views.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="A description of Analytics views and Tabular Analytics views.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/analytics/5a_views.html">
<meta name="page-nav-header-levels" content="0">
<meta name="generator" content="Antora 3.1.4">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://simon-dew.github.io/docs-site/DOC-11527/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://simon-dew.github.io/docs-site/DOC-11527/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="https://github.com/simon-dew/docs-analytics/edit/release/7.2/modules/analytics/pages/5a_views.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Develop</li>
<li class="crumb">Analytics</li>
<li class="crumb">SQL++ for Analytics Language Reference</li>
<li class="crumb"><a href="5a_views.html">Analytics Views</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Analytics Views</h1>
<div class="labels">
<ul></ul>
</div>
<div class="labels">
<ul>
<li class="edition"><a href="https://www.couchbase.com/products/editions">Enterprise Edition</a></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Analytics views are virtual Analytics collections that are derived from actual stored Analytics collections.
Analytics views might be used to present a subset of the stored data, or to present a join or other transformation of
stored data for some particular purpose.
Queries may operate on Analytics views in exactly the same way as they do on real stored data&#8201;&#8212;&#8201;in fact, a query
might refer to both a stored Analytics collection and an Analytics view, perhaps joining them together.
Analytics views are not materialized.
When a query refers to an Analytics view, the definition of the view is merged with the query to produce the desired
result.</p>
</div>
<div class="paragraph">
<p>Most of the examples in this section assume that you are using an Analytics scope called <code>Commerce</code>.
Refer to <a href="appendix_4_examples.html" class="xref page">Appendix 4: Example Data</a> to install this example data.</p>
</div>
<div class="paragraph">
<p>You can use the <a href="5_ddl.html#Use_statements" class="xref page">USE statement</a>
to set the default scope for the statement immediately following.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre>USE Commerce;</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, use the <strong>query context</strong> drop-down list at the top right of the Query Editor to select <code>Commerce</code> as
the default scope for the following examples.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/workbench-context-set.png" alt="The query context drop-down menu with 'Commerce' selected">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-an-analytics-view"><a class="anchor" href="#creating-an-analytics-view"></a>Creating an Analytics View</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An Analytics view is created by a CREATE statement with the following syntax:</p>
</div>
<h5 id="createview" class="discrete">CreateView</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/CreateView.png" alt="&quot;CREATE&quot; (&quot;OR&quot; &quot;REPLACE&quot;)? &quot;ANALYTICS&quot; &quot;VIEW&quot; ViewName (&quot;IF&quot; &quot;NOT&quot; &quot;EXISTS&quot;)? &quot;AS&quot; ViewDefn">
</div>
</div>
<h5 id="viewname" class="discrete">ViewName</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/ViewName.png" alt="QualifiedName">
</div>
</div>
<h5 id="viewdefn" class="discrete">ViewDefn</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/ViewDefn.png" alt="QualifiedName &vert; Selection">
</div>
</div>
<div class="paragraph">
<p>The CREATE ANALYTICS VIEW statement simply specifies the name of the view (<code>QualifiedName</code>) and the definition of the
view.
The view definition may be the <code>QualifiedName</code> of an Analytics collection or another Analytics view, or (more likely)
it may be a query that defines the content of the view.
The view-defining query must conform to the syntax of a <code>Selection</code>&#8201;&#8212;&#8201;in other words, it is a query that may
include optional features such as WITH, UNION, and SELECT VALUE.</p>
</div>
<div class="paragraph">
<p>The <code>QualifiedName</code> of the view to be created consists of an optional Analytics scope name followed by an identifier.
If the <code>QualifiedName</code> contains a scope name, the view is created within the specified Analytics scope.
Otherwise, the view is created in the scope defined by the immediately preceding USE statement, or the scope defined by
the <code>query_context</code> parameter, or the <code>Default</code> Analytics scope, according to the rules for <a href="appendix_3_resolution.html#Resolving_database_entities" class="xref page">Resolving Database Entities</a>.</p>
</div>
<div class="paragraph">
<p>The scope where the view is created becomes the default scope for resolving names in the <code>ViewDefn</code> expression or query
(the "body" of the view definition).</p>
</div>
<div class="paragraph">
<p>Analytics views share the same namespace as Analytics collections.
This means that a view cannot be created with the same name as another view or collection in the same Analytics scope.
However, views and collections do not share the same namespace as synonyms; a synonym can coexist with a view or
collection with the same name in the same Analytics scope.
In this case, the view or collection takes precedence over the synonym.</p>
</div>
<div class="paragraph">
<p>The OR REPLACE and IF NOT EXISTS clauses specify the action to take if an Analytics view already exists with the
specified name, as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If neither OR REPLACE nor IF NOT EXISTS is specified, an error is raised.</p>
</li>
<li>
<p>If only OR REPLACE is specified, the existing view definition is replaced with the new one.</p>
</li>
<li>
<p>If only IF NOT EXISTS is specified, the statement is ignored and the existing view definition is retained.</p>
</li>
<li>
<p>If both of these clauses are specified, an error is raised because the clauses contradict each other.</p>
</li>
</ul>
</div>
<h5 id="examples" class="discrete">Examples</h5>
<div class="paragraph">
<p>The examples shown here are based on the Commerce data in <a href="appendix_4_examples.html" class="xref page">Appendix 4: Example Data</a>.</p>
</div>
<div class="paragraph">
<p>The following Analytics view operates on the <code>customers</code> Analytics collection, showing the <code>custid</code>, <code>name</code>, and
<code>rating</code> of each customer whose rating is greater than 700, omitting the customer&#8217;s address.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CREATE ANALYTICS VIEW good_customers AS
    SELECT custid, name, rating
    FROM customers
    WHERE rating &gt; 700;</pre>
</div>
</div>
<div class="paragraph">
<p>The following Analytics view unnests ("flattens") the items in each order and aggregates them to compute the total
revenue for each order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CREATE ANALYTICS VIEW orders_summary AS
   SELECT o.orderno, o.order_date, o.custid, sum(i.qty * i.price) AS revenue
   FROM orders AS o UNNEST o.items AS i
   GROUP BY o.orderno, o.order_date, o.custid;</pre>
</div>
</div>
<div class="paragraph">
<p>The Analytics view in the previous example might be used in the following query, which lists orders in the year 2020
that had more than 1000 in total revenue, in descending order by revenue.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT s.orderno, s.order_date, s.revenue
FROM orders_summary AS s
WHERE date_part_str(s.order_date, "year") = 2020
AND s.revenue &gt; 1000
ORDER BY revenue DESC;</pre>
</div>
</div>
<div class="paragraph">
<p>Metadata for Analytics views can be found in the <code>Metadata.`Dataset`</code> collection, identified by
<code>DatasetType = "VIEW"</code>.
Analytics views and Analytics tabular views are also displayed in the insights sidebar to the right of the Analytics Workbench.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tabular-analytics-views"><a class="anchor" href="#tabular-analytics-views"></a>Tabular Analytics Views</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Tabular Analytics view (abbreviated here as TAV) is a special kind of Analytics view that enables Couchbase Analytics
to interact with software tools that are designed for relational databases.
A TAV always presents data in the form of a table with uniform rows and columns and with a well-defined schema.
Like any Analytics view, a TAV can be queried by an ordinary SQL++ for Analytics query.
But, because its data is presented in the form of tables, a TAV is also accessible to relational tools.</p>
</div>
<div class="paragraph">
<p>Currently, Couchbase Analytics provides a <a href="../../../tableau-connector/current/index.html" class="xref page">Connector for the Tableau tool</a>
that is used to visualize relational data.
The Connector enables Tableau to execute SQL queries against TAVs.
In the future, additional Connectors may be provided to make TAVs accessible to other relational tools.</p>
</div>
<div class="paragraph">
<p>A TAV is created by a CREATE ANALYTICS VIEW statement with certain additional clauses, using the following syntax:</p>
</div>
<h5 id="createtabularview" class="discrete">CreateTabularView</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/CreateTabularView.png" alt="&quot;CREATE&quot; (&quot;OR&quot; &quot;REPLACE&quot;)? &quot;ANALYTICS&quot; &quot;VIEW&quot; ViewName &quot;(&quot; ViewSchema &quot;)&quot;&quot;( &quot;IF&quot; &quot;NOT&quot; &quot;EXISTS&quot;)? &quot;DEFAULT&quot; &quot;NULL&quot; (DateTimeFormatSpecification)? (PrimaryKeyDefn)? (ForeignKeyDefn)? &quot;AS&quot; ViewDefn">
</div>
</div>
<h5 id="viewschema" class="discrete">ViewSchema</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/ViewSchema.png" alt="ColumnName ViewTypeRef (&quot;NOT&quot; &quot;UNKNOWN&quot;)? ( &quot;,&quot; ColumnName ViewTypeRef (&quot;NOT&quot; &quot;UNKNOWN&quot;)? )*">
</div>
</div>
<h5 id="columnname" class="discrete">ColumnName</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/ColumnName.png" alt="Identifier">
</div>
</div>
<h5 id="viewtyperef" class="discrete">ViewTypeRef</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/ViewTypeRef.png" alt="&quot;BOOLEAN&quot; &vert; &quot;BIGINT&quot; &vert; &quot;INT&quot; &vert; &quot;DOUBLE&quot; &vert; &quot;STRING&quot; &vert; &quot;DATE&quot; &vert; &quot;TIME&quot; &vert; &quot;DATETIME&quot;">
</div>
</div>
<h5 id="datetimeformatspec" class="discrete">DateTimeFormatSpec</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/DateTimeFormatSpec.png" alt="(&quot;DATE&quot; StringLiteral)? (&quot;TIME&quot; StringLiteral)? (&quot;DATETIME&quot; StringLiteral)?">
</div>
</div>
<h5 id="primarykeydefn" class="discrete">PrimaryKeyDefn</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/PrimaryKeyDefn.png" alt="&quot;PRIMARY&quot; &quot;KEY&quot; &quot;(&quot; ColumnName ( &quot;,&quot; ColumnName )* &quot;)&quot; &quot;NOT&quot; &quot;ENFORCED&quot;">
</div>
</div>
<h5 id="foreignkeydefn" class="discrete">ForeignKeyDefn</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/ForeignKeyDefn.png" alt="&quot;FOREIGN&quot; &quot;KEY&quot; &quot;(&quot; ColumnName ( &quot;,&quot; ColumnName )* &quot;)&quot; &quot;REFERENCES&quot; QualifiedName &quot;NOT&quot; &quot;ENFORCED&quot;">
</div>
</div>
<div class="paragraph">
<p>The clauses that are in common with an ordinary CREATE ANALYTICS VIEW statement are handled in the usual way.
The additional clauses are handled as follows.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>ViewSchema</strong></dt>
<dd>
<p>This clause identifies the view as a TAV and specifies the column names of the resulting table and their datatypes.
The following datatypes are supported in TAVs:</p>
<div class="paragraph">
<p><code>BOOLEAN</code><br>
<code>STRING</code><br>
<code>BIGINT</code> (synonym <code>INT</code>)<br>
<code>DOUBLE</code><br>
<code>DATE</code> (includes date only, no timezone)<br>
<code>TIME</code> (includes time only, no timezone)<br>
<code>DATETIME</code> (includes date and time, no timezone)</p>
</div>
<div class="paragraph">
<p>The data values returned by the view definition query are cast into the datatypes specified in the <code>ViewSchema</code>.
Whenever this casting process fails, a NULL value is returned and a warning is raised.
However, columns that are designated NOT UNKNOWN in the <code>ViewSchema</code> may not contain NULL or MISSING values.
Any row in which a NULL or MISSING value would appear in a NOT UNKNOWN column is excluded from the view.</p>
</div>
<div class="paragraph">
<p>Columns that are included in the PRIMARY KEY clause are automatically treated as NOT UNKNOWN columns.</p>
</div>
</dd>
<dt class="hdlist1"><strong>DEFAULT NULL</strong></dt>
<dd>
<p>This required clause documents the fact that missing data values are replaced by NULL, unless NOT UNKNOWN is specified.
This convention is required because relational databases use NULL to represent missing values.</p>
</dd>
<dt class="hdlist1"><strong>DateTimeFormatSpec</strong></dt>
<dd>
<p>This clause specifies the format in which values are represented in columns of type DATE, TIME, and/or DATETIME.
Permissible formats, based on the ISO 8601 Standard, are described in
<a href="../n1ql/n1ql-language-reference/datefun.html#date-formats" class="xref page">Temporal Formats</a>.
If no explicit formats are specified, the default formats are as follows:</p>
<div class="paragraph">
<p>For DATE columns: <code>"YYYY-MM-DD"</code><br>
For TIME columns: <code>"hh:mm:ss.s"</code><br>
For DATETIME columns: <code>"YYYY-MM-DDThh:mm:ss.s"</code></p>
</div>
<div class="paragraph">
<p>Timezones appearing in TIME or DATETIME values are ignored.</p>
</div>
</dd>
<dt class="hdlist1"><strong>PRIMARY KEY</strong> and <strong>FOREIGN KEY</strong></dt>
<dd>
<p>These optional clauses allow the view definer to specify which columns in the TAV serve as primary or foreign keys.
This information can be accessed and exploited by tools like the Tableau Connector.
However, the primary and foreign key relationships are not enforced by Couchbase Analytics.
The clause NOT ENFORCED is required in primary and foreign key specifications.
The <code>QualifiedName</code> following REFERENCES in a FOREIGN KEY clause must be the name of a TAV.
Self-references are allowed&#8201;&#8212;&#8201;for example, the <code>manager</code> field in an <code>employee</code> view might be a foreign key
referencing another row in the <code>employee</code> view.</p>
</dd>
<dt class="hdlist1"><strong>ViewDefn</strong></dt>
<dd>
<p>The view definition body (usually a query) is handled in the same way as in an ordinary CREATE ANALYTICS VIEW
statement.
However, the view definition must generate tabular data with column names that match the column names in the
<code>ViewSchema</code>, and the values in these columns must be castable into the types specified in the <code>ViewSchema</code>.
(If the casting process fails, a NULL value is returned, or the row is excluded if NOT UNKNOWN is specified.)
The correspondence between the column names in the <code>ViewSchema</code> and the column names generated by the <code>ViewDefn</code> is
based on name-matching, not on relative position.
In other words, each column in the <code>ViewSchema</code> must have a column in the <code>ViewDefn</code> with the same name and a
compatible (castable) type, but the columns need not be in the same order.</p>
</dd>
</dl>
</div>
<h5 id="examples-2" class="discrete">Examples</h5>
<div class="paragraph">
<p>The simplest form of a TAV simply makes an existing Analytics collection available to be queried by relational tools.
This is possible if the existing collection already has a tabular form&#8201;&#8212;&#8201;that is, it consists of an array of
objects with no nested arrays or nested objects.</p>
</div>
<div class="paragraph">
<p>Suppose that an Analytics collection named <code>staff</code> contains the following data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  { "empno": 105, "name": "B. Happy", "hiredate": "03/15/2021"},
  { "empno": 107, "name": "Y. Knott", "hiredate": "06/30/2021"}
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This collection could be made available to SQL queries by creating the following TAV.
In this view definition, the <code>DATE</code> clause is necessary because dates are stored in the nonstandard format <code>MM/DD/YYYY</code>
instead of the standard ISO 8601 format.
Note how the view definition provides the schema information that is expected by relational tools.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CREATE OR REPLACE ANALYTICS VIEW staff_table (
   empno BIGINT,
   name STRING,
   hiredate DATE
)
DEFAULT NULL
DATE "MM/DD/YYYY"
AS staff;</pre>
</div>
</div>
<div class="paragraph">
<p>Data that includes nested objects can be made accessible to relational tools by TAVs that convert the nested data into
tabular form, using a process called <em>normalization</em>.
The following examples illustrate normalization techniques, using the Commerce data in
<a href="appendix_4_examples.html" class="xref page">Appendix 4: Example Data</a>.</p>
</div>
<div class="paragraph">
<p>If each object in a collection directly contains a nested object, that nested object can easily be "flattened", as
illustrated in the definition of <code>customers_view</code>, which flattens the <code>address</code> object into three fields named
<code>addr_street</code>, <code>addr_city</code>, and <code>addr_zipcode</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CREATE OR REPLACE ANALYTICS VIEW customers_view (
   custid STRING, name STRING, rating BIGINT,
   adr_street STRING, adr_city STRING, adr_zipcode STRING)
DEFAULT NULL
PRIMARY KEY (custid) NOT ENFORCED
AS
   SELECT custid, name, rating, address.street AS adr_street,
      address.city AS adr_city, address.zipcode AS adr_zipcode
   FROM customers;</pre>
</div>
</div>
<div class="paragraph">
<p>If each object in a collection contains a nested array of objects, the nested array can be removed from the main view
table and put into a side view table that is linked to the main table by a foreign key.
This technique&#8201;&#8212;&#8201;common in traditional relational schema design&#8201;&#8212;&#8201;is illustrated by the following view
definitions in which the <code>items</code> array is moved from <code>orders</code> into a separate table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CREATE OR REPLACE ANALYTICS VIEW orders_view (
   orderno BIGINT, custid STRING, order_date DATE, ship_date DATE)
DEFAULT NULL
PRIMARY KEY (orderno) NOT ENFORCED
FOREIGN KEY (custid) REFERENCES customers_view NOT ENFORCED
AS
  SELECT orderno, custid, order_date, ship_date
  FROM orders;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>CREATE OR REPLACE ANALYTICS VIEW items_view (
   orderno BIGINT, itemno BIGINT, qty BIGINT, price DOUBLE)
DEFAULT NULL
PRIMARY KEY (orderno, itemno) NOT ENFORCED
FOREIGN KEY (orderno) REFERENCES orders_view NOT ENFORCED
AS
  SELECT o.orderno, i.itemno, i.qty, i.price
  FROM orders AS o UNNEST o.items AS i;</pre>
</div>
</div>
<div class="paragraph">
<p>The resulting normalized tabular view schema can then be used by Tableau as if it were stored relational data.
This includes, of course, the possibility of referencing TAVs in queries produced by user actions in Tableau.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-indexes-with-analytics-views"><a class="anchor" href="#using-indexes-with-analytics-views"></a>Using Indexes with Analytics Views</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Indexes can be used to improve performance of queries on Analytics views, including TAVs.
The index must be created on the underlying Analytics collection rather than on the view itself.
More details about the creation and use of indexes in Analytics can be found in
<a href="7_using_index.html" class="xref page">Using Indexes</a>.</p>
</div>
<div class="paragraph">
<p>When creating an index to support a TAV, an additional CAST clause should be specified in the CREATE INDEX statement.
This clause specifies that data values are to be cast into the specified type before indexing them, and that, if the
cast fails, the data value is indexed as NULL.
The CAST clause may also specify the format in which a DATE, TIME, or TIMESTAMP is represented if it is other than the
standard ISO 8601.</p>
</div>
<h5 id="indexcastdefault" class="discrete">IndexCastDefault</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/IndexCastDefault.png" alt="&quot;CAST&quot; &quot;(&quot; &quot;DEFAULT&quot; &quot;NULL&quot; DateTimeFormatSpecification? &quot;)&quot;">
</div>
</div>
<h5 id="examples-3" class="discrete">Examples</h5>
<div class="paragraph">
<p>The <code>orders_summary</code> Analytics view, defined above, is based on the <code>orders</code> collection and contains a <code>custid</code> field.
The following statement creates an index on the <code>custid</code> field of the underlying collection.
This index might improve performance of queries that search for the orders of a particular customer, either through the
<code>orders</code> table or through the <code>orders_summary</code> view.
This example does not require a CAST clause because <code>orders_summary</code> is not a Tabular Analytics view (TAV).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CREATE INDEX idx1 ON orders(custid:STRING);</pre>
</div>
</div>
<div class="paragraph">
<p>The index created in the following example might improve the performance of queries against either the <code>staff</code>
collection or the Tabular Analytics view named <code>staff_table</code> (defined above), when searching for staff members hired on
a particular date.
The <code>DATE</code> clause in this statement is needed because <code>hiredate</code> values are stored in a nonstandard format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CREATE INDEX idx2 ON staff(hiredate:DATE) CAST(DEFAULT NULL DATE "MM/DD/YYYY");</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dropping-an-analytics-view"><a class="anchor" href="#dropping-an-analytics-view"></a>Dropping an Analytics View</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Any Analytics view (including a TAV) can be dropped using the following statement:</p>
</div>
<h5 id="dropview" class="discrete">DropView</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/DropView.png" alt="&quot;DROP&quot; &quot;ANALYTICS&quot; &quot;VIEW&quot; QualifiedName (&quot;IF&quot; &quot;EXISTS&quot;)?">
</div>
</div>
<div class="paragraph">
<p>The <code>QualifiedName</code> identifies the Analytics view to be dropped.</p>
</div>
<div class="paragraph">
<p>The target scope (Analytics scope containing the view to be dropped) is identified as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The scope specified in the <code>QualifiedName</code>, if any;</p>
</li>
<li>
<p>The scope named in the immediately preceding USE statement, if any;</p>
</li>
<li>
<p>The scope defined by the <code>query_context</code> parameter, or the <code>Default</code> Analytics scope, according to the rules for
<a href="appendix_3_resolution.html#Resolving_database_entities" class="xref page">Resolving Database Entities</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the target scope does not exist, the DROP statement fails.</p>
</div>
<div class="paragraph">
<p>If the target scope exists but does not contain a view with the specified name, the DROP statement fails unless IF
EXISTS is specified.</p>
</div>
<div class="paragraph">
<p>If an Analytics collection with the same name exists in the target scope, the DROP statement fails.</p>
</div>
<div class="paragraph">
<p>If an existing view or user-defined function depends on the view to be dropped, the DROP statement fails.</p>
</div>
<div class="paragraph">
<p>When an Analytics view is dropped, its descriptive metadata is deleted from the <code>Metadata.`Dataset`</code>
collection, and the Analytics view is removed from the insights sidebar to the right of the Analytics Workbench.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
