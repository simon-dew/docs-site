<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>Queries | Couchbase Docs (Preview)</title>
<link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-11527/server/current/analytics/3_query.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="A description of Couchbase SQL++ for Analytics queries.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/analytics/3_query.html">
<meta name="page-nav-header-levels" content="0">
<meta name="generator" content="Antora 3.1.4">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://simon-dew.github.io/docs-site/DOC-11527/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://simon-dew.github.io/docs-site/DOC-11527/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="https://github.com/simon-dew/docs-analytics/edit/release/7.2/modules/analytics/pages/3_query.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Develop</li>
<li class="crumb">Analytics</li>
<li class="crumb">SQL++ for Analytics Language Reference</li>
<li class="crumb"><a href="3_query.html">Queries</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Queries</h1>
<div class="labels">
<ul></ul>
</div>
<div class="labels">
<ul>
<li class="edition"><a href="https://www.couchbase.com/products/editions">Enterprise Edition</a></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Most of the examples in this section assume that you are using an Analytics scope called <code>Commerce</code>.
Refer to <a href="appendix_4_examples.html" class="xref page">Appendix 4: Example Data</a> to install this example data.</p>
</div>
<div class="paragraph">
<p>You can use the <a href="5_ddl.html#Use_statements" class="xref page">USE statement</a>
to set the default scope for the statement immediately following.</p>
</div>
<div class="literalblock">
<div class="title">Example</div>
<div class="content">
<pre>USE Commerce;</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, use the <strong>query context</strong> drop-down list at the top right of the Query Editor to select <code>Commerce</code> as
the default scope for the following examples.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/workbench-context-set.png" alt="The query context drop-down menu with 'Commerce' selected">
</div>
</div>
<div class="paragraph">
<p>A <em>query</em> can be an expression, or it can be constructed from blocks of code called <em>query blocks</em>. A query block may contain several clauses, including <code>SELECT</code>, <code>FROM</code>, <code>LET</code>, <code>WHERE</code>, <code>GROUP BY</code>, and <code>HAVING</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="query"><a class="anchor" href="#query"></a>Query</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/Query.png" alt="Query">
</div>
</div>
</div>
<div class="sect4">
<h5 id="selection"><a class="anchor" href="#selection"></a>Selection</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/Selection.png" alt="Selection">
</div>
</div>
</div>
<div class="sect4">
<h5 id="queryblock"><a class="anchor" href="#queryblock"></a>QueryBlock</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/QueryBlock.png" alt="QueryBlock">
</div>
</div>
</div>
<div class="sect4">
<h5 id="streamgenerator"><a class="anchor" href="#streamgenerator"></a>StreamGenerator</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/StreamGenerator.png" alt="StreamGenerator">
</div>
</div>
<div class="paragraph">
<p>Note that, unlike SQL, SQL&#43;&#43; allows the <code>SELECT</code> clause to appear either at the beginning or at the end of a query block. For some queries, placing the <code>SELECT</code> clause at the end may make a query block easier to understand, because the <code>SELECT</code> clause refers to variables defined in the other clauses.</p>
</div>
</div>
<div class="sect1">
<h2 id="Select_clauses"><a class="anchor" href="#Select_clauses"></a>SELECT Clause</h2>
<div class="sectionbody">
<h5 id="selectclause" class="discrete">SelectClause</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/SelectClause.png" alt="SelectClause">
</div>
</div>
<h5 id="projection" class="discrete">Projection</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/Projection.png" alt="Projection">
</div>
</div>
<div class="paragraph">
<p>Synonyms for <code>VALUE</code>: <code>ELEMENT</code>, <code>RAW</code></p>
</div>
<div class="paragraph">
<p>In a query block, the <code>FROM</code>, <code>WHERE</code>, <code>GROUP BY</code>, and <code>HAVING</code> clauses (if present) are collectively called the Stream Generator. All these clauses, taken together, generate a stream of tuples of bound variables. The <code>SELECT</code> clause then uses these bound variables to generate the output of the query block.</p>
</div>
<div class="paragraph">
<p>For example, the clause <code>FROM customers AS c</code> scans over the <code>customers</code> collection, binding the variable <code>c</code> to each <code>customer</code> object in turn, producing a stream of bindings.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a slightly more complex example of a stream generator:</p>
</div>
<div class="literalblock">
<div class="title">Example</div>
<div class="content">
<pre>FROM customers AS c, orders AS o
WHERE c.custid = o.custid</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>FROM</code> clause scans over the customers and orders collections, producing a stream of variable pairs (<code>c</code>, <code>o</code>) in which <code>c</code> is bound to a <code>customer</code> object and <code>o</code> is bound to an <code>order</code> object. The <code>WHERE</code> clause then retains only those pairs in which the custid values of the two objects match.</p>
</div>
<div class="paragraph">
<p>The output of the query block is a collection containing one output item for each tuple produced by the stream generator. If the stream generator produces no tuples, the output of the query block is an empty collection. Depending on the <code>SELECT</code> clause, each output item may be an object or some other kind of value.</p>
</div>
<div class="paragraph">
<p>In addition to using the variables bound by previous clauses, the <code>SELECT</code> clause may create and bind some additional variables. For example, the clause <code>SELECT salary + bonus AS pay</code> creates the variable <code>pay</code> and binds it to the value of <code>salary + bonus</code>. This variable may then be used in a later <code>ORDER BY</code> clause.</p>
</div>
<div class="paragraph">
<p>In SQL&#43;&#43;, the <code>SELECT</code> clause may appear either at the beginning or at the end of a query block. Since the <code>SELECT</code> clause depends on variables that are bound in the other clauses, the examples in this section place <code>SELECT</code> at the end of the query blocks.</p>
</div>
<div class="sect2">
<h3 id="Select_element"><a class="anchor" href="#Select_element"></a>SELECT VALUE</h3>
<div class="paragraph">
<p>The <code>SELECT VALUE</code> clause returns an array or multiset that contains the results of evaluating the <code>VALUE</code> expression, with one evaluation being performed per "binding tuple" (i.e., per <code>FROM</code> clause item) satisfying the statement&#8217;s selection criteria.
If there is no <code>FROM</code> clause, the expression after <code>VALUE</code> is evaluated once with no binding tuples
(except those inherited from an outer environment).</p>
</div>
<h5 id="example" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.1)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT VALUE 1;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
   1
]</pre>
</div>
</div>
<h5 id="example-2" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.2) The following query returns the names of all customers whose rating is above 650.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c
WHERE c.rating &gt; 650
SELECT VALUE name;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    "T. Cody",
    "M. Sinclair",
    "T. Henry"
]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="SQL_select"><a class="anchor" href="#SQL_select"></a>SQL-style SELECT</h3>
<div class="paragraph">
<p>Traditional SQL-style <code>SELECT</code> syntax is also supported in SQL&#43;&#43;, however the result of a query is not guaranteed to preserve the order of expressions in the <code>SELECT</code> clause.</p>
</div>
<h5 id="example-3" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.3) The following query returns the names and customers ids of any customers whose rating is 750.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c
WHERE c.rating = 750
SELECT c.name AS customer_name, c.custid AS customer_id;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "customer_id": "C13",
        "customer_name": "T. Cody"
    },
    {
        "customer_id": "C37",
        "customer_name": "T. Henry"
    }
]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Select_star"><a class="anchor" href="#Select_star"></a>SELECT *</h3>
<div class="paragraph">
<p>As in SQL, the phrase <code>SELECT *</code> suggests, "select everything."</p>
</div>
<div class="paragraph">
<p>For each binding tuple in the stream, <code>SELECT *</code> produces an output object. For each variable in the binding tuple, the output object contains a field: the name of the field is the name of the variable, and the value of the field is the value of the variable. Essentially, <code>SELECT *</code> means, "return all the bound variables, with their names and values."</p>
</div>
<div class="paragraph">
<p>The effect of <code>SELECT *</code> can be illustrated by an example based on two small collections named <code>ages</code> and <code>eyes</code>. The contents of the two collections are as follows:</p>
</div>
<div class="paragraph">
<p><code>ages</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    { "name": "Bill", "age": 21 },
    { "name": "Sue", "age": 32 }
]</pre>
</div>
</div>
<div class="paragraph">
<p><code>eyes</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    { "name": "Bill", "eyecolor": "brown" },
    { "name": "Sue", "eyecolor": "blue" }
]</pre>
</div>
</div>
<div class="paragraph">
<p>The following example applies <code>SELECT *</code> to a single collection.</p>
</div>
<h5 id="example-4" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.4a) Return all the information in the <code>ages</code> collection.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM ages AS a
SELECT * ;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    { "a": { "name": "Bill", "age": 21 },
    },
    { "a": { "name": "Sue", "age": 32}
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the variable-name <code>a</code> appears in the query result. If the <code>FROM</code> clause had been simply <code>FROM ages</code> (omitting <code>AS a</code>), the variable-name in the query result would have been <code>ages</code>.</p>
</div>
<div class="paragraph">
<p>The next example applies <code>SELECT *</code> to a join of two collections.</p>
</div>
<h5 id="example-5" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.4b) Return all the information in a join of <code>ages</code> and <code>eyes</code> on matching name fields.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM ages AS a, eyes AS e
WHERE a.name = e.name
SELECT * ;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    { "a": { "name": "Bill", "age": 21 },
      "e": { "name": "Bill", "eyecolor": "Brown" }
    },
    { "a": { "name": "Sue", "age": 32 },
      "e": { "name": "Sue", "eyecolor": "Blue" }
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the result of <code>SELECT *</code> in SQL&#43;&#43; is more complex than the result of <code>SELECT *</code> in SQL.</p>
</div>
</div>
<div class="sect2">
<h3 id="Select_variable_star"><a class="anchor" href="#Select_variable_star"></a>SELECT <em>variable</em>.*</h3>
<div class="paragraph">
<p>SQL&#43;&#43; has an alternative version of <code>SELECT *</code> in which the star is preceded by a variable.</p>
</div>
<div class="paragraph">
<p>Whereas the version without a named variable means, "return all the bound variables, with their names and values," <code>SELECT</code> <em>variable</em> <code>.*</code> means "return only the named variable, and return only its value, not its name."</p>
</div>
<div class="paragraph">
<p>The following example can be compared with (Q3.4a) to see the difference between the two versions of <code>SELECT *</code>:</p>
</div>
<h5 id="example-6" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.4c) Return all information in the <code>ages</code> collection.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM ages AS a
SELECT a.*</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    { "name": "Bill", "age": 21 },
    { "name": "Sue", "age": 32 }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Note that, for queries over a single collection, <code>SELECT</code> <em>variable</em> <code>.*</code> returns a simpler result and therefore may be preferable to <code>SELECT *</code>.</p>
</div>
<div class="paragraph">
<p>In fact, <code>SELECT</code> <em>variable</em> <code>.*</code>, like <code>SELECT *</code> in SQL, is equivalent to a <code>SELECT</code> clause that enumerates all the fields of the collection, as in (Q3.4d):</p>
</div>
<h5 id="example-7" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.4d) Return all the information in the <code>ages</code> collection.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM ages AS a
SELECT a.name, a.age</pre>
</div>
</div>
<div class="paragraph">
<p>(same result as (Q3.4c))</p>
</div>
<div class="paragraph">
<p><code>SELECT</code> <em>variable</em> <code>.*</code> has an additional application. It can be used to return all the fields of a nested object. To illustrate this use, we will use the <code>customers</code> dataset in the example database &mdash; see <a href="appendix_4_examples.html">Appendix 4</a>.</p>
</div>
<h5 id="example-8" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.4e) In the <code>customers</code> dataset, return all the fields of the <code>address</code> objects that have zipcode "02340".</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c
WHERE c.address.zipcode = "02340"
SELECT address.*  ;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "street": "690 River St.",
        "city": "Hanover, MA",
        "zipcode": "02340"
    }
]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Select_distinct"><a class="anchor" href="#Select_distinct"></a>SELECT DISTINCT</h3>
<div class="paragraph">
<p>The <code>DISTINCT</code> keyword is used to eliminate duplicate items from the results of a query block.</p>
</div>
<h5 id="example-9" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.5) Returns all of the different cities in the <code>customers</code> dataset.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c
SELECT DISTINCT c.address.city;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "city": "Boston, MA"
    },
    {
        "city": "Hanover, MA"
    },
    {
        "city": "St. Louis, MO"
    },
    {
        "city": "Rome, Italy"
    }
]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Unnamed_projections"><a class="anchor" href="#Unnamed_projections"></a>Unnamed Projections</h3>
<div class="paragraph">
<p>Similar to standard SQL, the query language supports unnamed projections (a.k.a, unnamed <code>SELECT</code> clause items), for which names are generated rather than user-provided.
Name generation has three cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a projection expression is a variable reference expression, its generated name is the name of the variable.</p>
</li>
<li>
<p>If a projection expression is a field access expression, its generated name is the last identifier in the expression.</p>
</li>
<li>
<p>For all other cases, the query processor will generate a unique name.</p>
</li>
</ul>
</div>
<h5 id="example-10" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.6) Returns the last digit and the order date of all orders for the customer whose ID is "C41".</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM orders AS o
WHERE o.custid = "C41"
SELECT o.orderno % 1000,  o.order_date;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "$1": 1,
        "order_date": "2020-04-29"
    },
    {
        "$1": 6,
        "order_date": "2020-09-02"
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>In the result, <code>$1</code> is the generated name for <code>o.orderno % 1000</code>, while <code>order_date</code> is the generated name for <code>o.order_date</code>. It is good practice, however, to not rely on the randomly generated names which can be confusing and irrelevant. Instead, practice good naming conventions by providing a meaningful and concise name which properly describes the selected item.</p>
</div>
</div>
<div class="sect2">
<h3 id="Abbreviated_field_access_expressions"><a class="anchor" href="#Abbreviated_field_access_expressions"></a>Abbreviated Field Access Expressions</h3>
<div class="paragraph">
<p>As in standard SQL, field access expressions can be abbreviated when there is no ambiguity. In the next example, the variable <code>o</code> is the only possible variable reference for fields <code>orderno</code> and <code>order_date</code> and thus could be omitted in the query. This practice is not recommended, however, as queries may have fields (such as <code>custid</code>) which can be present in multiple datasets. More information on abbreviated field access can be found in the appendix section on Variable Resolution.</p>
</div>
<h5 id="example-11" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.7) Same as Q3.6, omitting the variable reference for the order number and date and providing custom names for <code>SELECT</code> clause items.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM orders AS o
WHERE o.custid = "C41"
SELECT orderno % 1000 AS last_digit, order_date;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "last_digit": 1,
        "order_date": "2020-04-29"
    },
    {
        "last_digit": 6,
        "order_date": "2020-09-02"
    }
]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="From_clauses"><a class="anchor" href="#From_clauses"></a>FROM Clause</h2>
<div class="sectionbody">
<h5 id="fromclause" class="discrete">FromClause</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/FromClause.png" alt="FromClause">
</div>
</div>
<h5 id="fromterm" class="discrete">FromTerm</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/FromTerm.png" alt="FromTerm">
</div>
</div>
<h5 id="namedexpr" class="discrete">NamedExpr</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/NamedExpr.png" alt="NamedExpr">
</div>
</div>
<h5 id="joinstep" class="discrete">JoinStep</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/JoinStep.png" alt="JoinStep">
</div>
</div>
<h5 id="unneststep" class="discrete">UnnestStep</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/UnnestStep.png" alt="UnnestStep">
</div>
</div>
<div class="paragraph">
<p>Synonyms for <code>UNNEST</code>: <code>CORRELATE</code>, <code>FLATTEN</code></p>
</div>
<div class="paragraph">
<p>The purpose of a <code>FROM</code> clause is to iterate over a collection, binding a variable to each item in turn. Here&#8217;s a query that iterates over the <code>customers</code> dataset, choosing certain customers and returning some of their attributes.</p>
</div>
<h5 id="example-12" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.8) List the customer ids and names of the customers in zipcode 63101, in order by their customer IDs.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers
WHERE address.zipcode = "63101"
SELECT custid AS customer_id, name
ORDER BY customer_id;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "customer_id": "C13",
        "name": "T. Cody"
    },
    {
        "customer_id": "C31",
        "name": "B. Pruitt"
    },
    {
        "customer_id": "C41",
        "name": "R. Dodge"
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s take a closer look at what this <code>FROM</code> clause is doing. A <code>FROM</code> clause always produces a stream of bindings, in which an iteration variable is bound in turn to each item in a collection. In Q3.8, since no explicit iteration variable is provided, the <code>FROM</code> clause defines an implicit variable named <code>customers</code>, the same name as the dataset that is being iterated over. The implicit iteration variable serves as the object-name for all field-names in the query block that do not have explicit object-names. Thus, <code>address.zipcode</code> really means <code>customers.address.zipcode</code>, <code>custid</code> really means <code>customers.custid</code>, and <code>name</code> really means <code>customers.name</code>.</p>
</div>
<div class="paragraph">
<p>You may also provide an explicit iteration variable, as in this version of the same query:</p>
</div>
<h5 id="example-13" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.9) Alternative version of Q3.8 (same result).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c
WHERE c.address.zipcode = "63101"
SELECT c.custid AS customer_id, c.name
ORDER BY customer_id;</pre>
</div>
</div>
<div class="paragraph">
<p>In Q3.9, the variable <code>c</code> is bound to each <code>customer</code> object in turn as the query iterates over the <code>customers</code> dataset. An explicit iteration variable can be used to identify the fields of the referenced object, as in <code>c.name</code> in the <code>SELECT</code> clause of Q3.9. When referencing a field of an object, the iteration variable can be omitted when there is no ambiguity. For example, <code>c.name</code> could be replaced by <code>name</code> in the <code>SELECT</code> clause of Q3.9. That&#8217;s why field-names like <code>name</code> and <code>custid</code> could stand by themselves in the Q3.8 version of this query.</p>
</div>
<div class="paragraph">
<p>In the examples above, the <code>FROM</code> clause iterates over the objects in a dataset. But in general, a <code>FROM</code> clause can iterate over any collection. For example, the objects in the <code>orders</code> dataset each contain a field called <code>items</code>, which is an array of nested objects. In some cases, you will write a <code>FROM</code> clause that iterates over a nested array like <code>items</code>.</p>
</div>
<div class="paragraph">
<p>The stream of objects (more accurately, variable bindings) that is produced by the <code>FROM</code> clause does not have any particular order. The system will choose the most efficient order for the iteration. If you want your query result to have a specific order, you must use an <code>ORDER BY</code> clause.</p>
</div>
<div class="paragraph">
<p>It&#8217;s good practice to specify an explicit iteration variable for each collection in the <code>FROM</code> clause, and to use these variables to qualify the field-names in other clauses. Here are some reasons for this convention:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s nice to have different names for the collection as a whole and an object in the collection. For example, in the clause <code>FROM customers AS c</code>, the name <code>customers</code> represents the dataset and the name <code>c</code> represents one object in the dataset.</p>
</li>
<li>
<p>In some cases, iteration variables are required. For example, when joining a dataset to itself, distinct iteration variables are required to distinguish the left side of the join from the right side.</p>
</li>
<li>
<p>In a subquery it&#8217;s sometimes necessary to refer to an object in an outer query block (this is called a <em>correlated subquery</em>). To avoid confusion in correlated subqueries, it&#8217;s best to use explicit variables.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="Join_clauses"><a class="anchor" href="#Join_clauses"></a>Joins</h3>
<div class="paragraph">
<p>A <code>FROM</code> clause gets more interesting when there is more than one collection involved. The following query iterates over two collections: <code>customers</code> and <code>orders</code>. The <code>FROM</code> clause produces a stream of binding tuples, each containing two variables, <code>c</code> and <code>o</code>. In each binding tuple, <code>c</code> is bound to an object from <code>customers</code>, and <code>o</code> is bound to an object from <code>orders</code>. Conceptually, at this point, the binding tuple stream contains all possible pairs of a customer and an order (this is called the <em>Cartesian product</em> of <code>customers</code> and <code>orders</code>). Of course, we are interested only in pairs where the <code>custid</code> fields match, and that condition is expressed in the <code>WHERE</code> clause, along with the restriction that the order number must be 1001.</p>
</div>
<h5 id="example-14" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.10) Create a packing list for order number 1001, showing the customer name and address and all the items in the order.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c, orders AS o
WHERE c.custid = o.custid
AND o.orderno = 1001
SELECT o.orderno,
    c.name AS customer_name,
    c.address,
    o.items AS items_ordered;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "orderno": 1001,
        "customer_name": "R. Dodge",
        "address": {
            "street": "150 Market St.",
            "city": "St. Louis, MO",
            "zipcode": "63101"
        },
        "items_ordered": [
            {
                "itemno": 347,
                "qty": 5,
                "price": 19.99
            },
            {
                "itemno": 193,
                "qty": 2,
                "price": 28.89
            }
        ]
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Q3.10 is called a <em>join query</em> because it joins the <code>customers</code> collection and the <code>orders</code> collection, using the join condition <code>c.custid = o.custid</code>. In SQL&#43;&#43;, as in SQL, you can express this query more explicitly by a <code>JOIN</code> clause that includes the join condition, as follows:</p>
</div>
<h5 id="example-15" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.11) Alternative statement of Q3.10 (same result).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c JOIN orders AS o
    ON c.custid = o.custid
WHERE o.orderno = 1001
SELECT o.orderno,
    c.name AS customer_name,
    c.address,
    o.items AS items_ordered;</pre>
</div>
</div>
<div class="paragraph">
<p>Whether you express the join condition in a <code>JOIN</code> clause or in a <code>WHERE</code> clause is a matter of taste; the result is the same. This manual will generally use a comma-separated list of collection-names in the <code>FROM</code> clause, leaving the join condition to be expressed elsewhere. As we&#8217;ll soon see, in some query blocks the join condition can be omitted entirely.</p>
</div>
<div class="paragraph">
<p>There is, however, one case in which an explicit <code>JOIN</code> clause is necessary. That is when you need to join collection A to collection B, and you want to make sure that every item in collection A is present in the query result, even if it doesn&#8217;t match any item in collection B. This kind of query is called a <em>left outer join</em>, and it is illustrated by the following example.</p>
</div>
<h5 id="example-16" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.12) List the customer ID and name, together with the order numbers and dates of their orders (if any) of customers T. Cody and M. Sinclair.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c LEFT OUTER JOIN orders AS o ON c.custid = o.custid
WHERE c.name = "T. Cody"
   OR c.name = "M. Sinclair"
SELECT c.custid, c.name, o.orderno, o.order_date
ORDER BY c.custid, o.order_date;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "custid": "C13",
        "orderno": 1002,
        "name": "T. Cody",
        "order_date": "2020-05-01"
    },
    {
        "custid": "C13",
        "orderno": 1007,
        "name": "T. Cody",
        "order_date": "2020-09-13"
    },
    {
        "custid": "C13",
        "orderno": 1008,
        "name": "T. Cody",
        "order_date": "2020-10-13"
    },
    {
        "custid": "C13",
        "orderno": 1009,
        "name": "T. Cody",
        "order_date": "2020-10-13"
    },
    {
        "custid": "C25",
        "name": "M. Sinclair"
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the result of this left outer join, our data includes four orders from customer T. Cody, but no orders from customer M. Sinclair. The behavior of left outer join in SQL&#43;&#43; is different from that of SQL. SQL would have provided M. Sinclair with an order in which all the fields were <code>null</code>. SQL&#43;&#43;, on the other hand, deals with schemaless data, which permits it to simply omit the order fields from the outer join.</p>
</div>
<div class="paragraph">
<p>Now we&#8217;re ready to look at a new kind of join that was not provided (or needed) in original SQL. Consider this query:</p>
</div>
<h5 id="example-17" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.13) For every case in which an item is ordered in a quantity greater than 100, show the order number, date, item number, and quantity.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM orders AS o, o.items AS i
WHERE i.qty &gt; 100
SELECT o.orderno, o.order_date, i.itemno AS item_number,
    i.qty AS quantity
ORDER BY o.orderno, item_number;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "orderno": 1002,
        "order_date": "2020-05-01",
        "item_number": 680,
        "quantity": 150
    },
    {
        "orderno": 1005,
        "order_date": "2020-08-30",
        "item_number": 347,
        "quantity": 120
    },
    {
        "orderno": 1006,
        "order_date": "2020-09-02",
        "item_number": 460,
        "quantity": 120
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Q3.13 illustrates a feature called <em>left-correlation</em> in the <code>FROM</code> clause. Notice that we are joining <code>orders</code>, which is a dataset, to <code>items</code>, which is an array nested inside each order. In effect, for each order, we are unnesting the <code>items</code> array and joining it to the <code>order</code> as though it were a separate collection. For this reason, this kind of query is sometimes called an <em>unnesting query</em>. The keyword <code>UNNEST</code> may be used whenever left-correlation is used in a <code>FROM</code> clause, as shown in this example:</p>
</div>
<h5 id="example-18" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.14) Alternative statement of Q3.13 (same result).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM orders AS o UNNEST o.items AS i
WHERE i.qty &gt; 100
SELECT o.orderno, o.order_date, i.itemno AS item_number,
        i.qty AS quantity
ORDER BY o.orderno, item_number;</pre>
</div>
</div>
<div class="paragraph">
<p>The results of Q3.13 and Q3.14 are exactly the same. <code>UNNEST</code> serves as a reminder that left-correlation is being used to join an object with its nested items. The join condition in Q3.14 is expressed by the left-correlation: each order <code>o</code> is joined to its own items, referenced as <code>o.items</code>. The result of the <code>FROM</code> clause is a stream of binding tuples, each containing two variables, <code>o</code> and <code>i</code>. The variable <code>o</code> is bound to an order and the variable <code>i</code> is bound to one item inside that order.</p>
</div>
<div class="paragraph">
<p>Like <code>JOIN</code>, <code>UNNEST</code> has a <code>LEFT OUTER</code> option. Q3.14 could have specified:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM orders AS o LEFT OUTER UNNEST o.items AS i</pre>
</div>
</div>
<div class="paragraph">
<p>In this case, orders that have no nested items would appear in the query result.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Let_clauses"><a class="anchor" href="#Let_clauses"></a>LET Clause</h2>
<div class="sectionbody">
<h5 id="letclause" class="discrete">LetClause</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/LetClause.png" alt="LetClause">
</div>
</div>
<div class="paragraph">
<p>Synonyms for <code>LET</code>: <code>LETTING</code></p>
</div>
<div class="paragraph">
<p><code>LET</code> clauses can be useful when a (complex) expression is used several times within a query, allowing it to be written once to make the query more concise. The word <code>LETTING</code> can also be used, although this is not as common. The next query shows an example.</p>
</div>
<h5 id="example-19" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.15) For each item in an order, the revenue is defined as the quantity times the price of that item. Find individual items for which the revenue is greater than 5000. For each of these, list the order number, item number, and revenue, in descending order by revenue.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM orders AS o, o.items AS i
LET revenue = i.qty * i.price
WHERE revenue &gt; 5000
SELECT o.orderno, i.itemno, revenue
ORDER by revenue desc;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "orderno": 1006,
        "itemno": 460,
        "revenue": 11997.6
    },
    {
        "orderno": 1002,
        "itemno": 460,
        "revenue": 9594.05
    },
    {
        "orderno": 1006,
        "itemno": 120,
        "revenue": 5525
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>The expression for computing revenue is defined once in the <code>LET</code> clause and then used three times in the remainder of the query. Avoiding repetition of the revenue expression makes the query shorter and less prone to errors.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Where_having_clauses"><a class="anchor" href="#Where_having_clauses"></a>WHERE Clause</h2>
<div class="sectionbody">
<h5 id="whereclause" class="discrete">WhereClause</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/WhereClause.png" alt="WhereClause">
</div>
</div>
<div class="paragraph">
<p>The purpose of a <code>WHERE</code> clause is to operate on the stream of binding tuples generated by the <code>FROM</code> clause, filtering out the tuples that do not satisfy a certain condition. The condition is specified by an expression based on the variable names in the binding tuples. If the expression evaluates to true, the tuple remains in the stream; if it evaluates to anything else, including <code>null</code> or <code>missing</code>, it is filtered out. The surviving tuples are then passed along to the next clause to be processed (usually either <code>GROUP BY</code> or <code>SELECT</code>).</p>
</div>
<div class="paragraph">
<p>Often, the expression in a <code>WHERE</code> clause is some kind of comparison like <code>quantity &gt; 100</code>. However, any kind of expression is allowed in a <code>WHERE</code> clause. The only thing that matters is whether the expression returns <code>true</code> or not.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Grouping"><a class="anchor" href="#Grouping"></a>Grouping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Grouping is especially important when manipulating hierarchies like the ones that are often found in JSON data. Often you will want to generate output data that includes both summary data and line items within the summaries. For this purpose, SQL&#43;&#43; supports several important extensions to the traditional grouping features of SQL. The familiar <code>GROUP BY</code> and <code>HAVING</code> clauses are still there, and they are joined by a new clause called <code>GROUP AS</code>. We&#8217;ll illustrate these clauses by a series of examples.</p>
</div>
<div class="sect2">
<h3 id="Group_By_clauses"><a class="anchor" href="#Group_By_clauses"></a>GROUP BY Clause</h3>
<h5 id="groupbyclause" class="discrete">GroupByClause</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/GroupByClause.png" alt="GroupByClause">
</div>
</div>
<h5 id="groupingelement" class="discrete">GroupingElement</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/GroupingElement.png" alt="GroupingElement">
</div>
</div>
<h5 id="ordinarygroupingset" class="discrete">OrdinaryGroupingSet</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/OrdinaryGroupingSet.png" alt="OrdinaryGroupingSet">
</div>
</div>
<h5 id="namedexpr-2" class="discrete">NamedExpr</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/NamedExpr.png" alt="NamedExpr">
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll begin our discussion of grouping with an example from ordinary SQL.</p>
</div>
<h5 id="example-20" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.16) List the number of orders placed by each customer who has placed an order.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT o.custid, COUNT(o.orderno) AS `order count`
FROM orders AS o
GROUP BY o.custid
ORDER BY o.custid;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "order count": 4,
        "custid": "C13"
    },
    {
        "order count": 1,
        "custid": "C31"
    },
    {
        "order count": 1,
        "custid": "C35"
    },
    {
        "order count": 1,
        "custid": "C37"
    },
    {
        "order count": 2,
        "custid": "C41"
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>The input to a <code>GROUP BY</code> clause is the stream of binding tuples generated by the <code>FROM</code> and <code>WHERE</code>clauses. In this query, before grouping, the variable <code>o</code> is bound to each object in the <code>orders</code> collection in turn.</p>
</div>
<div class="paragraph">
<p>SQL&#43;&#43; evaluates the expression in the <code>GROUP BY</code> clause, called the grouping expression, once for each of the binding tuples. It then organizes the results into groups in which the grouping expression has a common value (as defined by the <code>=</code> operator). In this example, the grouping expression is <code>o.custid</code>, and each of the resulting groups is a set of <code>orders</code> that have the same <code>custid</code>. If necessary, a group is formed for <code>orders</code> in which <code>custid</code> is <code>null</code>, and another group is formed for <code>orders</code> that have no <code>custid</code>. This query uses the aggregating function <code>COUNT(o.orderno)</code>, which counts how many order numbers are in each group. If we are sure that each order object has a distinct <code>orderno</code>, we could also simply count the order objects in each group by using <code>COUNT(*)</code> in place of <code>COUNT(o.orderno)</code>.</p>
</div>
<div class="paragraph">
<p>In the <code>GROUP BY</code>clause, you may optionally define an alias for the grouping expression. For example, in Q3.16, you could have written <code>GROUP BY o.custid AS cid</code>. The alias <code>cid</code> could then be used in place of the grouping expression in later clauses. In cases where the grouping expression contains an operator, it is especially helpful to define an alias (for example, <code>GROUP BY salary + bonus AS pay)</code>.</p>
</div>
<div class="paragraph">
<p>Q3.16 had a single grouping expression, <code>o.custid</code>. If a query has multiple grouping expressions, the combination of grouping expressions is evaluated for every binding tuple, and the stream of binding tuples is partitioned into groups that have values in common for all of the grouping expressions. We&#8217;ll see an example of such a query in Q3.18.</p>
</div>
<div class="paragraph">
<p>After grouping, the number of binding tuples is reduced: instead of a binding tuple for each of the input objects, there is a binding tuple for each group. The grouping expressions (identified by their aliases, if any) are bound to the results of their evaluations. However, all the non-grouping fields (that is, fields that were not named in the grouping expressions), are accessible only in a special way: as an argument of one of the special aggregation pseudo-functions such as: <code>SUM</code>, <code>AVG</code>, <code>MAX</code>, <code>MIN</code>, <code>STDEV</code> and <code>COUNT</code>. The clauses that come after grouping can access only properties of groups, including the grouping expressions and aggregate properties of the groups such as <code>COUNT(o.orderno)</code> or <code>COUNT(*)</code>. (We&#8217;ll see an exception when we discuss the new <code>GROUP AS</code> clause.)</p>
</div>
<div class="paragraph">
<p>You may notice that the results of Q3.16 do not include customers who have no <code>orders</code>. If we want to include these <code>customers</code>, we need to use an outer join between the <code>customers</code> and <code>orders</code> collections. This is illustrated by the following example, which also includes the name of each customer.</p>
</div>
<h5 id="example-21" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.17) List the number of orders placed by each customer including those customers who have placed no orders.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT c.custid, c.name, COUNT(o.orderno) AS `order count`
FROM customers AS c LEFT OUTER JOIN orders AS o ON c.custid = o.custid
GROUP BY c.custid, c.name
ORDER BY c.custid;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "custid": "C13",
        "order count": 4,
        "name": "T. Cody"
    },
    {
        "custid": "C25",
        "order count": 0,
        "name": "M. Sinclair"
    },
    {
        "custid": "C31",
        "order count": 1,
        "name": "B. Pruitt"
    },
    {
        "custid": "C35",
        "order count": 1,
        "name": "J. Roberts"
    },
    {
        "custid": "C37",
        "order count": 1,
        "name": "T. Henry"
    },
    {
        "custid": "C41",
        "order count": 2,
        "name": "R. Dodge"
    },
    {
        "custid": "C47",
        "order count": 0,
        "name": "S. Logan"
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Notice in Q3.17 what happens when the special aggregation function <code>COUNT</code> is applied to a collection that does not exist, such as the orders of M. Sinclair: it returns zero. This behavior is unlike that of the other special aggregation functions <code>SUM</code>, <code>AVG</code>, <code>MAX</code>, and <code>MIN</code>, which return <code>null</code> if their operand does not exist. This should make you cautious about the <code>COUNT</code> function: If it returns zero, that may mean that the collection you are counting has zero members, or that it does not exist, or that you have misspelled the collection&#8217;s name.</p>
</div>
<div class="paragraph">
<p>Q3.17 also shows how a query block can have more than one grouping expression. In general, the <code>GROUP BY</code>clause produces a binding tuple for each different combination of values for the grouping expressions. In Q3.17, the <code>c.custid</code> field uniquely identifies a customer, so adding <code>c.name</code> as a grouping expression does not result in any more groups. Nevertheless, <code>c.name</code> must be included as a grouping expression if it is to be referenced outside (after) the <code>GROUP BY</code> clause. If <code>c.name</code> were not included in the <code>GROUP BY</code> clause, it would not be a group property and could not be used in the <code>SELECT</code> clause.</p>
</div>
<div class="paragraph">
<p>Of course, a grouping expression need not be a simple field-name. In Q3.18, orders are grouped by month, using a temporal function to extract the month component of the order dates. In cases like this, it is helpful to define an alias for the grouping expression so that it can be referenced elsewhere in the query e.g. in the <code>SELECT</code> clause.</p>
</div>
<h5 id="example-22" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.18) Find the months in 2020 that had the largest numbers of orders; list the months and their numbers of orders. (Return the top three.)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM orders AS o
WHERE DATE_PART_STR(o.order_date, "year") = 2020
GROUP BY DATE_PART_STR(o.order_date, "month") AS month
SELECT month, COUNT(*) AS order_count
ORDER BY order_count DESC, month DESC
LIMIT 3;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "month": 10,
        "order_count": 2
    },
    {
        "month": 9,
        "order_count": 2
    },
    {
        "month": 8,
        "order_count": 1
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Groups are commonly formed from named collections like <code>customers</code> and <code>orders</code>. But in some queries you need to form groups from a collection that is nested inside another collection, such as <code>items</code> inside <code>orders</code>. In SQL&#43;&#43; you can do this by using left-correlation in the <code>FROM</code> clause to unnest the inner collection, joining the inner collection with the outer collection, and then performing the grouping on the join, as illustrated in Q3.19.</p>
</div>
<div class="paragraph">
<p>Q3.19 also shows how a <code>LET</code> clause can be used after a <code>GROUP BY</code> clause to define an expression that is referenced multiple times in later clauses.</p>
</div>
<h5 id="example-23" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.19) For each order, define the total revenue of the order as the sum of quantity times price for all the items in that order. List the total revenue for all the orders placed by the customer with id "C13", in descending order by total revenue.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM orders as o, o.items as i
WHERE o.custid = "C13"
GROUP BY o.orderno
LET total_revenue = sum(i.qty * i.price)
SELECT o.orderno, total_revenue
ORDER BY total_revenue desc;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "orderno": 1002,
        "total_revenue": 10906.55
    },
    {
        "orderno": 1008,
        "total_revenue": 1999.8
    },
    {
        "orderno": 1007,
        "total_revenue": 130.45
    }
]</pre>
</div>
</div>
<div class="sect3">
<h4 id="Rollup"><a class="anchor" href="#Rollup"></a>ROLLUP</h4>
<div class="paragraph">
<p>The <code>ROLLUP</code> subclause is an aggregation feature that extends the functionality of the <code>GROUP BY</code> clause.
It returns extra <em>super-aggregate</em> items in the query results, giving subtotals and a grand total for the aggregate
functions in the query.
To illustrate, first consider the following query.</p>
</div>
<div class="sect4">
<h5 id="example-24"><a class="anchor" href="#example-24"></a>Example</h5>
<div class="paragraph">
<p>(Q3.R1) List the number of orders, grouped by customer region and city.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT customer_region AS Region,
       customer_city AS City,
       COUNT(o.orderno) AS `Order Count`
FROM customers AS c LEFT OUTER JOIN orders AS o ON c.custid = o.custid
LET address_line = SPLIT(c.address.city, ","),
    customer_city = TRIM(address_line[0]),
    customer_region = TRIM(address_line[1])
GROUP BY customer_region, customer_city
ORDER BY customer_region ASC, customer_city ASC, `Order Count` DESC;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
  {
    "Region": "Italy",
    "City": "Rome",
    "Order Count": 0
  },
  {
    "Region": "MA",
    "City": "Boston",
    "Order Count": 2
  },
  {
    "Region": "MA",
    "City": "Hanover",
    "Order Count": 0
  },
  {
    "Region": "MO",
    "City": "St. Louis",
    "Order Count": 7
  }
]</pre>
</div>
</div>
<div class="paragraph">
<p>This query uses string functions to split each customer&#8217;s address into city and region.
The query then counts the total number of orders placed by each customer, and groups the results first by customer
region, then by customer city.
The aggregate results (labeled <code>Order Count</code>) are only shown by city, and there are no subtotals or grand total.
We can add these using the <code>ROLLUP</code> subclause, as in the following example.</p>
</div>
</div>
<div class="sect4">
<h5 id="example-25"><a class="anchor" href="#example-25"></a>Example</h5>
<div class="paragraph">
<p>(Q3.R2) List the number of orders by customer region and city, including subtotals and a grand total.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT customer_region AS Region,
       customer_city AS City,
       COUNT(o.orderno) AS `Order Count`
FROM customers AS c LEFT OUTER JOIN orders AS o ON c.custid = o.custid
LET address_line = SPLIT(c.address.city, ","),
    customer_city = TRIM(address_line[0]),
    customer_region = TRIM(address_line[1])
GROUP BY ROLLUP(customer_region, customer_city)
ORDER BY customer_region ASC, customer_city ASC, `Order Count` DESC;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
  {
    "Region": null,
    "City": null,
    "Order Count": 9
  },
  {
    "Region": "Italy",
    "City": null,
    "Order Count": 0
  },
  {
    "Region": "Italy",
    "City": "Rome",
    "Order Count": 0
  },
  {
    "Region": "MA",
    "City": null,
    "Order Count": 2
  },
  {
    "Region": "MA",
    "City": "Boston",
    "Order Count": 2
  },
  {
    "Region": "MA",
    "City": "Hanover",
    "Order Count": 0
  },
  {
    "Region": "MO",
    "City": null,
    "Order Count": 7
  },
  {
    "Region": "MO",
    "City": "St. Louis",
    "Order Count": 7
  }
]</pre>
</div>
</div>
<div class="paragraph">
<p>With the addition of the <code>ROLLUP</code> subclause, the results now include an extra item at the start of each region,
giving the subtotal for that region.
There is also another extra item at the very start of the results, giving the grand total for all regions.</p>
</div>
<div class="paragraph">
<p>The order of the fields specified by the <code>ROLLUP</code> subclause determines the hierarchy of the super-aggregate items.
The customer region is specified first, followed by the customer city; so the results are aggregated by region first,
and then by city within each region.</p>
</div>
<div class="paragraph">
<p>The grand total returns <code>null</code> as a value for the city and the region, and the subtotals return <code>null</code> as the
value for the city, which may make the results hard to understand at first glance.
A workaround for this is given in the next example.</p>
</div>
</div>
<div class="sect4">
<h5 id="example-26"><a class="anchor" href="#example-26"></a>Example</h5>
<div class="paragraph">
<p>(Q3.R3) List the number of orders by customer region and city, with meaningful subtotals and grand total.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT IFNULL(customer_region, "All regions") AS Region,
       IFNULL(customer_city, "All cities") AS City,
       COUNT(o.orderno) AS `Order Count`
FROM customers AS c LEFT OUTER JOIN orders AS o ON c.custid = o.custid
LET address_line = SPLIT(c.address.city, ","),
    customer_city = TRIM(address_line[0]),
    customer_region = TRIM(address_line[1])
GROUP BY ROLLUP(customer_region, customer_city)
ORDER BY customer_region ASC, customer_city ASC, `Order Count` DESC;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
  {
    "Region": "All regions",
    "City": "All cities",
    "Order Count": 9
  },
  {
    "Region": "Italy",
    "City": "All cities",
    "Order Count": 0
  },
  {
    "Region": "Italy",
    "City": "Rome",
    "Order Count": 0
  },
  {
    "Region": "MA",
    "City": "All cities",
    "Order Count": 2
  },
  {
    "Region": "MA",
    "City": "Boston",
    "Order Count": 2
  },
  {
    "Region": "MA",
    "City": "Hanover",
    "Order Count": 0
  },
  {
    "Region": "MO",
    "City": "All cities",
    "Order Count": 7
  },
  {
    "Region": "MO",
    "City": "St. Louis",
    "Order Count": 7
  }
]</pre>
</div>
</div>
<div class="paragraph">
<p>This query uses the <code>IFNULL</code> function to populate the region and city fields with meaningful values for the
super-aggregate items.
This makes the results clearer and more readable.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Cube"><a class="anchor" href="#Cube"></a>CUBE</h4>
<div class="paragraph">
<p>The <code>CUBE</code> subclause is similar to the <code>ROLLUP</code> subclause, in that it returns extra super-aggregate items in the query
results, giving subtotals and a grand total for the aggregate functions.
Whereas <code>ROLLUP</code> returns a grand total and a hierarchy of subtotals based on the specified fields,
the <code>CUBE</code> subclause returns a grand total and subtotals for every possible combination of the specified fields.</p>
</div>
<div class="paragraph">
<p>The following example is a modification of Q3.R3 which illustrates the <code>CUBE</code> subclause.</p>
</div>
<div class="sect4">
<h5 id="example-27"><a class="anchor" href="#example-27"></a>Example</h5>
<div class="paragraph">
<p>(Q3.C) List the number of orders by customer region and order date, with all possible subtotals and a grand total.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT IFNULL(customer_region, "All regions") AS Region,
       IFNULL(order_month, "All months") AS Month,
       COUNT(o.orderno) AS `Order Count`
FROM customers AS c INNER JOIN orders AS o ON c.custid = o.custid
LET address_line = SPLIT(c.address.city, ","),
    customer_region = TRIM(address_line[1]),
    order_month = DATE_PART_STR(o.order_date, "month")
GROUP BY CUBE(customer_region, order_month)
ORDER BY customer_region ASC, order_month ASC;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
  {
    "Region": "All regions",
    "Order Count": 9,
    "Month": "All months"
  },
  {
    "Region": "All regions",
    "Order Count": 1,
    "Month": 4
  },
  {
    "Region": "All regions",
    "Order Count": 1,
    "Month": 5
  },
  {
    "Region": "All regions",
    "Order Count": 1,
    "Month": 6
  },
  {
    "Region": "All regions",
    "Order Count": 1,
    "Month": 7
  },
  {
    "Region": "All regions",
    "Order Count": 1,
    "Month": 8
  },
  {
    "Region": "All regions",
    "Order Count": 2,
    "Month": 9
  },
  {
    "Region": "All regions",
    "Order Count": 2,
    "Month": 10
  },
  {
    "Region": "MA",
    "Order Count": 2,
    "Month": "All months"
  },
  {
    "Region": "MA",
    "Order Count": 1,
    "Month": 7
  },
  {
    "Region": "MA",
    "Order Count": 1,
    "Month": 8
  },
  {
    "Region": "MO",
    "Order Count": 7,
    "Month": "All months"
  },
  {
    "Region": "MO",
    "Order Count": 1,
    "Month": 4
  },
  {
    "Region": "MO",
    "Order Count": 1,
    "Month": 5
  },
  {
    "Region": "MO",
    "Order Count": 1,
    "Month": 6
  },
  {
    "Region": "MO",
    "Order Count": 2,
    "Month": 9
  },
  {
    "Region": "MO",
    "Order Count": 2,
    "Month": 10
  }
]</pre>
</div>
</div>
<div class="paragraph">
<p>To simplify the results, this query uses an inner join, so that customers who have not placed an order are not included
in the totals.
The query uses string functions to extract the region from each customer&#8217;s address,
and a temporal function to extract the year from the order date.</p>
</div>
<div class="paragraph">
<p>The query uses the <code>CUBE</code> subclause with customer region and order month.
This means that there are four possible aggregates to calculate:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All regions, all months</p>
</li>
<li>
<p>All regions, each month</p>
</li>
<li>
<p>Each region, all months</p>
</li>
<li>
<p>Each region, each month</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The results start with the grand total, showing the total number of orders across all regions for all months.
This is followed by date subtotals, showing the number of orders across all regions for each month.
Following that are the regional subtotals, showing the total number of orders for all months in each region;
and the result items, giving the number of orders for each month in each region.</p>
</div>
<div class="paragraph">
<p>The query also uses the <code>IFNULL</code> function to populate the region and date fields with meaningful values for the
super-aggregate items.
This makes the results clearer and more readable.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Having_clauses"><a class="anchor" href="#Having_clauses"></a>HAVING Clause</h3>
<h5 id="havingclause" class="discrete">HavingClause</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/HavingClause.png" alt="HavingClause">
</div>
</div>
<div class="paragraph">
<p>The <code>HAVING</code> clause is very similar to the <code>WHERE</code> clause, except that it comes after <code>GROUP BY</code> and applies a filter to groups rather than to individual objects. Here&#8217;s an example of a <code>HAVING</code> clause that filters orders by applying a condition to their nested arrays of <code>items</code>.</p>
</div>
<div class="paragraph">
<p>By adding a <code>HAVING</code> clause to Q3.19, we can filter the results to include only those orders whose total revenue is greater than 1000, as shown in Q3.22.</p>
</div>
<h5 id="example-28" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.20) Modify Q3.19 to include only orders whose total revenue is greater than 5000.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM orders AS o, o.items as i
WHERE o.custid = "C13"
GROUP BY o.orderno
LET total_revenue = sum(i.qty * i.price)
HAVING total_revenue &gt; 5000
SELECT o.orderno, total_revenue
ORDER BY total_revenue desc;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "orderno": 1002,
        "total_revenue": 10906.55
    }
]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Aggregation_PseudoFunctions"><a class="anchor" href="#Aggregation_PseudoFunctions"></a>Aggregation Pseudo-Functions</h3>
<div class="paragraph">
<p>SQL provides several special functions for performing aggregations on groups including: <code>SUM</code>, <code>AVG</code>, <code>MAX</code>, <code>MIN</code>, and <code>COUNT</code> (some implementations provide more). These same functions are supported in SQL&#43;&#43;. However, it&#8217;s worth spending some time on these special functions because they don&#8217;t behave like ordinary functions. They are called "pseudo-functions" here because they don&#8217;t evaluate their operands in the same way as ordinary functions. To see the difference, consider these two examples, which are syntactically similar:</p>
</div>
<div class="literalblock">
<div class="title">Example 1</div>
<div class="content">
<pre>SELECT LENGTH(name) FROM customers</pre>
</div>
</div>
<div class="paragraph">
<p>In Example 1, <code>LENGTH</code> is an ordinary function. It simply evaluates its operand (name) and then returns a result computed from the operand.</p>
</div>
<div class="literalblock">
<div class="title">Example 2</div>
<div class="content">
<pre>SELECT AVG(rating) FROM customers</pre>
</div>
</div>
<div class="paragraph">
<p>The effect of <code>AVG</code> in Example 2 is quite different. Rather than performing a computation on an individual rating value, <code>AVG</code> has a global effect: it effectively restructures the query. As a pseudo-function, <code>AVG</code> requires its operand to be a group; therefore, it automatically collects all the rating values from the query block and forms them into a group.</p>
</div>
<div class="paragraph">
<p>The aggregation pseudo-functions always require their operand to be a group. In some queries, the group is explicitly generated by a <code>GROUP BY</code> clause, as in Q3.21:</p>
</div>
<h5 id="example-29" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.21) List the average credit rating of customers by zipcode.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c
GROUP BY c.address.zipcode AS zip
SELECT zip, AVG(c.rating) AS `avg credit rating`
ORDER BY zip;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "avg credit rating": 625
    },
    {
        "avg credit rating": 657.5,
        "zip": "02115"
    },
    {
        "avg credit rating": 690,
        "zip": "02340"
    },
    {
        "avg credit rating": 695,
        "zip": "63101"
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Note in the result of Q3.21 that one or more customers had no zipcode. These customers were formed into a group for which the value of the grouping key is missing. When the query results were returned in JSON format, the <code>missing</code> key simply does not appear. Also note that the group whose key is <code>missing</code> appears first because <code>missing</code> is considered to be smaller than any other value. If some customers had had <code>null</code> as a zipcode, they would have been included in another group, appearing after the <code>missing</code> group but before the other groups.</p>
</div>
<div class="paragraph">
<p>When an aggregation pseudo-function is used without an explicit <code>GROUP BY</code> clause, it implicitly forms the entire query block into a single group, as in Q3.22:</p>
</div>
<h5 id="example-30" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.22) Find the average credit rating among all customers.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c
SELECT AVG(c.rating) AS `avg credit rating`;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "avg credit rating": 670
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>The aggregation pseudo-function <code>COUNT</code> has a special form in which its operand is <code>*</code> instead of an expression.</p>
</div>
<div class="paragraph">
<p>For example, <code>SELECT COUNT(*) FROM customers</code> simply returns the total number of customers, whereas <code>SELECT COUNT(rating) FROM customers</code> returns the number of customers who have known ratings (that is, their ratings are not <code>null</code> or <code>missing</code>).</p>
</div>
<div class="paragraph">
<p>Because the aggregation pseudo-functions sometimes restructure their operands, they can be used only in query blocks where (explicit or implicit) grouping is being done. Therefore the pseudo-functions cannot operate directly on arrays or multisets. For operating directly on JSON collections, SQL&#43;&#43; provides a set of ordinary functions for computing aggregations. Each ordinary aggregation function (except the ones corresponding to <code>COUNT</code> and <code>ARRAY_AGG</code>) has two versions: one that ignores <code>null</code> and <code>missing</code> values and one that returns <code>null</code> if a <code>null</code> or <code>missing</code> value is encountered anywhere in the collection. The names of the aggregation functions are as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Aggregation pseudo-function; operates on groups only</th>
<th class="tableblock halign-left valign-top">Ordinary function: Ignores NULL or MISSING values</th>
<th class="tableblock halign-left valign-top">Ordinary function: Returns NULL if NULL or MISSING are encountered</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SUM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY_SUM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRICT_SUM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AVG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY_MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRICT_MAX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY_MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRICT_MIN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY_AVG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRICT_AVG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">COUNT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY_COUNT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRICT_COUNT (see exception below)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">STDDEV_SAMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY_STDDEV_SAMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRICT_STDDEV_SAMP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">STDDEV_POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY_STDDEV_POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRICT_STDDEV_POP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR_SAMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY_VAR_SAMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRICT_VAR_SAMP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR_POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY_VAR_POP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRICT_VAR_POP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SKEWENESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY_SKEWNESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRICT_SKEWNESS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KURTOSIS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY_KURTOSIS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRICT_KURTOSIS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY_AGG</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Exception: the ordinary aggregation function STRICT_COUNT operates on any collection, and returns a count of its items, including null values in the count. In this respect, STRICT_COUNT is more similar to COUNT(*) than to COUNT(expression).</p>
</div>
<div class="paragraph">
<p>Note that the ordinary aggregation functions that ignore <code>null</code> have names beginning with "ARRAY". This naming convention has historical roots. Despite their names, the functions operate on both arrays and multisets.</p>
</div>
<div class="paragraph">
<p>Because of the special properties of the aggregation pseudo-functions, SQL (and therefore SQL&#43;&#43;) is not a pure functional language. But every query that uses a pseudo-function can be expressed as an equivalent query that uses an ordinary function. Q3.23 is an example of how queries can be expressed without pseudo-functions. A more detailed explanation of all of the functions is also available in the section on <a href="8_builtin.html#AggregateFunctions">Aggregate Functions</a>.</p>
</div>
<h5 id="example-31" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.23) Alternative form of Q3.22, using the ordinary function <code>ARRAY_AVG</code> rather than the aggregating pseudo-function <code>AVG</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT ARRAY_AVG(
    (SELECT VALUE c.rating
    FROM customers AS c) ) AS `avg credit rating`;</pre>
</div>
</div>
<div class="paragraph">
<p>Result (same as Q3.22):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "avg credit rating": 670
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>If the function <code>STRICT_AVG</code> had been used in Q3.23 in place of <code>ARRAY_AVG</code>, the average credit rating returned by the query would have been <code>null</code>, because at least one customer has no credit rating.</p>
</div>
</div>
<div class="sect2">
<h3 id="Group_As_clauses"><a class="anchor" href="#Group_As_clauses"></a>GROUP AS Clause</h3>
<h5 id="groupasclause" class="discrete">GroupAsClause</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/GroupAsClause.png" alt="GroupAsClause">
</div>
</div>
<div class="paragraph">
<p>JSON is a hierarchical format, and a fully featured JSON query language needs to be able to produce hierarchies of its own, with computed data at every level of the hierarchy. The key feature of SQL&#43;&#43; that makes this possible is the <code>GROUP AS</code> clause.</p>
</div>
<div class="paragraph">
<p>A query may have a <code>GROUP AS</code> clause only if it has a <code>GROUP BY</code> clause. The <code>GROUP BY</code> clause "hides" the original objects in each group, exposing only the grouping expressions and special aggregation functions on the non-grouping fields. The purpose of the <code>GROUP AS</code> clause is to make the original objects in the group visible to subsequent clauses. Thus the query can generate output data both for the group as a whole and for the individual objects inside the group.</p>
</div>
<div class="paragraph">
<p>For each group, the <code>GROUP AS</code> clause preserves all the objects in the group, just as they were before grouping, and gives a name to this preserved group. The group name can then be used in the <code>FROM</code> clause of a subquery to process and return the individual objects in the group.</p>
</div>
<div class="paragraph">
<p>To see how this works, we&#8217;ll write some queries that investigate the customers in each zipcode and their credit ratings. This would be a good time to review the sample database in <a href="appendix_4_examples.html">Appendix 4</a>. A part of the data is summarized below.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Customers in zipcode 02115:
    C35, J. Roberts, rating 565
    C37, T. Henry, rating 750

Customers in zipcode 02340:
    C25, M. Sinclair, rating 690

Customers in zipcode 63101:
    C13, T. Cody, rating 750
    C31, B. Pruitt, (no rating)
    C41, R. Dodge, rating 640

Customers with no zipcode:
    C47, S. Logan, rating 625</pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s consider the effect of the following clauses:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c
GROUP BY c.address.zipcode
GROUP AS g</pre>
</div>
</div>
<div class="paragraph">
<p>This query fragment iterates over the <code>customers</code> objects, using the iteration variable <code>c</code>. The <code>GROUP BY</code> clause forms the objects into groups, each with a common zipcode (including one group for customers with no zipcode). After the <code>GROUP BY</code> clause, we can see the grouping expression, <code>c.address.zipcode</code>, but other fields such as <code>c.custid</code> and <code>c.name</code> are visible only to special aggregation functions.</p>
</div>
<div class="paragraph">
<p>The clause <code>GROUP AS g</code> now makes the original objects visible again. For each group in turn, the variable <code>g</code> is bound to a multiset of objects, each of which has a field named <code>c</code>, which in turn contains one of the original objects. Thus after <code>GROUP AS g</code>, for the group with zipcode 02115, <code>g</code> is bound to the following multiset:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    { "c":
        { "custid": "C35",
          "name": "J. Roberts",
          "address":
            { "street": "420 Green St.",
              "city": "Boston, MA",
              "zipcode": "02115"
            },
          "rating": 565
        }
    },
    { "c":
        { "custid": "C37",
          "name": "T. Henry",
          "address":
            { "street": "120 Harbor Blvd.",
              "city": "St. Louis, MO",
              "zipcode": "02115"
            },
          "rating": 750
        }
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Thus, the clauses following <code>GROUP AS</code> can see the original objects by writing subqueries that iterate over the multiset <code>g</code>.</p>
</div>
<div class="paragraph">
<p>The extra level named <code>c</code> was introduced into this multiset because the groups might have been formed from a join of two or more collections. Suppose that the <code>FROM</code> clause looked like <code>FROM customers AS c, orders AS o</code>. Then each item in the group would contain both a <code>customers</code> object and an <code>orders</code> object, and these two objects might both have a field with the same name. To avoid ambiguity, each of the original objects is wrapped in an "outer" object that gives it the name of its iteration variable in the <code>FROM</code> clause. Consider this fragment:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c, orders AS o
WHERE c.custid = o.custid
GROUP BY c.address.zipcode
GROUP AS g</pre>
</div>
</div>
<div class="paragraph">
<p>In this case, following <code>GROUP AS g</code>, the variable <code>g</code> would be bound to the following collection:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    { "c": { an original customers object },
      "o": { an original orders object }
    },
    { "c": { another customers object },
      "o": { another orders object }
    },
    ...
]</pre>
</div>
</div>
<div class="paragraph">
<p>After using <code>GROUP AS</code> to make the content of a group accessible, you will probably want to write a subquery to access that content. A subquery for this purpose is written in exactly the same way as any other subquery. The name specified in the <code>GROUP AS</code> clause (<code>g</code> in the above example) is the name of a collection of objects. You can write a <code>FROM</code> clause to iterate over the objects in the collection, and you can specify an iteration variable to represent each object in turn. For <code>GROUP AS</code> queries in this manual, we&#8217;ll use <code>g</code>as the name of the reconstituted group, and <code>gi</code> as an iteration variable representing one object inside the group. Of course, you can use any names you like for these purposes.</p>
</div>
<div class="paragraph">
<p>Now we are ready to take a look at how <code>GROUP AS</code> might be used in a query. Suppose that we want to group customers by zipcode, and for each group we want to see the average credit rating and a list of the individual customers in the group. Here&#8217;s a query that does that:</p>
</div>
<h5 id="example-32" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.24) For each zipcode, list the average credit rating in that zipcode, followed by the customer numbers and names in numeric order.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c
GROUP BY c.address.zipcode AS zip
GROUP AS g
SELECT zip, AVG(c.rating) AS `avg credit rating`,
    (FROM g AS gi
     SELECT gi.c.custid, gi.c.name
     ORDER BY gi.c.custid) AS `local customers`
ORDER BY zip;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "avg credit rating": 625,
        "local customers": [
            {
                "custid": "C47",
                "name": "S. Logan"
            }
        ]
    },
    {
        "avg credit rating": 657.5,
        "local customers": [
            {
                "custid": "C35",
                "name": "J. Roberts"
            },
            {
                "custid": "C37",
                "name": "T. Henry"
            }
        ],
        "zip": "02115"
    },
    {
        "avg credit rating": 690,
        "local customers": [
            {
                "custid": "C25",
                "name": "M. Sinclair"
            }
        ],
        "zip": "02340"
    },
    {
        "avg credit rating": 695,
        "local customers": [
            {
                "custid": "C13",
                "name": "T. Cody"
            },
            {
                "custid": "C31",
                "name": "B. Pruitt"
            },
            {
                "custid": "C41",
                "name": "R. Dodge"
            }
        ],
        "zip": "63101"
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Note that this query contains two <code>ORDER BY</code> clauses: one in the outer query and one in the subquery. These two clauses govern the ordering of the outer-level list of zipcodes and the inner-level lists of customers, respectively. Also note that the group of customers with no zipcode comes first in the output list.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Union_all"><a class="anchor" href="#Union_all"></a>Selection and UNION ALL</h2>
<div class="sectionbody">
<h5 id="selection-2" class="discrete">Selection</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/Selection.png" alt="Selection">
</div>
</div>
<h5 id="unionoption" class="discrete">UnionOption</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/UnionOption.png" alt="UnionOption">
</div>
</div>
<div class="paragraph">
<p>In a SQL&#43;&#43; query, two or more query blocks can be connected by the operator <code>UNION ALL</code>. The result of a <code>UNION ALL</code> between two query blocks contains all the items returned by the first query block, and all the items returned by the second query block. Duplicate items are not eliminated from the query result.</p>
</div>
<div class="paragraph">
<p>As in SQL, there is no ordering guarantee on the contents of the output stream. However, unlike SQL, the query language does not constrain what the data looks like on the input streams; in particular, it allows heterogeneity on the input and output streams. A type error will be raised if one of the inputs is not a collection.</p>
</div>
<div class="paragraph">
<p>When two or more query blocks are connected by <code>UNION ALL</code>, they can be followed by <code>ORDER BY</code>, <code>LIMIT</code>, and <code>OFFSET</code> clauses that apply to the <code>UNION</code> query as a whole. For these clauses to be meaningful, the field-names returned by the two query blocks should match. The following example shows a <code>UNION ALL</code> of two query blocks, with an ordering specified for the result.</p>
</div>
<div class="paragraph">
<p>In this example, a customer might be selected because he has ordered more than two different items (first query block) or because he has a high credit rating (second query block). By adding an explanatory string to each query block, the query writer can cause the output objects to be labeled to distinguish these two cases.</p>
</div>
<h5 id="example-33" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.25a) Find customer ids for customers who have placed orders for more than two different items or who have a credit rating greater than 700, with labels to distinguish these cases.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM orders AS o, o.items AS i
GROUP BY o.orderno, o.custid
HAVING COUNT(*) &gt; 2
SELECT DISTINCT o.custid AS customer_id, "Big order" AS reason

UNION ALL

FROM customers AS c
WHERE rating &gt; 700
SELECT c.custid AS customer_id, "High rating" AS reason
ORDER BY customer_id;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "reason": "High rating",
        "customer_id": "C13"
    },
    {
        "reason": "Big order",
        "customer_id": "C37"
    },
    {
        "reason": "High rating",
        "customer_id": "C37"
    },
    {
        "reason": "Big order",
        "customer_id": "C41"
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>If, on the other hand, you simply want a list of the customer ids and you don&#8217;t care to preserve the reasons, you can simplify your output by using <code>SELECT VALUE</code>, as follows:</p>
</div>
<div class="paragraph">
<p>(Q3.25b) Simplify Q3.25a to return a simple list of unlabeled customer ids.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM orders AS o, o.items AS i
GROUP BY o.orderno, o.custid
HAVING COUNT(*) &gt; 2
SELECT VALUE o.custid

UNION ALL

FROM customers AS c
WHERE rating &gt; 700
SELECT VALUE c.custid;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    "C37",
    "C41",
    "C13",
    "C37"
]</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="With_clauses"><a class="anchor" href="#With_clauses"></a>WITH Clause</h2>
<div class="sectionbody">
<h5 id="withclause" class="discrete">WithClause</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/WithClause.png" alt="WithClause">
</div>
</div>
<div class="paragraph">
<p>As in standard SQL, a <code>WITH</code> clause can be used to improve the modularity of a query. A <code>WITH</code> clause often contains a subquery that is needed to compute some result that is used later in the main query. In cases like this, you can think of the <code>WITH</code> clause as computing a "`temporary view" of the input data. The next example uses a <code>WITH</code> clause to compute the total revenue of each order in 2020; then the main part of the query finds the minimum, maximum, and average revenue for orders in that year.</p>
</div>
<h5 id="example-34" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.26) Find the minimum, maximum, and average revenue among all orders in 2020, rounded to the nearest integer.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>WITH order_revenue AS
    (FROM orders AS o, o.items AS i
    WHERE DATE_PART_STR(o.order_date, "year") = 2020
    GROUP BY o.orderno
    SELECT o.orderno, SUM(i.qty * i.price) AS revenue
  )
FROM order_revenue
SELECT AVG(revenue) AS average,
       MIN(revenue) AS minimum,
       MAX(revenue) AS maximum;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "average": 4669.99,
        "minimum": 130.45,
        "maximum": 18847.58
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p><code>WITH</code> can be particularly useful when a value needs to be used several times in a query.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Order_By_clauses"><a class="anchor" href="#Order_By_clauses"></a>ORDER BY, LIMIT, and OFFSET Clauses</h2>
<div class="sectionbody">
<h5 id="orderbyclause" class="discrete">OrderbyClause</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/OrderbyClause.png" alt="OrderbyClause">
</div>
</div>
<h5 id="limitclause" class="discrete">LimitClause</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/LimitClause.png" alt="LimitClause">
</div>
</div>
<h5 id="offsetclause" class="discrete">OffsetClause</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/OffsetClause.png" alt="OffsetClause">
</div>
</div>
<div class="paragraph">
<p>The last three (optional) clauses to be processed in a query are <code>ORDER BY</code>, <code>LIMIT</code>, and <code>OFFSET</code>.</p>
</div>
<div class="paragraph">
<p>The <code>ORDER BY</code> clause is used to globally sort data in either ascending order (i.e., <code>ASC</code>) or descending order (i.e., <code>DESC</code>).
During ordering (if the <code>NULLS</code> modifier is not specified), <code>MISSING</code> and <code>NULL</code> are treated as being smaller than any other value if they are encountered
in the ordering key(s). <code>MISSING</code> is treated as smaller than <code>NULL</code> if both occur in the data being sorted.
The <code>NULLS</code> modifier determines how <code>MISSING</code> and <code>NULL</code> are ordered relative to all other values:
first (<code>NULLS</code> <code>FIRST</code>) or last (<code>NULLS</code> <code>LAST</code>). The relative order between <code>MISSING</code> and <code>NULL</code> is not affected by the <code>NULLS</code> modifier
(i.e. <code>MISSING</code> is still treated as smaller than <code>NULL</code>). The ordering of values of a given type is consistent with its type&#8217;s <code>&lt;=</code> ordering;
the ordering of values across types is implementation-defined but stable.</p>
</div>
<div class="paragraph">
<p>The <code>LIMIT</code> clause is used to limit the result set to a specified maximum size.
The optional <code>OFFSET</code> clause is used to specify a number of items in the output stream to be discarded before the query result begins.
The <code>OFFSET</code> can also be used as a standalone clause, without the <code>LIMIT</code>.</p>
</div>
<div class="paragraph">
<p>The following example illustrates use of the <code>ORDER BY</code> and <code>LIMIT</code> clauses.</p>
</div>
<h5 id="example-35" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.27) Return the top three customers by rating.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c
SELECT c.custid, c.name, c.rating
ORDER BY c.rating DESC
LIMIT 3;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "custid": "C13",
        "name": "T. Cody",
        "rating": 750
    },
    {
        "custid": "C37",
        "name": "T. Henry",
        "rating": 750
    },
    {
        "custid": "C25",
        "name": "M. Sinclair",
        "rating": 690
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>The following example illustrates the use of <code>OFFSET</code>:</p>
</div>
<h5 id="example-36" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.38) Find the customer with the third-highest credit rating.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c
SELECT c.custid, c.name, c.rating
ORDER BY c.rating DESC
LIMIT 1 OFFSET 2;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "custid": "C25",
        "name": "M. Sinclair",
        "rating": 690
    }
]</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Subqueries"><a class="anchor" href="#Subqueries"></a>Subqueries</h2>
<div class="sectionbody">
<h5 id="subquery" class="discrete">Subquery</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/Subquery.png" alt="Subquery">
</div>
</div>
<div class="paragraph">
<p>A subquery is simply a query surrounded by parentheses. In SQL&#43;&#43;, a subquery can appear anywhere that an expression can appear. Like any query, a subquery always returns a collection, even if the collection contains only a single value or is empty. If the subquery has a SELECT clause, it returns a collection of objects. If the subquery has a SELECT VALUE clause, it returns a collection of scalar values. If a single scalar value is expected, the indexing operator [0] can be used to extract the single scalar value from the collection.</p>
</div>
<h5 id="example-37" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.29) (Subquery in SELECT clause)
For every order that includes item no. 120, find the order number, customer id, and customer name.</p>
</div>
<div class="paragraph">
<p>Here, the subquery is used to find a customer name, given a customer id. Since the outer query expects a scalar result, the subquery uses SELECT VALUE and is followed by the indexing operator [0].</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM orders AS o, o.items AS i
WHERE i.itemno = 120
SELECT o.orderno, o.custid,
    (FROM customers AS c
     WHERE c.custid = o.custid
     SELECT VALUE c.name)[0] AS name;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "orderno": 1003,
        "custid": "C31",
        "name": "B. Pruitt"
    },
    {
        "orderno": 1006,
        "custid": "C41",
        "name": "R. Dodge"
    }
]</pre>
</div>
</div>
<h5 id="example-38" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.30) (Subquery in WHERE clause)
Find the customer number, name, and rating of all customers whose rating is greater than the average rating.</p>
</div>
<div class="paragraph">
<p>Here, the subquery is used to find the average rating among all customers. Once again, SELECT VALUE and indexing [0] have been used to get a single scalar value.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM customers AS c1
WHERE c1.rating &gt;
   (FROM customers AS c2
    SELECT VALUE AVG(c2.rating))[0]
SELECT c1.custid, c1.name, c1.rating;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "custid": "C13",
        "name": "T. Cody",
        "rating": 750
    },
    {
        "custid": "C25",
        "name": "M. Sinclair",
        "rating": 690
    },
    {
        "custid": "C37",
        "name": "T. Henry",
        "rating": 750
    }
]</pre>
</div>
</div>
<h5 id="example-39" class="discrete">Example</h5>
<div class="paragraph">
<p>(Q3.31) (Subquery in FROM clause)
Compute the total revenue (sum over items of quantity time price) for each order, then find the average, maximum, and minimum total revenue over all orders.</p>
</div>
<div class="paragraph">
<p>Here, the FROM clause expects to iterate over a collection of objects, so the subquery uses an ordinary SELECT and does not need to be indexed. You might think of a FROM clause as a "natural home" for a subquery.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM
   (FROM orders AS o, o.items AS i
    GROUP BY o.orderno
    SELECT o.orderno, SUM(i.qty * i.price) AS revenue
   ) AS r
SELECT AVG(r.revenue) AS average,
       MIN(r.revenue) AS minimum,
       MAX(r.revenue) AS maximum;</pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[
    {
        "average": 4669.99,
        "minimum": 130.45,
        "maximum": 18847.58
    }
]</pre>
</div>
</div>
<div class="paragraph">
<p>Note the similarity between Q3.26 and Q3.31. This illustrates how a subquery can often be moved into a <code>WITH</code> clause to improve the modularity and readability of a query.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Over_clauses"><a class="anchor" href="#Over_clauses"></a>OVER Clause and Window Functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Window functions are special functions that compute aggregate values over a "window" of input data. Like an ordinary function, a window function returns a value for every item in the input dataset. But in the case of a window function, the value returned by the function can depend not only on the argument of the function, but also on other items in the same collection. For example, a window function applied to a set of employees might return the rank of each employee in the set, as measured by salary. As another example, a window function applied to a set of items, ordered by purchase date, might return the running total of the cost of the items.</p>
</div>
<div class="paragraph">
<p>A window function call is identified by an <code>OVER</code> clause, which can specify three things: partitioning, ordering, and framing. The partitioning specification is like a <code>GROUP BY</code>: it splits the input data into partitions. For example, a set of employees might be partitioned by department. The window function, when applied to a given object, is influenced only by other objects in the same partition. The ordering specification is like an <code>ORDER BY</code>: it determines the ordering of the objects in each partition. The framing specification defines a "frame" that moves through the partition, defining how the result for each object depends on nearby objects. For example, the frame for a current object might consist of the two objects before and after the current one; or it might consist of all the objects before the current one in the same partition. A window function call may also specify some options that control (for example) how nulls are handled by the function.</p>
</div>
<div class="paragraph">
<p>Here is an example of a window function call:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT deptno, purchase_date, item, cost,
    SUM(cost) OVER (
        PARTITION BY deptno
        ORDER BY purchase_date
        ROWS UNBOUNDED PRECEDING) AS running_total_cost
FROM purchases
ORDER BY deptno, purchase_date</pre>
</div>
</div>
<div class="paragraph">
<p>This example partitions the <code>purchases</code> dataset by department number. Within each department, it orders the <code>purchases</code> by date and computes a running total cost for each item, using the frame specification <code>ROWS UNBOUNDED PRECEDING</code>. Note that the <code>ORDER BY</code> clause in the window function is separate and independent from the <code>ORDER BY</code> clause of the query as a whole.</p>
</div>
<div class="paragraph">
<p>The general syntax of a window function call is specified in this section. SQL&#43;&#43; has a set of builtin window functions, which are listed and explained in the <a href="8_builtin.html#WindowFunctions">Window Functions</a> section of the builtin functions page. In addition, standard SQL aggregate functions such as <code>SUM</code> and <code>AVG</code> can be used as window functions if they are used with an <code>OVER</code> clause.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Window_function_call"><a class="anchor" href="#Window_function_call"></a>Window Function Call</h2>
<div class="sectionbody">
<h5 id="windowfunctioncall" class="discrete">WindowFunctionCall</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/WindowFunctionCall.png" alt="WindowFunctionCall">
</div>
</div>
<h5 id="windowfunctiontype" class="discrete">WindowFunctionType</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/WindowFunctionType.png" alt="WindowFunctionType">
</div>
</div>
<div class="paragraph">
<p>Refer to the <a href="8_builtin.html#AggregateFunctions">Aggregate Functions</a> section
for a list of aggregate functions.</p>
</div>
<div class="paragraph">
<p>Refer to the <a href="8_builtin.html#WindowFunctions">Window Functions</a> section for a
list of window functions.</p>
</div>
<div class="sect2">
<h3 id="Window_function_arguments"><a class="anchor" href="#Window_function_arguments"></a>Window Function Arguments</h3>
<h5 id="windowfunctionarguments" class="discrete">WindowFunctionArguments</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/WindowFunctionArguments.png" alt="WindowFunctionArguments">
</div>
</div>
<div class="paragraph">
<p>Refer to the <a href="8_builtin.html#AggregateFunctions">Aggregate Functions</a> section or the <a href="8_builtin.html#WindowFunctions">Window Functions</a> section for details of the arguments for individual functions.</p>
</div>
</div>
<div class="sect2">
<h3 id="Window_function_options"><a class="anchor" href="#Window_function_options"></a>Window Function Options</h3>
<h5 id="windowfunctionoptions" class="discrete">WindowFunctionOptions</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/WindowFunctionOptions.png" alt="WindowFunctionOptions">
</div>
</div>
<div class="paragraph">
<p>Window function options cannot be used with <a href="8_builtin.html#AggregateFunctions">aggregate functions</a>.</p>
</div>
<div class="paragraph">
<p>Window function options can only be used with some <a href="8_builtin.html#WindowFunctions">window functions</a>, as described below.</p>
</div>
<div class="paragraph">
<p>The <em>FROM modifier</em> determines whether the computation begins at the first or last tuple in the window. It is optional and can only be used with the <code>nth_value()</code> function. If it is omitted, the default setting is <code>FROM FIRST</code>.</p>
</div>
<div class="paragraph">
<p>The <em>NULLS modifier</em> determines whether NULL values are included in the computation, or ignored. MISSING values are treated the same way as NULL values. It is also optional and can only be used with the <code>first_value()</code>, <code>last_value()</code>, <code>nth_value()</code>, <code>lag()</code>, and <code>lead()</code> functions. If omitted, the default setting is <code>RESPECT NULLS</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Window_frame_variable"><a class="anchor" href="#Window_frame_variable"></a>Window Frame Variable</h3>
<div class="paragraph">
<p>The <code>AS</code> keyword enables you to specify an alias for the window frame contents. It introduces a variable which will be bound to the contents of the frame. When using a built-in <a href="8_builtin.html#AggregateFunctions">aggregate function</a> as a window function, the function&#8217;s argument must be a subquery which refers to this alias, for example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT ARRAY_COUNT(DISTINCT (FROM alias SELECT VALUE alias.src.field))
OVER alias AS (PARTITION BY … ORDER BY …)
FROM source AS src</pre>
</div>
</div>
<div class="paragraph">
<p>The alias is not necessary when using a <a href="8_builtin.html#WindowFunctions">window function</a>, or when using a standard SQL aggregate function with the <code>OVER</code> clause.</p>
</div>
</div>
<div class="sect2">
<h3 id="Window_definition"><a class="anchor" href="#Window_definition"></a>Window Definition</h3>
<h5 id="windowdefinition" class="discrete">WindowDefinition</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/WindowDefinition.png" alt="WindowDefinition">
</div>
</div>
<div class="paragraph">
<p>The <em>window definition</em> specifies the partitioning, ordering, and framing for window functions.</p>
</div>
<div class="sect3">
<h4 id="Window_partition_clause"><a class="anchor" href="#Window_partition_clause"></a>Window Partition Clause</h4>
<div class="sect4">
<h5 id="windowpartitionclause"><a class="anchor" href="#windowpartitionclause"></a>WindowPartitionClause</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/WindowPartitionClause.png" alt="WindowPartitionClause">
</div>
</div>
<div class="paragraph">
<p>The <em>window partition clause</em> divides the tuples into logical partitions
using one or more expressions.</p>
</div>
<div class="paragraph">
<p>This clause may be used with any <a href="8_builtin.html#WindowFunctions">window function</a>,
or any <a href="8_builtin.html#AggregateFunctions">aggregate function</a> used as a window
function.</p>
</div>
<div class="paragraph">
<p>This clause is optional.
If omitted, all tuples are united in a single partition.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Window_order_clause"><a class="anchor" href="#Window_order_clause"></a>Window Order Clause</h4>
<div class="sect4">
<h5 id="windoworderclause"><a class="anchor" href="#windoworderclause"></a>WindowOrderClause</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/WindowOrderClause.png" alt="WindowOrderClause">
</div>
</div>
<div class="paragraph">
<p>The <em>window order clause</em> determines how tuples are ordered within each partition. The window function works on tuples in the order specified by this clause.</p>
</div>
<div class="paragraph">
<p>This clause may be used with any <a href="8_builtin.html#WindowFunctions">window function</a>, or any <a href="8_builtin.html#AggregateFunctions">aggregate function</a> used as a window function.</p>
</div>
<div class="paragraph">
<p>This clause is optional. If omitted, all tuples are considered peers, i.e. their order is tied. When tuples in the window partition are tied, each window function behaves differently.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>row_number()</code> function returns a distinct number for each tuple.
If tuples are tied, the results may be unpredictable.</p>
</li>
<li>
<p>The <code>rank()</code>, <code>dense_rank()</code>, <code>percent_rank()</code>, and <code>cume_dist()</code> functions
return the same result for each tuple.</p>
</li>
<li>
<p>For other functions, if the <a href="#Window_frame_clause">window frame</a> is
defined by <code>ROWS</code>, the results may be unpredictable.
If the window frame is defined by <code>RANGE</code> or <code>GROUPS</code>, the results are same
for each tuple.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This clause does not guarantee the overall order of the query results. To guarantee the order of the final results, use the query <code>ORDER BY</code> clause.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Window_frame_clause"><a class="anchor" href="#Window_frame_clause"></a>Window Frame Clause</h4>
<div class="sect4">
<h5 id="windowframeclause"><a class="anchor" href="#windowframeclause"></a>WindowFrameClause</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/WindowFrameClause.png" alt="WindowFrameClause">
</div>
</div>
<div class="paragraph">
<p>The <em>window frame clause</em> defines the window frame. It can be used with all <a href="8_builtin.html#AggregateFunctions">aggregate functions</a> and some <a href="8_builtin.html#WindowFunctions">window functions</a> &mdash; refer to the descriptions of individual functions for more details.  It is optional and allowed only when the <a href="#Window_order_clause">window order clause</a> is present.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If this clause is omitted and there is no <a href="#Window_order_clause">window order clause</a>, the window frame is the entire partition.</p>
</li>
<li>
<p>If this clause is omitted but there is a <a href="#Window_order_clause">window order clause</a>, the window frame becomes all tuples
in the partition preceding the current tuple and its peers &mdash; the same as <code>RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The window frame can be defined in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ROWS</code>: Counts the exact number of tuples within the frame. If window ordering doesn&#8217;t result in unique ordering, the function may produce unpredictable results. You can add a unique expression or more window ordering expressions to produce unique ordering.</p>
</li>
<li>
<p><code>RANGE</code>: Looks for a value offset within the frame. The function produces deterministic results.</p>
</li>
<li>
<p><code>GROUPS</code>: Counts all groups of tied rows within the frame. The function produces deterministic results.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If this clause uses <code>RANGE</code> with either <em>Expr</em> <code>PRECEDING</code> or <em>Expr</em> <code>FOLLOWING</code>, the <a href="#Window_order_clause">window order clause</a> must have only a single ordering term.
The ordering term expression must evaluate to a number.
If these conditions are not met, the window frame will be empty, which means the window function will return its default value: in most cases this is <code>null</code>, except for <code>strict_count()</code> or <code>array_count()</code>, whose default value is 0. This restriction does not apply when the window frame uses <code>ROWS</code> or <code>GROUPS</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>RANGE</code> window frame is commonly used to define window frames based
on date or time.
If you want to use <code>RANGE</code> with either <em>Expr</em> <code>PRECEDING</code> or <em>Expr</em> <code>FOLLOWING</code>, and you want to use an ordering expression based on date or time, the expression in <em>Expr</em> <code>PRECEDING</code> or <em>Expr</em> <code>FOLLOWING</code> must use a data type that can be added to the ordering expression.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Window_frame_extent"><a class="anchor" href="#Window_frame_extent"></a>Window Frame Extent</h4>
<div class="sect4">
<h5 id="windowframeextent"><a class="anchor" href="#windowframeextent"></a>WindowFrameExtent</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/WindowFrameExtent.png" alt="WindowFrameExtent">
</div>
</div>
<div class="paragraph">
<p>The <em>window frame extent clause</em> specifies the start point and end point of the window frame.
The expression before <code>AND</code> is the start point and the expression after <code>AND</code> is the end point.
If <code>BETWEEN</code> is omitted, you can only specify the start point; the end point becomes <code>CURRENT ROW</code>.</p>
</div>
<div class="paragraph">
<p>The window frame end point can&#8217;t be before the start point. If this clause violates this restriction explicitly, an error will result. If it violates this restriction implicitly, the window frame will be empty, which means the window function will return its default value: in most cases this is <code>null</code>, except for <code>strict_count()</code> or
<code>array_count()</code>, whose default value is 0.</p>
</div>
<div class="paragraph">
<p>Window frame extents that result in an explicit violation are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BETWEEN CURRENT ROW AND</code> <em>Expr</em> <code>PRECEDING</code></p>
</li>
<li>
<p><code>BETWEEN</code> <em>Expr</em> <code>FOLLOWING AND</code> <em>Expr</em> <code>PRECEDING</code></p>
</li>
<li>
<p><code>BETWEEN</code> <em>Expr</em> <code>FOLLOWING AND CURRENT ROW</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Window frame extents that result in an implicit violation are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BETWEEN UNBOUNDED PRECEDING AND</code> <em>Expr</em> <code>PRECEDING</code> &mdash; if <em>Expr</em> is too high, some tuples may generate an empty window frame.</p>
</li>
<li>
<p><code>BETWEEN</code> <em>Expr</em> <code>PRECEDING AND</code> <em>Expr</em> <code>PRECEDING</code> &mdash; if the second  <em>Expr</em> is greater than or equal to the first <em>Expr</em>, all result sets will generate an empty window frame.</p>
</li>
<li>
<p><code>BETWEEN</code> <em>Expr</em> <code>FOLLOWING AND</code> <em>Expr</em> <code>FOLLOWING</code> &mdash; if the first <em>Expr</em> is greater than or equal to the second <em>Expr</em>, all result sets will generate an empty window frame.</p>
</li>
<li>
<p><code>BETWEEN</code> <em>Expr</em> <code>FOLLOWING AND UNBOUNDED FOLLOWING</code> &mdash; if <em>Expr</em> is too high, some tuples may generate an empty window frame.</p>
</li>
<li>
<p>If the <a href="#Window_frame_exclusion">window frame exclusion clause</a> is present, any window frame specification may result in empty window frame.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>Expr</em> must be a positive constant or an expression that evaluates as a positive number. For <code>ROWS</code> or <code>GROUPS</code>, the <em>Expr</em> must be an integer.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Window_frame_exclusion"><a class="anchor" href="#Window_frame_exclusion"></a>Window Frame Exclusion</h4>
<div class="sect4">
<h5 id="windowframeexclusion"><a class="anchor" href="#windowframeexclusion"></a>WindowFrameExclusion</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/WindowFrameExclusion.png" alt="WindowFrameExclusion">
</div>
</div>
<div class="paragraph">
<p>The <em>window frame exclusion clause</em> enables you to exclude specified tuples from the window frame.</p>
</div>
<div class="paragraph">
<p>This clause can be used with all <a href="8_builtin.html#AggregateFunctions">aggregate functions</a> and some <a href="8_builtin.html#WindowFunctions">window functions</a> &mdash; refer to the descriptions of individual functions for more details.</p>
</div>
<div class="paragraph">
<p>This clause is allowed only when the <a href="#Window_frame_clause">window frame clause</a> is present.</p>
</div>
<div class="paragraph">
<p>This clause is optional. If this clause is omitted, the default is no exclusion &mdash; the same as <code>EXCLUDE NO OTHERS</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EXCLUDE CURRENT ROW</code>: If the current tuple is still part of the window frame, it is removed from the window frame.</p>
</li>
<li>
<p><code>EXCLUDE GROUP</code>: The current tuple and any peers of the current tuple are removed from the window frame.</p>
</li>
<li>
<p><code>EXCLUDE TIES</code>: Any peers of the current tuple, but not the current tuple itself, are removed from the window frame.</p>
</li>
<li>
<p><code>EXCLUDE NO OTHERS</code>: No additional tuples are removed from the window frame.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the current tuple is already removed from the window frame, then it remains removed from the window frame.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Vs_SQL-92"><a class="anchor" href="#Vs_SQL-92"></a>Differences from SQL-92</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SQL&#43;&#43; offers the following additional features beyond SQL-92:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fully composable and functional: A subquery can iterate over any intermediate collection and can appear anywhere in a query.</p>
</li>
<li>
<p>Schema-free: The query language does not assume the existence of a static schema for any data that it processes.</p>
</li>
<li>
<p>Correlated <code>FROM</code> terms: A right-side <code>FROM</code> term expression can refer to variables defined by <code>FROM</code> terms on its left.</p>
</li>
<li>
<p>Powerful <code>GROUP BY</code>: In addition to a set of aggregate functions as in standard SQL, the groups created by the <code>GROUP BY</code> clause are directly usable in nested queries and/or to obtain nested results.</p>
</li>
<li>
<p>Generalized <code>SELECT</code> clause: A <code>SELECT</code> clause can return any type of collection, while in SQL-92, a <code>SELECT</code> clause has to return a (homogeneous) collection of objects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following matrix is a quick "SQL-92 compatibility cheat sheet" for SQL&#43;&#43;.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">SQL&#43;&#43;</th>
<th class="tableblock halign-left valign-top">SQL-92</th>
<th class="tableblock halign-left valign-top">Why different?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELECT *</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns nested objects</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns flattened concatenated objects</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nested collections are 1st class citizens</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELECT list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">order not preserved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">order preserved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fields in a JSON object are not ordered</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subquery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The returned collection is cast into a scalar value if the subquery appears in a SELECT list or on one side of a comparison or as input to a function</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nested collections are 1st class citizens</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LEFT OUTER JOIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fills in <code>MISSING</code>(s) for non-matches</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fills in <code>NULL</code>(s) for non-matches</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Absence" is more appropriate than "unknown" here</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNION ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows heterogeneous inputs and output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input streams must be UNION-compatible and output field names are drawn from the first input stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Heterogenity and nested collections are common</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IN constant_expr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The constant expression has to be an array or multiset, i.e., [..,..,&#8230;&#8203;]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The constant collection can be represented as comma-separated items in a paren pair</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nested collections are 1st class citizens</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String literal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double quotes or single quotes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single quotes only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double quoted strings are pervasive in JSON</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delimited identifiers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backticks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double quotes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double quoted strings are pervasive in JSON</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following SQL-92 features are not implemented yet. However, SQL&#43;&#43; does not conflict with these features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CROSS JOIN, NATURAL JOIN, UNION JOIN</p>
</li>
<li>
<p>FULL OUTER JOIN</p>
</li>
<li>
<p>INTERSECT, EXCEPT, UNION with set semantics</p>
</li>
<li>
<p>CAST expression</p>
</li>
<li>
<p>ALL and SOME predicates for linking to subqueries</p>
</li>
<li>
<p>UNIQUE predicate (tests a collection for duplicates)</p>
</li>
<li>
<p>MATCH predicate (tests for referential integrity)</p>
</li>
<li>
<p>Row and Table constructors</p>
</li>
<li>
<p>Preserved order for expressions in a SELECT list</p>
</li>
</ul>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
