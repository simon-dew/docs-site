<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>cbbackupmgr restore | Couchbase Docs (Staging)</title>
<link rel="canonical" href="https://simon-dew.github.io/docs-site/MB-42134/server/6.6/backup-restore/cbbackupmgr-restore.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Restores data from the backup archive to a Couchbase cluster">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">
<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="6.6">
<meta name="generator" content="Antora 3.0.0-alpha.5">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://simon-dew.github.io/docs-site/MB-42134/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a href="https://cloud.couchbase.com/sign-up" class="free-trial-link" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  <i class="fas fa-cloud"></i>
                  Free Trial
                </a>
                <a class="btn btn-primary try-btn"  onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<nav class="nav">
</nav>
<aside class="toc sidebar">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/simondew/GitHub/couchbase/backup/docs/modules/backup-restore/pages/cbbackupmgr-restore.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../index.html">server</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">cbbackupmgr restore</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Restores data from the backup archive to a Couchbase cluster</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="synopsis"><a class="anchor" href="#synopsis"></a>SYNOPSIS</h2>
<div class="sectionbody">
<div class="verseblock">
<pre class="content">cbbackupmgr restore [--archive &lt;archive_dir&gt;] [--repo &lt;repo_name&gt;]
                    [--cluster &lt;host&gt;] [--username &lt;username&gt;]
                    [--password &lt;password&gt;] [--start &lt;backup&gt;] [--end &lt;backup&gt;]
                    [--include-buckets &lt;buckets&gt;]
                    [--exclude-bucket &lt;buckets&gt;] [--map-buckets &lt;list&gt;]
                    [--disable-bucket-config] [--disable-analytics]
                    [--disable-views] [--disable-gsi-indexes]
                    [--disable-ft-indexes] [--disable-ft-alias]
                    [--disable-data] [--disable-eventing] [--replace-ttl &lt;type&gt;]
                    [--replace-ttl-with &lt;timestamp&gt;] [--force-updates]
                    [--threads &lt;integer&gt;] [--vbucket-filter &lt;integer_list&gt;]
                    [--no-progress-bar] [--auto-create-buckets]
                    [--continue-on-cs-failure] [--restore-partial-backups]
                    [--obj-access-key-id &lt;access_key_id&gt;] [--obj-cacert &lt;cert_path&gt;]
                    [--obj-endpoint &lt;endpoint&gt;] [--obj-read-only-mode]
                    [--obj-no-ssl-verify] [--obj-region &lt;region&gt;]
                    [--obj-staging-dir &lt;staging_dir&gt;]
                    [--obj-secret-access-key &lt;secret_access_key&gt;]
                    [--s3-force-path-style] [--s3-log-level &lt;level&gt;]
                    [--filter-keys &lt;regexp&gt;] [--filter-values &lt;regexp&gt;]</pre>
</div>
</div>
</div>
<div class="sect1">
<h2 id="description"><a class="anchor" href="#description"></a>DESCRIPTION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Restores data from the backup archive to a target Couchbase cluster. By default
all data, index definitions, view definitions, full-text index definitions and
bucket configuration data are restored to the cluster unless specified otherwise
in the repos backup config or though command line parameters when running the
restore command. For example, if you changed bucket configuration settings since
your last backup then restoring a previous backup will by default overwrite
these settings unless you explicitly tell cbbackupmgr not to restore the bucket
settings using the --disable-bucket-config flag.</p>
</div>
<div class="paragraph">
<p>The restore command is capable of restoring a single backup or a range of
backups. When restoring a single backup, all data from that backup is restored.
If a range of backups is restored, then cbbackupmgr will take into account
any failovers that may have occurred in between the time that the backups were
originally taken. If a failover did occur in between the backups, and the backup
archive contains data that no longer exists in the cluster, then the data that
no longer exists will be skipped during the restore. If no failovers occurred in
between backups then restoring a range of backups will restore all data from
each backup. If all data must be restored regardless of whether a failover
occurred in between the original backups, then data should be restored one
backup at a time.</p>
</div>
<div class="paragraph">
<p>The restore command is guaranteed to work during rebalances and failovers. If a
rebalance is taking place, cbbackupmgr will track the movement of vbuckets
around a Couchbase cluster and ensure that data is restored to the appropriate
node. If a failover occurs during the restore then the client will wait 180
seconds for the failed node to be removed from the cluster. If the failed node
is not removed in 180 seconds then the restore will fail, but if the failed node
is removed before the timeout then data will continue to be restored.</p>
</div>
<div class="paragraph">
<p>Note that if you are restoring indexes then it is highly likely that you will
need to take some manual steps in order to properly restore them. This is
because by default indexes will only be built if they are restored to the exact
same index node that they were backed up from. If the index node they were
backed up from does not exist then the indexes will be restored in round-robin
fashion among the current indexer nodes. These indexes will be created, but not
built and will required the administrator to manually build them. We do this
because we cannot know the optimal index topology ahead of time. By not building
the indexes the administrator can move each index between nodes and build them
when they deem that the index topology is optimal.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="options"><a class="anchor" href="#options"></a>OPTIONS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Below is a list of required and optional parameters for the restore command.</p>
</div>
<div class="sect2">
<h3 id="required"><a class="anchor" href="#required"></a>Required</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">-a,--archive &lt;archive_dir&gt;</dt>
<dd>
<p>The directory containing the backup repository to restore data from. When
restoring from an archive stored in S3 prefix the archive path with
<code>s3://${BUCKET_NAME}/</code>.</p>
</dd>
<dt class="hdlist1">-r,--repo &lt;repo_name&gt;</dt>
<dd>
<p>The name of the backup repository to restore data from.</p>
</dd>
<dt class="hdlist1">-c,--cluster &lt;hostname&gt;</dt>
<dd>
<p>The hostname of one of the nodes in the cluster to restore data to. See the
Host Formats section below for hostname specification details.</p>
</dd>
<dt class="hdlist1">-u,--username &lt;username&gt;</dt>
<dd>
<p>The username for cluster authentication. The user must have the appropriate
privileges to take a backup.</p>
</dd>
<dt class="hdlist1">-p,--password &lt;password&gt;</dt>
<dd>
<p>The password for cluster authentication. The user must have the appropriate
privileges to take a backup. If not password is supplied to this option then
you will be prompted to enter your password.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="optional"><a class="anchor" href="#optional"></a>Optional</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">--start &lt;backup&gt;</dt>
<dd>
<p>The name of the  first backup in  the backup repository to restore or an index
value which references an incremental backup. Valid index values are any
positive integer, "oldest", and "latest". If a positive integer is used then
it should reference the index of the incremental backup starting from the
oldest to the most recent backup. For example, "1" corresponds to the oldest
backup, "2" corresponds to the second oldest backup, and so on. Specifying
"oldest" means that the index of the oldest backup should be used and
specifying "latest" means the index of the most recent backup should be
used. If this flag is not specified then the restore will start with the
oldest backup in the backup repository.</p>
</dd>
<dt class="hdlist1">--end &lt;backup&gt;</dt>
<dd>
<p>The name of the last backup in the backup repository to restore or an index
value which references an incremental backup. Valid index values are any
positive integer, "oldest", and "latest". If a positive integer is used then
it should reference the index of the incremental backup starting from the
oldest to the most recent backup. For example, "1" corresponds to the oldest
backup, "2" corresponds to the second oldest backup, and so on. Specifying
"oldest" means that the index of the oldest backup should be used and
specifying "latest" means the index of the most recent backup should be
used. If this flag is not specified then the restore will end with the most
recent backup in the backup repository.</p>
</dd>
<dt class="hdlist1">--include-buckets &lt;buckets&gt;</dt>
<dd>
<p>Only restore the buckets in the comma separated list &lt;buckets&gt;.</p>
</dd>
<dt class="hdlist1">--exclude-buckets &lt;buckets&gt;</dt>
<dd>
<p>Skip the restore for the buckets in the comma separated list &lt;buckets&gt;.</p>
</dd>
<dt class="hdlist1">--filter-keys</dt>
<dd>
<p>Only restore data where the key matches a particular regular expression.
The regular expressions provided must follow
<a href="https://github.com/google/re2/wiki/Syntax">RE2 syntax</a>.</p>
</dd>
<dt class="hdlist1">--filter-values</dt>
<dd>
<p>Only restore data where the value matches a particular regular expression.
The regular expressions provided must follow
<a href="https://github.com/google/re2/wiki/Syntax">RE2 syntax</a>.</p>
</dd>
<dt class="hdlist1">--enable-bucket-config</dt>
<dd>
<p>Enables restoring the bucket configuration.</p>
</dd>
<dt class="hdlist1">--disable-views</dt>
<dd>
<p>Skips restoring view definitions for all buckets.</p>
</dd>
<dt class="hdlist1">--disable-gsi-indexes</dt>
<dd>
<p>Skips restoring gsi index definitions for all buckets.</p>
</dd>
<dt class="hdlist1">--disable-ft-indexes</dt>
<dd>
<p>Skips restoring full-text index definitions for all buckets.</p>
</dd>
<dt class="hdlist1">--disable-ft-alias</dt>
<dd>
<p>Skips restoring full-text alias definitions.</p>
</dd>
<dt class="hdlist1">--disable-data</dt>
<dd>
<p>Skips restoring all key-value data for all buckets.</p>
</dd>
<dt class="hdlist1">--disable-analytics</dt>
<dd>
<p>Skips restoring analytics data.</p>
</dd>
<dt class="hdlist1">--disable-eventing</dt>
<dd>
<p>Skips restoring the eventing service metadata.</p>
</dd>
<dt class="hdlist1">--force-updates</dt>
<dd>
<p>Forces data in the Couchbase cluster to be overwritten even if the data in
the cluster is newer. By default updates are not forced and all updates use
Couchbase&#8217;s conflict resolution mechanism to ensure that if newer data
exists on the cluster that is not overwritten by older restore data.</p>
</dd>
<dt class="hdlist1">--map-buckets &lt;bucket_mapping&gt;</dt>
<dd>
<p>Specified when you want to restore a backup to a destination bucket that has
a different name than the bucket that was originally backed up. This
parameter takes a list of mappings since multiple buckets may be restored at
the same time. Each bucket mapping is separated by an "=" and if multiple
bucket mappings are specified then they should be comma separated. If we
have two buckets, bucket-1 and bucket-2, and we want to restore them to
renamed-1 and renamed-2 then we would denote the mapping as
"bucket-1=renamed-1,bucket-2=renamed-2". This option will only restore data
to the Data service and will not restore the metadata for any other service.</p>
</dd>
<dt class="hdlist1">--replace-ttl &lt;type&gt;</dt>
<dd>
<p>Sets a new expiration (time-to-live) value for the specified keys. This
parameter can either be set to "none", "all" or "expired" and should be used
along with the --replace-ttl-with flag. If "none" is supplied then the TTL
values are not changed. If "all" is specified then the TTL values for all
keys are replaced with the value of the --replace-ttl-with flag.  If
"expired" is set then only keys which have already expired will have the
TTL&#8217;s replaced.</p>
</dd>
<dt class="hdlist1">--replace-ttl-with &lt;timestamp&gt;</dt>
<dd>
<p>Updates the expiration for the keys specified by the --replace-ttl parameter.
The parameter has to be set when --replace-ttl is set to "all". There are two
options, RFC3339 time stamp format (2006-01-02T15:04:05-07:00) or "0". When
"0" is specified the expiration will be removed. Please note that the RFC3339
value is converted to a Unix time stamp on the cbbackupmgr client. It is
important that the time on both the client and the Couchbase Server are the
same to ensure expiry happens correctly.</p>
</dd>
<dt class="hdlist1">--vbucket-filter &lt;list&gt;</dt>
<dd>
<p>Specifies a list of VBuckets that should be restored. VBuckets are specified
as a comma separated list of integers. If this parameter is not set then all
vBuckets which were backed up are restored.</p>
</dd>
<dt class="hdlist1">--no-ssl-verify</dt>
<dd>
<p>Skips the SSL verification phase. Specifying this flag will allow a
connection using SSL encryption, but will not verify the identity of the
server you connect to. You are vulnerable to a man-in-the-middle attack if
you use this flag. Either this flag or the --cacert flag must be specified
when using an SSL encrypted connection.</p>
</dd>
<dt class="hdlist1">--cacert &lt;cert_path&gt;</dt>
<dd>
<p>Specifies a CA certificate that will be used to verify the identity of the
server being connecting to. Either this flag or the --no-ssl-verify flag
must be specified when using an SSL encrypted connection.</p>
</dd>
<dt class="hdlist1">-t,--threads &lt;num&gt;</dt>
<dd>
<p>Specifies the number of concurrent clients to use when restoring data. Fewer
clients means restores will take longer, but there will be less cluster
resources used to complete the restore. More clients means faster restores,
but at the cost of more cluster resource usage. This parameter defaults to 1
if it is not specified and it is recommended that this parameter is not set
to be higher than the number of CPUs on the machine where the restore is
taking place.</p>
</dd>
<dt class="hdlist1">--no-progress-bar</dt>
<dd>
<p>By default, a progress bar is printed to stdout so that the user can see how
long the restore is expected to take, the amount of data that is being
transferred per second, and the amount of data that has been restored.
Specifying this flag disables the progress bar and is useful when running
automated jobs.</p>
</dd>
<dt class="hdlist1">--auto-create-buckets</dt>
<dd>
<p>It will create the destination buckets if not present in the server.</p>
</dd>
<dt class="hdlist1">--continue-on-cs-failure</dt>
<dd>
<p>It&#8217;s possible that during a restore, a checksum validation will fail; in this
case the restore will fail fast. Supplying this flag will mean that the restore
will attempt to continue upon receiving a checksum failure. See CHECKSUM FAILURE
for more information.</p>
</dd>
<dt class="hdlist1">--restore-partial-backups</dt>
<dd>
<p>Allow a restore to continue when the final backup in the restore range is
incomplete. This flag is incompatible with the <code>--obj-read-only</code> flag.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="cloud-integration"><a class="anchor" href="#cloud-integration"></a>Cloud integration</h3>
<div class="sect3">
<h4 id="required-2"><a class="anchor" href="#required-2"></a>Required</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">--obj-staging-dir &lt;staging_dir&gt;</dt>
<dd>
<p>When performing an operation on an archive which is located in the cloud such
as AWS, the staging directory is used to store local meta data files. This
directory can be temporary (it&#8217;s not treated as a persistent store) and is
only used during the backup. NOTE: Do not use <code>/tmp</code> as the <code>obj-staging-dir</code>.
See <code>Disk requirements</code> in <a href="cbbackupmgr-cloud.html" class="page">cbbackupmgr-cloud</a> for more information.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="optional-2"><a class="anchor" href="#optional-2"></a>Optional</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">--obj-access-key-id &lt;access_key_id&gt;</dt>
<dd>
<p>The access key id which has access to your chosen object store. This option
can be omitted when using the shared config functionality provided by your
chosen object store. Can alternatively be provided using the
<code>CB_OBJSTORE_ACCESS_KEY_ID</code> environment variable.</p>
</dd>
<dt class="hdlist1">--obj-cacert &lt;cert_path&gt;</dt>
<dd>
<p>Specifies a CA certificate that will be used to verify the identity of the
object store being connected to.</p>
</dd>
<dt class="hdlist1">--obj-endpoint &lt;endpoint&gt;</dt>
<dd>
<p>The host/address of your object store.</p>
</dd>
<dt class="hdlist1">--obj-read-only</dt>
<dd>
<p>Enable read only mode. When interacting with a cloud archive modifications
will be made e.g. a lockfile will be created, log rotation will take place
and the modified logs will be uploaded upon completion of the subcommand.
This flag disables these features should you wish to interact with an archive
in a container where you lack write permissions. This flag should be used
with caution and you should be aware that your logs will not be uploaded to
the cloud. This means that it&#8217;s important that if you encounter an error you
don&#8217;t remove you staging directory (since logs will still be created in there
and collected by the <code>collect-logs</code> subcommand).</p>
</dd>
<dt class="hdlist1">--obj-no-ssl-verify</dt>
<dd>
<p>Skips the SSL verification phase when connecting to the object store.
Specifying this flag will allow a connection using SSL encryption, but you
are vulnerable to a man-in-the-middle attack.</p>
</dd>
<dt class="hdlist1">--obj-region &lt;region&gt;</dt>
<dd>
<p>The region in which your bucket/container resides. For AWS this option may be
omitted when using the shared config functionality. See the AWS section of
the cloud documentation for more information.</p>
</dd>
<dt class="hdlist1">--obj-secret-access-key &lt;secret_access_key&gt;</dt>
<dd>
<p>The secret access key which has access to you chosen object store. This
option can be omitted when using the shared config functionality provided by
your chosen object store. Can alternatively be provided using the
<code>CB_OBJSTORE_SECRET_ACCESS_KEY</code> environment variable.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="aws-s3-options"><a class="anchor" href="#aws-s3-options"></a>AWS S3 Options</h4>
<div class="sect4">
<h5 id="optional-3"><a class="anchor" href="#optional-3"></a>Optional</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">--s3-force-path-style</dt>
<dd>
<p>By default the updated virtual style paths will be used when interfacing with
AWS S3. This option will force the AWS SDK to use the alternative path style
URLs which are often required by S3 compatible object stores.</p>
</dd>
<dt class="hdlist1">--s3-log-level &lt;level&gt;</dt>
<dd>
<p>  Set the log level for the AWS SDK. By default logging will be disabled. Valid
  options are <code>debug</code>, <code>debug-with-signing</code>, <code>debug-with-body</code>,
  <code>debug-with-request-retries</code>, <code>debug-with-request-errors</code>, and
  <code>debug-with-event-stream-body</code>.
:!supports_read_only_mode:</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="host-formats"><a class="anchor" href="#host-formats"></a>HOST FORMATS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When specifying a host for the couchbase-cli command the following formats are expected:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>couchbase://&lt;addr&gt;</code></p>
</li>
<li>
<p><code>&lt;addr&gt;:&lt;port&gt;</code></p>
</li>
<li>
<p><code>http://&lt;addr&gt;:&lt;port&gt;</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is recommended to use the couchbase://&lt;addr&gt; format for standard
installations. The other two formats allow an option to take a port number which
is needed for non-default installations where the admin port has been set up on
a port other that 8091.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="#examples"></a>EXAMPLES</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The restore command can be used to restore a single backup or range of backups
in a backup repository. In the examples below, we will look a few different ways
to restore data from a backup repository. All examples will assume that the
backup archive is located at /data/backups and that all backups are located in
the "example" backup repository.</p>
</div>
<div class="paragraph">
<p>The first thing to do when getting ready to restore data is to decide which
backups to restore. The easiest way to do this is to use the list command to see
which backups are available to restore.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr list --archive /data/backups --repo example</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Size      Items          Name
2.24GB    -              + example
1.11GB    -                  + 2016-03-08T14_41_10.757145596-08_00
1.11GB    -                      + default
295B      0                          bucket-config.json
1.11GB    983797                     + data
1.11GB    983797                         shard_0.fdb
2B        0                          full-text.json
128B      0                          gsi.json
2B        0                          views.json
430.52MB  -                  + 2016-03-09T14_42_24.024494032-08_00
430.52MB  -                      + default
295B      0                          bucket-config.json
430.52MB  334400                     + data
430.52MB  334400                         shard_0.fdb
2B        0                          full-text.json
128B      0                          gsi.json
2B        0                          views.json
728.72MB  -                  + 2016-03-10T14_42_58.743250296-08_00
728.72MB  -                      + default
295B      0                          bucket-config.json
728.72MB  607500                     + data
728.72MB  607500                         shard_0.fdb
2B        0                          full-text.json
128B      0                          gsi.json
2B        0                          views.json</pre>
</div>
</div>
<div class="paragraph">
<p>From listing the backup repository we can see we have three backups that we can
restore in the "examples" backup repository. If we just want to restore one of
them we set the --start and --end flags in the restore command to the same
backup name and specify the cluster that we want to restore the data to. In the
example below we will restore only the oldest backup.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr restore -a /data/backups -r example \
 -c couchbase://127.0.0.1 -u Administrator -p password \
 --start 2016-03-08T14_41_10.757145596-08_00 \
 --end 2016-03-08T14_41_10.757145596-08_00</pre>
</div>
</div>
<div class="paragraph">
<p>If we want to restore only the two most recent backups then we specify the
--start and --end flags with different backup names in order to specify the
range we want to restore.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr restore -a /data/backups -r example \
 -c couchbase://127.0.0.1 -u Administrator -p password \
 --start 2016-03-09T14_42_24.024494032-08_00 \
 --end 2016-03-10T14_42_58.743250296-08_00</pre>
</div>
</div>
<div class="paragraph">
<p>If we want to restore all of the backups in the "examples" directory then we can
omit the --start and --end flags since their default values are the oldest and
most recent backup in the backup repository.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr restore -a /data/backups -r example \
 -c couchbase://127.0.0.1 -u Administrator -p password</pre>
</div>
</div>
<div class="paragraph">
<p>Restore also allows filtering the data restored by document key and/or value by passing
regular expressions to the flags <code>--filter-keys</code> and <code>--filter-values</code> respectively.
Say we backup the sample bucket 'beer-sample' if we only wanted to restore only the
documents that have a key that starts with '21st_amendment_brewery_cafe'. This can be
done using the flag <code>--filter-keys</code> as shown bellow.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cbbackupmg restore -c http://127.0.0.1:8091 -u Administrator -p password \
 -a /data/backups -r beer --filter-keys '^21st_amendment_brewery_cafe.*'</pre>
</div>
</div>
<div class="paragraph">
<p>Restore also allows filtering by value. Let&#8217;s say we only want to restore documents that
contain the JSON field <code>address</code>. This could be done by passing the regular expression
<code>{.*"address":.*}</code> to the <code>--filter-values</code> flag as illustrated below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cbbackupmgr -c http://127.0.0.1:8091 -u Administrator -p password \
 -a /data/backups -r beer --filter-values '{.*"address":.*}'</pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we can combine both flags to filter by both key and value. Imagine you want to
restore the values for beers that start with the key '21st_amendment_brewery_cafe' and
have the JSON field <code>"category":"North American Ale"</code>. This can be done by using
the command bellow.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cbbackupmgr -c http://127.0.0.1:8091 -u Administrator -p password \
 -a /data/backups -r beer --filter-values '{.*"category":"North American Ale".*}' \
 --filter-keys '^21st_amendment_brewery_cafe.*'</pre>
</div>
</div>
<div class="paragraph">
<p>The regular expressions provided must follow <a href="https://github.com/google/re2/wiki/Syntax">RE2 syntax</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="checksum-failure"><a class="anchor" href="#checksum-failure"></a>CHECKSUM FAILURE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A checksum failure may occur during a restore and indicates that a document
has changed since the creation of the backup. Depending on the type of corruption
we may be able to restore by skipping only the corrupted documents. However, if the
size of the data file has changed (e.g. not a bit flip or byte for byte modification)
<strong>all</strong> documents after the corruption (for that vBucket) will be unusable.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="discussion"><a class="anchor" href="#discussion"></a>DISCUSSION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The restore command works by replaying the data recorded in backup files. During
a restore each key-value pair backed up by cbbackupmgr will be sent to the
cluster as either a "set" or "delete" operation. The restore command replays
data from each file in order of backup time to guarantee that older backup data
does not overwrite newer backup data. The restore command uses Couchbase&#8217;s
conflict resolution mechanism by default to ensure this behavior. The conflict
resolution mechanism can be disable by specifying the --force-updates flag when
executing a restore.</p>
</div>
<div class="paragraph">
<p>Starting in Couchbase 4.6 each bucket can have different conflict resolution
mechanisms. cbbackupmgr will backup all meta data used for conflict resolution,
but since each conflict resolution mechanism is different cbbackupmgr will
prevent restores to a bucket when the source and destination conflict resolution
methods differ. This is done because by default cbbackupmgr will use the
conflict resolution mechanism of the destination bucket to ensure an older value
does not overwrite a newer value. If you want to restore a backup to a bucket
with a different conflict resolution type you can do by using the
--force-updates flag. This is allowed because forcing updates means that
cbbackupmgr will skip doing conflict resolution on the destination bucket.</p>
</div>
<div class="paragraph">
<p>Also keep in mind that unlike backups, restores cannot be resumed if they fail.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="environment-and-configuration-variables"><a class="anchor" href="#environment-and-configuration-variables"></a>ENVIRONMENT AND CONFIGURATION VARIABLES</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">CB_CLUSTER</dt>
<dd>
<p>Specifies the hostname of the Couchbase cluster to connect to. If the
hostname is supplied as a command line argument then this value is
overridden.</p>
</dd>
<dt class="hdlist1">CB_USERNAME</dt>
<dd>
<p>Specifies the username for authentication to a Couchbase cluster. If the
username is supplied as a command line argument then this value is
overridden.</p>
</dd>
<dt class="hdlist1">CB_PASSWORD</dt>
<dd>
<p>Specifies the password for authentication to a Couchbase cluster. If the
password is supplied as a command line argument then this value is
overridden.</p>
</dd>
<dt class="hdlist1">CB_ARCHIVE_PATH</dt>
<dd>
<p>Specifies the path to the backup archive. If the archive path is supplied as
a command line argument then this value is overridden.</p>
</dd>
<dt class="hdlist1">CB_OBJSTORE_STAGING_DIRECTORY</dt>
<dd>
<p>Specifies the path to the staging directory. If the <code>--obj-staging-dir</code>
argument is provided in the command line then this value is overridden.</p>
</dd>
<dt class="hdlist1">CB_OBJSTORE_REGION</dt>
<dd>
<p>Specifies the object store region. If the <code>--obj-region</code> argument is provided
in the command line then this value is overridden.</p>
</dd>
<dt class="hdlist1">CB_OBJSTORE_ACCESS_KEY_ID</dt>
<dd>
<p>Specifies the object store access key id. If the <code>--obj-access-key-id</code>
argument is provided in the command line this value is overridden.</p>
</dd>
<dt class="hdlist1">CB_OBJSTORE_SECRET_ACCESS_KEY</dt>
<dd>
<p>Specifies the object store secret access key. If the
<code>--obj-secret-access-key</code> argument is provided in the command line this value
is overridden.</p>
</dd>
<dt class="hdlist1">CB_AWS_ENABLE_EC2_METADATA</dt>
<dd>
<p>By default cbbackupmgr will disable fetching EC2 instance metadata. Setting
this environment variable to true will allow the AWS SDK to fetch metadata
from the EC2 instance endpoint.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="see-also"><a class="anchor" href="#see-also"></a>SEE ALSO</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="cbbackupmgr-backup.html" class="page">cbbackupmgr-backup</a>,
<a href="cbbackupmgr-list.html" class="page">cbbackupmgr-list</a>,
<a href="cbbackupmgr-cloud.html" class="page">cbbackupmgr-cloud</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cbbackupmgr"><a class="anchor" href="#cbbackupmgr"></a>CBBACKUPMGR</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Part of the <a href="cbbackupmgr.html" class="page">cbbackupmgr</a> suite</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2021 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../../_/js/vendor/fontawesome.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
