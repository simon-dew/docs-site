<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Data Definition Language (DDL) | Couchbase Docs (Staging)</title>
<link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-7638/server/6.6/analytics/5_ddl.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="A description of the DDLs in Couchbase Analytics.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">
<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="6.6">
<meta name="generator" content="Antora 2.3.0">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://simon-dew.github.io/docs-site/DOC-7638/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <form class="navbar-item search">
                  <input type="text" placeholder="Search Docs" class="query" id="search-query" />
                  <button type="button" class="search-btn">
                    <i class="fas fa-search"></i>
                  </button>
                </form>
                <a class="btn btn-primary try-btn" href="https://www.couchbase.com/downloads">
                  Downloads
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<nav class="nav">
</nav>
<aside class="toc sidebar">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="https://github.com/couchbase/docs-analytics/edit/release/6.6/modules/analytics/pages/5_ddl.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../index.html">server</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Data Definition Language (DDL)</h1>
<div class="labels">
<ul>
<li class="edition"><a href="https://www.couchbase.com/products/editions">Enterprise Edition</a></li>
</ul>
</div>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section lists all supported DDL statements in Couchbase Analytics.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A user must have one of the following RBAC roles to be able
to execute DDL statements: Admin, Cluster Admin, Analytics Admin, or Analytics Manager.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
No <code>CREATE</code>/<code>DROP</code> or <code>CONNECT</code>/<code>DISCONNECT</code> statement can
be executed while the cluster topology changes (e.g. during rebalance). The evaluation of such DDL statements will fail
and it can be reattempted after the topology change has completed.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Entities"><a class="anchor" href="#Entities"></a>Entities</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These are the entities that are required to create shadow datasets for Data Service buckets.</p>
</div>
<div class="sect2">
<h3 id="Dataverses"><a class="anchor" href="#Dataverses"></a>Dataverses</h3>
<div class="paragraph">
<p>A dataverse is a namespace for the other metadata entities (links, buckets, datasets, indexes).
There is one <code>Default</code> dataverse that is available without creating it and that cannot be deleted.
Because the <code>Default</code> dataverse is always available, creating a dataverse is optional.</p>
</div>
<div class="paragraph">
<p>Refer to
<a href="#Creating_and_dropping">Create Statements</a>,
<a href="#Use_statements">Use Statements</a>, and
<a href="#Drop_statements">Drop Statements</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Datasets"><a class="anchor" href="#Datasets"></a>Datasets</h3>
<div class="paragraph">
<p>In Analytics, a dataset is a collection of data within a dataverse.
By default, a dataset is linked to the Data service of the local Couchbase cluster.
This type of dataset may be referred to as a local dataset,
or simply as a dataset without qualification.</p>
</div>
<div class="paragraph">
<p>Local datasets contain a shadow of the data of a bucket.
A dataset is updated as the bucket that it shadows is updated.
A dataset can contain the full content of the bucket or a filtered subset.
Multiple datasets can shadow the same bucket.
A dataset is created <code>ON</code> a bucket with an optional filter expression.
The name of the dataset is optional and defaults to the name of the bucket.
Creating a dataset fails if there is an existing dataset with the same name
in the selected dataverse and <code>IF NOT EXISTS</code> is not specified.</p>
</div>
<div class="paragraph">
<p>Refer to
<a href="#Creating_and_dropping">Create Statements</a> and
<a href="#Drop_statements">Drop Statements</a>.</p>
</div>
<div class="sect3">
<h4 id="External_datasets"><a class="anchor" href="#External_datasets"></a>Remotely-Linked Datasets and External Datasets</h4>
<div class="paragraph">
<p>In Couchbase 6.6 and later, you can also create datasets on remote links and external links.
These enable you to query data from outside the local Couchbase cluster.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A dataset on a remote link shadows the data from a remote cluster to a local dataset.</p>
</li>
<li>
<p>An external dataset reads data directly from an external source, such as Amazon S3, without shadowing it locally.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Backup and restore only operates on datasets on the local link.
Only the dataset definition is backed up or restored, not the actual data.
Backup and restore excludes datasets on remote links and external links entirely.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before you can create an external dataset or a dataset on a remote link,
you must first create the appropriate link for your dataset to use.</p>
</div>
<div class="paragraph">
<p>Refer to
<a href="#Remote_external_links">Remote Links and External Links</a>,
<a href="#Creating_and_dropping">Create Statements</a>, and
<a href="#Drop_statements">Drop Statements</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Workbench_datasets"><a class="anchor" href="#Workbench_datasets"></a>Manage Datasets with the Analytics Workbench</h4>
<div class="paragraph">
<p>In Couchbase Server 6.6.1 and later, you can use the Analytics Workbench to create or drop datasets on local links, remote links, and external links; and to connect or disconnect local links and remote links.
Refer to <a href="manage-datasets.html" class="page">Managing Datasets</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Links"><a class="anchor" href="#Links"></a>Links</h3>
<div class="paragraph">
<p>In Analytics, a link represents a connection to a data source.
The default type of link is a <code>Local</code> link.</p>
</div>
<div class="paragraph">
<p>The <code>Local</code> link represents a connection to the Data service on the local Couchbase cluster,
specifically to all buckets available to a specific user on the local cluster.
Every dataverse implicitly contains a <code>Local</code> link for all buckets in the local cluster that are available to the
current user.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When a bucket has one or more shadow datasets and the <code>Local</code> link is connected,
you cannot create a new dataset to shadow that bucket, or drop a dataset which shadows that bucket.
However, you can always create a new dataset on any bucket which does <em>not</em> currently have a shadow dataset,
even if the <code>Local</code> link is connected.
In this case, data ingestion to the new shadow dataset does not start at once.
To start ingestion to the new shadow dataset, you must disconnect the <code>Local</code> link and connect it again.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Refer to
<a href="#Connecting_and_disconnecting">Connect Statements</a> and
<a href="#Disconnect_statements">Disconnect Statements</a>.</p>
</div>
<div class="sect3">
<h4 id="Remote_external_links"><a class="anchor" href="#Remote_external_links"></a>Remote Links and External Links</h4>
<div class="paragraph">
<p>In Couchbase 6.6 and later, you can also create remote links and external links.
These enable you to access data from outside the local Couchbase cluster.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A remote link is a link to a remote Couchbase cluster.</p>
</li>
<li>
<p>An external link is a link to an external data source, such as Amazon S3.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After you have created a remote link or an external link, you must create a dataset on that link to query the data.</p>
</div>
<div class="paragraph">
<p>To create, edit, or delete a remote or external link, you must use the command-line interface or the REST API.
Refer to <a href="../cli/cbcli/couchbase-cli-analytics-link-setup.html">couchbase-cli analytics-link-setup</a> or
<a href="rest-links.html">Analytics Links REST API</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Workbench_links"><a class="anchor" href="#Workbench_links"></a>Manage Links with the Analytics Workbench</h4>
<div class="paragraph">
<p>In Couchbase Server 6.6.1 and later, you can use the Analytics Workbench to create or edit remote links and external links.
Refer to <a href="manage-links.html" class="page">Managing Links</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Indexes"><a class="anchor" href="#Indexes"></a>Indexes</h3>
<div class="paragraph">
<p>An index is a materialized access path for data in a dataset.
You can create more than one index on the same dataset.
Each index name must be unique within a dataset.
Creating an index fails if there is an existing index with the same name
in the target dataset and <code>IF NOT EXISTS</code> is not specified.</p>
</div>
<div class="paragraph">
<p>For each JSON document ingested into a dataset, the system computes the indexed key for each index.
The index key of a secondary index is computed as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The target field values are extracted from the JSON document according to the specified path of fields;</p>
</li>
<li>
<p>For non-numeric typed index fields (i.e., the specified type is <code>STRING</code>),
if the specified type of the field is the same as the actual field value&#8217;s type,
the value becomes part of the indexed key, otherwise the indexed key cannot be built;</p>
</li>
<li>
<p>For numeric typed index fields (i.e., the specified type is <code>DOUBLE</code> or <code>BIGINT</code>),
the actual field value can be cast to the specified type and it becomes part of the indexed key.
If the cast is impossible, the indexed key cannot be built;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After the indexed key has been built, it is inserted into the secondary index.
In case the index key cannot be built, there is no entry made in the index for this object.</p>
</div>
<div class="paragraph">
<p>Secondary indexes are automatically maintained by the system during data ingestion
(i.e., when their corresponding buckets are connected and data are flowing into the system).
In addition, they are automatically rebalanced when their shadow datasets are rebalanced.</p>
</div>
<div class="paragraph">
<p>Refer to
<a href="#Creating_and_dropping">Create Statements</a> and
<a href="#Drop_statements">Drop Statements</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Statements"><a class="anchor" href="#Statements"></a>Statements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to queries, N1QL for Analytics (the Couchbase Analytics implementation of SQL&#43;&#43;) supports statements for
data definition, and to connect Couchbase Analytics to Data Service buckets or external data sources.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Statement       ::= ( ( SingleStatement )? ( ";" )+ )* &lt;EOF&gt;
SingleStatement ::= CreateStatement
                  | UseStatement
                  | DropStatement
                  | ConnectStatement
                  | DisconnectStatement
                  | Query</pre>
</div>
</div>
<div class="sect2">
<h3 id="Creating_and_dropping"><a class="anchor" href="#Creating_and_dropping"></a>Create Statements</h3>
<div class="paragraph">
<p>The CREATE statement is used to create dataverses, datasets, and indexes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CreateStatement     ::= "CREATE" ( DataverseSpecification
                                 | DatasetSpecification
                                 | IndexSpecification )</pre>
</div>
</div>
<div class="sect3">
<h4 id="dataverse-specification"><a class="anchor" href="#dataverse-specification"></a>Dataverse Specification</h4>
<div class="literalblock">
<div class="content">
<pre>DataverseSpecification ::= "DATAVERSE" Identifier ( IfNotExists )?             ➊

IfNotExists         ::= "IF" "NOT" "EXISTS"</pre>
</div>
</div>
<div class="paragraph">
<p>➀ For dataverses, the <code>Identifier</code> is the dataverse name.</p>
</div>
<div class="sect4">
<h5 id="examples"><a class="anchor" href="#examples"></a>Examples</h5>
<div class="literalblock">
<div class="content">
<pre>CREATE DATAVERSE `beer-data`;</pre>
</div>
</div>
<div class="paragraph">
<p>Creates a dataverse with the name <code>beer-data</code> to be used to manage other metadata entities.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dataset-specification"><a class="anchor" href="#dataset-specification"></a>Dataset Specification</h4>
<div class="literalblock">
<div class="content">
<pre>DatasetSpecification             ::= ( LocalDatasetSpecification
                                     | RemoteLinkedDatasetSpecification
                                     | ExternalDatasetSpecification )
LocalDatasetSpecification        ::= "DATASET" ( IfNotExists )?
                                     ( QualifiedName )?                        ➊
                                     "ON" Identifier                           ➋
                                     ( "WITH" ObjectValue )?                   ➌
                                     ( "WHERE" Expression )?                   ➍
RemoteLinkedDatasetSpecification ::= "DATASET" ( IfNotExists )?
                                     ( QualifiedName )?
                                     "ON" Identifier
                                     ( "WITH" ObjectValue )?
                                     ( "AT" Identifier )?                      ➎
                                     ( "WHERE" Expression )?
ExternalDatasetSpecification     ::= "EXTERNAL" "DATASET" ( IfNotExists )?
                                     ( QualifiedName )?
                                     ( TypeDefinition )?                       ➏
                                     "ON" Identifier
                                     ( "WITH" ObjectValue )?
                                     ( "AT" Identifier
                                     ( "USING" Expression )? )?                ➐
                                     ( "WHERE" Expression )?

QualifiedName        ::= Identifier ( "." Identifier )?

ObjectValue          ::= "{" ( Pair ( "," Pair )* )? "}"
Pair                 ::= StringLiteral ":" ParameterValue
ParameterValue       ::= ObjectValue | ArrayValue | Literal
ArrayValue           ::= "[" ( ParameterValue ( "," ParameterValue )* )? "]"

TypeDefinition       ::= "(" Field ( "," Field )* ")"
Field                ::= Identifier DataType ( "NOT" "UNKNOWN" )?
DataType             ::= ( "BOOLEAN" | "BIGINT" | "INT" | "DOUBLE" | "STRING" )</pre>
</div>
</div>
<div class="paragraph">
<p>➀ For datasets, the <code>QualifiedName</code> is the full name of the dataset.
It consists of an optional dataverse name and a name for the dataset.
If no dataverse name is given, the dataset is created in the <code>Default</code> dataverse,
or in the dataverse specified by the immediately preceding USE statement.
If the full name of the dataset is not specified, the bucket name is used as the dataset name.</p>
</div>
<div class="paragraph">
<p>➁ The <code>Identifier</code> in the <code>ON</code> clause represents the data source for the dataset.
For a local dataset, this is the bucket which this dataset will shadow.
For a dataset on a remote link, this is a bucket on the remote Couchbase cluster.
For an external dataset, this is an external data source, such as an Amazon S3 bucket.</p>
</div>
<div class="paragraph">
<p>➂ Parameters for the dataset can be provided though the <code>ObjectValue</code> object after <code>WITH</code>.
The <code>ObjectValue</code> contains key-value pairs, one for each parameter.
The following parameters are available.
Note that many of these parameters only apply when creating an external dataset.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>storage-block-compression</strong> <br>
<em>optional</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines the storage compression used for this dataset. This parameter takes a nested object value&#8201;&#8212;&#8201;<code>scheme</code>.<br>
<br>
Possible values for <code>scheme</code> are <code>snappy</code> or <code>none</code>. The default storage compression scheme is <code>snappy</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>format</strong> <br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Only used when creating an external dataset.)<br>
<br>
Specifies the format of the external data. May be one of the following string values:<br>
<br>
<code>json</code>&#8201;&#8212;&#8201;<a href="http://jsonlines.org" target="_blank" rel="noopener">JSON Lines</a><br>
<code>csv</code>&#8201;&#8212;&#8201;<a href="https://tools.ietf.org/html/rfc4180" target="_blank" rel="noopener">Comma-separated values</a><br>
<code>tsv</code>&#8201;&#8212;&#8201;<a href="https://www.iana.org/assignments/media-types/text/tab-separated-values" target="_blank" rel="noopener">Tab-separated values</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enum (json,csv,tsv)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>header</strong> <br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Only used when creating an external dataset, and only if it has the format CSV or TSV.)<br>
<br>
When <code>true</code>, the first row of the file is skipped.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>redact-warnings</strong> <br>
<em>optional</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Only used when creating an external dataset, and only if it has the format CSV or TSV.)<br>
<br>
When <code>true</code>, sensitive information (such as the file name) is redacted from warning messages.<br>
<strong>Default</strong> : <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>null</strong> <br>
<em>optional</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Only used when creating an external dataset, and only if it has the format CSV or TSV.)<br>
<br>
The string used in the external dataset to represent a <code>null</code> value. You may escape special characters using a backslash <code>\</code>.<br>
<br>
(Refer also to the <code>NOT UNKNOWN</code> flag in the type definition, described below.)<br>
<strong>Example</strong> : <code>"\\N"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>include</strong> <br>
<em>optional</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Only used when creating an external dataset. May not be used if the <strong>exclude</strong> parameter is present.)<br>
<br>
The names of the files to be included from the external dataset. The file name may include subdirectories of the location specified by the <code>USING</code> clause, described below. Any files that do not match the specification are excluded.<br>
<br>
May contain the same wildcard characters as the <strong>exclude</strong> parameter.<br>
<strong>Example</strong> : <code>["*2018*.json", "*2019*.json"]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string, or array of strings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>exclude</strong> <br>
<em>optional</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Only used when creating an external dataset. May not be used if the <strong>include</strong> parameter is present.)<br>
<br>
The names of the files to be excluded from the external dataset. The file name may include subdirectories of the location specified by the <code>USING</code> clause, described below. Any files that do not match the specification are included.<br>
<br>
May contain the following wildcard characters, in common with the <strong>include</strong> parameter:<br>
<br>
<code>*</code>&#8201;&#8212;&#8201;Matches anything<br>
<code>?</code>&#8201;&#8212;&#8201;Matches any single character<br>
<code>[</code> <em>sequence</em> <code>]</code>&#8201;&#8212;&#8201;Matches any characters in <em>sequence</em><br>
<code>[!</code> <em>sequence</em> <code>]</code>&#8201;&#8212;&#8201;Matches any characters not in <em>sequence</em><br>
<strong>Example</strong> : <code>"*.?sv"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string, or array of strings</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>➃ The <code>WHERE</code> clause enables you to filter the documents in the dataset.
The <code>Expression</code> in this clause must be deterministic.</p>
</div>
<div class="paragraph">
<p>➄ The <code>AT</code> clause is only used when creating a dataset on a remote link, or an external dataset.
The <code>Identifier</code> in this clause is the name of the remote or external link on which the dataset is to be created.</p>
</div>
<div class="paragraph">
<p>➅ The <code>TypeDefinition</code> is only used when creating an external dataset,
and only if it has the format CSV or TSV.
It consists of a comma-separated list of field definitions,
which guides the transformation of each CSV or TSV record into a JSON object.
Each field definition consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A name to be assigned to the field.</p>
</li>
<li>
<p>The data type of the field.
This may be any of the <a href="9_data_type.html#PrimitiveTypes">primitive data types</a>,
where <code>INT</code> is an alias for <code>BIGINT</code>.
If this field does not contain a value of this data type, the record is ignored.</p>
</li>
<li>
<p>Optionally, the <code>NOT UNKNOWN</code> flag.
When this flag is present, if this field is <code>missing</code> or <code>null</code>, the record is ignored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Every time a record is ignored because it does not match the type definition, a warning is issued.</p>
</div>
<div class="paragraph">
<p>➆ The <code>USING</code> clause is only used when creating an external dataset.
The expression in this clause must resolve to a string containing a path to the location of the data,
relative to the external data source.</p>
</div>
<div class="sect4">
<h5 id="examples-2"><a class="anchor" href="#examples-2"></a>Examples</h5>
<div class="literalblock">
<div class="content">
<pre>CREATE DATASET beers ON `beer-sample` WHERE `type` = "beer";

CREATE DATASET breweries WITH {"storage-block-compression": {"scheme": "snappy"}}
ON `beer-sample` WHERE `type` = "brewery";</pre>
</div>
</div>
<div class="paragraph">
<p>This example creates 2 datasets <code>beers</code> and <code>breweries</code> on the <code>beer-sample</code> bucket and filters
the content for each dataset by the value of the <code>type</code> field of the record.
For the <code>breweries</code> dataset, the <code>snappy</code> storage compression scheme is specified.
Note that back-ticks are only necessary for reserved keywords, such as <code>type</code>, or certain operators, such as <code>-</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE DATASET airports ON `travel-sample`
AT myCbLink WHERE `type` = "airport";</pre>
</div>
</div>
<div class="paragraph">
<p>This example creates a dataset called <code>airports</code>.
The dataset uses data from the <code>travel-sample</code> bucket at the remote
Couchbase cluster which is connected via the remote link called <code>myCbLink</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE EXTERNAL DATASET reviews
ON BeerFestival
AT `beer-data`.myAwsLink
USING "json-data/reviews"
WITH {
  "format": "json",
  "include": ["*2018*.json", "*2019*.json"]
};</pre>
</div>
</div>
<div class="paragraph">
<p>This example creates an external dataset called <code>reviews</code>.
The dataset uses data from the Amazon S3 bucket called <code>BeerFestival</code>,
which is connected via the link called <code>myAwsLink</code> in the <code>beer-data</code> dataverse.</p>
</div>
<div class="paragraph">
<p>The files containing the data are located in <code>json-data/reviews</code> and use JSON Lines format.
The only files included are those with the extension <code>.json</code>, and with <code>2018</code> and <code>2019</code> as part of the file name.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE EXTERNAL DATASET outgoings(
    id INT NOT UNKNOWN,
    datetime STRING NOT UNKNOWN,
    amount DOUBLE NOT UNKNOWN
    details STRING,
  ) ON BeerFestival
AT `beer-data`.myAwsLink
USING "csv-data/accounts"
WITH {
  "format": "csv",
  "header": true,
  "include": "201[5-9]/*[!234].csv"
};</pre>
</div>
</div>
<div class="paragraph">
<p>This example creates an external dataset called <code>outgoings</code>.
The dataset uses data from the Amazon S3 bucket called <code>BeerFestival</code>,
which is connected on the link called <code>myAwsLink</code> in the <code>beer-data</code> dataverse.</p>
</div>
<div class="paragraph">
<p>The files containing the data are located in <code>csv-data/accounts</code> and have CSV format.
The only files included are those with the extension <code>.csv</code>, in subdirectories ranging from <code>2015</code> to <code>2019</code>, and whose file name does <em>not</em> end with <code>2</code>, <code>3</code>, or <code>4</code>.</p>
</div>
<div class="paragraph">
<p>Each CSV file is expected to have a header row, which is excluded.
In each row, the first column is expected to be a bigint which cannot be null,
the second column is expected to be a string which cannot be null,
the third column is expected to be a double which cannot be null,
and the fourth column is expected to be a string.
If any of the rows do not meet this data model, they will not be included.
These fields will be given the names <code>id</code>, <code>datetime</code>, <code>amount</code>, and <code>details</code> respectively.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="index-specification"><a class="anchor" href="#index-specification"></a>Index Specification</h4>
<div class="literalblock">
<div class="content">
<pre>IndexSpecification ::= "INDEX" ( IfNotExists )? Identifier                     ➊
                       "ON" QualifiedName                                      ➋
                       "(" FieldSpecification ( ","  FieldSpecification )* ")" ➌

FieldSpecification ::= NestedField ":" "STRING"|"BIGINT"|"DOUBLE"

NestedField        ::= Identifier ( "." Identifier )*</pre>
</div>
</div>
<div class="paragraph">
<p>➀ For indexes, the first <code>Identifier</code> is the index name.</p>
</div>
<div class="paragraph">
<p>➁ The <code>QualifiedName</code> identifies the dataset on which the index is built.
It consists of an optional dataverse name and the name of the dataset.
If no dataverse name is given, the dataset is assumed to be in the <code>Default</code> dataverse,
or in the dataverse specified by the immediately preceding USE statement.</p>
</div>
<div class="paragraph">
<p>➂ The <code>FieldSpecification</code> consists of a <code>NestedField</code> that specifies a field path into the indexed JSON document,
and a type identifier.</p>
</div>
<div class="sect4">
<h5 id="examples-3"><a class="anchor" href="#examples-3"></a>Examples</h5>
<div class="literalblock">
<div class="content">
<pre>CREATE INDEX beers_name_idx on beers (name: string);
CREATE INDEX breweries_name_idx on breweries (name: string);
CREATE INDEX breweries_loc_idx on breweries (geo.lon: double, geo.lat: double);</pre>
</div>
</div>
<div class="paragraph">
<p>Creates indexes on the identified fields for the specified types.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Use_statements"><a class="anchor" href="#Use_statements"></a>Use Statements</h3>
<div class="paragraph">
<p>The USE statement sets the <code>Identifier</code> to be the default dataverse for the following statement.
If no USE statement is issued, the <code>Default</code> dataverse is used.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>UseStatement ::= "USE" Identifier</pre>
</div>
</div>
<div class="paragraph">
<p>The USE statement only works in a conjunction with another statement in a single request.</p>
</div>
<div class="literalblock">
<div class="title">Example</div>
<div class="content">
<pre>USE `beer-data`;</pre>
</div>
</div>
<div class="paragraph">
<p>This example sets <code>beer-data</code> to be the default dataverse for the statement immediately following.</p>
</div>
</div>
<div class="sect2">
<h3 id="Drop_statements"><a class="anchor" href="#Drop_statements"></a>Drop Statements</h3>
<div class="paragraph">
<p>The DROP statement is the inverse of the CREATE statement.
It can be used to drop dataverses, datasets, and indexes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DropStatement ::= "DROP" ( "DATAVERSE" Identifier ( IfExists )?                ➊
                         | "DATASET" QualifiedName ( IfExists )?               ➋
                         | "INDEX" DoubleQualifiedName ( IfExists )? )         ➌

DoubleQualifiedName ::= Identifier "." Identifier ( "." Identifier )?

IfExists      ::= "IF" "EXISTS"</pre>
</div>
</div>
<div class="paragraph">
<p>➀ For dataverses, the <code>Identifier</code> is the dataverse name.</p>
</div>
<div class="paragraph">
<p>➁ For datasets, the <code>QualifiedName</code> is the full name of the dataset.
It consists of an optional dataverse name and the name of the dataset.
If no dataverse name is given, the dataset is assumed to be in the <code>Default</code> dataverse,
or in the dataverse specified by the immediately preceding USE statement.</p>
</div>
<div class="paragraph">
<p>➂ For indexes, the <code>DoubleQualifiedName</code> is the full name of the index.
It consists of an optional dataverse name, the name of the dataset, and the name of the index.
If no dataverse name is given, the dataset is assumed to be in the <code>Default</code> dataverse,
or in the dataverse specified by the immediately preceding USE statement.</p>
</div>
<div class="literalblock">
<div class="title">Examples</div>
<div class="content">
<pre>DROP DATAVERSE `beer-data` IF EXISTS;</pre>
</div>
</div>
<div class="paragraph">
<p>This example drops the <code>beer-data</code> dataverse, if it already exists.
Dropping a dataverse disconnects any links and drops any datasets contained in it.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DROP DATASET beers;
DROP DATASET breweries;</pre>
</div>
</div>
<div class="paragraph">
<p>This example removes the datasets and all contained data.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DROP INDEX beers.beers_name_idx;
DROP INDEX breweries.breweries_name_idx;
DROP INDEX breweries.breweries_loc_idx;</pre>
</div>
</div>
<div class="paragraph">
<p>Drops the indexes.</p>
</div>
</div>
<div class="sect2">
<h3 id="Connecting_and_disconnecting"><a class="anchor" href="#Connecting_and_disconnecting"></a>Connect Statements</h3>
<div class="paragraph">
<p>The CONNECT statement connects all datasets in the given dataverse(s) to the buckets on which the datasets were
created.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ConnectStatement  ::= "CONNECT" "LINK" LinkSpecification                       ➊
                      ( "WITH" ObjectValue )                                   ➋

LinkSpecification ::= ( Identifier "." )? Identifier
                      ( "," ( Identifier "." )? Identifier )*</pre>
</div>
</div>
<div class="paragraph">
<p>➀ For links, the <code>LinkSpecification</code> is the full name of the link.
It consists of (optionally) the name of the dataverse to connect to, and the name of the link.
For the local link, the name of the link is <code>Local</code>; for remote links,
it is the name given to the link when it was created.
If no dataverse name is given, the link is created in the <code>Default</code> dataverse,
or in the dataverse specified by the immediately preceding USE statement.</p>
</div>
<div class="paragraph">
<p>➁ Parameters for the connection can be provided though the <code>ObjectValue</code> object after <code>WITH</code>.
The <code>ObjectValue</code> contains key-value pairs, one for each parameter.</p>
</div>
<div class="paragraph">
<p>Only one parameter is currently supported for the connection:
the <code>force</code> parameter, which takes a Boolean value (true / false)&#8201;&#8212;&#8201;default false.
This parameter determines the behavior of CONNECT LINK if there has been a change in the bucket&#8217;s UUID,
i.e. the bucket has been deleted and recreated with the same name.</p>
</div>
<div class="paragraph">
<p>If <code>force</code> is false, then CONNECT LINK fails&#8201;&#8212;&#8201;this is the default behavior.
If <code>force</code> is true, CONNECT LINK proceeds:
Analytics deletes all existing data in the dataset and ingests all data from the bucket again.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You do not need to use the CONNECT statement to connect an external dataset.
An external dataset is available for query as soon as you create it.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="title">Examples</div>
<div class="content">
<pre>CONNECT LINK Local;</pre>
</div>
</div>
<div class="paragraph">
<p>This example connects all datasets that use the link <code>Local</code> in the current dataverse to their Data Service buckets, and starts shadowing.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CONNECT LINK myCbLink;</pre>
</div>
</div>
<div class="paragraph">
<p>This example connects all datasets on the remote link called <code>myCbLink</code> and starts shadowing.</p>
</div>
</div>
<div class="sect2">
<h3 id="Disconnect_statements"><a class="anchor" href="#Disconnect_statements"></a>Disconnect Statements</h3>
<div class="paragraph">
<p>The DISCONNECT statement is the inverse of the CONNECT statement.
It disconnects all datasets in the given dataverse(s).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DisconnectStatement ::= "DISCONNECT" "LINK" LinkSpecification</pre>
</div>
</div>
<div class="paragraph">
<p>The DISCONNECT statement is not applicable to external datasets.</p>
</div>
<div class="literalblock">
<div class="title">Examples</div>
<div class="content">
<pre>DISCONNECT LINK Local;</pre>
</div>
</div>
<div class="paragraph">
<p>This example stops shadowing for all datasets that use the link <code>Local</code> in the current dataverse, and disconnects their Data Service buckets.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DISCONNECT LINK myCbLink;</pre>
</div>
</div>
<div class="paragraph">
<p>This example stops shadowing and disconnects all datasets on the remote link called <code>myCbLink</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metadata-introspection"><a class="anchor" href="#metadata-introspection"></a>Metadata Introspection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Metadata entities can be introspected by querying the datasets in the <code>Metadata</code> dataverse.
The Metadata dataverse contains the datasets <code>Dataverse</code>, <code>Dataset</code>, <code>Index</code> and <code>Link</code>.
Each dataset contains the queryable metadata for each entity type.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT VALUE d.DataverseName || '.' || d.DatasetName
FROM Metadata.`Dataset` d
WHERE d.DataverseName &lt;&gt; "Metadata"</pre>
</div>
</div>
<div class="paragraph">
<p>Returns the qualified names of all datasets that are not in the <code>Metadata</code> dataverse.
While dataverses, datasets, and indexes are created and removed by the corresponding CREATE and DROP statements,
and remote links and external links are created and removed by the command-line interface or the REST API,
the lifecycle of local links is managed by the system&#8201;&#8212;&#8201;they are created and removed as needed.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase_logo_black.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2021 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../../_/js/vendor/fontawesome.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
