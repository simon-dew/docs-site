<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>N1QL for Analytics vs. N1QL for Query | Couchbase Docs (Staging)</title>
    <link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-4061/server/6.5/analytics/6_n1ql.html">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <meta name="description" content="A comparison between N1QL for Analytics and N1QL for Query.">
    <link rel="schema.dcterms" href="https://purl.org/dc/terms/">
    <meta name="dcterms.subject" content="server">
    <meta name="dcterms.identifier" content="6.5">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" id="topbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://www.couchbase.com"><img src="../../../_/img/logo.svg" alt="Couchbase"></a>
        <button class="navbar-burger" data-target="topbar-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="topbar-menu" class="navbar-menu">
        <div class="navbar-start">
          <div class="navbar-item has-dropdown">
            <a class="navbar-link" href="https://simon-dew.github.io/docs-site/DOC-4061">Docs</a>
            <div class="navbar-dropdown explore">
              <div class="title">Couchbase Documentation Overview</div>
              <div class="cols">
                <ul>
                  <li class="heading"><a href="../index.html">Server</a></li>
                  <li><a href="../../../server/6.5/n1ql/n1ql-language-reference/index.html">N1QL</a></li>
                  <li><a href="../../../server/6.5/fts/full-text-intro.html">Full Text Search</a></li>
                  <li><a href="../../../server/6.5/analytics/introduction.html">Analytics</a></li>
                  <li><a href="../../../server/6.5/eventing/eventing-overview.html">Eventing</a></li>
                  <li><a href="#">Autonomous Operator</a></li>
                </ul>
                <ul>
                  <li class="heading">Mobile</li>
                  <li><a href="#">Lite</a></li>
                  <li><a href="#">Sync Gateway</a></li>
                </ul>
                <ul class="two-cols">
                  <li class="heading"><a href="../../../server/6.5/sdk/overview.html">SDKs</a></li>
                  <li><a href="#">C</a></li>
                  <li><a href="#">.NET</a></li>
                  <li><a href="#">Go</a></li>
                  <li><a href="#">Java</a></li>
                  <li><a href="#">Node.js</a></li>
                  <li><a href="#">PHP</a></li>
                  <li><a href="#">Python</a></li>
                  <li><a href="#">Scala</a></li>
                </ul>
                <ul>
                  <li class="heading"><a href="../../../server/6.5/connectors/intro.html">Connectors</a></li>
                  <li><a href="#">Elasticsearch</a></li>
                  <li><a href="../../../server/6.5/connectors/hadoop-1.2/hadoop.html">Hadoop</a></li>
                  <li><a href="#">Kafka</a></li>
                  <li><a href="#">Spark</a></li>
                  <li><a href="#">Talend</a></li>
                  <li><a href="../../../server/6.5/connectors/odbc-jdbc-drivers.html">ODBC/JDBC</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="navbar-item has-dropdown">
            <a class="navbar-link component" href="../index.html"><span class="title">server</span> <span class="version">6.5</span></a>
            <div class="navbar-dropdown versions">
              <div class="cols">
                <ul>
                  <li><a class="navbar-item" href="../../6.0/analytics/6_n1ql.html">server 6.0</a></li>
                  <li><a class="navbar-item" href="../../5.5/analytics/6_n1ql.html">server 5.5</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <a class="btn red-btn" href="https://www.couchbase.com/downloads">Downloads</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body container">
<nav class="nav">
</nav>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
<main class="article" data-ceiling="topbar">
  <div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../index.html">server</a></li>
    <li class="crumb"><a href="6_n1ql.html">N1QL for Analytics vs. N1QL for Query</a></li>
  </ul>
</nav>
<div class="tools" role="navigation">
  <ul>
    <li class="tool edit"><a href="file:///Users/simondew/GitHub/couchbaselabs/asterix-opt/cbas/doc/build/docs/modules/analytics/pages/6_n1ql.adoc" title="Edit Page" target="_blank" rel="noopener">Edit</a></li>
  </ul>
</div>
  </div>
<article class="doc">
<h1 class="page">N1QL for Analytics vs. N1QL for Query</h1>
<div class="paragraph">
<p>N1QL for Analytics offers the following key advancements beyond N1QL for Query:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WITH:  N1QL for Analytics supports the ANSI SQL WITH clause to allow the definition of inlined views or variables of primitive types to simplify complex query construction.</p>
</li>
<li>
<p>JOIN:  N1QL for Analytics supports the ANSI join syntax and allows joins on any condition expressions over datasets, arrays, or subqueries.</p>
</li>
<li>
<p>GROUP BY: In N1QL for Analytics, in addition to a set of aggregate functions as in standard SQL, the groups created by the <code>GROUP BY</code> clause are directly usable in nested queries and/or to obtain nested results.</p>
</li>
<li>
<p>Subquery: Any valid N1QL for Analytics query can be used as a subquery.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For N1QL for Query users, the following matrix is a quick compatibility cheat sheet for N1QL for Analytics.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">N1QL for Query</th>
<th class="tableblock halign-left valign-top">N1QL for Analytics Equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">USE KEYS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELECT fname, email FROM tutorial USE KEYS ["dave", "ian"];</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELECT fname, email FROM tutorial WHERE meta().id IN ["dave", "ian"];</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ON KEYS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELECT * FROM user u<br>
JOIN orders o ON KEYS ARRAY s.order_id FOR s IN u.order_history END;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELECT * FROM user u, u.order_history s<br>
JOIN orders o ON s.order_id = meta(o).id;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ON KEY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELECT * FROM user u<br>
JOIN orders o ON KEY o.user_id FOR u;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELECT * FROM user u<br>
JOIN orders o ON meta(u).id = o.user_id;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELECT * FROM user u<br>
NEST orders orders<br>
ON KEYS ARRAY s.order_id FOR s IN u.order_history END;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELECT u, orders FROM users u<br>
LET orders=(SELECT VALUE o FROM u.order_history s, orders o WHERE meta(o).id = s.order_id)<br>
WHERE EXISTS orders;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LEFT OUTER NEST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELECT * FROM user u<br>
LEFT OUTER NEST orders orders<br>
ON KEYS ARRAY s.order_id FOR s IN u.order_history END;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELECT u, (SELECT VALUE o FROM u.order_history s, orders o WHERE meta(o).id = s.order_id) orders<br>
FROM users u;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY i FOR i IN [1, 2] END</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(SELECT VALUE i FROM [1, 2] AS i)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY FIRST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARRAY FIRST arr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">arr[0]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LIMIT l OFFSET o</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows OFFSET without LIMIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Doesn&#8217;t support OFFSET without LIMIT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UNION, INTERSECT, and EXCEPT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All three are supported (with ALL and DISTINCT variants)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only UNION ALL is supported (and necessary for query expressability)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OUTER JOIN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Both LEFT and RIGHT OUTER JOIN supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only LEFT OUTER JOIN supported (and necessary for query expressability)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;, &lt;=, =, etc. operators</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can compare either complex values or scalar values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only scalar values may be compared</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ORDER BY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can order by complex values or scalar values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can only order by scalar values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELECT DISTINCT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SELECT DISTINCT VALUE is supported when the returned values are scalars</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CREATE INDEX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported but different (e.g., typed)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INSERT/UPSERT/DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsupported (by design)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>N1QL for Analytics generalizes N1QL for Query&#8217;s syntax constructs such as <code>USE KEYS</code>, <code>ON KEYS</code>, <code>ON KEY</code>, <code>NEST</code>,
<code>LEFT OUTER NEST</code> and <code>ARRAY</code> and thus eliminates cases where must-be-indexed or must-use-keys
restrictions are required for certain N1QL for Query queries or expressions to be acceptable.
In addition, the general composability of N1QL for Analytics queries eliminates the need for some of N1QL for Query&#8217;s
special syntax; for example, N1QL for Analytics does not require or support the IN/WITHIN subclauses of
N1QL for Query&#8217;s existential (SOME, ANY, or EVERY) expressions.</p>
</div>
<div class="paragraph">
<p>Note that INSERT/UPSERT/DELETE are not supported at all in the Couchbase Analytics Service.
Data is mutated in Couchbase Server, using the Couchbase Server SDK or N1QL for Query mutation, and
the mutations will then be automatically synchronized into the Couchbase Analytics Service.</p>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/logo.svg" alt="Couchbase">
          </a>
        </div>
        <div class="contact">
          <p class="address">3250 Olcott Street
Santa Clara, CA 95054
United States</p>
          <a href="https://www.couchbase.com/contact" class="btn white-btn">Contact Us</a>
          <a class="tel" href="tel:1-650-417-7500">1-650-417-7500</a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Company</span></li>
          <li><a href="https://www.couchbase.com/about">About</a></li>
          <li><a href="https://www.couchbase.com/leadership">Leadership</a></li>
          <li><a href="https://www.couchbase.com/news-and-press-releases">News &amp; Press</a></li>
          <li><a href="https://www.couchbase.com/careers">Careers</a></li>
          <li><a href="https://www.couchbase.com/resources/events">Events</a></li>
          <li><a href="https://www.couchbase.com/contact">Contact Us</a></li>
          <li><a href="https://www.couchbase.com/request-pricing">Pricing</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Support</span></li>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://www.couchbase.com/services">Professional Services</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support Login</a></li>
          <li><a href="https://learn.couchbase.com/store" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Quicklinks</span></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Online Training</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
          <li><a href="https://www.couchbase.com/nosql-resources/why-nosql">Why NoSQL</a></li>
          <li><a href="https://www.couchbase.com/resources/security">Security</a></li>
          <li><a href="https://www.couchbase.com/resources/gdpr">GDPR</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://plus.google.com/+CouchbaseServer" class="icon">
              <svg width="50px" height="50px" viewBox="36.72 225.573 542.326 343.67"><path d="m209.02 363.05v68.732h93.212c-15.065 44.252-37.662 68.732-93.212 68.732-56.492 0-100.74-46.135-100.74-102.63s44.252-102.63 100.74-102.63c30.129 0 48.96 10.357 66.849 25.422 14.123-14.123 13.182-16.006 48.96-49.902-31.071-28.246-71.557-45.194-115.81-45.194-95.096-0.94-172.3 76.266-172.3 171.36s77.206 172.3 172.3 172.3c142.17 0 177.01-124.28 165.71-206.2-33.896-1e-3 -165.71-1e-3 -165.71-1e-3zm310.71 3.766v-59.317h-42.369v59.317h-61.2v42.369h61.2v61.2h42.369v-61.2h59.317v-42.369h-59.317z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2018 COUCHBASE All rights reserved.</span>
      <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
      <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
      <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
      <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
    </div>
  </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
