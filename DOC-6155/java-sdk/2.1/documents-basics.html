<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Document basics | Couchbase Docs (Staging)</title>
    <link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-6155/java-sdk/3.0/hello-world/start-using-sdk.html">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="schema.dcterms" href="https://purl.org/dc/terms/">
    <meta name="dcterms.subject" content="java-sdk">
    <meta name="dcterms.identifier" content="2.1">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" id="topbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://www.couchbase.com"><img src="../../_/img/logo.svg" alt="Couchbase"></a>
        <button class="navbar-burger" data-target="topbar-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="topbar-menu" class="navbar-menu">
        <div class="navbar-start">
          <div class="navbar-item has-dropdown">
            <a class="navbar-link" href="https://simon-dew.github.io/docs-site/DOC-6155">Docs</a>
            <div class="navbar-dropdown explore">
              <div class="title">Couchbase Documentation Overview</div>
              <div class="cols">
                <ul>
                  <li class="heading"><a href="../../server/6.5/introduction/intro.html">Server</a></li>
                  <li><a href="../../server/6.5/n1ql/n1ql-language-reference/index.html">N1QL</a></li>
                  <li><a href="../../server/6.5/fts/full-text-intro.html">Full Text Search</a></li>
                  <li><a href="../../server/6.5/analytics/introduction.html">Analytics</a></li>
                  <li><a href="../../server/6.5/eventing/eventing-overview.html">Eventing</a></li>
                  <li><a href="#">Autonomous Operator</a></li>
                </ul>
                <ul>
                  <li class="heading">Mobile</li>
                  <li><a href="#">Lite</a></li>
                  <li><a href="#">Sync Gateway</a></li>
                </ul>
                <ul class="two-cols">
                  <li class="heading"><a href="../../server/6.5/sdk/overview.html">SDKs</a></li>
                  <li><a href="#">C</a></li>
                  <li><a href="#">.NET</a></li>
                  <li><a href="#">Go</a></li>
                  <li><a href="../3.0/hello-world/start-using-sdk.html">Java</a></li>
                  <li><a href="#">Node.js</a></li>
                  <li><a href="#">PHP</a></li>
                  <li><a href="#">Python</a></li>
                  <li><a href="#">Scala</a></li>
                </ul>
                <ul>
                  <li class="heading"><a href="../../server/6.5/connectors/intro.html">Connectors</a></li>
                  <li><a href="#">Elasticsearch</a></li>
                  <li><a href="../../server/6.5/connectors/hadoop-1.2/hadoop.html">Hadoop</a></li>
                  <li><a href="#">Kafka</a></li>
                  <li><a href="#">Spark</a></li>
                  <li><a href="../../server/6.5/connectors/odbc-jdbc-drivers.html">ODBC/JDBC</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="navbar-item has-dropdown">
            <a class="navbar-link component" href="java-intro.html"><span class="title">Java SDK</span> <span class="version">2.1</span></a>
            <div class="navbar-dropdown versions">
              <div class="cols">
                <ul>
                  <li><a class="navbar-item" href="../3.0/hello-world/start-using-sdk.html">Java SDK 3.0</a></li>
                  <li><a class="navbar-item" href="../2.7/start-using-sdk.html">Java SDK 2.7</a></li>
                  <li><a class="navbar-item" href="../2.6/start-using-sdk.html">Java SDK 2.6</a></li>
                  <li><a class="navbar-item" href="../2.5/start-using-sdk.html">Java SDK 2.5</a></li>
                  <li><a class="navbar-item" href="../2.4/start-using-sdk.html">Java SDK 2.4</a></li>
                  <li><a class="navbar-item" href="../2.3/start-using-sdk.html">Java SDK 2.3</a></li>
                  <li><a class="navbar-item" href="../2.2/documents-basics.html">Java SDK 2.2</a></li>
                </ul>
                <ul class="related">
                  <li><a class="navbar-item" href="#">c-sdk</a></li>
                  <li><a class="navbar-item" href="#">dotnet-sdk</a></li>
                  <li><a class="navbar-item" href="#">go-sdk</a></li>
                  <li><a class="navbar-item" href="#">nodejs-sdk</a></li>
                  <li><a class="navbar-item" href="#">php-sdk</a></li>
                  <li><a class="navbar-item" href="#">python-sdk</a></li>
                  <li><a class="navbar-item" href="#">scala-sdk</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <a class="btn red-btn" href="https://www.couchbase.com/downloads">Downloads</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body container">
<nav class="nav">
<div class="nav-menu">
<ul class="nav-list">
  <li class="nav-item is-current-path is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="java-intro.html">Java SDK 2.1</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="overview.html">Overview</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="download-links.html">Download and API Reference</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="migrate.html">Migrating from Java SDK 1.4.x to 2.x</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="getting-started.html">Getting started with the Java SDK</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="hello-couchbase.html">Hello Couchbase Example</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="tutorial.html">Java SDK tutorial</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="managing-connections.html">Managing connections</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="env-config.html">Configuring the environment</a>
    </span>
  </li>
  <li class="nav-item is-current-path is-active" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="documents.html">Working with documents</a>
    </span>
<ul class="nav-list">
  <li class="nav-item is-current-page is-active" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="documents-basics.html">Document basics</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="documents-creating.html">Creating documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="documents-updating.html">Updating documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="documents-retrieving.html">Retrieving documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="documents-deleting.html">Deleting documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="documents-atomic.html">Atomic operations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="documents-bulk.html">Bulk operations</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="querying.html">Querying buckets</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="querying-views.html">Working with views</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="querying-n1ql.html">Working with N1QL</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="observables.html">Mastering observables</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="logging.html">Setting up logging</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="release-notes.html">Release notes</a>
    </span>
  </li>
</ul>
  </li>
</ul>
</div>
</nav>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
<main class="article" data-ceiling="topbar">
  <div class="article-banner">
    <p>A newer version of this documentation is available.</p>
    <a class="btn" href="../3.0/hello-world/start-using-sdk.html">View Latest</a>
  </div>
  <div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="java-intro.html">Java SDK</a></li>
    <li class="crumb"><a href="java-intro.html">Java SDK 2.1</a></li>
    <li class="crumb"><a href="documents.html">Working with documents</a></li>
    <li class="crumb"><a href="documents-basics.html">Document basics</a></li>
  </ul>
</nav>
<div class="tools" role="navigation">
  <ul>
    <li class="tool edit"><a href="https://github.com/couchbase/docs-sdk-java/edit/release/2.1/modules/ROOT/pages/documents-basics.adoc" title="Edit Page" target="_blank" rel="noopener">Edit</a></li>
  </ul>
</div>
  </div>
<article class="doc">
<h1 class="page">Document basics</h1>
<div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
Describes the properties and types of <code>Document</code> objects and how to use them.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-document"><a class="anchor" href="#the-document"></a>The Document</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>Document</code> class encapsulates the consolidated representation of all attributes that relate to a document stored on a Couchbase Server cluster.
It includes the document&#8217;s identifier and related metadata.
A <code>Document</code> object contains the following properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The (per bucket) unique identifier of the document.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>content</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual content of the document.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cas</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The CAS (Compare And Swap) value of the document.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>expiry</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The expiration time of the document.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are a few different implementations of a <code>Document</code>, the most prominent one is the <code>JsonDocument</code>.</p>
</div>
<div class="paragraph">
<p>Because Couchbase Server is able to not only store JSON but in fact anything, many document types exist to satisfy the general needs of an application.
You can also write your own <code>Document</code> implementations, but this is not covered in this introduction.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Every <code>Document</code> has an associated <code>Transcoder</code> that handles serialization and deserialization to and from the target wire format.
This conversion is transparent, but needs to be taken into account when custom documents are implemented.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following <code>Document</code> types are supported out of the box:</p>
</div>
<div class="paragraph">
<p><strong>Documents with JSON content:</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Document Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Compatible: 2.x SDKs</th>
<th class="tableblock halign-left valign-top">Compatible: 1.x Java SDK</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default, which has a <code>JsonObject</code> at the top level content.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonArrayDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similar to <code>JsonDocument</code>, but has a <code>JsonArray</code> at the top level content.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonBooleanDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores JSON-compatible Boolean values.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Partially</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonLongDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores JSON compatible long (number) values.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Partially</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonDoubleDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores JSON compatible double (number) values.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Partially</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonStringDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores JSON compatible String values.
Input is automatically wrapped with <code>"..."</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Partially</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RawJsonDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores any JSON value and should be used if custom JSON serializers such as Jackson or GSON are already in use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Documents with other content:</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Document Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Compatible: 2.x SDKs</th>
<th class="tableblock halign-left valign-top">Compatible: 1.x Java SDK</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BinaryDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can be used to store arbitrary binary data.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SerializableDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores objects that implement <code>Serializable</code> through default Java object serialization.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LegacyDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses the <code>Transcoder</code> from the 1.x SDKs and can be used for full cross-compatibility between the old and new versions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StringDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can be used to store arbitrary strings.
They will not be quoted, but stored as-is and flagged as "String".</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Backward compatibility"></i>
</td>
<td class="content">
Other than the <code>LegacyDocument</code> class, which strives for full backward compatibility, all <code>Document</code> types are trying best effort in that regard.
Specific constraints are noted in each document description, but for all types keep in mind that compression is not supported other than on the <code>LegacyDocument</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cas-and-expiry"><a class="anchor" href="#cas-and-expiry"></a>CAS and Expiry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every <code>Document</code> also contains the <code>expiry</code> and <code>cas</code> properties.
They are considered meta information and are optional.
An expiration time of <code>0</code> means that no expiration is set at all, and a <code>CAS</code> value 0 means it won&#8217;t be used.</p>
</div>
<div class="paragraph">
<p>You can set the <code>expiry</code> to control when the document should be deleted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Expire in 10 seconds.
JsonDocument.create("id", 10, content);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Expire in 1 day.
JsonDocument.create("id", TimeUnit.DAYS.toSeconds(1), content);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The expiration time starts when the document has been successfully stored on the server, not when the document was created on the application server.
Any expiration time larger than 30 days in seconds is considered absolute (as in a Unix time stamp), anything smaller is considered relative in seconds.</p>
</div>
<div class="paragraph">
<p>The <code>CAS</code> value can either be set by you directly or is populated by the SDK when the <code>Document</code> is loaded from the server (which is the recommended way to use it).</p>
</div>
<div class="paragraph">
<p>For detailed information about how to utilize CAS for optimistic concurrency control, see <a href="documents-updating.html" class="page">Updating documents</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jsondocument"><a class="anchor" href="#jsondocument"></a>JsonDocument</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Couchbase Server uses the JSON format as a first-class citizen.
It is used for querying (via both views and N1QL) and represents the main storage format that should be used.</p>
</div>
<div class="paragraph">
<p>The <code>JsonDocument</code> class has factory methods named <code>create()</code> that you use to create documents.
If you do not want to pass in an expiration time or CAS value (just the ID and content) you do it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">JsonDocument doc = JsonDocument.create("id", content);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The content needs to be of type <code>JsonObject</code>, which ships with the Java SDK.
It works very much like a <code>Map</code> object, but makes sure only data types understood by JSON are used.</p>
</div>
<div class="paragraph">
<p>An empty JSON document can be created like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">JsonObject content = JsonObject.empty();</code></pre>
</div>
</div>
<div class="paragraph">
<p>After it is created, you can use the various <code>put()</code> methods to insert data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">JsonArray friends = JsonArray.empty()
    .add(JsonObject.empty().put("name", "Mike Ehrmantraut"))
    .add(JsonObject.empty().put("name", "Jesse Pinkman"));

JsonObject content = JsonObject.empty()
    .put("firstname", "Walter")
    .put("lastname", "White")
    .put("age", 52)
    .put("aliases", JsonArray.from("Walt Jackson", "Mr. Mayhew", "David Lynn"))
    .put("friends", friends);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This generates a JSON document like this (unordered, because the actual content is stored in a <code>Map</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "firstname":"Walter",
   "aliases":[
      "Walt Jackson",
      "Mr. Mayhew",
      "David Lynn"
   ],
   "age":52,
   "friends":[
      {
         "name":"Mike Ehrmantraut"
      },
      {
         "name":"Jesse Pinkman"
      }
   ],
   "lastname":"White"
}</code></pre>
</div>
</div>
<div id="image_i31_yqb_1" class="imageblock">
<div class="content">
<img src="_images/document-jsonobject.png" alt="document jsonobject" width="650px">
</div>
</div>
<div class="paragraph">
<p>In addition, the <code>JsonObject</code> and <code>JsonArray</code> classes provide convenience methods to generate and modify them.</p>
</div>
<div class="paragraph">
<p>The <code>JsonDocument</code> can then be passed into the various operations on the <code>Bucket</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">JsonDocument walter = JsonDocument.create("user:walter", content);
JsonDocument inserted = bucket.insert(walter);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to read values out of the <code>JsonDocument</code>, you can use either the typed or untyped getter methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">int age = content.getInt("age");
String name = content.getString("firstname") + content.getString("lastname");</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are accessing values that potentially do not exist, you need to use boxed values (<code>Integer</code>, <code>Long</code>, <code>Boolean</code>) instead of their unboxed variants (<code>int</code>, <code>long</code>, <code>boolean</code>) to avoid getting <code>NullPointerException</code> exceptions.
If you use unboxed variants, make sure to catch them properly.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jsonarraydocument"><a class="anchor" href="#jsonarraydocument"></a>JsonArrayDocument</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>JsonArrayDocument</code> class works exactly like the <code>JsonDocument</code> class, with the main difference that you can have a JSON array at the top level content (instead of an object).</p>
</div>
<div class="paragraph">
<p>So if you create a <code>JsonArrayDocument</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">JsonArray content = JsonArray.from("Hello", "World", 1234);
bucket.upsert(JsonArrayDocument.create("docWithArray", content));</code></pre>
</div>
</div>
<div class="paragraph">
<p>It will look like this on the server:</p>
</div>
<div id="image_json-array" class="imageblock">
<div class="content">
<img src="_images/document-jsonarray.png" alt="document jsonarray" width="650px">
</div>
</div>
<div class="paragraph">
<p>If you want to read the <code>JsonArrayDocument</code> back, you need to tell the SDK you explicitly want to deviate from the default.
This needs to be done for every document type other than <code>JsonDocument</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">bucket.get("docWithArray", JsonArrayDocument.class);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rawjsondocument"><a class="anchor" href="#rawjsondocument"></a>RawJsonDocument</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>JsonObject</code> and <code>JsonArray</code> types have been added for developer convenience.
In a lot of places though, custom JSON handling is already in place through libraries like Jackson or Google GSON.</p>
</div>
<div class="paragraph">
<p>Of course we want to provide the best of both worlds, and this is where the <code>RawJsonDocument</code> comes into play.
You can store and read the already stringified JSON, but the SDK properly marks it as JSON so it is cross-compatible with all other documents.</p>
</div>
<div class="paragraph">
<p>Here is how you can read and write raw JSON data.
For clarity, a plain string is used but it is up to you to wire this up with Jackson or a similar JSON processor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// write the raw data
String content = "{\"hello\": \"couchbase\", \"active\": true}";
bucket.upsert(RawJsonDocument.create("rawJsonDoc", content));

// read the raw data
// prints RawJsonDocument{id='rawJsonDoc', cas=..., expiry=0, content={"hello": "couchbase", "active": true}}
System.out.println(bucket.get("rawJsonDoc", RawJsonDocument.class));

// read it parsed
// prints true
System.out.println(bucket.get("rawJsonDoc").content().getBoolean("active"));</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/document-rawjson.png" alt="document rawjson" width="650px">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use the <code>RawJsonDocument</code> type, the SDK does not perform any validation because the expectation is that a JSON-compatible library is used and additional overhead will be avoided.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="json-value-documents"><a class="anchor" href="#json-value-documents"></a>JSON value documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The JSON specification also allows you to store different values as content and it also specifies how these values need to be encoded.
Because the type system of Java is not as rich as it could be, different document types are provided to represent different values that can be stored.
Because the encoding is clearly defined, these JSON values are also compatible with other 2.0 SDKs.</p>
</div>
<div class="paragraph">
<p>A word on compatibility with the 1.X Java SDK: in a best-effort way the SDK tries to read properly flagged data from the old SDKs, but it stores it under the new format, which is not readable by the old SDKs anymore.
So if you care about back-and-forth compatibility only read those values from the new SDK or use the <code>LegacyDocument</code> right away.
Another option is to use strings only on the old SDK, then working with it back and forth should be safe.</p>
</div>
<div class="paragraph">
<p>Backward compatibility for JSON value documents works only if the actual content is not compressed.</p>
</div>
<div class="paragraph">
<p>The following documents exist, which all work similarly except the content type that can be stored:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JsonBooleanDocument</code></p>
</li>
<li>
<p><code>JsonLongDocument</code></p>
</li>
<li>
<p><code>JsonDoubleDocument</code></p>
</li>
<li>
<p><code>JsonStringDocument</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>They are all encoded and decoded based on their <a href="http://json.org" target="_blank" rel="noopener">JSON specification</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="binarydocument"><a class="anchor" href="#binarydocument"></a>BinaryDocument</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>BinaryDocument</code> can be used to store and read arbitrary bytes.
It is the only default codec that directly exposes the underlying low-level Netty <code>ByteBuf</code> objects.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Because the raw data is exposed, it is important to free it after it has been properly used.
Not freeing it will result in increased garbage collection and should be avoided by all means.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Because binary data is arbitrary anyway, it is backward compatible with the old SDK in terms of flags, so it can be read and written back and forth.
Make sure it is not compressed in the old SDK and that the same encoding and decoding process is used on the application side to avoid data corruption.</p>
</div>
<div class="paragraph">
<p>Here is some demo code that shows how to write and read raw data.
The example writes binary data, reads it back, and then frees the pooled resources:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Create buffer out of a string
ByteBuf toWrite = Unpooled.copiedBuffer("Hello World", CharsetUtil.UTF_8);

// Write it
bucket.upsert(BinaryDocument.create("binaryDoc", toWrite));

// Read it back
BinaryDocument read = bucket.get("binaryDoc", BinaryDocument.class);

// Print it
System.out.println(read.content().toString(CharsetUtil.UTF_8));

// Free the resources
ReferenceCountUtil.release(read.content());</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serializabledocument"><a class="anchor" href="#serializabledocument"></a>SerializableDocument</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Any object that implements <code>Serializable</code> can be safely encoded and decoded using the built-in Java serialization mechanism.
While it is very convenient, it can be slow in cases where the POJOs are very complex and deeply nested.
It is backward compatible with the old SDK unless the data has been compressed previously.</p>
</div>
<div class="paragraph">
<p>Here is an example that serializes a POJO, deserializes it later, and then prints one of its properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import java.io.Serializable;

public class User implements Serializable {

    private final String username;

    public User(String username) {
        this.username = username;
    }

    public String getUsername() {
        return username;
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Create the User and store it
bucket.upsert(SerializableDocument.create("user::michael",  new User("Michael")));

// Read it back
SerializableDocument found = bucket.get("user::michael", SerializableDocument.class);

// Print a property to verify
System.out.println(((User) found.content()).getUsername());</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="legacydocument"><a class="anchor" href="#legacydocument"></a>LegacyDocument</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>LegacyDocument</code> is intended to be 1:1 compatible (including compression) with the 1.x Java SDK.
For better compatibility with the other 2.0 SDKs we recommend to move to JSON type documents (and other compatible ones), but the <code>LegacyDocument</code> is very helpful during data migration and side-by-side usage.</p>
</div>
<div class="paragraph">
<p>Because the old and new SDKs don&#8217;t share artifacts or namespaces, they can be used at the same time.
If you&#8217;re using Maven, you can add both a 1.x SDK and a 2.x SDK as dependencies in the <em class="path">pom.xml</em> file.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.couchbase.client&lt;/groupId&gt;
        &lt;artifactId&gt;java-client&lt;/artifactId&gt;
        &lt;version&gt;2.0.3&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.couchbase.client&lt;/groupId&gt;
        &lt;artifactId&gt;couchbase-client&lt;/artifactId&gt;
        &lt;version&gt;1.4.5&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a snippet that writes a value using the old SDK and reads it out with the new one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Open bucket on the new SDK
Cluster cluster = CouchbaseCluster.create();
Bucket bucket = cluster.openBucket();

// Open bucket on the old SDK
CouchbaseClient client = new CouchbaseClient(
    Arrays.asList(URI.create("http://127.0.0.1:8091/pools")),
    "default",
    ""
);

// Create document on old SDK
client.set("fromOld", "Hello from Old!").get();

// Create document on new SDK
bucket.upsert(LegacyDocument.create("fromNew", "Hello from New!"));

// Read old from new
System.out.println(bucket.get("fromOld", LegacyDocument.class));

// Read new from old
System.out.println(client.get("fromNew"));

// Shutdown old client
client.shutdown();

// Shutdown new client
cluster.disconnect();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This prints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>LegacyDocument{id='fromOld', cas=1097880624822, expiry=0, content=Hello from Old!}
Hello from New!</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stringdocument"><a class="anchor" href="#stringdocument"></a>StringDocument</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document type provides an SDK 2.0 cross-compatible way to exchange strings.
It should not be mistaken with the <code>JsonStringDocument</code> which automatically quotes it and also flags it as JSON.
It is also backward compatible unless compression was used previously.</p>
</div>
<div class="paragraph">
<p>If a <code>String</code> is stored through it, it is explicitly flagged as a non-JSON string.
The usage is straightforward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Create the document
bucket.upsert(StringDocument.create("stringDoc", "Hello World"));

// Prints:
// StringDocument{id='stringDoc', cas=1424054670330, expiry=0, content=Hello World}
System.out.println(bucket.get("stringDoc", StringDocument.class));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the <code>cbc</code> command line tool to compare the flags and actual content compared to the <code>JsonStringDocument</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">bucket.upsert(StringDocument.create("stringDoc", "Hello World"));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">└──╼ cbc cat stringDoc
stringDoc            CAS=0x55668b55f010000, Flags=0x4000000. Size=11
Hello World</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">bucket.upsert(JsonStringDocument.create("jsonStringDoc", "Hello World"));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">└──╼ cbc cat jsonStringDoc
jsonStringDoc        CAS=0x84d77eb55f010000, Flags=0x2000000. Size=13
"Hello World"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that the JSON string got automatically quoted and also has different flags applied to it.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/logo.svg" alt="Couchbase">
          </a>
        </div>
        <div class="contact">
          <p class="address">3250 Olcott Street
Santa Clara, CA 95054
United States</p>
          <a href="https://www.couchbase.com/contact" class="btn white-btn">Contact Us</a>
          <a class="tel" href="tel:1-650-417-7500">1-650-417-7500</a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Company</span></li>
          <li><a href="https://www.couchbase.com/about">About</a></li>
          <li><a href="https://www.couchbase.com/leadership">Leadership</a></li>
          <li><a href="https://www.couchbase.com/news-and-press-releases">News &amp; Press</a></li>
          <li><a href="https://www.couchbase.com/careers">Careers</a></li>
          <li><a href="https://www.couchbase.com/resources/events">Events</a></li>
          <li><a href="https://www.couchbase.com/contact">Contact Us</a></li>
          <li><a href="https://www.couchbase.com/request-pricing">Pricing</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Support</span></li>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://www.couchbase.com/services">Professional Services</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support Login</a></li>
          <li><a href="https://learn.couchbase.com/store" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Quicklinks</span></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Online Training</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
          <li><a href="https://www.couchbase.com/nosql-resources/why-nosql">Why NoSQL</a></li>
          <li><a href="https://www.couchbase.com/resources/security">Security</a></li>
          <li><a href="https://www.couchbase.com/resources/gdpr">GDPR</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2019 COUCHBASE All rights reserved.</span>
      <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
      <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
      <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
      <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
