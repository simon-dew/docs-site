<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Compaction API — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a><ul class="sub-sections"><li class="section"><a href="../../admin/REST/overview-rest-api.html"><span>REST API overview</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/REST/rest-cluster-intro.html"><span>Cluster API</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/REST/rest-server-nodes.html"><span>Server nodes API</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/REST/rest-rza.html"><span>Server groups API</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/REST/rest-bucket-intro.html"><span>Buckets API</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/REST/rest-views-intro.html"><span>Views API</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/REST/rest-xdcr-intro.html"><span>XDCR API</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/REST/compaction-rest-api.html" class="current"><span>Compaction API</span></a><ul class="sub-sections"><li class="section"><a href="../../admin/REST/rest-compact-post.html"><span>Compacting buckets</span></a></li><li class="section"><a href="../../admin/REST/rest-compact-spatialviews.html"><span>Compacting spatial views</span></a></li><li class="section"><a href="../../admin/REST/rest-autocompact-get.html"><span>Getting auto-compaction settings</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/REST/logs-rest-api.html"><span>Logs API</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/REST/rest-users.html"><span>User API</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
	<h1 class="title topictitle1" id="ariaid-title1">Compaction API</h1>

	
	<div class="body refbody"><p class="shortdesc">Compaction is used to reclaim disk space and reduce disk fragmentation.</p>

		
		<section class="section"><h2 class="title sectiontitle">Description</h2>
			<p class="p">Couchbase Server writes all data that you append, update and delete as files on disk. The
				compaction process can eventually lead to gaps in the data file, particularly when
				you delete data. Be aware the server also writes index files in a sequential format
				based on appending new results in the index. You can reclaim the empty gaps in all
				data files by performing a process called compaction. For both data files and index
				files, perform frequent compaction of the files on disk to help reclaim disk space
				and reduce disk fragmentation. </p>

			
			
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap">Table 1. Compaction endpoints</span></caption>
					<col style="width:13.477088948787062%">
					<col style="width:49.73045822102426%">
					<col style="width:36.79245283018868%">
					<thead class="thead" style="text-align:left;">
						<tr class="row">
							<th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d69743e39">HTTP method</th>

							<th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d69743e42">URI path</th>

							<th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d69743e45">Description</th>

						</tr>

					</thead>

					<tbody class="tbody">
						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e39 ">POST </td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e42 "><span class="ph filepath">/pools/default/buckets/[bucket_name]/controller/compactBucket</span></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e45 ">Compacts bucket data and indexes.</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e39 ">POST</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e42 "><span class="ph filepath">/pools/default/buckets/[bucket_name]/controller/cancelBucketCompaction</span></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e45 ">Cancels compaction for the specified bucket.</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e39 ">POST</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e42 "><span class="ph filepath">/[bucket_name]/_design/[ddoc_name]/_spatial/_compact</span></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e45 ">Compacts a spatial view.</td>

						</tr>

					</tbody>

				</table>
</div>

			
		</section>

		
		
		
		
		
		
		<section class="section"><h2 class="title sectiontitle">Auto-compaction description</h2><p class="p">Auto-compaction parameters are configured to trigger data and view compaction. These parameters
			can be specified for an entire cluster (cluster-wide) or for a specific bucket in a cluster.</p>
 
			
			<div class="note note"><span class="notetitle">Note:</span> Administrative credentials are required to change these settings.</div>
			
			
			
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap">Table 2. Auto-compaction endpoints</span></caption>
					<col style="width:14.662756598240467%">
					<col style="width:48.53372434017595%">
					<col style="width:36.80351906158357%">
					<thead class="thead" style="text-align:left;">
						<tr class="row">
							<th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d69743e121">HTTP method</th>

							<th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d69743e124">URI path</th>

							<th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d69743e127">Description</th>

						</tr>

					</thead>

					<tbody class="tbody">
						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e121 ">POST </td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e124 "><span class="ph filepath">/controller/setAutoCompaction</span></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e127 ">Sets cluster-wide auto-compaction intervals and
								thresholds</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e121 ">GET </td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e124 "><span class="ph filepath">/settings/autoCompaction</span></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e127 ">Retrieves cluster-wide settings for auto-compaction</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e121 ">GET </td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e124 "><span class="ph filepath">/pools/default/buckets/[<var class="keyword varname">bucket_name</var>]</span></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e127 ">Retrieves auto-compaction settings for named bucket</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e121 ">POST</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e124 "><span class="ph filepath">/pools/default/buckets/[<var class="keyword varname">bucket_name</var>]</span></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e127 ">Sets auto-compaction interval or thresholds for named
								bucket</td>

						</tr>

					</tbody>

				</table>
</div>

			
			
			
			
			
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap">Table 3. Auto-compaction parameters</span></caption>
					<col style="width:37.5%">
					<col style="width:25%">
					<col style="width:37.5%">
					<thead class="thead" style="text-align:left;">
						<tr class="row">
							<th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d69743e212">Parameter</th>

							<th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d69743e215">Value</th>

							<th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d69743e218">Notes</th>

						</tr>

					</thead>

					<tbody class="tbody">
						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e212 "><samp class="ph codeph">databaseFragmentationThreshold
								[percentage]</samp></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e215 ">Integer between 2 and 100</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e218 ">Percentage disk fragmentation for data</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e212 "><samp class="ph codeph">databaseFragmentationThreshold [size]</samp></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e215 ">Integer greater than 1</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e218 ">Bytes of disk fragmentation for data</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e212 "><samp class="ph codeph">viewFragmentationThreshold [percentage]</samp></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e215 ">Integer between 2 and 100</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e218 ">Percentage disk fragmentation for index</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e212 "><samp class="ph codeph">viewFragmentationThreshold [size]</samp></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e215 ">Integer greater than 1</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e218 ">Bytes of disk fragmentation for index</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e212 "><samp class="ph codeph">parallelDBAndViewCompaction</samp></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e215 "><samp class="ph codeph">true</samp> or <samp class="ph codeph">false</samp>. </td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e218 ">Run index and data compaction in parallel. Global setting
								only.</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e212 "><samp class="ph codeph">allowedTimePeriod [abortOutside]</samp></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e215 "><samp class="ph codeph">true</samp> or <samp class="ph codeph">false</samp>.</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e218 ">Terminate compaction if the process takes longer than the allowed
								time</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e212 "><samp class="ph codeph">allowedTimePeriod [fromHour]</samp></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e215 ">Integer between 0 and 23</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e218 ">Compaction can occur from this hour onward</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e212 "><samp class="ph codeph">allowedTimePeriod [fromMinute]</samp></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e215 ">Integer between 0 and 59</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e218 ">Compaction can occur from this minute onward</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e212 "><samp class="ph codeph">allowedTimePeriod [toHour]</samp></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e215 ">Integer between 0 and 23</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e218 ">Compaction can occur up to this hour</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e212 "><samp class="ph codeph">allowedTimePeriod [toMinute]</samp></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e215 ">Integer between 0 and 59</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e218 ">Compaction can occur up to this minute</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e212 "><samp class="ph codeph">purgeInterval</samp></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e215 ">Integer between 1 and 60</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d69743e218 ">Number of days a item is deleted or expired. The key and metadata
								for that item is purged by auto-compaction</td>

						</tr>

					</tbody>

				</table>
</div>

			
			<div class="note note"><span class="notetitle">Note:</span> The purge interval parameter removes the key and metadata for items that have been deleted or are expired. 
				This is known as tombstone purging.</div>

			
			
			
		</section>

		
		
		
	</div>

	
<nav class="related-links"><h2>Related information</h2>
<ol class="olchildlinks">
<li class="link olchildlink"><a href="../../admin/REST/rest-compact-post.html">Compacting buckets</a><br>
Bucket compaction is initiated with the <samp class="ph codeph">POST /pools/default/buckets/[bucket-name]/controller/compactBucket</samp> HTTP method and URI</li>
<li class="link olchildlink"><a href="../../admin/REST/rest-compact-spatialviews.html">Compacting spatial views</a><br>
Spatial views are compacted with the <samp class="ph codeph">POST /[bucket-name]/_design/[ddoc-name]/_spatial/_compact </samp> HTTP method and URI</li>
<li class="link olchildlink"><a href="../../admin/REST/rest-autocompact-get.html">Getting auto-compaction settings</a><br>
Auto-compaction settings can be retrieved on a cluster-wide level or bucket level.</li>
</ol>

<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../admin/rest-intro.html" title="The Couchbase REST API enables you to manage a Couchbase Server deployment as well as perform operations such as storing design documents and querying for results.">REST API reference</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../admin/REST/rest-xdcr-intro.html" title="The XDCR REST API is used to manage Cross Datacenter Replication (XDCR) operations.">XDCR API</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../admin/REST/logs-rest-api.html" title="The Logs REST API provides the REST API endpoints for retrieving log and diagnostic information as well as how an SDK can add entries into a log.">Logs API</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>