<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>vBuckets — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/admin-intro.html"><span>Administration</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../admin/Misc/admin-basics.html"><span>Administration basics</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/Concepts/concept-intro.html"><span>Architecture and concepts</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../admin/Concepts/concept-clusterMgr.html"><span>Cluster Manager</span></a></li><li class="section"><a href="../../admin/Concepts/concept-dataStorage.html"><span>Data storage</span></a></li><li class="section"><a href="../../admin/Concepts/concept-ramQuota.html"><span>RAM quotas</span></a></li><li class="section"><a href="../../admin/Concepts/concept-vBucket.html" class="current"><span>vBuckets</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../admin/Concepts/concept-cacheLayer.html"><span>Caching layer</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/concept-diskStorage.html"><span>Disk storage</span></a></li><li class="section"><a href="../../admin/Concepts/global-thread-pool.html"><span>Shared thread pool</span></a></li><li class="section"><a href="../../admin/Concepts/bucket-priority.html"><span>Disk I/O priority</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/bucket-eviction.html"><span>Tunable memory</span></a></li><li class="section"><a href="../../admin/Concepts/concept-docExpiration.html"><span>Expiration</span></a></li><li class="section"><a href="../../admin/Concepts/concept-serverWarmup.html"><span>Server warmup</span></a></li><li class="section"><a href="../../admin/Concepts/concept-replication.html"><span>Replicas and replication</span></a></li><li class="section"><a href="../../admin/Concepts/concepts-TAP.html"><span>TAP</span></a></li><li class="section"><a href="../../admin/Concepts/dcp.html"><span>Database Change Protocol</span></a></li><li class="section"><a href="../../admin/Concepts/concept-client-interface.html"><span>Client interface</span></a></li><li class="section"><a href="../../admin/Concepts/concepts-statsMonitor.html"><span>Statistics and monitoring</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/security/security-intro.html"><span>Security in Couchbase </span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/bp-deployment-considerations.html"><span>Deployment considerations</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Tasks/cluster-management.html"><span>Cluster management</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Monitoring/monitor-intro.html"><span>Monitoring</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/XDCR/xdcr-intro.html"><span>Cross Datacenter Replication (XDCR)</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/UI/ui-intro.html"><span>Web console</span></a></li><li class="section"><a href="../../admin/Misc/faq.html"><span>FAQs</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Misc/Trbl-intro.html"><span>Troubleshooting</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
  <h1 class="title topictitle1" id="ariaid-title1">vBuckets</h1>

  
  <div class="body"><p class="shortdesc">A vBucket is defined as the <em class="ph i">owner</em> of a subset of the key space of a Couchbase
    cluster. These vBuckets are used to distribute information effectively across a cluster. </p>

    <p class="p">The vBucket system is used both for distributing data and for supporting replicas (copies of
      bucket data) on more than one node. vBuckets are not a user-accessible component, but they are
      a critical component of Couchbase Server and are vital to the availability support and elastic
      nature.</p>

    <p class="p">Clients access the information stored in a bucket by communicating directly with the node
      responsible for the corresponding vBucket. This direct access enables clients to communicate
      with the node storing the data, rather than using a proxy or redistribution architecture. The
      result abstracts the physical topology from the logical partitioning of data. This
      architecture gives Couchbase Server elasticity and flexibility </p>

    <p class="p">Every document ID belongs to a vBucket. A mapping function is used to calculate the vBucket
      in which a given document belongs. In Couchbase Server, that mapping function is a hashing
      function that takes a document ID as input and outputs a vBucket identifier. Once the vBucket
      identifier has been computed, a table is consulted to lookup the server that “hosts” that
      vBucket. The table contains one row per vBucket, pairing the vBucket to its hosting server. A
      server appearing in this table can be (and usually is) responsible for multiple vBuckets.</p>

    
    <p class="p">The following diagrams shows how the Key to Server mapping (vBucket map) works.</p>

    
    <p class="p">In this scenario, there are three servers in the cluster and client wants to look up the value of
      KEY using the <samp class="ph codeph">GET</samp> operation.</p>

    
    <ol class="ol">
      <li class="li">The client first hashes the key to calculate the vBucket which owns KEY. In this example,
        the hash resolves to vBucket 8 (vB8). </li>

      <li class="li">By examining the vBucket map, the
        client determines Server C hosts vB8.</li>

      <li class="li">The client sends the <samp class="ph codeph">GET</samp> operation directly to Server C.</li>

    </ol>

    
      <img class="image" src="../images/vbuckets.png" width="500">
    
    <p class="p">In the next scenario, a server added to the original cluster of three. A new node, Server D,
      is added to the cluster and the vBucket Map is updated (during the rebalance operation). The
      updated map is then sent to all the cluster participants including the other nodes, any
      connected “smart” clients, and the Moxi proxy service.</p>

    
    <p class="p">Within the new four-node cluster model, when a client again wants to determine the 
      value of KEY using the <samp class="ph codeph">GET</samp> operation:</p>

    <ul class="ul">
      <li class="li">The hashing algorithm still resolves to vBucket 8 (vB8).</li>

      <li class="li">The new vBucket Map now maps vBucket 8 to Server D.</li>
 
      <li class="li">The client sends the <samp class="ph codeph">GET</samp> operation directly to Server D.</li>

    </ul>

    
    <img class="image" src="../images/vbuckets-after.png" width="500">
    
    <div class="note note"><span class="notetitle">Note:</span>  This architecture permits Couchbase Server to cope with changes without using
      the typical RDBMS sharding method. In addition, the architecture differs from the method used
      by <samp class="ph codeph">memcached</samp>, which uses client-side key hashes to determine the server from
      a defined list. The memcached method requires active management of the list of servers and
      specific hashing algorithms such as Ketama to cope with changes to the topology. </div>

    
  
    
  </div>

  
  <nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../admin/Concepts/concept-intro.html" title="Couchbase Server concepts include the different components and systems that make up an individual Couchbase Server instance and a Couchbase cluster including information and concepts needed to understand the fast and elastic nature, high availability, and high performance of the Couchbase Server database.">Architecture and concepts</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../admin/Concepts/concept-ramQuota.html" title="RAM is allocated to Couchbase Server in the following configurable quantities: Server Quota and Bucket Quota.">RAM quotas</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../admin/Concepts/concept-cacheLayer.html" title="Couchbase Server includes a built-in caching layer which acts as a central part of the server and provides very rapid reads and writes of data.">Caching layer</a></div>
</div>

<div class="linklist linklist">
<div><a class="link" href="concept-rebalancing.html" title="Rebalancing operation is performed to expand or reduce the size of a cluster, to react to fail-overs, or to temporary remove nodes for various upgrades.">Rebalancing operation</a></div></div>
</nav>
</div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>