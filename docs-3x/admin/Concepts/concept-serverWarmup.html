<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Server warmup — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/admin-intro.html"><span>Administration</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../admin/Misc/admin-basics.html"><span>Administration basics</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/Concepts/concept-intro.html"><span>Architecture and concepts</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../admin/Concepts/concept-clusterMgr.html"><span>Cluster Manager</span></a></li><li class="section"><a href="../../admin/Concepts/concept-dataStorage.html"><span>Data storage</span></a></li><li class="section"><a href="../../admin/Concepts/concept-ramQuota.html"><span>RAM quotas</span></a></li><li class="section"><a href="../../admin/Concepts/concept-vBucket.html"><span>vBuckets</span></a></li><li class="section"><a href="../../admin/Concepts/concept-cacheLayer.html"><span>Caching layer</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/concept-diskStorage.html"><span>Disk storage</span></a></li><li class="section"><a href="../../admin/Concepts/global-thread-pool.html"><span>Shared thread pool</span></a></li><li class="section"><a href="../../admin/Concepts/bucket-priority.html"><span>Disk I/O priority</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/bucket-eviction.html"><span>Tunable memory</span></a></li><li class="section"><a href="../../admin/Concepts/concept-docExpiration.html"><span>Expiration</span></a></li><li class="section"><a href="../../admin/Concepts/concept-serverWarmup.html" class="current"><span>Server warmup</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../admin/Concepts/concept-replication.html"><span>Replicas and replication</span></a></li><li class="section"><a href="../../admin/Concepts/concepts-TAP.html"><span>TAP</span></a></li><li class="section"><a href="../../admin/Concepts/dcp.html"><span>Database Change Protocol</span></a></li><li class="section"><a href="../../admin/Concepts/concept-client-interface.html"><span>Client interface</span></a></li><li class="section"><a href="../../admin/Concepts/concepts-statsMonitor.html"><span>Statistics and monitoring</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/security/security-intro.html"><span>Security in Couchbase </span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/bp-deployment-considerations.html"><span>Deployment considerations</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Tasks/cluster-management.html"><span>Cluster management</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Monitoring/monitor-intro.html"><span>Monitoring</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/XDCR/xdcr-intro.html"><span>Cross Datacenter Replication (XDCR)</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/UI/ui-intro.html"><span>Web console</span></a></li><li class="section"><a href="../../admin/Misc/faq.html"><span>FAQs</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Misc/Trbl-intro.html"><span>Troubleshooting</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
 <h1 class="title topictitle1" id="ariaid-title1">Server warmup</h1>

 
 <div class="body conbody"><p class="shortdesc">Whenever Couchbase Server is restarted, or data is restored to a server instance, the
  server undergoes a warmup process before data requests can be handled.</p>

  <p class="p">During warmup, Couchbase Server loads data persisted on disk into RAM. </p>

  <p class="p">Couchbase Server provides an optimized warmup process that loads data sequentially from disk
   into RAM. It divides the data to be loaded and handles it in multiple phases. After the warmup
   process completes, the data is available for clients to read and write. The time needed for
   server warmup depends on system size, system configuration and the amount of data persisted in
   the system.</p>

  <div class="note note"><span class="notetitle">Note:</span> Couchbase Server is able to begin serving data before it has actually loaded all
   the keys and data from vBuckets.</div>

  <p class="p">Couchbase Server identifies items that are frequently used, prioritizes them, and loads them
   before sequentially loading the remaining data. The frequently-used items are prioritized in an
   access log. The server pre-fetches a list of the most frequently accessed keys and then fetches
   these documents before any other items from disk.</p>

  <p class="p">The server runs a configurable scanner process that determines which keys are most frequently
   used. The scanner process is pre-set and is configurable. The command-line tool, <samp class="ph codeph">cbepctl
    flush_param</samp>, is used to change the initial time and interval for the scanner process.
   For example, you might want to configure the scanner process to be run during a specific time
   period when certain keys need to be identified and made available sooner.</p>

  <p class="p">The server can also switch into a ready mode before it has actually retrieved all documents for
   keys into RAM. Therefore, data can be served before all stored items are loaded. Switching into
   ready mode is a configurable setting so that server warmup time can be adjusted.</p>

  <p class="p">In these first phase of the initial warmup, Couchbase Server begins to fetch all keys and
   metadata from disk. Afterward, it accesses the log information that it needs to retrieve the most
   used keys:</p>

  
  <dl class="dl">
   
    <dt class="dt dlterm">1. Initialize</dt>

    <dd class="dd">In this phase, Couchbase Server has no data it can serve. It starts populating a list of all
     vBuckets stored on disk by loading the recorded, initial state of each vBucket.</dd>

   
  </dl>

  <dl class="dl">
   
    <dt class="dt dlterm">2. Key dump</dt>

    <dd class="dd">Couchbase Server starts pre-fetching all keys and metadata from disk based on the items in
     the vBucket list.</dd>

   
  </dl>

  <dl class="dl">
   
    <dt class="dt dlterm">3. Check access log</dt>

    <dd class="dd">Couchbase Server reads a single cached access log that indicates which keys are frequently
     accessed. It generates and maintains this configurable log on a periodic basis. If this log
     exists, the server first loads items based on it before it loads other items from disk.</dd>

   
  </dl>

  
  <p class="p">Once Couchbase Server has the information about keys and has read in any access log
   information, it loads documents based on the following criteria:</p>

  <dl class="dl">
   
    <dt class="dt dlterm">Loading based on access logs</dt>

    <dd class="dd">Couchbase Server loads documents into memory based on the frequently-used items identified
     in the access log.</dd>

   
  </dl>

  <dl class="dl">
   
    <dt class="dt dlterm">Loading data</dt>

    <dd class="dd">If the access log is empty or is disabled, Couchbase Server sequentially loads documents for
     each key based on the vBucket list.</dd>

   
  </dl>

  <p class="p">Couchbase Server is able to serve information from RAM when one of the following conditions is
   met during warmup:</p>

  <ul class="ul">
   <li class="li">The server has finished loading documents for all keys listed in the access log.</li>

   <li class="li">The server has finished loading documents for every key stored on disk for all vBuckets.</li>

   <li class="li">The percentage of documents loaded into memory is greater than, or equal to, the setting for
    the <samp class="ph codeph">cbepctl ep_warmup_min_items_threshold</samp> parameter.</li>

   <li class="li">Total % of RAM filled by documents is greater than, or equal to, the setting for the
     <samp class="ph codeph">cbepctl ep_warmup_min_memory_threshold</samp> parameter</li>

   <li class="li">Total RAM usage by a node is greater than or equal to the setting for
     <samp class="ph codeph">mem_low_wat</samp>.</li>

  </ul>

  <p class="p">When Couchbase Server reaches one of these states, known as the <em class="ph i">run level</em>, it stops
   loading documents for the remaining keys. There isn't any further loading of data unless the
   document is requested by a client, triggering a background fetch. </p>

 </div>

 <nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../admin/Concepts/concept-intro.html" title="Couchbase Server concepts include the different components and systems that make up an individual Couchbase Server instance and a Couchbase cluster including information and concepts needed to understand the fast and elastic nature, high availability, and high performance of the Couchbase Server database.">Architecture and concepts</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../admin/Concepts/concept-docExpiration.html" title="Each document stored in the database has an optional expiration value (TTL, Time To Live) that is used to automatically delete items.">Expiration</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../admin/Concepts/concept-replication.html" title="Replicas are copies of data that are proved on another node in a cluster.">Replicas and replication</a></div>
</div>

<div class="linklist linklist">
<div><a class="link" href="../CLI/cbepctl-intro.html" title="The cbepctl tool is used to control vBucket states, configuration, and memory and disk persistence behavior.">cbepctl tool</a></div>
<div><a class="link" href="../CLI/CBepctl/cbepctl-accesslog.html" title="Access log settings determine when the access scanner process initially runs and how often.">Changing access log settings</a></div>
<div><a class="link" href="../CLI/cbstats-intro.html" title="The cbstats tool is used to get node and cluster-level statistics about performance and items in storage.">cbstats tool</a></div>
<div><a class="link" href="../Tasks/tasks-manage-serverWarmup.html" title="Couchbase server warmup behavior can be modified by changing the access scanner and warmup threshold settings via the cbepctl tool.">Handling server warmup</a></div></div>
</nav>
</div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>