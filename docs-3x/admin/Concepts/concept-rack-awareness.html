<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Rack Awareness — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/admin-intro.html"><span>Administration</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../admin/Misc/admin-basics.html"><span>Administration basics</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/Concepts/concept-intro.html"><span>Architecture and concepts</span></a><ul class="sub-sections"><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/Concepts/concept-clusterMgr.html"><span>Cluster Manager</span></a><ul class="sub-sections"><li class="section"><a href="../../admin/Concepts/concept-nodesCluster.html"><span>Nodes and clusters</span></a></li><li class="section"><a href="../../admin/Concepts/concept-rack-awareness.html" class="current"><span>Rack Awareness</span></a><ul class="sub-sections"></ul></li></ul></li><li class="section"><a href="../../admin/Concepts/concept-dataStorage.html"><span>Data storage</span></a></li><li class="section"><a href="../../admin/Concepts/concept-ramQuota.html"><span>RAM quotas</span></a></li><li class="section"><a href="../../admin/Concepts/concept-vBucket.html"><span>vBuckets</span></a></li><li class="section"><a href="../../admin/Concepts/concept-cacheLayer.html"><span>Caching layer</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/concept-diskStorage.html"><span>Disk storage</span></a></li><li class="section"><a href="../../admin/Concepts/global-thread-pool.html"><span>Shared thread pool</span></a></li><li class="section"><a href="../../admin/Concepts/bucket-priority.html"><span>Disk I/O priority</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/bucket-eviction.html"><span>Tunable memory</span></a></li><li class="section"><a href="../../admin/Concepts/concept-docExpiration.html"><span>Expiration</span></a></li><li class="section"><a href="../../admin/Concepts/concept-serverWarmup.html"><span>Server warmup</span></a></li><li class="section"><a href="../../admin/Concepts/concept-replication.html"><span>Replicas and replication</span></a></li><li class="section"><a href="../../admin/Concepts/concepts-TAP.html"><span>TAP</span></a></li><li class="section"><a href="../../admin/Concepts/dcp.html"><span>Database Change Protocol</span></a></li><li class="section"><a href="../../admin/Concepts/concept-client-interface.html"><span>Client interface</span></a></li><li class="section"><a href="../../admin/Concepts/concepts-statsMonitor.html"><span>Statistics and monitoring</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/security/security-intro.html"><span>Security in Couchbase </span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/bp-deployment-considerations.html"><span>Deployment considerations</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Tasks/cluster-management.html"><span>Cluster management</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Monitoring/monitor-intro.html"><span>Monitoring</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/XDCR/xdcr-intro.html"><span>Cross Datacenter Replication (XDCR)</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/UI/ui-intro.html"><span>Web console</span></a></li><li class="section"><a href="../../admin/Misc/faq.html"><span>FAQs</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Misc/Trbl-intro.html"><span>Troubleshooting</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
 <h1 class="title topictitle1" id="ariaid-title1">Rack Awareness</h1>

 
  
  <div class="body conbody"><p class="shortdesc">The Rack Awareness feature permits logical groupings of servers on a cluster where each server 
  group physically belongs to a rack or Availability Zone. </p>

   <div class="note attention"><span class="attentiontitle">Attention:</span> This feature is available only in the Enterprise edition.</div>

   <p class="p">Rack Awareness provides the ability to 
    specify that active and corresponding replica partitions be created on servers that are part of a separate rack or zone. 
    To use and enable Rack Awareness, all servers in a cluster must be upgraded to Couchbase Server Enterprise Edition and minimally, version 2.5. 
    By design, Couchbase Server evenly distributes data of active and replica vBuckets across the cluster for cluster performance and redundancy purposes. 
   With Rack Awareness, server partitions are laid out so the replica partitions for servers in one server group are distributed in servers for a second group and vice versa. 
   If one of the servers becomes unavailable or if an entire rack goes down, data is retained since the replicas are available on the second server group.
  </p>

  <p class="p">Replica vBuckets are evenly distributed from one server group to another server group to provide redundancy and data availability. 
   The rebalance operation also evenly distributes the replica vBuckets from one server group to another server group across the cluster. 
   If an imbalance occurs where there is an unequal number of servers in one server group, 
   the rebalance operation performs a "best effort" of evenly distributing the replica vBuckets across the cluster.</p>

  <section class="section"><h2 class="title sectiontitle">Distribution of vBuckets and replica vBuckets</h2>
   
   <p class="p">The following example shows how Rack Awareness functionality implements replica vBuckets to provide redundancy.  
    In this example, there are two (2) server groups in the cluster and four (4) servers in each server group. 
    Since there is equal number of servers in each server group, 
    the cluster is balanced which guarantees that replica vBuckets for one server group are on a different server group.</p>

   <p class="p">The following diagram shows a cluster of servers on two racks, Rack #1 and Rack #2, where each rack has a group of four (4) servers.</p>

    <ul class="ul">
     <li class="li">Group 1 has Servers 1, 2, 3, and 4.</li>

     <li class="li">Group 1 servers have their active vBuckets and replica vBuckets from Group 2.</li>

     <li class="li">Group 2 has Servers 5, 6, 7, and 8.</li>

     <li class="li">Group 2 servers have their active vBuckets and replica vBuckets from Group 1.</li>
  
    </ul>


   <figure class="fig fignone"><span class="figcap">Figure 1. Rack Awareness</span>
    <img class="image" src="../images/RZASimple.png" width="680"></figure>
 
  </section>

  
  <section class="section"><h2 class="title sectiontitle">Distribution with additional server</h2>
   
   <p class="p">The following scenario shows how Rack Awareness functionality implements replica vBuckets 
    when an imbalance is caused by an additional server being added to one server group. 
    In this example, an additional server (Server 9) is added to a server group (Group 1). 
    An imbalance occurs because one server group has more servers than the other server group. 
    In this case, the rebalance operation performs a "best effort" of evenly distributing the replica vBuckets 
    of the additional server across the nodes on all the racks in the cluster.</p>

    <p class="p">The following diagram shows a cluster of servers on two racks, 
     Rack #1 and Rack #2, where one rack has a group of five (5) servers and the other rack has a group of four (4) servers.</p>

   <ul class="ul">
    <li class="li">Group 1 has Servers 1, 2, 3, 4, and 9.</li>

    <li class="li">Group 1 servers have their active vBuckets and replica vBuckets from Group 2.</li>

    <li class="li">Group 1 Servers 1 - 4 also has replica vBuckets for Server 9.</li>

    <li class="li">Group 2 has Servers 5, 6, 7, and 8.</li>

     <li class="li">Group 2 servers have their active vBuckets and replica vBuckets from Group 1 including the replica vBuckets from Server 9 in Group 1.</li>
  
   </ul>

   
   <figure class="fig fignone"><span class="figcap">Figure 2. Rack Awareness with additional server</span>
    <img class="image" src="../images/RZAServerIN.png" width="680"></figure>

  </section>

  
  <section class="section"><h2 class="title sectiontitle">Distribution with unavailable server</h2>
   
   <p class="p">The following scenario shows how Rack Awareness functionality 
    implements replica vBuckets when an imbalance is caused by a server being removed or unavailable in a server group. 
    In this example, a server (Server 2) is unavailable to a server group (Group 1). 
    An imbalance occurs because one server group has fewer servers than the other server group. 
    In this case, if the rebalance operation is performed, a "best effort" of evenly 
    distributing the replica vBuckets across the cluster occurs.</p>

   
   <div class="note note"><span class="notetitle">Note:</span> 
    If the cluster becomes imbalanced, add servers to balance the cluster. 
    For optimal Rack Awareness functionality, a balanced cluster is recommended.
    If there is only one server or only one server group, 
    default behavior is automatically implemented, that is, Rack Awareness functionality is disabled.
   </div>

   
   <p class="p">The following diagram shows the loss of a server resulting in an imbalance. 
    In this case, Server 2 (from Group 1, Rack #1) becomes unavailable. 
    The replica vBuckets for Server 2 in Group 2, Rack #2 become enabled and rebalancing occurs.</p>

   <ul class="ul">
    <li class="li">Group 1 has Servers 1, 2, 3, and 4.</li>

    <li class="li">Group 1 servers have their active vBuckets and replica vBuckets from Group 2.</li>

    <li class="li">Group 1 Server 2 becomes unavailable.</li>

    <li class="li">Group 2 has Servers 5, 6, 7, and 8.</li>

    <li class="li">Group 2 servers have their active vBuckets and replica vBuckets from Group 1.</li>

    <li class="li">Group 2 server activates the replica vBuckets for Server 2 in Group 1.</li>
  
   </ul>

   
   <figure class="fig fignone"><span class="figcap">Figure 3. Rack Awareness with unavailable server</span>
    <img class="image" src="../images/RZAServerOUT.png" width="680"></figure>

  </section>

 
 </div>

 <nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../admin/Concepts/concept-clusterMgr.html" title="The Cluster Manager is responsible for node and cluster management. Every node within a Couchbase cluster includes the Cluster Manager component.">Cluster Manager</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../admin/Concepts/concept-nodesCluster.html" title="Couchbase Server can be used either in a standalone configuration or cluster configuration. A cluster configuration is multiple Couchbase Servers connected together to provide a single, distributed data store.">Nodes and clusters</a></div>
</div>

<div class="linklist linklist">
<div><a class="link" href="../Tasks/rza-manage-group.html" title="The Rack Awareness feature (Enterprise Edition) enables logical groupings of servers on a cluster where each server group physically belongs to a rack or availability zone. This feature provides the ability to specify that active and corresponding replica partitions be created on servers that are part of a separate rack or zone.">Managing Rack Awareness</a></div></div>
</nav>
</div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>