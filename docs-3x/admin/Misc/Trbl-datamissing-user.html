<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Incorrect or missing data (user issue) — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/admin-intro.html"><span>Administration</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../admin/Misc/admin-basics.html"><span>Administration basics</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/concept-intro.html"><span>Architecture and concepts</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/security/security-intro.html"><span>Security in Couchbase </span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/bp-deployment-considerations.html"><span>Deployment considerations</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Tasks/cluster-management.html"><span>Cluster management</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Monitoring/monitor-intro.html"><span>Monitoring</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/XDCR/xdcr-intro.html"><span>Cross Datacenter Replication (XDCR)</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/UI/ui-intro.html"><span>Web console</span></a></li><li class="section"><a href="../../admin/Misc/faq.html"><span>FAQs</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/Misc/Trbl-intro.html"><span>Troubleshooting</span></a><ul class="sub-sections"><li class="section"><a href="../../admin/Misc/Trbl-commonErrors.html"><span>Common errors</span></a></li><li class="section"><a href="../../admin/Misc/Trbl-generalTips.html"><span>General tips</span></a></li><li class="section"><a href="../../admin/Misc/Trbl-logs.html"><span>Logs and logging</span></a></li><li class="section"><a href="../../admin/Misc/Trbl-issuesReport.html"><span>Reporting issues</span></a></li><li class="section"><a href="../../admin/Misc/Trbl-beam-smp-issue.html"><span>Beam.smp</span></a></li><li class="section"><a href="../../admin/Misc/Trbl-blockedIndexer.html"><span>Blocked indexer</span></a></li><li class="section"><a href="../../admin/Misc/Trbl-common.html"><span>Server issues</span></a></li><li class="section"><a href="../../admin/Misc/Trbl-datamissing-server.html"><span>Incorrect or missing data (server issue)</span></a></li><li class="section"><a href="../../admin/Misc/Trbl-datamissing-user.html" class="current"><span>Incorrect or missing data (user issue)</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../admin/Misc/Trbl-designdocs.html"><span>Design document aliases</span></a></li><li class="section"><a href="../../admin/Misc/Trbl-expireddocs.html"><span>Expired documents issue</span></a></li><li class="section"><a href="../../admin/Misc/Trbl-indexFileSystem.html"><span>Index filesystem structure</span></a></li><li class="section"><a href="../../admin/Misc/Trbl-queryResults.html"><span>Index results for a single node</span></a></li><li class="section"><a href="../../admin/Misc/Trbl-replicaIndex.html"><span>Debugging replica index</span></a></li><li class="section"><a href="../../admin/Misc/Trbl-staleFalse-debug.html"><span>Debugging stale=false queries</span></a></li><li class="section"><a href="../../admin/Misc/Trbl-timeoutErrors.html"><span>Timeout errors</span></a></li><li class="section"><a href="../../admin/Misc/Trbl-total_row-debug.html"><span>total_rows values are too high</span></a></li></ul></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
    <h1 class="title topictitle1" id="ariaid-title1">Incorrect or missing data (user issue)</h1>

    
    <div class="body"><p class="shortdesc">Data missing in query response or it’s wrong (user issue)</p>

        <p class="p">For example, you defined a view with a <samp class="ph codeph">_stats</samp> reduce function. You query
            your view, and keep getting empty results all the time, for example:</p>

        <pre class="pre codeblock"><code><samp class="ph codeph">&gt; curl -s 'http://localhost:8092/default/_design/dev_test3/_view/view1?full_set=true'
{"rows":[
]
}
</samp></code></pre>

        <p class="p">You repeat this query over and over for several minutes or even hours, and you always get
            an empty result set.</p>

        <p class="p">Try to query the view with <samp class="ph codeph">stale=false</samp>, and you get:</p>

        <pre class="pre codeblock"><code><samp class="ph codeph">&gt; curl -s 'http://localhost:8092/default/_design/dev_test3/_view/view1?full_set=true&amp;stale=false'
{"rows":[
],
"errors":[
{"from":"local","reason":"Builtin _stats function
 requires map values to be numbers"},
{"from":"http://192.168.1.80:9502/_view_merge/?stale=false","reason":"Builtin _stats function requires map values to be
 numbers"},
{"from":"http://192.168.1.80:9501/_view_merge/?stale=false","reason":"Builtin _stats function requires map values to be
 numbers"},
{"from":"http://192.168.1.80:9503/_view_merge/?stale=false","reason":"Builtin _stats function requires map values to be
 numbers"}
]
}
</samp></code></pre>

        <p class="p">Then looking at the design document, you see it could never work, as values are not
            numbers:</p>

        <pre class="pre codeblock"><code><samp class="ph codeph">{
   "views":
   {
       "view1": {
           "map": "function(doc, meta) { emit(meta.id, meta.id); }",
           "reduce": "_stats"
       }
   }
}
</samp></code></pre>

        <p class="p">One important question to answer is, why do you see the errors when querying with
                <samp class="ph codeph">stale=false</samp> but do not see them when querying with
                <samp class="ph codeph">stale=update_after</samp> (default) or <samp class="ph codeph">stale=ok</samp> ? The
            answer is simple:</p>

        <ol class="ol">
            <li class="li"><p class="p"><samp class="ph codeph">stale=false</samp> means: trigger an index update/build, and wait until
                    it that update/build finishes, then start streaming the view results. For this
                    example, index build/update failed, so the client gets an error, describing why
                    it failed, from all nodes where it failed.</p>
</li>

            <li class="li"><p class="p"><samp class="ph codeph">stale=update_after</samp> means start streaming the index contents
                    immediately and after trigger an index update (if index is not up to date
                    already), so query responses won’t see indexing errors as they do for the
                        <samp class="ph codeph">stale=false</samp> scenario. For this particular example, the
                    error happened during the initial index build, so the index was empty when the
                    view queries arrived in the system, whence the empty result set.</p>
</li>

            <li class="li"><p class="p"><samp class="ph codeph">stale=ok</samp> is very similar to (2), except it doesn’t trigger index
                    updates.</p>
</li>

        </ol>

        <p class="p">Finally, index build/update errors, related to user Map/Reduce functions, can be found in
            a dedicated log file that exists per node and has a file name matching
                <samp class="ph codeph">mapreduce_errors.#</samp>. For example, from node 1, the file
                <samp class="ph codeph">*mapreduce_errors.1</samp> contained:</p>

        <pre class="pre codeblock"><code><samp class="ph codeph">[mapreduce_errors:error,2012-08-20T16:18:36.250,n_0@192.168.1.80:&lt;0.2096.1&gt;] Bucket `default`, main group `_design/dev_test3`,
 error executing reduce
function for view `view1'
   reason:                Builtin _stats function requires map values to be
numbers
</samp></code></pre>

    </div>

<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../admin/Misc/Trbl-intro.html" title="Troubleshooting covers general tips, common errors, log information, and other issues.">Troubleshooting</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../admin/Misc/Trbl-datamissing-server.html" title="Data missing in query response or it’s wrong (potentially due to server issues)">Incorrect or missing data (server issue)</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../admin/Misc/Trbl-designdocs.html">Design document aliases</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>