<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Compaction process — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/admin-intro.html"><span>Administration</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../admin/Misc/admin-basics.html"><span>Administration basics</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/concept-intro.html"><span>Architecture and concepts</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/security/security-intro.html"><span>Security in Couchbase </span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/bp-deployment-considerations.html"><span>Deployment considerations</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/Tasks/cluster-management.html"><span>Cluster management</span></a><ul class="sub-sections"><li class="section"><a href="../../admin/Tasks/tasks-manage-serverWarmup.html"><span>Handling server warmup</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Tasks/tasks-manage-replication.html"><span>Handling replication</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/Tasks/tasks-compaction.html"><span>Compacting data files</span></a><ul class="sub-sections"><li class="section"><a href="../../admin/Tasks/tasks-compaction-process.html" class="current"><span>Compaction process</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../admin/Tasks/tasks-autocompact-strategies.html"><span>Auto-compaction configuration and strategies</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/Tasks/cluster-maintenance.html"><span>Cluster maintenance</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Tasks/maintenance-server-node.html"><span>Server maintenance</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Tasks/tasks-backup-restore.html"><span>Backup and restore</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Tasks/tasks-manage-xdcr.html"><span>Managing XDCR</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/Monitoring/monitor-intro.html"><span>Monitoring</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/XDCR/xdcr-intro.html"><span>Cross Datacenter Replication (XDCR)</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/UI/ui-intro.html"><span>Web console</span></a></li><li class="section"><a href="../../admin/Misc/faq.html"><span>FAQs</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Misc/Trbl-intro.html"><span>Troubleshooting</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
  <h1 class="title topictitle1" id="ariaid-title1">Compaction process</h1>

  <div class="body"><p class="shortdesc">Couchbase Server compacts views and data files.</p>

   <p class="p">For database compaction, Couchbase Server creates a new file to which the active (non-stale)
      information is written. Meanwhile, the existing database files stay in place and continue to
      be used for storing information and updating the index data. This process ensures that the
      database continues to be available while compaction takes place. Once compaction is completed,
      the old database is disabled and saved. After that, any incoming updates are posted in the
      newly created database files and the old database is deleted from the system.</p>

    <p class="p">View compaction occurs in the same way. Couchbase Server creates a new index file for each
      active design document. Then it takes this new index file and writes active index information
      into it. Old index files are handled in the same way as the old data files during compaction.
      Once compaction is completed, old index files are deleted from the system.</p>

    
  <section class="section"><h2 class="title sectiontitle">How to use compaction</h2>
    
    <p class="p">Compaction takes place as a background process while Couchbase Server is running.
            You do not need to shut down or pause the database operation and clients can continue to access
            and submit requests while the database is running. While compaction takes place in the
            background, be sure to:</p>

    
    <dl class="dl">
      
        <dt class="dt dlterm">Perform compaction on every server.</dt>

        <dd class="dd">Compaction operates only on a single server in the Couchbase Server cluster. You need to
            perform compaction on each node in your cluster, and on each database in your
            cluster.</dd>

      
    </dl>

    <dl class="dl">
      
        <dt class="dt dlterm">Perform compaction during off-peak hours.</dt>

        <dd class="dd">The compaction process is both disk and CPU intensive. In heavy write-based databases
            where compaction is required, it must be scheduled during off-peak hours (use
            auto-compact to schedule specific times). <p class="p">If compaction isn’t scheduled during
              off-peak hours, it can cause problems. Since the compaction process can take long time
              to complete on large and busy databases, it is possible that it can fail to complete
              properly while the database is still active. In extreme cases, this can lead to the
              compaction process never catching up with the database modifications, and eventually
              using up all the disk space. Schedule compaction during off-peak hours to prevent
              this!</p>
</dd>

      
    </dl>

    <dl class="dl">
      
        <dt class="dt dlterm">Perform compaction with adequate disk space.</dt>

        <dd class="dd">Since compaction occurs by creating new files and
          updating the information, you might need as much as twice the disk space of your current database
          and index files. However, it is important to keep in mind that the exact amount of the disk space required
            depends on the level of fragmentation, the amount of dead data, and the activity of the database,
            as changes during compaction will also need to be written to the updated data
            files. Before compaction takes place, the disk space is checked. If the amount of
              available disk space is less than twice the current database size, the compaction process does
              not take place and a warning is issued in the log.</dd>

      
    </dl>

    
    
  </section>

    <section class="section"><h2 class="title sectiontitle">Compaction behavior</h2>
      
   <p class="p">The activities you can set up for auto-compaction are:</p>

      
      <dl class="dl">
        
          <dt class="dt dlterm">Stop/Restart:</dt>

          <dd class="dd">The compaction process can be stopped and restarted. However, you should be aware that
            in case the compaction process is stopped and updates to the database completed, when
            the compaction process is restarted the updated database may not be a clean compacted
            version. This happens because any changes to the portion of the database file that were
            processed before the compaction was canceled and restarted have already been
            processed.</dd>

        
      </dl>

      
      <dl class="dl">
        
          <dt class="dt dlterm">Auto-compaction:</dt>

          <dd class="dd">Auto-compaction automatically triggers the compaction process on
            your database. You can schedule specific hours when compaction can take place.</dd>

        
      </dl>

      <dl class="dl">
        
          <dt class="dt dlterm">Compaction activity log:</dt>

          <dd class="dd">Compaction activity is reported in the Couchbase Server log. You will see entries
            similar to following showing the compaction operation and duration: <ul class="ul">
              <li class="li">Autocompaction: Indicates compaction cannot be performed because of inadequate
                disk space.</li>

              <li class="li">Manually triggered compaction</li>

              <li class="li">Compaction completed successfully</li>

              <li class="li">Compaction failed</li>

              <li class="li">Purge deletes compaction</li>

              <li class="li">Compaction started/completed</li>

              <li class="li">Compaction failed</li>

            </ul>

          </dd>

        </dl>

                        
      </section>
  
  </div>
 
  

<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../admin/Tasks/tasks-compaction.html" title="Database and view compaction helps to reclaim disk space and reduce fragmentation.">Compacting data files</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../admin/Tasks/tasks-autocompact-strategies.html" title="Couchbase Server incorporates an automates compaction mechanism that can compact both data files and the view index files.">Auto-compaction configuration and strategies</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>