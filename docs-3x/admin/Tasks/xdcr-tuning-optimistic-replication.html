<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Tuning XDCR performance — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/admin-intro.html"><span>Administration</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../admin/Misc/admin-basics.html"><span>Administration basics</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/concept-intro.html"><span>Architecture and concepts</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/security/security-intro.html"><span>Security in Couchbase </span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/bp-deployment-considerations.html"><span>Deployment considerations</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/Tasks/cluster-management.html"><span>Cluster management</span></a><ul class="sub-sections"><li class="section"><a href="../../admin/Tasks/tasks-manage-serverWarmup.html"><span>Handling server warmup</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Tasks/tasks-manage-replication.html"><span>Handling replication</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Tasks/tasks-compaction.html"><span>Compacting data files</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Tasks/cluster-maintenance.html"><span>Cluster maintenance</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Tasks/maintenance-server-node.html"><span>Server maintenance</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Tasks/tasks-backup-restore.html"><span>Backup and restore</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/Tasks/tasks-manage-xdcr.html"><span>Managing XDCR</span></a><ul class="sub-sections"><li class="section"><a href="../../admin/Tasks/xdcr-configure-replications.html"><span>Configuring XDCR replications</span></a></li><li class="section"><a href="../../admin/Tasks/xdcr-conflictResolution.html"><span>Conflict resolution in XDCR</span></a></li><li class="section"><a href="../../admin/Tasks/xdcr-secure-communication.html"><span>Securing data communication</span></a></li><li class="section"><a href="../../admin/Tasks/xdcr-tuning-optimistic-replication.html" class="current"><span>Tuning XDCR performance</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../admin/Tasks/xdcr-configure-bidirection.html"><span>Configuring bi-directional replication</span></a></li><li class="section"><a href="../../admin/Tasks/xdcr-modify-settings.html"><span>Modifying XDCR settings</span></a></li><li class="section"><a href="../../admin/Tasks/tasks-dataRecovery.html"><span>Data recovery from remote clusters</span></a></li><li class="section"><a href="../../admin/XDCR/xdcr-memory-replication.html"><span>Stream-based XDCR</span></a></li></ul></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/Monitoring/monitor-intro.html"><span>Monitoring</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/XDCR/xdcr-intro.html"><span>Cross Datacenter Replication (XDCR)</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/UI/ui-intro.html"><span>Web console</span></a></li><li class="section"><a href="../../admin/Misc/faq.html"><span>FAQs</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Misc/Trbl-intro.html"><span>Troubleshooting</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
  <h1 class="title topictitle1" id="ariaid-title1">Tuning XDCR performance</h1>

  
  <div class="body"><p class="shortdesc">XDCR performance can be tuned via the Web console or the REST XDCR advanced
    settings.</p>

      
      <p class="p"> By default, XDCR
        gets metadata twice for documents over 256 bytes before it performs conflict resolution for at a
        destination cluster. If the document fails conflict resolution it will be discarded at the
        destination cluster.</p>

      
      <p class="p">When a document is smaller than the number of bytes provided as this
        parameter, XDCR immediately puts it into the replication queue without getting metadata on the
        source cluster. If the document is deleted on a source cluster, XDCR will no longer fetch
        metadata for the document before it sends this update to a destination cluster. Once a document
        reaches the destination cluster, XDCR will fetch the metadata and perform conflict resolution
        between documents. If the document ‘loses’ conflict resolution, Couchbase Server discards it on
        the destination cluster and keeps the version on the destination. This new feature improves
        replication latency, particularly when you replicate small documents.</p>

      
      <p class="p">There are tradeoffs
        when you change this setting. If you set this low relative to document size, XDCR will
        frequently check metadata. This will increase latency during replication, it also means that it
        will get metadata before it puts a document into the replication queue, and will get it again
        for the destination to perform conflict resolution. The advantage is that you do not waste
        network bandwidth since XDCR will send less documents that will ‘lose.’</p>

      
      <p class="p">If you set this
        very high relative to document size, XDCR fetches less metadata which will improve latency
        during replication. This also means that you will increase the rate at which XDCR puts items
        immediately into the replication queue which can potentially overwhelm your network, especially
        if you set a high number of parallel replicators. This may increase the number of documents sent
        by XDCR which ultimately ‘lose’ conflicts at the destination which wastes network
        bandwidth.</p>

      
      <div class="note note"><span class="notetitle">Note:</span> XDCR does not fetch metadata for documents that are deleted.</div>

      
      <section class="section"><h2 class="title sectiontitle">Changing the document threshold</h2>
        
        <p class="p">Change the document threshold with the REST <samp class="ph codeph">/settings/replications
          optimisticReplicationThreshold</samp> URI and parameter for XDCR advanced settings.
        Alternatively, change the <span class="ph uicontrol">XDCR Optimistic Replication Threshold</span> setting for 
          the XDCR replication.</p>

      </section>

      
      
      <section class="section"><h2 class="title sectiontitle">Monitoring optimistic replication</h2>
      <p class="p">The easiest way you can monitor the impact of this setting is in Couchbase Web console. On
        the Data Buckets tab under Incoming XDCR Operations, you can compare <samp class="ph codeph">metadata reads
          per sec</samp> to <samp class="ph codeph">sets per sec</samp>. </p>

      <img class="image" src="../images/monitor_optmized_xdcr.png">
      <p class="p">If you set a low threshold relative to document size, <samp class="ph codeph">metadata reads per
          sec</samp> will be roughly twice the value of <samp class="ph codeph">sets per sec</samp>. If you set
        a high threshold relative to document size, this will virtually eliminate the first fetch of
        metadata and therefore <samp class="ph codeph">metadata reads per sec</samp> will roughly equal
          <samp class="ph codeph">sets per sec</samp></p>

      <p class="p">The other option is to check the log files for XDCR, which you can find in
          <samp class="ph codeph">/opt/couchbase/var/lib/couchbase/logs</samp> on the nodes for a source bucket.
        The log files following the naming convention <samp class="ph codeph">xdcr.1</samp>,
          <samp class="ph codeph">xdcr.2</samp> and so on. In the logs you will see a series of entries as
        follows:</p>

      <pre class="pre codeblock"><code>
out of all 11 docs, number of small docs (including dels: 2) is 4,
number of big docs is 7, threshold is 256 bytes,
after conflict resolution at target ("http://Administrator:asdasd@127.0.0.1:9501/default%2f3%3ba19c9d4e733a97fa7cb38daa4113d034/"),
out of all big 7 docs the number of docs we need to replicate is: 5;
total # of docs to be replicated is: 9, total latency: 142 ms
</code></pre>

      <p class="p">The first line means that 4 documents are under the threshold and XDCR checked metadata
        twice for all 7 documents and replicated 5 larger documents and 4 smaller documents. The
        amount of time to check and replicate all 11 documents was 142 milliseconds.</p>

    </section>

  </div>


<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../admin/Tasks/tasks-manage-xdcr.html" title="Cross datacenter replication (XDCR) provides an easy method of replicating data from one cluster to another for disaster recovery as well as better data locality (getting data closer to its users).">Managing XDCR</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../admin/Tasks/xdcr-secure-communication.html" title="To ensure security for the replicated information, configure a suitable VPN gateway between the two datacenters that encrypts the data between each route between datacenters.">Securing data communication</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../admin/Tasks/xdcr-configure-bidirection.html">Configuring bi-directional replication</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>