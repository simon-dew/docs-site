<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Changing ejection thresholds — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../../admin/cli-intro.html"><span>CLI reference</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../../admin/CLI/cli-overview.html"><span>CLI overview</span></a></li><li class="section section--has-sub-sections"><a href="../../../admin/CLI/cbcli-intro.html"><span>couchbase-cli tool</span></a></li><li class="section"><a href="../../../admin/CLI/cbanalyze-core_tool.html"><span>cbanalyze-core tool</span></a></li><li class="section section--has-sub-sections"><a href="../../../admin/CLI/cbbackup_tool.html"><span>cbbackup tool</span></a></li><li class="section"><a href="../../../admin/CLI/cbcollect_info_tool.html"><span>cbcollect_info tool</span></a></li><li class="section"><a href="../../../admin/CLI/cbdocloader_tool.html"><span>cbdocloader tool</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../../admin/CLI/cbepctl-intro.html"><span>cbepctl tool</span></a><ul class="sub-sections"><li class="section"><a href="../../../admin/CLI/CBepctl/cbepctl-threadpool-tuning.html"><span>Changing shared thread pool settings</span></a></li><li class="section"><a href="../../../admin/CLI/CBepctl/cbepctl-thresholds.html" class="current"><span>Changing ejection thresholds</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../../admin/CLI/CBepctl/cbepctl-accesslog.html"><span>Changing access log settings</span></a></li><li class="section"><a href="../../../admin/CLI/CBepctl/cbepctl-diskcleanup.html"><span>Changing disk cleanup intervals</span></a></li><li class="section"><a href="../../../admin/CLI/CBepctl/cbepctl-diskwritequeue.html"><span>Changing disk write queue quotas</span></a></li><li class="section"><a href="../../../admin/CLI/CBepctl/cbepctl-timeout.html"><span>Changing out-of-memory thresholds</span></a></li></ul></li><li class="section"><a href="../../../admin/CLI/cbhealthchecker_tool.html"><span>cbhealthchecker tool</span></a></li><li class="section"><a href="../../../admin/CLI/cbreset_password_tool.html"><span>cbreset_password tool</span></a></li><li class="section section--has-sub-sections"><a href="../../../admin/CLI/cbrestore_tool.html"><span>cbrestore tool</span></a></li><li class="section section--has-sub-sections"><a href="../../../admin/CLI/cbstats-intro.html"><span>cbstats tool</span></a></li><li class="section"><a href="../../../admin/CLI/cbtransfer_tool.html"><span>cbtransfer tool</span></a></li><li class="section"><a href="../../../admin/CLI/cbworkloadgen_tool.html"><span>cbworkloadgen tool</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections"><a href="../../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a></li><li class="section section--has-sub-sections"><a href="../../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
  <h1 class="title topictitle1" id="ariaid-title1">Changing ejection thresholds</h1>

  
  <div class="body refbody"><p class="shortdesc">The item pager process ejects items from RAM when too much space is being taken up in
    RAM.</p>

    <section class="section"><h2 class="title sectiontitle">Description</h2>
      <p class="p">Ejection means that documents are removed from RAM but the key and metadata remain. If the
        amount of RAM used by items reaches the high water mark (upper threshold), both active and
        replica data are ejected until the memory usage (amount of RAM consumed) reaches the low
        water mark (lower threshold). The server determines that items are not frequently used based
        on a not-recently-used (NRU) value.</p>

      
      <p class="p">Use the <samp class="ph codeph">mem_low_wat</samp>, <samp class="ph codeph">mem_high_wat</samp>, and
          <samp class="ph codeph">pager_active_vb_pcnt</samp> settings to change the server thresholds for
        ejection.</p>

      
      <div class="note warning"><span class="warningtitle">Warning:</span> We do not recommend that you change the ejection defaults unless
        required by Couchbase Support.</div>

      <div class="note note"><span class="notetitle">Note:</span> Changes of thresholds are NOT persistent and must be reapplied after the
        bucket warmup.</div>

    </section>

    
    <section class="section"><h2 class="title sectiontitle">Syntax</h2>
      <p class="p">Basic syntax:</p>

      <pre class="pre codeblock"><code>cbepctl [localhost]:11210 -b [bucket-name] -p [bucket-password] set flush_param [parameter] [value]</code></pre>

      
      <p class="p">Parameters used for changing ejection thresholds:</p>

      <ul class="ul">
        <li class="li">mem_low_wat</li>

        <li class="li">mem_high_wat</li>

        <li class="li">pager_active_vb_pcnt</li>

      </ul>

    
    </section>


    <section class="section"><h2 class="title sectiontitle">Example: Setting the low water mark</h2>
      <p class="p">The low water mark sets the lower threshold of RAM for a specific data bucket on
        a node. The item pager stops ejecting items once the low water mark is reached. </p>

      <p class="p">The following example sets the low water mark percentage to 70% of RAM.</p>

      <pre class="pre codeblock"><code>cbepctl 10.5.2.117:11210 -b foo-bucket -p foo-password set flush_param mem_low_wat 70
</code></pre>
</section>

    
    <section class="section"><h2 class="title sectiontitle">Example: Setting the high water mark</h2>
      <p class="p">The high water mark set the amount of RAM consumed by items that must be breached before
        infrequently used active and replica items are ejected.</p>

      <p class="p">The following example sets the high water mark percentage to 80% of RAM for a specific data bucket on
        a node. This means that items in RAM on this node can consume up to 80% of RAM before
        the item pager begins ejecting items. </p>

      <pre class="pre codeblock"><code>cbepctl 10.5.2.117:11210 -b foo-bucket -p foo-password set flush_param mem_high_wat 80
</code></pre>
</section>

    
    <section class="section"><h2 class="title sectiontitle">Example: Setting percentage of ejected items</h2>
      <p class="p">Based on the NRU algorithm, the server ejects active and replica data from a node. By default, the server is configured to
        40% active items and 60% replica data from a node.</p>

      <p class="p">The following example increases the percentage of active items that can be ejected from a
        node to 50%.</p>

      <pre class="pre codeblock"><code>cbepctl 10.5.2.117:11210 -b foo-bucket -p foo-password set flush_param pager_active_vb_pcnt 50
</code></pre>

      
      <p class="p">Be aware of potential performance implications when changing the percentage of ejected items. It may be more
        desirable to eject as many replica items as possible and limit the amount of active data
        that can be ejected. By doing so, active data from a source node is maximized while
        maintaining incoming requests to that node. However, if the server is ejecting a very large
        percentage of replica data and a node fails, the replica data is not immediately available.
        In this case, the items are retrieved from disk and put back into RAM before the request is
        fulfilled. </p>

    </section>

    
    <section class="section"><h2 class="title sectiontitle">Response</h2>
      <p class="p">The following example response shows the low water mark, high water mark, and percentage of ejected items being set.</p>

      <pre class="pre codeblock"><code>
setting param: mem_low_wat 70
set mem_low_wat to 70

setting param: mem_high_wat 80
set mem_high_wat to 80

setting param: pager_active_vb_pcnt 50
set pager_active_vb_pcnt to 50
      </code></pre>

    
    </section>

  </div>


<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../../admin/CLI/cbepctl-intro.html" title="The cbepctl tool is used to control vBucket states, configuration, and memory and disk persistence behavior.">cbepctl tool</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../../admin/CLI/CBepctl/cbepctl-threadpool-tuning.html" title="Dynamic shared thread pool performance is tunable via cbepctl set flush_param command options.">Changing shared thread pool settings</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../../admin/CLI/CBepctl/cbepctl-accesslog.html" title="Access log settings determine when the access scanner process initially runs and how often.">Changing access log settings</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../../';</script><script src="../../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>