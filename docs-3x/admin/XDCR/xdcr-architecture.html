<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>XDCR architecture — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/admin-intro.html"><span>Administration</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../admin/Misc/admin-basics.html"><span>Administration basics</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/concept-intro.html"><span>Architecture and concepts</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/security/security-intro.html"><span>Security in Couchbase </span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Concepts/bp-deployment-considerations.html"><span>Deployment considerations</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Tasks/cluster-management.html"><span>Cluster management</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Monitoring/monitor-intro.html"><span>Monitoring</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/XDCR/xdcr-intro.html"><span>Cross Datacenter Replication (XDCR)</span></a><ul class="sub-sections"><li class="section"><a href="../../admin/XDCR/xdcr-usecases.html"><span>XDCR use cases</span></a></li><li class="section"><a href="../../admin/XDCR/xdcr-architecture.html" class="current"><span>XDCR architecture</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../admin/XDCR/xdcr-memory-replication.html"><span>Stream-based XDCR</span></a></li><li class="section"><a href="../../admin/XDCR/xdcr-topologies.html"><span>XDCR basic topologies</span></a></li><li class="section"><a href="../../admin/XDCR/xdcr-topologies-adv.html"><span>XDCR advanced topologies</span></a></li><li class="section"><a href="../../admin/XDCR/xdcr-memcachedReplication.html"><span>XDCR replication via memcached protocol</span></a></li><li class="section"><a href="../../admin/XDCR/xdcr-systemOutage.html"><span>XDCR and network or system outages</span></a></li><li class="section"><a href="../../admin/XDCR/xdcr-docs.html"><span>XDCR document handling</span></a></li><li class="section"><a href="../../admin/XDCR/xdcr-flushRequests.html"><span>XDCR flush requests</span></a></li><li class="section"><a href="../../admin/XDCR/xdcr-streamMgmt.html"><span>XDCR stream management</span></a></li><li class="section"><a href="../../admin/XDCR/xdcr-pause-resume.html"><span>XDCR pause and resume replication</span></a></li><li class="section"><a href="../../admin/XDCR/xdcr-dataEncryption.html"><span>XDCR data encryption</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/UI/ui-intro.html"><span>Web console</span></a></li><li class="section"><a href="../../admin/Misc/faq.html"><span>FAQs</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Misc/Trbl-intro.html"><span>Troubleshooting</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
  <h1 class="title topictitle1" id="ariaid-title1">XDCR architecture</h1>

  <div class="body">
    <p class="p">There are a number of key elements in Couchbase Server’s XDCR architecture including:</p>

    <p class="p"><strong class="ph b">Continuous Replication.</strong> XDCR in Couchbase Server provides continuous replication
      across geographically distributed datacenters. Data mutations are replicated to the
      destination cluster after they are written to disk. There are multiple data streams (32 by
      default) that are shuffled across all shards (called <dfn class="term">vBuckets</dfn> in Couchbase Server) on the
      source cluster to move data in parallel to the destination cluster. The vBucket list is
      shuffled so that replication is evenly load balanced across all the servers in the cluster.
      The clusters scale horizontally, more the servers, more the replication streams, faster the
      replication rate. </p>

    <p class="p"><strong class="ph b">Cluster Aware.</strong> XDCR is cluster topology aware. The source and destination clusters
      could have different number of servers. If a server in the source or destination cluster goes
      down, XDCR is able to get the updated cluster topology information and continue replicating
      data to available servers in the destination cluster.</p>

    <p class="p"><strong class="ph b">Push based connection resilient replication.</strong> XDCR in Couchbase Server is push-based
      replication. The source cluster regularly checkpoints the replication queue per vBucket and
      keeps track of what data the destination cluster last received. If the replication process is
      interrupted for example due to a server crash or intermittent network connection failures, it
      is not required to restart replication from the beginning. Instead, once the replication link
      is restored, replication can continue from the last checkpoint seen by the destination
      cluster.</p>

    <p class="p"><strong class="ph b">Efficient.</strong> For the sake of efficiency, Couchbase Server is able to de-duplicate
      information that is waiting to be stored on disk. For instance, if there are three changes to
      the same document in Couchbase Server, and these three changes are waiting in queue to be
      persisted, only the last version of the document is stored on disk and later gets pushed into
      the XDCR queue to be replicated.</p>

    <p class="p"><strong class="ph b">Active-Active Conflict Resolution.</strong> Within a cluster, Couchbase Server provides strong
      consistency at the document level. On the other hand, XDCR also provides eventual consistency
      across clusters. Built-in conflict resolution will pick the same “winner” on both the clusters
      if the same document was mutated on both the clusters. If a conflict occurs, the document with
      the most updates will be considered the “winner.” If the same document is updated the same
      number of times on the source and destination, additional metadata such as numerical sequence,
      CAS value, document flags and expiration TTL value are used to pick the “winner.” XDCR applies
      the same rule across clusters to make sure document consistency is maintained:</p>

    
        <img class="image" src="../images/xdcr_conflict_res.png" width="720">
    <p class="p">As shown in above, bidirectional replication is set up between Datacenter 1 and Datacenter 2
      and both the clusters start off with the same JSON document (Doc 1). In addition, two
      additional updates to Doc 1 happen on Datacenter 2. In the case of a conflict, Doc 1 on
      Datacenter 2 is chosen as the winner because it has seen more updates.</p>

  </div>

  <nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../admin/XDCR/xdcr-intro.html" title="XDCR replicates data from one cluster to another cluster primarily for disaster recovery.">Cross Datacenter Replication (XDCR)</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../admin/XDCR/xdcr-usecases.html">XDCR use cases</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../admin/XDCR/xdcr-memory-replication.html" title="Stream-based XDCR collects data changes from memory on the source cluster and streams the data changes directly to memory on the destination cluster.">Stream-based XDCR</a></div>
</div>

<div class="linklist linklist">
<div><a class="link" href="../REST/rest-xdcr-intro.html" title="The XDCR REST API is used to manage Cross Datacenter Replication (XDCR) operations.">XDCR API</a></div></div>
</nav>
</div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>