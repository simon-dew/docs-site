<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Stream-based views — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a><ul class="sub-sections"><li class="section"><a href="../../admin/Views/views-basics.html"><span>View basics</span></a></li><li class="section"><a href="../../admin/Views/views-index-updates.html" class="current"><span>Stream-based views</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../admin/Views/views-operation.html"><span>Views operations</span></a></li><li class="section"><a href="../../admin/Views/views-storedData.html"><span>Views and stored data</span></a></li><li class="section"><a href="../../admin/Views/views-development.html"><span>Development views</span></a></li><li class="section"><a href="../../admin/Views/views-production.html"><span>Production views</span></a></li><li class="section"><a href="../../admin/Views/views-writing.html"><span>Writing views</span></a></li><li class="section"><a href="../../admin/Views/views-geospatial.html"><span>Writing geospatial views</span></a></li><li class="section"><a href="../../admin/Views/views-schemaless.html"><span>Views in a schema-less database</span></a></li><li class="section"><a href="../../admin/Views/views-translateSQL.html"><span>Translating SQL to map/reduce</span></a></li><li class="section"><a href="../../admin/Views/views-querying.html"><span>Querying views</span></a></li><li class="section"><a href="../../admin/Views/views-querySample.html"><span>View and query examples</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Misc/sample-bucket-intro.html"><span>Sample buckets</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">

	<h1 class="title topictitle1" id="ariaid-title1">Stream-based views</h1>

	


	<div class="body conbody"><div class="abstract">
		 <span class="shortdesc">Stream-based views reduce latency for view updates, providing faster view
			consistency and fresher data.</span>
This feature uses the new streaming protocol,
		Database Change Protocol (DCP). </div>


		<p class="p">With DCP, data does not need to be persisted to disk before retrieving it with a view query.
			DCP offers the following benefits for views: </p>

		<ul class="ul">
			<li class="li">Views are updated with key-value data sooner.</li>

			<li class="li">Latency for view updates is reduced.</li>

			<li class="li">Views are more closely synchronized with the data.</li>

		</ul>

		
		<p class="p">The following diagram gives an overview of how stream-based views operate.</p>

		
		<img class="image" src="../images/stream-based-views.png" width="600">

		<p class="p">When submitting a view query, you can include a parameter that specifies your data freshness
			requirements. The name of the parameter is <samp class="ph codeph">stale</samp> and it takes the
			following values:</p>


		<ul class="ul">
			<li class="li"><samp class="ph codeph">ok</samp>—The server returns the current entries from the index file.</li>

			<li class="li"><samp class="ph codeph">update_after</samp>—The server returns the current entries from the index,
				and then initiates an index update.</li>

			<li class="li"><samp class="ph codeph">false</samp>—The server waits for the indexer to finish the changes that
				correspond to the current key-value document set and then returns the latest entries
				from the view index.</li>

		</ul>


		<p class="p">Every 5 seconds the automatic update process checks whether 5000 changes have occurred. If
			a minimum of 5000 changes occurred, an index update is triggered. Otherwise, no update is
			triggered. When triggered, the indexer requests from DCP all changes since it was last run.
			The default number of changes to check for is 5000, but that number can be configured by
			setting the <samp class="ph codeph">updateMinChanges</samp> option. The update interval can also be
			configured by setting the <samp class="ph codeph">updateInterval</samp> option. </p>


		<p class="p">The <samp class="ph codeph">stale=false</samp> view query argument has been enhanced. When an application
			sends a query that has the <samp class="ph codeph">stale</samp> parameter set to false, the
			application receives all recent changes to the documents, including changes that haven't
			yet been persisted to disk. It considers all document changes that have been received at
			the time the query was received. </p>

		<p class="p">You can issue the <samp class="ph codeph">stale=false</samp> view query anytime and results will fetch
			all changes that have been made when the query was issued. </p>



		<div class="note note"><span class="notetitle">Best practice:</span> For better scalability and throughput, we
			recommend that you set the value of the <samp class="ph codeph">stale</samp> parameter to
				<samp class="ph codeph">ok</samp>. With the stream-based views feature, data returned when
				<samp class="ph codeph">stale</samp> is set to <samp class="ph codeph">ok</samp> is closer to the key-value data,
			even though it might not include all of it.</div>


	</div>


<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../admin/Views/views-intro.html" title="Couchbase views enable indexing and querying of data.">Views and indexes</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../admin/Views/views-basics.html" title="Views allow you to extract specific fields and information from data and create an index.">View basics</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../admin/Views/views-operation.html" title="Views create indexes on your information that enable search and select operations on the data.">Views operations</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>