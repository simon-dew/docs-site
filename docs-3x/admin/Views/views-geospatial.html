<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Writing geospatial views — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a><ul class="sub-sections"><li class="section"><a href="../../admin/Views/views-basics.html"><span>View basics</span></a></li><li class="section"><a href="../../admin/Views/views-index-updates.html"><span>Stream-based views</span></a></li><li class="section"><a href="../../admin/Views/views-operation.html"><span>Views operations</span></a></li><li class="section"><a href="../../admin/Views/views-storedData.html"><span>Views and stored data</span></a></li><li class="section"><a href="../../admin/Views/views-development.html"><span>Development views</span></a></li><li class="section"><a href="../../admin/Views/views-production.html"><span>Production views</span></a></li><li class="section"><a href="../../admin/Views/views-writing.html"><span>Writing views</span></a></li><li class="section"><a href="../../admin/Views/views-geospatial.html" class="current"><span>Writing geospatial views</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../admin/Views/views-schemaless.html"><span>Views in a schema-less database</span></a></li><li class="section"><a href="../../admin/Views/views-translateSQL.html"><span>Translating SQL to map/reduce</span></a></li><li class="section"><a href="../../admin/Views/views-querying.html"><span>Querying views</span></a></li><li class="section"><a href="../../admin/Views/views-querySample.html"><span>View and query examples</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Misc/sample-bucket-intro.html"><span>Sample buckets</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
	<h1 class="title topictitle1" id="ariaid-title1">Writing geospatial views</h1>

	
	<div class="body"><p class="shortdesc">Geospatial views add multidimensional index support to Couchbase. </p>

		<p class="p">Spatial support enables you to record geometry data into the bucket and then
		perform queries that return information based on whether the recorded geometries exist
		within a given two-dimensional range such as a bounding box. The geometry data can be used
		in spatial queries and geolocational queries where you want to find entries based on your
		location or region.</p>

		
		<div class="note warning"><span class="warningtitle">Warning:</span> Geospatial views are provided as an experimental feature. They are not
			intended for production use and are not supported in production deployments.</div>

		
		<section class="section"><h2 class="title sectiontitle">Adding geometry data</h2>
			<p class="p">Geospacial views support the storage of any geometry information using the GeoJSON
				specification. The format of the storage of the point data is arbitrary with the
				geometry type being supported during the view index generation.</p>

			<p class="p">For example, you can use two-dimensional geometries
				for storing simple location data. You can add these to your Couchbase documents
				using any field name. The convention is to use a single field with two-element array
				with the point location, but you can also use two separate fields or compound
				structures as it is the view that compiles the information into the geospatial
				index.</p>
<p class="p">For example, to populate a bucket with city location information, the
				document sent to the bucket could be formatted like that
				below:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">{
"loc" : [-122.270833, 37.804444],
"title" : "Oakland"
}
</samp></code></pre>

			</section>

		
		
		
		<section class="section"><h2 class="title sectiontitle">Views and queries</h2><p class="p">Geospatial views extensions use the standard Couchbase indexing system to build a two-dimensional
				index from the point data within the bucket. The format of the index information is
				based on the GeoJSON specification.</p>

			<p class="p">To create a geospatial index, use the
					<samp class="ph codeph">emit()</samp> function to output a GeoJSON Point value containing the
				coordinates of the point you are describing. For example, the following function
				will create a geospatial index on the earlier spatial record
				example.</p>
<pre class="pre codeblock"><code><samp class="ph codeph">function(doc, meta)
{
  if (doc.loc)
  {
     emit(
          {
             type: "Point",
             coordinates: doc.loc,
          },
          [meta.id, doc.loc]);
  }
}
</samp></code></pre>
<p class="p">The
				key in the spatial view index can be any valid GeoJSON geometry value, including
				points, multipoints, linestrings, polygons and geometry collections.</p>
<p class="p">The view
					<samp class="ph codeph">map()</samp> function should be placed into a design document using
				the <samp class="ph codeph">spatial</samp> prefix to indicate the nature of the view definition.
				For example, the following design document includes the above function as the view
					<samp class="ph codeph">points</samp></p>
<pre class="pre codeblock"><code>{
   "spatial" : {
      "points" : "function(doc, meta) 
         { if (doc.loc) 
            { emit({ type: \"Point\", coordinates: doc.loc}, [meta.id, doc.loc]);}}",
   }
}
</code></pre>
<p class="p">To
				execute the geospatial query you use the design document format using the embedded
				spatial indexing. For example, if the design document is called
					<samp class="ph codeph">main</samp> within the bucket <samp class="ph codeph">places</samp>, the URL will be
					<samp class="ph codeph">http://localhost:8092/places/_design/main/_spatial/points</samp>.</p>
<p class="p">Spatial
				queries include support for a number of additional arguments to the view request.
				The full list is provided in the following summary
				table.</p>

			
			
			
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
					<col style="width:50%">
					<col style="width:50%">
					<thead class="thead" style="text-align:left;">
						<tr class="row">
							<th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d112191e92">Get Spatial Name</th>

							<th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d112191e95">Description</th>

						</tr>

					</thead>

					<tbody class="tbody">
						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 "><strong class="ph b">Method</strong></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 "><samp class="ph codeph">GET
									/bucket/_design/design-doc/_spatial/spatial-name</samp></td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 "><strong class="ph b">Request Data</strong></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 ">None</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 "><strong class="ph b">Response Data</strong></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 ">JSON of the documents returned by the view</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 "><strong class="ph b">Authentication Required</strong></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 ">no</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 ">&nbsp;</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 "><strong class="ph b">Query Arguments</strong></td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 "><samp class="ph codeph">bbox</samp></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 ">Specify the bounding box for a spatial query</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 ">&nbsp;</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 "><strong class="ph b">Parameters</strong> : string; optional</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 "><samp class="ph codeph">limit</samp></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 ">Limit the number of the returned documents to the specified
								number</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 ">&nbsp;</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 "><strong class="ph b">Parameters</strong> : numeric; optional</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 "><samp class="ph codeph">skip</samp></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 ">Skip this number of records before starting to return the
								results</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 ">&nbsp;</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 "><strong class="ph b">Parameters</strong> : numeric; optional</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 "><samp class="ph codeph">stale</samp></td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 ">Allow the results from a stale view to be used</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 ">&nbsp;</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 "><strong class="ph b">Parameters</strong> : string; optional</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 ">&nbsp;</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 "><strong class="ph b">Supported Values</strong></td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 ">&nbsp;</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 "><samp class="ph codeph">false</samp> : Force update of the view index before
								results are returned</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 ">&nbsp;</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 "><samp class="ph codeph">ok</samp> : Allow stale views</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e92 ">&nbsp;</td>

							<td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d112191e95 "><samp class="ph codeph">update_after</samp> : Allow stale view, update view
								after access </td>

						</tr>

					</tbody>

				</table>
</div>
<p class="p">If you do not supply a bounding box, the full data set is returned. When querying a spatial index
				you can use the bounding box to specify the boundaries of the query lookup on a given
				value. The specification should be in the form of a comma-separated list of the
				coordinates to use during the query.</p>
<p class="p">These coordinates are specified using the GeoJSON format, so the first
				two numbers are the lower left coordinates, and the last two numbers are the upper
				right coordinates.</p>
<p class="p">For example, using the above design
				document:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">GET http://localhost:8092/places/_design/main/_spatial/points?bbox=-180,-90,0,0
Content-Type: application/json
</samp></code></pre>
<p class="p">Returns
				the following
				information:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">{
    "total_rows": 0,
    "rows": [
        {
            "id": "oakland",
            "key": [
                [
                    -122.270833,
                    -122.270833
                ],
                [
                    37.804444,
                    37.804444
                ]
            ],
            "value": [
                "oakland",
                [
                    -122.270833,
                    37.804444
                ]
            ],
            "geometry": {
                "coordinates": [
                    -122.270833,
                    37.804444
                ],
                "type": "Point"
            }
        }
    ]
}
</samp></code></pre>
<div class="note note"><span class="notetitle">Note:</span> The return data includes the value specified in the design document view
				function, and the bounding box of each individual matching document. If the spatial
				index includes the <samp class="ph codeph">bbox</samp> bounding box property as part of the
				specification, then this information will be output in place of the automatically
				calculated version.</div>
</section>

	</div>

	<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../admin/Views/views-intro.html" title="Couchbase views enable indexing and querying of data.">Views and indexes</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../admin/Views/views-writing.html" title="During the view creation process, the output structure, field order, content, and any summary or grouping information desired in the view is defined.">Writing views</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../admin/Views/views-schemaless.html" title="A schema-less database along with view definitions provide for a flexible document structure.">Views in a schema-less database</a></div>
</div>

<div class="linklist linklist">
<div><a class="link" href="http://geojson.org/geojson-spec.html" target="_blank">GeoJSON</a></div></div>
</nav>
</div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>