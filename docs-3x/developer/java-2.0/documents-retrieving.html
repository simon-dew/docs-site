<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Retrieving documents — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../developer/java-2.1/java-intro.html"><span>Java SDK 2.1</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/java-2.0/java-intro.html"><span>Java SDK 2.0</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/java-2.0/overview.html"><span>Overview</span></a></li><li class="section"><a href="../../developer/java-2.0/download-links.html"><span>Download and API Reference</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/java-2.0/getting-started.html"><span>Getting started</span></a></li><li class="section"><a href="../../developer/java-2.0/managing-connections.html"><span>Managing connections</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/java-2.0/documents.html"><span>Working with documents</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/java-2.0/documents-basics.html"><span>Document basics</span></a></li><li class="section"><a href="../../developer/java-2.0/documents-creating.html"><span>Creating documents</span></a></li><li class="section"><a href="../../developer/java-2.0/documents-updating.html"><span>Updating documents</span></a></li><li class="section"><a href="../../developer/java-2.0/documents-retrieving.html" class="current"><span>Retrieving documents</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../developer/java-2.0/documents-deleting.html"><span>Deleting documents</span></a></li><li class="section"><a href="../../developer/java-2.0/documents-atomic.html"><span>Atomic operations</span></a></li><li class="section"><a href="../../developer/java-2.0/documents-bulk.html"><span>Bulk operations</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/java-2.0/querying.html"><span>Querying buckets</span></a></li><li class="section"><a href="../../developer/java-2.0/observables.html"><span>Mastering observables</span></a></li><li class="section"><a href="../../developer/java-2.0/logging.html"><span>Setting up logging</span></a></li><li class="section"><a href="../../developer/java-2.0/release-notes.html"><span>Release notes</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dotnet-2.1/dotnet-intro.html"><span>.NET SDK 2.1</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dotnet-2.0/dotnet-intro.html"><span>.NET SDK 2.0</span></a></li></ul></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
	<h1 class="title topictitle1" id="ariaid-title1">Retrieving documents</h1>

	
	<div class="body conbody"><p class="shortdesc">Describes how to load documents using the various <samp class="ph codeph">get()</samp> methods.</p>


		<section class="section"><h2 class="title sectiontitle">Regular reads</h2>
			

			<p class="p">Reading a document is done by using the <samp class="ph codeph">get()</samp> method. This can be done by either passing in the <samp class="ph codeph">id</samp> of the <samp class="ph codeph">Document</samp> or a <samp class="ph codeph">Document</samp> itself (where the <samp class="ph codeph">id</samp> is taken from).</p>


<pre class="pre codeblock language-java"><code>Observable&lt;JsonDocument&gt; loadedFromId = bucket.get("id");
Observable&lt;JsonDocument&gt; loadedFromDoc = bucket.get(JsonDocument.create("id"));</code></pre>


			<p class="p">Both methods have the same effect. The latter method is helpful if you are already dealing
				with <samp class="ph codeph">Document</samp> instances in your code and you don't want to extract the
					<samp class="ph codeph">ID</samp> out of them on your own.</p>


			<p class="p">When only the ID is passed in, there is no way to figure out which <samp class="ph codeph">Document</samp>
				type should be used, so <samp class="ph codeph">JsonDocument</samp> is selected as a sensible default.
				If you want to override this, you can pass in a specific <samp class="ph codeph">Document</samp> type
				like this:</p>


<pre class="pre codeblock language-java"><code>Observable&lt;LegacyDocument&gt; loaded = bucket.get("legacyId", LegacyDocument.class);</code></pre>


			<p class="p">If the document is not found, an empty <samp class="ph codeph">Observable</samp> is returned. This aligns
				with how <samp class="ph codeph">Observable</samp> objects are supposed to work by contract, but also makes
				it easier to deal with the implementation later. If no document is returned, the
				subsequent operations are just not executed, which avoids having null checks all over
				the place (if say, a <samp class="ph codeph">Document</samp> would be returned but with the content
				set to <samp class="ph codeph">null</samp>).</p>


			<p class="p">If you are dealing with blocking code, use <samp class="ph codeph">singleOrDefault()</samp> to avoid a
					<samp class="ph codeph">NoSuchElementException</samp> to be thrown. You can either use a
					<samp class="ph codeph">Document</samp> populated with default settings or just
					<samp class="ph codeph">null</samp>, which can be checked later:</p>


<pre class="pre codeblock language-java"><code>JsonDocument found = bucket.get("notexisting").toBlocking().singleOrDefault(null);
if (found == null) {
    // doc not found
} else {
    // doc found
}</code></pre>


		</section>


		<section class="section"><h2 class="title sectiontitle">Reading from replica</h2>
			

			<p class="p">A regular read always reads the document from its master node. If this node is down or not available, the document cannot be loaded. Reading from replica allows you to load the document from one or more replica nodes instead.</p>


			<div class="p"><div class="note note"><span class="notetitle">Note:</span> When replica reads are used, always use them under the assumption that the data returned is stale. There is no way to guarantee that the data is up-to-date on the replica node unless the proper durability requirements have been set and succeeded on write operations. Only use replica reads if you understand the implications.</div>
</div>


			<p class="p">You can either read the data from one specific replica or all of the available replicas:</p>


<pre class="pre codeblock language-java"><code>// Read from all available replicas and the master node and return all responding
bucket.getFromReplica("id", ReplicaMode.ALL);

// Read only from the first replica
bucket.getFromReplica("id", ReplicaMode.FIRST);

// Read only from the second replica
bucket.getFromReplica("id", ReplicaMode.SECOND);

// Read only from the third replica
bucket.getFromReplica("id", ReplicaMode.THIRD);</code></pre>


			<p class="p">Note that if <samp class="ph codeph">ReplicaMode.ALL</samp> is used, requests are sent to the master node
				and all configured replicas. The main goal is to get responses back as fast as possible,
				but because more requests are sent, more responses can arrive. You can use this to
				either compare all of the responding documents and draw conclusions from that, or just
				pick the first one arriving:</p>


<pre class="pre codeblock language-java"><code>bucket
    .getFromReplica("id", ReplicaMode.ALL)
    .first()
    .subscribe();</code></pre>


    		<p class="p">In addition, you can add operations to filter based on some of your assumptions. Imagine
				you have a <samp class="ph codeph">version</samp> field in your document and you want to only use the
				replica information if it this specific version:</p>


<pre class="pre codeblock language-java"><code>bucket
    .getFromReplica("id", ReplicaMode.ALL)
    .filter(document -&gt; document.content().getInt("version") &gt; 5)
    .first()
    .subscribe();</code></pre>


		</section>


		<section class="section" id="concept2677__read-and-lock"><h2 class="title sectiontitle">Reading and locking</h2>
			

			<p class="p">Reading and locking works very similar to a regular read, but in addition the <samp class="ph codeph">Document</samp> is <strong class="ph b">write locked</strong> (not read locked) on the server side for the given amount of time.</p>


<pre class="pre codeblock language-java"><code>// Get and lock for 10 seconds
Observable&lt;JsonDocument&gt; doc = bucket.getAndLock("id", 10);</code></pre>


			<div class="p">
				<div class="note note"><span class="notetitle">Note:</span> You can only write lock a document for a maximum of 30 seconds. If an invalid lock time
					(less than 0 or greater than 30 seconds) is provided, 15 seconds is used as the
					default.</div>

			</div>


			<p class="p">The <samp class="ph codeph">Document</samp> is unlocked under the following conditions:</p>


			<ul class="ul">
				<li class="li">The <samp class="ph codeph">unlock()</samp> command is used.</li>

				<li class="li">The <samp class="ph codeph">Document</samp> is replaced with the correct CAS value.</li>

				<li class="li">30 seconds are over and the server unlocks it for you.</li>

			</ul>


		</section>


		<section class="section"><h2 class="title sectiontitle">Reading and touching</h2>
			

			<p class="p">Reading and touching works very similar to a regular read, but it also refreshes the expiration time of the document to the specified value.</p>


<pre class="pre codeblock language-java"><code>// Get and set the new expiration time to 4 seconds
Observable&lt;JsonDocument&gt; doc = bucket.getAndTouch("id", 4);</code></pre>


			<p class="p">You can also use the <samp class="ph codeph">touch()</samp> command if you do not want to read the document and just refresh its expiration time.</p>


			<p class="p">If you specify an expiration time greater than 30 days in seconds (60 seconds * 60 minutes *
				24 hours * 30 days = 2,592,000 seconds) it is considered an absolute time stamp instead
				of a relative one.</p>


		</section>

	</div>

<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../developer/java-2.0/documents.html">Working with documents</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../developer/java-2.0/documents-updating.html" title="Describes updating documents by using the replace() or upsert() methods.">Updating documents</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../developer/java-2.0/documents-deleting.html" title="Describes how to delete documents using the remove() method.">Deleting documents</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>