<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Thread safety for Couchbase SDKs — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/first-app.html"><span>Creating your first application</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/modeling-docs.html"><span>Modeling documents</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/access-data.html"><span>Accessing data with Couchbase SDKs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/store-data.html"><span>Storing data</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/find-data.html"><span>Finding data with views</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/advanced-topics.html"><span>Advanced topics in development</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/dev-guide-3.0/bulk-set.html"><span>Performing a bulk set</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/memory-errors.html"><span>Handling temporary out of memory errors</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/sync-async-transactions.html"><span>Synchronous and asynchronous transactions</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/transactional-logic.html"><span>Providing transactional logic</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/app-performance.html"><span>Improving application performance</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/thread-safety.html" class="current"><span>Thread safety for Couchbase SDKs</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../developer/dev-guide-3.0/common-errors.html"><span>Handling common errors</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/troubleshooting.html"><span>Troubleshooting</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/client-library.html"><span>Developing a client library</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
	<h1 class="title topictitle1" id="ariaid-title1">Thread safety for Couchbase SDKs</h1>

	<div class="body conbody">
		<p class="p">Developers typically want to know which Couchbase SDKs are thread-safe. In most programming
			languages a thread is associated with a single use of a program to serve one user. For
			multiple users you typically create and maintain a separate thread for each user.
			‘Thread-safe’ means the Couchbase SDK can spawn additional processes at the system level;
			the processes will access and change shared objects and data in the runtime environment in
			a way that guarantees safe execution of multiple process.</p>

		<p class="p">When a language or framework is not truly thread safe, multiple processes that try to share
			objects may corrupt object data, and may lead to inconsistent results. For instance sharing
			the same client object from multiple threads could lead to retrieving the wrong value for a
			key requested by a thread, or no value at all.</p>

		<p class="p">When you develop with Couchbase Server, creating a multi-threaded application is
			particularly helpful for sharing a client instance across multiple processes. When you
			create a new client instance, it is a relatively time-consuming and resource intensive
			process compared to other server requests. When you can reuse a client instance, multiple
			processes with multiple requests can reuse the connection to Couchbase Server. Therefore
			being able to safely reuse client objects across multiple processes can improve application
			performance.</p>

		<p class="p">Languages such as.Net and Java have in built-in support for thread-safety, and the
			Couchbase Java and.Net SDKs have been certified as being thread-safe if you utilize
			thread-safety mechanisms provided by the two languages with the SDKs.</p>

		<p class="p">Note that the client object you create with a Couchbase SDK does not spawn additional
			threads to handle multiple requests. Therefore to provide multi-threading and client object
			reuse even for SDKs that are thread-safe, you will need to implement connection pools and
			other language-specific thread-safety measures.</p>

		<p class="p">The following Couchbase SDKs are developed and tested as thread safe:</p>

		<ul class="ul">
			<li class="li"><p class="p">Java SDK 1.0 and above</p>
</li>

			<li class="li"><p class="p">.Net SDK 1.0 and above</p>
</li>

		</ul>

		<p class="p">The Couchbase C library is not tested or implemented as thread-safe. This means you cannot
			safely share a connection instance between threads. You also cannot make a copy of the
			connection with the current connection settings and pass it to another thread.</p>

		<p class="p">There are several Couchbase SDKs that rely on the underlying Couchbase C library for
			Couchbase Server communications, namely Couchbase SDKs based on scripting languages. Since
			these libraries are also dependent on the C library, they not certified as thread-safe.
			This includes the ruby, PHP, and Perl SDKs for Couchbase.</p>

		<p class="p">However there are alternatives for these SDKs that can enable safe reuse of client objects
			for multiple processes. The rest of this section describes some of these techniques.</p>

		<p class="p">The Ruby languages provides a class called <samp class="ph codeph">Thread</samp> so you can reuse a
			client object for multiple requests:</p>

		<pre class="pre codeblock"><code><samp class="ph codeph">require 'couchbase'

# setup default connection options

Couchbase.connection_options = {:bucket =&gt; 'mybucket', :port =&gt; 9000}

threads = []

      5.times do |num|
          threads &lt;&lt; Thread.new do
              Couchbase.bucket.set("key-#{num}", "val-#{num}")
              sleep(1)
              end
      end

threads.map(&amp;:join)
</samp></code></pre>

		<p class="p">In the example we create a new local variable called <samp class="ph codeph">Thread</samp>, with one
			local variable per thread. Each local instance has an individual client object which share
			the same connection objects. Individual thread instances could also establish more
			connections if needed. An alternate is to clone a client object. The following shows how
			you can duplicate an existing connection to a separate object which maintains the same
			connection information, but can be used safely by another thread:</p>

		<pre class="pre codeblock"><code><samp class="ph codeph">conn1 = Couchbase.connect(:bucket =&gt; 'mybucket')

conn2 = conn1.dup
</samp></code></pre>

		<p class="p">When you use the Ruby method <samp class="ph codeph">dup</samp> it will make a copy of the Couchbase
			client object and will create a new connection for that object using parameters from the
			original client object.</p>

	</div>

<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/advanced-topics.html">Advanced topics in development</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/app-performance.html">Improving application performance</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/common-errors.html">Handling common errors</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>