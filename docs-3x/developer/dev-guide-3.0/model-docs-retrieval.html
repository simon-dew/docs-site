<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Modeling documents for retrieval — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/first-app.html"><span>Creating your first application</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/modeling-docs.html"><span>Modeling documents</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/dev-guide-3.0/compare-docs-vs-relational.html"><span>Comparing document-oriented and relational data</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/using-json-docs.html"><span>Using JSON documents</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/schemaless.html"><span>Schemaless data modeling</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/doc-design-considerations.html"><span>Document design considerations</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/model-docs-retrieval.html" class="current"><span>Modeling documents for retrieval</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../developer/dev-guide-3.0/lookups.html"><span>Using reference documents for lookups</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/sample-docs.html"><span>Sample storage documents</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/access-data.html"><span>Accessing data with Couchbase SDKs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/store-data.html"><span>Storing data</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/find-data.html"><span>Finding data with views</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/advanced-topics.html"><span>Advanced topics in development</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/client-library.html"><span>Developing a client library</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
	<h1 class="title topictitle1" id="ariaid-title1">Modeling documents for retrieval</h1>

	<div class="body conbody">
		<p class="p">Once you grasp the concept that you can model real-world objects as documents and you
			understand the idea that you can create relationships between documents, you may wonder how
				<samp class="ph codeph">should</samp> you go about representing the relationships? For instance, if
			you have an object that has a relationship of ownership/possession, do you always want to
			include fields in that object which reference all the objects it owns? In other words, if
			you follow this approach, when an asteroid has craters, the asteroid document should
			contain references to each crater document. In traditional relational database terminology,
			this is called a <em class="ph i">one-to-many</em> relationship, and is often also called a
				<em class="ph i">has-many</em> relationship. In an asteroid example we say the “asteroid has many
			craters” and conceptually it would appear as follows:</p>

				<img class="image" src="images/modeling_retrieve_hasmany.png">
		<p class="p">Imagine we are creating a virtual universe containing asteroids. And all asteroids can have
			zero or more craters; users in the environment can create more craters on the asteroids,
			and the environment can also create more craters on an asteroid. In this case, we have a
			relationship of ownership/possession by our asteroid since an asteroid contains the craters
			that are on it. If we choose to express ownership of the craters by the asteroid and say
			the asteroid <em class="ph i">has-many</em> craters, we would provide an asteroid document as follows:</p>

		<pre class="pre codeblock"><code><samp class="ph codeph">{
"a_id" : "asteroidA",
"craters" : ["crater1", "crater2" .... ],
....
}
</samp></code></pre>

		<p class="p">In the asteroid document, we reference the crater by crater ID in an array of craters. Each
			of the craters could be represented by the following JSON document:</p>

		<pre class="pre codeblock"><code><samp class="ph codeph">{
"crater_id" : "crater1",
"location" : [ "37.42N", "-112.165W" ],
"depth" : 80
....
}
</samp></code></pre>

		<p class="p">But because we are working with a flexible, document-centric design, we could instead put
			all the references to the object-that-owns in the objects that are owned. In the asteroid
			example, we would have references from each crater document to the asteroid document. In
			the relational world, we refer to this as a <em class="ph i">many-to-one</em> relationship which is
			sometimes also called a <em class="ph i">belongs-to</em> relationship. This alternate approach would
			appear as follows:</p>

				<img class="image" src="images/modeling_retrieve_belongsto.png">
		<p class="p">The respective asteroid and crater JSON documents for this approach would now appear as
			follows:</p>

		<pre class="pre codeblock"><code><samp class="ph codeph">{
"a_id" : "asteroidA",
....
}
</samp></code></pre>

		<p class="p">In the asteroid document we have a unique asteroid ID field, <samp class="ph codeph">a_id</samp> which we
			can reference from our crater documents. Each of the craters could be represented by the
			following JSON document:</p>

		<pre class="pre codeblock"><code><samp class="ph codeph">{
"crater_id" : "crater1",
"on_asteroid" : "asteroidA"
"location" : [ "37.42N", "-112.165W" ],
"depth" : 80
....
}
</samp></code></pre>

		<p class="p">With this alternate approach, we provide any information about a relationship between
			asteroid and crater in each crater document. We provide a field
				<samp class="ph codeph">on_asteroid</samp> in each crater document with the value linking us to the
			asteroid document.</p>

		<p class="p">So which of these two approaches is preferable for relating the two documents? There are
			two important considerations to keep in mind when you relate documents:</p>

		<ul class="ul">
			<li class="li"><strong class="ph b">Issues of Contention</strong> : if you expect a lot of updates from different processes
				to occur to a document, creating several <em class="ph i">belongs-to</em> relationships is more
				desirable.</li>

		</ul>

		<p class="p">In the case of our asteroid example, if we have all craters referenced in the asteroid
			document, we can expect a good amount of conflict and contention over the asteroid
			document. As users create more craters, or as the environment creates more craters, we can
			expect conflicts between the processes that are all trying to update crater information on
			a single asteroid document. We could use locks and compare and swap operations to prevent conflict, but
			this would diminish read/write response time. So in this type of scenario, putting the link
			from craters to asteroid makes more sense to avoid contention.</p>

		<ul class="ul">
			<li class="li"><strong class="ph b">Retrieving Information:</strong>
				<em class="ph i">how</em> you relate documents or <em class="ph i">how you provide references</em> between documents
				will influence the way you should retrieve data at a later point. Similarly, how you
				want to retrieve information will influence your decision on how to model your
				documents.</li>

		</ul>

		<p class="p">In this asteroid model, since we choose to reference from craters to asteroid to avoid
			contention, we need to use indexing and querying to find all craters associated with an
			asteroid. If we had chosen the first approach where the asteroid contains references to all
			craters, we could perform a multiple-retrieve with the list of craters to get the actual
			crater documents.</p>

		<p class="p">If we did not have this concern about contention in our asteroid example, it would be
			preferable to use the <samp class="ph codeph">has-many</samp> approach, where one document has references
			to multiple documents. This is because performing a multiple-retrieve on a list of
			documents is always faster than getting the same set of documents through indexing and
			querying. Therefore, as long as there is less concern about contention, we should use the
				<samp class="ph codeph">has-many</samp> model as the preferred approach. The advantages of this
			approach apply to all cases where our object is relatively static. For example, if you have
			a player document and you do not expect to change the player profile object that often you
			could store references to player abilities in the player document and describe the
			abilities in separate documents.</p>

		<p class="p">For more information about retrieving information using a multiple retrieve, or by using
			indexing and querying, see <a class="xref" href="retrieve-info.html#concept16930__retrieve-multiple-keys">Retrieving multiple keys</a> and <a class="xref" href="find-data.html#concept1470">Finding data with views</a>.</p>

	</div>

<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/modeling-docs.html">Modeling documents</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/doc-design-considerations.html">Document design considerations</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/lookups.html">Using reference documents for lookups</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>