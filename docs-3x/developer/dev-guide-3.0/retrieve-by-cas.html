<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Retrieving items with CAS values — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/first-app.html"><span>Creating your first application</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/modeling-docs.html"><span>Modeling documents</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/access-data.html"><span>Accessing data with Couchbase SDKs</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/dev-guide-3.0/sdk-vs-sql.html"><span>Couchbase SDKs and SQL commands</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/read-write.html"><span>Reading and writing data</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/doc-expiration.html"><span>About document expiration</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/async-methods.html"><span>About asynchronous methods</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/store-info.html"><span>Storing information</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/retrieve-info.html"><span>Retrieving information</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/retrieve-by-cas.html" class="current"><span>Retrieving items with CAS values</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../developer/dev-guide-3.0/lock-items.html"><span>Locking items</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/update-info.html"><span>Updating Information</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/delete-info.html"><span>Deleting information</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/observe.html"><span>Monitoring data using observe</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/destroy-data.html"><span>Permanently destroying data</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/store-data.html"><span>Storing data</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/find-data.html"><span>Finding data with views</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/advanced-topics.html"><span>Advanced topics in development</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/client-library.html"><span>Developing a client library</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
	<h1 class="title topictitle1" id="ariaid-title1">Retrieving items with CAS values</h1>

	<div class="body conbody">
		<p class="p">These methods return a value and the associated CAS value for a given key. The CAS value
			can be used later to perform a compare and swap operation. Getting the CAS value for a given
			document while you are getting the document may be useful if you want to update it, but
			want to do so while avoiding conflict with another document change.</p>

		<p class="p">The most common scenario where you will use a get-with-cas operation is when you want to
			retrieve a value and update that value using a <samp class="ph codeph">cas</samp> operation. The
				<samp class="ph codeph">cas</samp> operation requires a key and the CAS value of the key, so you would
			retrieve the CAS value using a get-with-cas operation.</p>

		<p class="p">Another scenario where get-with-cas is useful is when you want to test and see if another
			process has updated a key, and then perform some check or special operation if another
			process has updated the key. In this case, when you perform a get-with-cas and it returns
			an unexpected CAS value, you can have your application logic proceed along another path,
			than you would if get-with-cas succeeds.</p>

		<p class="p">For instance, imagine you are creating a coupon redemption system, but you only want the
			coupon to be valid for the first 50 users. In this case, you can store a counter for the
			coupon and use get-with-cas to see if the CAS value has changed; if it has, you know that
			the number of available coupons has changed and you might want to offer a different coupon,
			you may need to check another system to get new deals from that vendor, or check the actual
			coupon count before you display the coupon. In this case we illustrate the principle that
			you use a get-with-cas method to find out if the CAS value has changed, and then you know
			you need to check another system:</p>

				<img class="image" src="images/get_w_cas.png">
		<p class="p">All documents and values stored in Couchbase Server will create a CAS value associated with
			it as metadata. Couchbase Server provides CAS values as integers; developer and server
			administrators do not provide these values. There are variations in the method naming and
			method signature; consult you respective SDK Language Reference to determine the correct
			method call.</p>

		<p class="p">When you want to perform a compare and swap, you will need to do a get-with-cas beforehand to
			get the current CAS value. You retrieve the CAS value for a given key, and then you can
			provide it as a parameter to the compare and swap operation.</p>

		<p class="p">In the case of some SDKs, such as Ruby, getting a document with a CAS value is an extension
			of the standard <samp class="ph codeph">get</samp> call. In the example that follows, for instance, we
			perform a get, and provide an optional parameter to the call in order to retrieve the CAS
			value:</p>

		<pre class="pre codeblock"><code><samp class="ph codeph">val = c.get("foo", :extended =&gt; true)
val.inspect #returns "foo"=&gt;["1", 0, 8835713818674332672]
</samp></code></pre>

		<p class="p">In this example, the value for the “foo” key is 1, flags are set to zero, and the CAS value
			is 8835713818674332672.</p>

		<p class="p">The equivalent call in the memcached protocol is <samp class="ph codeph">get</samp> which returns the
			value for the key as well as the CAS value.</p>

		<p class="p">If a key does not exist, you will get a ‘key does not exist’ error in response. If you did
			not expect this result, you should check any application logic that creates that type of
			key, or any logic that deletes it may inadvertently cause this result. Another reason why
			you might get this result is that the item expired; in this case Couchbase Server returns a
			‘key not found’ type error. So you will want to check any explicit expiration set for that
			key.</p>

		<p class="p">The types of errors that can occur during this operation include 1) inability to connect to
			a node, or 2) some error exists while attempting to format a value being retrieved. If you
			have a connection-level error you may need to reattempt connection, and possibly check the
			status of the server. If you have an error with the size of your value or formatting, you
			need to check the value itself, and how it is encoded and see if there are any issues that
			make the document incompatible with Couchbase Server.</p>

		<p class="p">For more information about connections and connection-level settings, see <a class="xref" href="app-performance.html#concept_gmj_qss_np__optimize-instances">Optimizing client instances</a>
			<a class="xref" href="common-errors.html#concept7680__client-timeouts">Client-side timeouts</a>.</p>

	</div>

<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/access-data.html">Accessing data with Couchbase SDKs</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/retrieve-info.html">Retrieving information</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/lock-items.html">Locking items</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>