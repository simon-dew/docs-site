<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Synchronous and asynchronous transactions — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/first-app.html"><span>Creating your first application</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/modeling-docs.html"><span>Modeling documents</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/access-data.html"><span>Accessing data with Couchbase SDKs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/store-data.html"><span>Storing data</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/find-data.html"><span>Finding data with views</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/advanced-topics.html"><span>Advanced topics in development</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/dev-guide-3.0/bulk-set.html"><span>Performing a bulk set</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/memory-errors.html"><span>Handling temporary out of memory errors</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/sync-async-transactions.html" class="current"><span>Synchronous and asynchronous transactions</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../developer/dev-guide-3.0/transactional-logic.html"><span>Providing transactional logic</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/app-performance.html"><span>Improving application performance</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/thread-safety.html"><span>Thread safety for Couchbase SDKs</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/common-errors.html"><span>Handling common errors</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/troubleshooting.html"><span>Troubleshooting</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/client-library.html"><span>Developing a client library</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content"><h1 class="title topictitle1" id="ariaid-title1">Synchronous and asynchronous transactions</h1>
<div class="body conbody"><p class="p">Some Couchbase SDKs support both synchronous and asynchronous transactions. In
the case of synchronous transactions, your application pauses its execution
until a response is returned from the Couchbase Server. In the case of
asynchronous commands, your application can continue performing other,
background operations until Couchbase Server responds. Asynchronous operations
are particularly useful when your application accesses persisted data, or when
you are performing data sets and updates.</p>
<p class="p">In the case of a typical asynchronous call, your application handles something
that does not depend on a server response, and the result is still being
computed on the server. The object that is eventually returned by an
asynchronous call is often referred to as a future object, which is
non-blocking. That is, the server returns the object sometime in the future,
after the original method call requesting it, and the object is non-blocking
because it does not interfere with the continued execution of the application.</p>
<p class="p">Please refer to your chosen SDK to find out more about which methods are
available for asynchronous transactions, as of this writing, asynchronous calls
are available in the Java and Ruby SDKs only.</p>
<p class="p">The following is an example showing the typical pattern you use to create an
asynchronous transaction; in an asynchronous transaction, we store a record and
process something in the meantime. Then we either successfully perform a <samp class="ph codeph">get()</samp>
and retrieve the future object, or cancel the process. This example is in Java:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">//perform a set asynchronously; return from set not important now

OperationFuture&lt;Boolean&gt; setOp = client.set(KEY, EXP_TIME, VALUE);

//do something in meantime

//check to see if set successful via get, if not fail
//the get will block application flow

if (setOp.get().booleanValue()) {
    System.out.println("Set Succeeded");
} else {
    System.err.println("Set failed:" + setOp.getStatus().getMessage());
}
</samp></code></pre>
<p class="p">Other operations such as <samp class="ph codeph">get()</samp> can be used asynchronously in your application.
Here is a second example in Java:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">GetFuture getOp = client.asyncGet(KEY);

//do something in meantime

//check to see if get successful
//if not cancel

if ((getObject = getOp.get()) != null {
    System.out.println("Asynchronous get succeeded: " + getObject);
} else {
    System.err.println("Asynchronous get failed: " + getOp.getStatus().getMessage());
}
</samp></code></pre>
<p class="p">This last example demonstrates use of <samp class="ph codeph">delete()</samp> in Java as in an asynchronous
transaction:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">// Do an asynchronous delete
OperationFuture&lt;Boolean&gt; delOp = null;

if (do_delete) {
     delOp = client.delete(KEY);
}

//do something in meantime

// Check to see if our delete succeeded

if (do_delete) {
    try {
        if (delOp.get().booleanValue()) {
            System.out.println("Delete Succeeded");
    } else {
        System.err.println("Delete failed: " + delOp.getStatus().getMessage());
    }
    } catch (Exception e) {
            System.err.println("Exception while doing delete: " + e.getMessage());
  }
}
</samp></code></pre>
<p class="p">This next example shows how asynchronous call can be made using the Ruby SDK.
When you use this mode in the Ruby SDK, you execute the operation and it returns
control immediately without performing any input/output. As in the case of Java,
we perform the asynchronous operation and later we use a callback that either
successfully retrieve the future value or it fails and reports on the error:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">Couchbase.bucket.run do |c|
    c.set("foo", "bar") do |res1|
      # res1 is the Couchbase::Bucket::Result instance
      if res1.success?
        c.get("foo") do |res2|
          puts res.value if res2.success?
      end
      else
            puts "Something wrong happened: #{res1.error.message}"
        end
    end
end
</samp></code></pre>
<p class="p">In the callback for our Ruby example, we perform a get from the SDK that will be
called as soon as a response is ready. The callback received a result object,
and we can check if the value was set with the <samp class="ph codeph">success?</samp> method. If the value
is true, then the record has been successfully set; otherwise you should assume
call failed and check the error property of the result, which will be an
exception object.</p>
<p class="p">In the case of PHP, <samp class="ph codeph">getDelayed()</samp> and <samp class="ph codeph">getDelayedByKey()</samp> are the two available
asynchronous methods for the SDK. Both methods can retrieve one or more key; the
major difference between <samp class="ph codeph">getDelayed()</samp> and <samp class="ph codeph">getDelayedByKey()</samp> is that the
later will retrieve a record from a specified node. Here is an example of
<samp class="ph codeph">getDelayed()</samp> :</p>
<pre class="pre codeblock"><code><samp class="ph codeph">&lt;?php

$cb = new Couchbase("127.0.0.1:8091");

$cb-&gt;set('int', 99);
$cb-&gt;set('string', 'a simple string');
$cb-&gt;set('array', array(11, 12));

$cb-&gt;getDelayed(array('int', 'array'), true);
var_dump($cb-&gt;fetchAll());

?&gt;
</samp></code></pre>
<p class="p">In this case <samp class="ph codeph">getDelayed()</samp> will make a request to Couchbase Server for multiple
items in the array. The method does not wait and returns immediately. When you
want to collect all the items, you perform a <samp class="ph codeph">fetch()</samp> or <samp class="ph codeph">fetchAll()</samp> as well
do in the last line of this example.</p>
<p class="p">All the Couchbase SDKs support synchronous transactions. In the most basic form
a synchronous call will block, or wait for a response from the Couchbase Server
before program execution continues. The most standard form of any method in a
Couchbase SDK is synchronous in its functioning. In this case of synchronous
calls, typically the return is assigned to variable, or used immediately
afterwards in the applications, such as output or display.</p>
</div>
<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/advanced-topics.html">Advanced topics in development</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/memory-errors.html">Handling temporary out of memory errors</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/transactional-logic.html">Providing transactional logic</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>