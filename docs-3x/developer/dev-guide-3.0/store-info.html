<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Storing information — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/first-app.html"><span>Creating your first application</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/modeling-docs.html"><span>Modeling documents</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/access-data.html"><span>Accessing data with Couchbase SDKs</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/dev-guide-3.0/sdk-vs-sql.html"><span>Couchbase SDKs and SQL commands</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/read-write.html"><span>Reading and writing data</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/doc-expiration.html"><span>About document expiration</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/async-methods.html"><span>About asynchronous methods</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/store-info.html" class="current"><span>Storing information</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../developer/dev-guide-3.0/retrieve-info.html"><span>Retrieving information</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/retrieve-by-cas.html"><span>Retrieving items with CAS values</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/lock-items.html"><span>Locking items</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/update-info.html"><span>Updating Information</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/delete-info.html"><span>Deleting information</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/observe.html"><span>Monitoring data using observe</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/destroy-data.html"><span>Permanently destroying data</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/store-data.html"><span>Storing data</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/find-data.html"><span>Finding data with views</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/advanced-topics.html"><span>Advanced topics in development</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/client-library.html"><span>Developing a client library</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
	<h1 class="title topictitle1" id="ariaid-title1">Storing information</h1>

	<div class="body conbody">
		<p class="p">These operations are used for storing information into Couchbase Server and consist of
				<samp class="ph codeph">add</samp> and <samp class="ph codeph">set</samp>. Both operations exist for all SDKs
			provided by Couchbase. For some languages, parameters, return values, and data types may
			differ. Unique behavior for these store methods that you should be aware of:</p>

		<ul class="ul">
			<li class="li">
				<p class="p">Expiration: By default all documents you store using <samp class="ph codeph">set</samp> and
						<samp class="ph codeph">add</samp> will not expire. Removal must be explicit, such as using
						<samp class="ph codeph">delete</samp>. If you do set an expiration to the value 0, this will
					also indicate no expiration. For more information, see <a class="xref" href="doc-expiration.html#concept6148" title="Time to live (TTL) is the amount of time until a document expires in Couchbase Server. By default, all documents have a TTL of zero, which indicates the document is kept indefinitely. Typically when you add, set, or replace information, you establish a custom TTL by passing it as a parameter to your method call. As part of normal maintenance operations, Couchbase Server periodically removes all items with expiration times that have passed.">About document expiration</a>.</p>

			</li>

			<li class="li">
				<p class="p">CAS ID/CAS Value: For every value that exists in Couchbase Server, the server will
					automatically add a unique compare and swap (CAS) value as a 64-bit integer with the
					item. You can use this value in your implementation to provide basic optimistic
					concurrency. For more information, see <a class="xref" href="retrieve-by-cas.html#concept3998">Retrieving items with CAS values</a>.</p>

			</li>

		</ul>

		<p class="p">For existing keys, <samp class="ph codeph">set</samp> will overwrite any existing value if a key already
			exists; in contrast <samp class="ph codeph">add</samp> will fail and return an error. If you use
				<samp class="ph codeph">replace</samp> it will fail if the key does not already exist.</p>

		<p class="p">The following storage limits exist for each type of information that you provide as well as
			the metadata that Couchbase Server automatically adds to items:</p>

		<ul class="ul">
			<li class="li">
				<p class="p">Keys: Can be up to 250 Bytes. Couchbase Server keeps all keys in RAM and does not
					eject any keys to free up space.</p>

			</li>

			<li class="li">
				<p class="p">Metadata: This is the information Couchbase Server automatically stores with your value,
					namely CAS value, expiration and flags. Metadata per document is 60 bytes for
					Couchbase 2.0.1 and 54 for Couchbase 2.1.0. This is stored in RAM at all times and
					cannot be ejected from RAM.</p>

			</li>

			<li class="li">
				<p class="p">Values: You can store values up to 1 MB in memcached buckets and up to 20 MB in
					Couchbase buckets. Values can be any arbitrary binary data or it can be a
					JSON-encoded document.</p>

			</li>

		</ul>

		<p class="p">Be aware of key and metadata size if you are handling millions of documents or more. Couchbase
			Server keeps all keys and metadata in RAM and does not remove them to create more space in
			RAM. One hundred million keys that are 70 bytes each plus metadata at 54 bytes each will
			require about 11.2 GB of RAM for a cluster. This figure does not include caching any values
			or replica copies of data, if you consider these factors, you would need over 23 GB. For
			more information, see <a class="xref" href="http://docs.couchbase.com/admin/admin/Concepts/bp-sizingGuidelines.html" target="_blank">Sizing guidelines</a>.</p>

		<section class="section"><h2 class="title sectiontitle">Set</h2>
			
			<p class="p"><samp class="ph codeph">set</samp> will write information to the data store regardless of whether the
				key for the value already exists or not. The method is destructive; if the key exists,
				it will overwrite any existing value. Typically you want to use <samp class="ph codeph">set</samp> in
				cases where you do not care whether or not you overwrite an existing value, nor do you
				care if the key already exists or not. This method is similar to an
					<samp class="ph codeph">INSERT</samp> statement in SQL.</p>

			<p class="p">For instance, if you have a player location document in a game, you might not care
				whether you overwrite the location with a new value; it is however important that you
				quickly create a location document if it does not already exist. In the case of this
				type of application logic, you might not want to waste any code to check if a player
				location exists; performing rapid read/writes of the player location and creating the
				initial score document may be more important than performing any checks in your
				application logic. In this case, using <samp class="ph codeph">set</samp> would be suitable.</p>

			<p class="p">Another scenario is when you populate a database with initial values. This can be a
				production or development database. In this case, you are creating all the initial
				values for an entire set of keys. Since you are starting out with an empty database, and
				have no risk of overwriting useful data, you would use <samp class="ph codeph">set</samp> here as
				well. For instance, if you are populating your new test database with documents that
				represent different planets, you could follow this approach:</p>

					<img class="image" src="images/set_seeding.png">
			<p class="p">Another scenario that is appropriate for using <samp class="ph codeph">set</samp> is another scenario
				where you do not care about overwriting the last value for a key. For instance if you
				want to document the last visitor to your site, you would store that as a key and update
				it each time a new visitor is at your site. You might not care who the previous visitors
				are; in this case, you use <samp class="ph codeph">set</samp> to overwrite anything that exists and
				replace it with the latest visit information.</p>

			<p class="p">This method is the functional equivalent of a RDMS commit/insert. <samp class="ph codeph">Set</samp>
				will support the following parameters which are used during the operation:</p>

			<ul class="ul">
				<li class="li">
					<p class="p">Key: unique identifier for the information you want to store. This can be a
						string, symbol, or numeric sequence. A required parameter.</p>

				</li>

				<li class="li">
					<p class="p">Value: the information you want to store. This can be in byte-stream, object, JSON
						document, or even string. A required parameter.</p>

				</li>

				<li class="li">
					<p class="p">Options: this includes expiration, also known as TTL (time to live), which
						specifies how long the information remains in the data store before it is
						automatically flagged for removal and then deleted. You can also specify
						formatting options and flags.</p>

				</li>

			</ul>

			<p class="p">The following shows a simple example of using set using the Ruby SDK:</p>

			<pre class="pre codeblock"><code><samp class="ph codeph">c.set("foo", "bar", :ttl =&gt; 2)
</samp></code></pre>

			<p class="p">This operation takes the key <samp class="ph codeph">foo</samp> and sets the string ‘bar’ for the key
				which will expire after 2 seconds. This next example is part of a data loader script in
				PHP which reads in different JSON files in a specified directory. It then sends requests
				to write each file to Couchbase Server:</p>

			<pre class="pre codeblock"><code><samp class="ph codeph">function import($cb, $dir) {
    $d = dir($dir);
    while (false !== ($file = $d-&gt;read())) {
        if (substr($file, -5) != '.json') continue;
            echo "adding $file\n";
        $json = json_decode(file_get_contents($dir . $file), true);
        unset($json["_id"]);
        echo $cb-&gt;set(substr($file, 0, -5), json_encode($json));
        echo "\n";
    }
}
</samp></code></pre>

			<p class="p">The first part of this function takes a Couchbase client instance as a parameter and a
				directory. It then assigns the directory to a local variable <samp class="ph codeph">$d</samp> and
				opens it. The <samp class="ph codeph">while</samp> loop will continue reading each file in the
				directory so long as we have not finished reading all the files. In the loop we detect
				if the file has the <samp class="ph codeph">.json</samp> file type or not so we know to handle it, and
				store it. If the file is json we decode it, remove the attribute <samp class="ph codeph">_id</samp>
				and then set the key as the filename with the other file contents as value. We choose
				this different key for better identification in our system. The following illustrates a
				sample JSON file which you can use with this loader:</p>

			<pre class="pre codeblock"><code><samp class="ph codeph">{
  "_id":"beer_#40_Golden_Lager",
  "brewery":"Minocqua Brewing Company",
  "name":"#40 Golden Lager",
  "updated":"2010-07-22 20:00:20"
}
</samp></code></pre>

			<p class="p">To view the complete loader application and sample data available on GitHub, see <a class="xref" href="https://github.com/couchbaselabs/couchbase-beers" target="_blank">Couchbase Labs: Beer Sample</a></p>

			<p class="p">In Couchbase SDKs you can store a value with <samp class="ph codeph">set</samp> while simultaneously
				providing a document expiration.</p>

			<p class="p"><samp class="ph codeph">Set</samp> will return a boolean of true if it is able to successfully commit
				data to the databases; it can also return a CAS value, which is a unique identifier for
				the document, and is used for optimistic locking.</p>

			<p class="p">The associated memcached protocol in ASCII is <samp class="ph codeph">set</samp> which stores a key.
				For more information, see <a class="xref" href="https://github.com/memcached/memcached/blob/master/doc/protocol.txt" target="_blank">memcached protocol</a></p>

			<p class="p">The types of errors that can occur during this operation include 1) inability to connect
				to a node, or 2) some error exists while attempting to format a value being set. If you
				have a connection-level error you may need to reattempt connection, and possibly check
				the status of the server. If you have an error with the size of your value or
				formatting, you need to check the value itself, and how it is encoded and see if there
				are any issues that make the document incompatible with Couchbase Server.</p>

			<p class="p">For more information about connections and connection-level settings, see <a class="xref" href="app-performance.html#concept_gmj_qss_np__optimize-instances">Optimizing client instances</a> and <a class="xref" href="common-errors.html#concept7680__client-timeouts">Client-side timeouts</a>.</p>

			<p class="p"></p>

		</section>

		<section class="section"><h2 class="title sectiontitle">Add</h2>
			
			<p class="p"><samp class="ph codeph">add</samp> will also write information to the Couchbase Server, but unlike
					<samp class="ph codeph">set</samp>, <samp class="ph codeph">add</samp> will fail if the value for a given key
				already exists in Couchbase Server.</p>

			<p class="p">The reason you would want to use <samp class="ph codeph">add</samp> instead of <samp class="ph codeph">set</samp> is
				so that you can create a new key, without accidentally overwriting an existing key with
				the same name. For Couchbase Server, keys must be unique for every bucket; therefore
				when you commit new keys to Couchbase Server, using <samp class="ph codeph">add</samp> may be
				preferable based on your application logic.</p>

			<p class="p">For example, if you create an application where you store all new users with a unique
				user name and you want to use user names as a keys, you would want to store the new key
				with <samp class="ph codeph">add</samp> instead of <samp class="ph codeph">set</samp>.</p>

			<img class="image" id="concept11321__image_h11_45p_qp" src="images/sdk_add_example.png">
			<p class="p">If a user already exists in your system with the unique username, you would not want to
				overwrite the user with a new user’s information. Instead, you could perform some
				real-time feedback and let the user know if the username has already been taken when the
				new user fills out their profile information. You can catch this type of error and
				report it back in your application when you use <samp class="ph codeph">add</samp> to create the
				document.</p>

			<p class="p">Because <samp class="ph codeph">add</samp> fails and reports an error when a key exists, some
				Couchbase Server developers prefer it to <samp class="ph codeph">set</samp> in cases where they create
				a new document.</p>

			<pre class="pre codeblock"><code><samp class="ph codeph">#stores successfully
c.add("foo", "bar")

#raises Couchbase::Error::KeyExists: failed to store value
#failed to store value (key="foo", error=0x0c)

c.add("foo", "baz")
</samp></code></pre>

			<p class="p">This next example demonstrates an <samp class="ph codeph">add</samp> in PHP:</p>

			<pre class="pre codeblock"><code><samp class="ph codeph">$script_name=$_SERVER["SCRIPT_NAME"];
$script_access_count=$cb_obj-&gt;get($script_name);

if($cb_obj-&gt;getResultCode() == COUCHBASE_KEY_ENOENT){
    #the add will fail if it has already been added
   $cb_obj-&gt;add($script_name,0);
</samp></code></pre>

			<p class="p">In this example we try to get a script name for the script that currently runs on our
				web application server. We then try to retrieve any script name that is already stored
				in Couchbase Server. If we receive a ‘key not found’ error, we add the script name to
				Couchbase Server.</p>

			<p class="p">In Couchbase SDKs you can store a value with <samp class="ph codeph">add</samp> while simultaneously
				providing a document expiration.</p>

			<p class="p">The memcached protocol equivalent for this method is <samp class="ph codeph">add</samp>. For more
				information about the underlying protocol, see <a class="xref" href="https://github.com/memcached/memcached/blob/master/doc/protocol.txt" target="_blank">memcached protocol</a></p>

			<p class="p">If you receive an unexpected ‘key exists’ error when you use <samp class="ph codeph">add</samp> you
				should log the error, and then go back into your code to determine why the key already
				exists. You will want to go back into the application logic that creates these keys and
				find out if there is a problem in the logic. One approach to use to ensure you have
				unique keys for all your documents is to use a key generator that creates unique keys
				for all documents.</p>

			<p class="p">There are application scenarios where you receive a ‘key exists’ error and you want that
				error to occur so you can handle it in your application logic. For instance, if you are
				handling a coupon, and if the coupon key already exists you know the coupon code has
				already been redeemed. In that case you can use the error to trigger a message to the
				user that the coupon has already been used.</p>

			<p class="p">The types of errors that can occur during this operation include 1) inability to connect
				to a node, or 2) some error exists while attempting to format a value being set. If you
				have a connection-level error you may need to reattempt connection, and possibly check
				the status of the server. If you have an error with the size of your value or
				formatting, you need to check the value itself, and how it is encoded and see if there
				are any issues that make the document incompatible with Couchbase Server.</p>
For more
			information about connections and connection-level settings, see <a class="xref" href="app-performance.html#concept_gmj_qss_np__optimize-instances">Optimizing client instances</a>
			<a class="xref" href="common-errors.html#concept7680__client-timeouts">Client-side timeouts</a>. </section>

	</div>


<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/access-data.html">Accessing data with Couchbase SDKs</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/async-methods.html">About asynchronous methods</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/retrieve-info.html">Retrieving information</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>