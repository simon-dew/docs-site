<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>About document expiration — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/first-app.html"><span>Creating your first application</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/modeling-docs.html"><span>Modeling documents</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/access-data.html"><span>Accessing data with Couchbase SDKs</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/dev-guide-3.0/sdk-vs-sql.html"><span>Couchbase SDKs and SQL commands</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/read-write.html"><span>Reading and writing data</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/doc-expiration.html" class="current"><span>About document expiration</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../developer/dev-guide-3.0/async-methods.html"><span>About asynchronous methods</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/store-info.html"><span>Storing information</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/retrieve-info.html"><span>Retrieving information</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/retrieve-by-cas.html"><span>Retrieving items with CAS values</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/lock-items.html"><span>Locking items</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/update-info.html"><span>Updating Information</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/delete-info.html"><span>Deleting information</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/observe.html"><span>Monitoring data using observe</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/destroy-data.html"><span>Permanently destroying data</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/store-data.html"><span>Storing data</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/find-data.html"><span>Finding data with views</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/advanced-topics.html"><span>Advanced topics in development</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/client-library.html"><span>Developing a client library</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
	<h1 class="title topictitle1" id="ariaid-title1">About document expiration</h1>

	
	<div class="body conbody"><p class="shortdesc">Time to live (TTL) is the amount of time until a document expires in Couchbase Server.
		By default, all documents have a TTL of zero, which indicates the document is kept
		indefinitely. Typically when you add, set, or replace information, you establish a custom TTL
		by passing it as a parameter to your method call. As part of normal maintenance operations,
		Couchbase Server periodically removes all items with expiration times that have
		passed.</p>


		<p class="p">Depending on the amount of time you want to specify for the document to live, you provide a
			TTL value as a relative number of seconds into the future or in <a class="xref" href="http://en.wikipedia.org/wiki/Unix_time" target="_blank">Unix
				time</a>. Unix time represents a specific date and time expressed as the number of
			seconds that have elapsed since Thursday, 1 January 1970 at 00:00:00 <a class="xref" href="http://www.timeanddate.com/time/aboututc.html" target="_blank">Coordinated Universal Time (UTC)</a>. For example, the value 1421454149 represents
			Saturday, 17 January 2015 at 00:22:29 UTC.</p>


		<p class="p">If you specify a TTL as a relative value of seconds into the future, it is actually stored
			in Couchbase Server as an absolute Unix time stamp. This means, for example, if you store
			an item with a two-day relative TTL, immediately make a backup, and then restore from that
			backup three days later, the expiration will have passed and the data is no longer
			there.</p>


		<div class="note important"><span class="importanttitle">Important:</span> Some of the SDKs, most notably the Java and .NET SDKs, provide convenience
			methods to set the TTL value. These convenience methods handle the translation logic for
			TTL values under and over 30 days. This topic describes how TTL values are handled
			internally by Couchbase Server. Refer to the developer guide and API reference for your
			particular SDK to learn how to set the TTL. Where available, always use the methods
			provided by the SDK you are using. They take precedence over the details provided below and
			are much easier to use.</div>


		<p class="p">Here is how to specify a TTL:</p>

		<ul class="ul">
			<li class="li"><strong class="ph b">To set a value of 30 days or less</strong>: If you want an item to live for less than 30
				days, you can provide a TTL in seconds or as Unix time. The maximum value you can
				specify in seconds is the number of seconds in a month, namely 30 x 24 x 60 x 60.
				Couchbase Server removes the item the given number of seconds after it stores the
				item.</li>

		</ul>

		<ul class="ul">
			<li class="li"><strong class="ph b">To set a value over 30 days</strong>: If you want an item to live for more than 30 days,
				you must provide a TTL in Unix time.</li>

		</ul>

		<p class="p">Couchbase Server does lazy expiration, that is, expired items are flagged as deleted rather
			than being immediately erased. Couchbase Server has a maintenance process, called the
				<dfn class="term">expiry pager</dfn> that periodically looks through all information and erases
			expired items. This maintenance process runs every 60 minutes, but it can be configured to
			run at a different interval. Couchbase Server immediately removes an item flagged for
			deletion the next time the item is requested and the server responds to the requesting
			process with a message indicating that the item does not exist.</p>

		<p class="p">Couchbase Server offers functionality you can use to index and find documents and perform
			calculations on data, known as <dfn class="term">views</dfn>. For views, you write functions in
			JavaScript that specify what data should be included in an index. When you want to retrieve
			information using views, it is called <em class="ph i">querying a view</em> and the information Couchbase
			Server returns is called a <em class="ph i">result set</em>.</p>

		<p class="p">The result set from a view will contain any items stored on disk that meet the requirements
			of your view function. Therefore, information that has not yet been removed from disk might
			appear as part of a result set when you query a view.</p>

		<p class="p">Using Couchbase views, you can also perform <dfn class="term">reduce functions</dfn> on data, which
			perform calculations or other aggregations of data. For instance, if you want to count the
			instances of a type of object, you would use a reduce function. Once again, if an item is
			on disk, it will be included in any calculation performed by your reduce functions. Based
			on this behavior due to disk persistence, here are guidelines on handling expiration with
			views:</p>

		<ul class="ul">
			<li class="li">
				<p class="p"><strong class="ph b">Detecting Expired Documents in Result Sets</strong>: If you are using views for
					indexing items from Couchbase Server, items that have not yet been removed as part of
					the expiry pager maintenance process will be part of a result set returned by
					querying the view. To exclude these items from a result set you should use query
					parameter <samp class="ph codeph">include_doc</samp> set to <samp class="ph codeph">true</samp>. This parameter
					typically includes all JSON documents associated with the keys in a result set. For
					example, if you use the parameter <samp class="ph codeph">include_docs=true</samp>, Couchbase
					Server will return a result set with an additional <samp class="ph codeph">doc</samp> object that
					contains the JSON or binary data for that key:</p>


				<pre class="pre codeblock language-json"><code>{
   "total_rows":2,
   "rows":[
      {
         "id":"test",
         "key":"test",
         "value":null,
         "doc":{
            "meta":{
               "id":"test",
               "rev":"4-0000003f04e86b040000000000000000",
               "expiration":0,
               "flags":0
            },
            "json":{
               "testkey":"testvalue"
            }
         }
      },
      {
         "id":"test2",
         "key":"test2",
         "value":null,
         "doc":{
            "meta":{
               "id":"test2",
               "rev":"3-0000004134bd596f50bce37d00000000",
               "expiration":1354556285,
               "flags":0
            },
            "json":{
               "testkey":"testvalue"
            }
         }
      }
   ]
}
</code></pre>


				<p class="p">For expired documents, if you set <samp class="ph codeph">include_doc=true</samp>, Couchbase Server
					returns a result set indicating the document does not exist anymore. Specifically,
					the key that had expired but had not yet been removed by the cleanup process will
					appear in the result set as a row where <samp class="ph codeph">"doc":null</samp> :</p>


				<pre class="pre codeblock language-json"><code>{
   "total_rows":2,
   "rows":[
      {
         "id":"test",
         "key":"test",
         "value":null,
         "doc":{
            "meta":{
               "id":"test",
               "rev":"4-0000003f04e86b040000000000000000",
               "expiration":0,
               "flags":0
            },
            "json":{
               "testkey":"testvalue"
            }
         }
      },
      {
         "id":"test2",
         "key":"test2",
         "value":null,
         "doc":null
      }
   ]
}
</code></pre>

			</li>

		</ul>

		<ul class="ul">
			<li class="li"><strong class="ph b">Reduces and Expired Documents</strong>: In some cases, you might want to perform a
					<em class="ph i">reduce function</em> to perform aggregations and calculations on data in Couchbase
				Server. In this case, Couchbase Server takes precalculated values that are stored for an
				index and derives a final result. This also means that any expired items still on disk
				will be part of the reduction. This may not be an issue for your final result if the
				ratio of expired items is proportionately low compared to other items. For instance, if
				you have 10 expired scores still on disk for an average performed over 1 million
				players, there might be only a minimal level of difference in the final result. However,
				if you have 10 expired scores on disk for an average performed over 20 players, you
				would get very different result than the average you expect. <p class="p">In this case, you might
					want to run the expiry pager process more frequently to ensure that items that have
					expired are not included in calculations used in the reduce function. We recommend an
					interval of 10 minutes for the expiry pager on each node of a cluster. Note that this
					interval has a slight impact on node performance as it performs cleanup more
					frequently on the node.</p>
</li>

		</ul>

		<p class="p">For more details about setting intervals for the maintenance process, see <a class="xref" href="http://docs.couchbase.com/admin/admin/CLI/cbepctl-intro.html" target="_blank">cbepctl command line tool</a> to find information about specifying
			disk cleanup intervals and refer to the examples about
			<samp class="ph codeph">exp_pager_stime</samp>.</p>


		<p class="p">For more information about views and view query parameters, see <a class="xref" href="find-data.html#concept1470">Finding data with views</a>.</p>

	</div>


<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/access-data.html">Accessing data with Couchbase SDKs</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/read-write.html">Reading and writing data</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/async-methods.html">About asynchronous methods</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>