<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Document design considerations — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/first-app.html"><span>Creating your first application</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/modeling-docs.html"><span>Modeling documents</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/dev-guide-3.0/compare-docs-vs-relational.html"><span>Comparing document-oriented and relational data</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/using-json-docs.html"><span>Using JSON documents</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/schemaless.html"><span>Schemaless data modeling</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/doc-design-considerations.html" class="current"><span>Document design considerations</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../developer/dev-guide-3.0/model-docs-retrieval.html"><span>Modeling documents for retrieval</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/lookups.html"><span>Using reference documents for lookups</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/sample-docs.html"><span>Sample storage documents</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/access-data.html"><span>Accessing data with Couchbase SDKs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/store-data.html"><span>Storing data</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/find-data.html"><span>Finding data with views</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/advanced-topics.html"><span>Advanced topics in development</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/client-library.html"><span>Developing a client library</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content"><h1 class="title topictitle1" id="ariaid-title1">Document design considerations</h1>
<div class="body conbody"><p class="p">When you work on document design, there are a few other considerations you
should have in mind. This will help you determine whether you use one or more
documents to represent something in your application. It will also help you
determine how and when you provide references to show relationships between
multiple documents. Consider:</p>
<ul class="ul">
<li class="li"><p class="p">Whether you will represent the items as separate objects.</p>
</li>

<li class="li"><p class="p">Whether you want to access the objects together at run time.</p>
</li>

<li class="li"><p class="p">If you want some data to be atomic; that is, changes occur at once to this data,
 or the change fails and will not made.</p>
</li>

<li class="li"><p class="p">Whether you will index and query data through <dfn class="term">views</dfn>, which are stored functions you
					use to find, extract, sort, and perform calculations on documents in Couchbase
					Server. For more information see <a class="xref" href="find-data.html#concept1470">Finding data with views</a>.</p>
</li>

</ul>
<p class="p">The following provides some guidelines on when you would prefer using one or
more than one document to represent your data.</p>
<p class="p">When you use one document to contain all related data you typically get these
benefits:</p>
<ul class="ul">
<li class="li"><p class="p">Application data is denormalized.</p>
</li>

<li class="li"><p class="p">Can read/write related information in one operation.</p>
</li>

<li class="li"><p class="p">Eliminate need for client-side joins.</p>
</li>

<li class="li"><p class="p">If you put all information for a transaction in a single document, you can
 better guarantee atomicity since any changes will occur to a single document at
 once.</p>
</li>

</ul>
<p class="p">When you provide a single document to represent an entire entity and any related
records, the document is known as an <em class="ph i">aggregate</em>. You can also choose to use
separate documents for different object types in your application. This approach
is known as <em class="ph i">denormalization</em> in NoSQL database terms. In this case you provide
cross references between objects as we demonstrated earlier in the beer-brewery
documents. You typically gain the following from separate documents:</p>
<ul class="ul">
<li class="li"><p class="p">Reduce data duplication.</p>
</li>

<li class="li"><p class="p">May provide better application performance and scale by keeping document size
 smaller.</p>
</li>

<li class="li"><p class="p">Application objects do not need to be in same document; separate documents may
 better reflect the objects as they are in the real world.</p>
</li>

</ul>
<p class="p">The following examples demonstrate the use of a single document compared to
separate documents for a simple blog. In the blog application a user can create
an entry with title and content. Other users can add comments to the post. In
the first case, we have a single JSON document to represent a blog post, plus
all the comments for the post:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">{
    "post_id": "dborkar_Hello_World",
    "author": "dborkar",
    "type": "post"
      "title": "Hello World",
      "format": "markdown",
      "body": "Hello from [Couchbase](http://couchbase.com).",
      "html": "&lt;p&gt;Hello from &lt;a href=\"http:  …
              "comments":[
              {"format": "markdown", "body":"Awesome post!"},
              {"format”: "markdown", "body":"Like it." }
           ]
}
</samp></code></pre>
<p class="p">The next JSON documents show the same blog post, however we have split the post
into the actual entry document and a separate comment document. First is the
core blog post document as JSON. Notice we have a reference to two comments
under the <samp class="ph codeph">comments</samp> key and two values in an array:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">{
  "post_id": "dborkar_Hello_World",
  "author": "dborkar",
  "type": "post",
  "title": "Hello World",
  "format": "markdown",
  "body": "Hello from [Couchbase](http://couchbase.com).",
  "html": “&lt;p&gt;Hello from &lt;a href="http:  …"&gt;
  "comments" : ["comment1_jchris_Hello_world", "comment2_kzeller_Hello_World"]
}
</samp></code></pre>
<p class="p">The next document contains the first actual comment that is associated with the
post. It has the key <samp class="ph codeph">comment_id</samp> with the first value of
‘comment1_dborkar_Hello_world’; this value serves as a reference back to the
blog post it belongs to:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">{
  "comment_id": "comment1_dborkar_Hello_World",
  "format": "markdown",
  "body": "Awesome post!"
}
</samp></code></pre>
<p class="p">The next example demonstrates our beer and breweries example as single and
separate documents. If we wanted to use a single-document approach to represent
a beer, it could look like this in JSON:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">{
    "beer_id": 10.0,
    "name": "Hoptimus Prime",
    "category": "North American Ale",
    "style": "Imperial or Double India Pale Ale",
    "brewery": "Legacy Brewing Co." : {
            "address1" : "Easy Peasy St.",
            "address2" : "Suite 4",
            "city" : "Baltimore",
            "state" : "Maryland",
            "zip" : "21215",
            "capacity" : 10000,
                     },
    "updated": [2010, 7, 22, 20, 0, 20],
    "available": true
}
</samp></code></pre>
<p class="p">In this case we provide information about the brewery as a subset of the beer.
But consider the case where we have more than one beer from the brewery, in this
case:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">{
    "beer_id": 12.0,
    "name": "Pleny the Hipster",
    "category": "Wheat Beer",
    "style": "Koelsch",
    "brewery": "Legacy Brewing Co." : {
            "address1" : "Easy Peasy St.",
            "address2" : "Suite 4",
            "city" : "Baltimore",
            "state" : "Maryland",
            "zip" : "21215",
            "capacity" : 10000,
                     },
    "updated": [2011, 8, 2, 20, 0, 20],
    "available": true
}
</samp></code></pre>
<p class="p">Here we are starting to develop duplicate information because we have the same
brewery information in each beer document. In this case it makes sense to
separate the brewery and beers as different documents and relate them through
fields. The revised, separate beer document appears below. Notice we have added
a new field to represent the brewery and provide the brewer id:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">{
    "beer_id": 10.0,
    "name": "Hoptimus Prime",
    "category": "North American Ale",
    "style": "Imperial or Double India Pale Ale",
    "brewery" : "leg_brew_10"
    "updated": [2010, 7, 22, 20, 0, 20],
    "available": true
}
</samp></code></pre>
<p class="p">And here is the associated brewery as a separate brewery document. In this case,
we may simplify the document structure since it is separate from the beer data,
and provide all the brewery information at the same level:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">{
    "brewery_id" : "leg_brew_10",
    "name": "Legacy Brewing Co.",
    "address1" : "Easy Peasy St.",
    "address2" : "Suite 4",
    "city" : "Baltimore",
    "state" : "Maryland",
    "zip" : "21215",
    "capacity" : 10000,
}
</samp></code></pre>
</div>
<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/modeling-docs.html">Modeling documents</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/schemaless.html">Schemaless data modeling</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/model-docs-retrieval.html">Modeling documents for retrieval</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>