<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Performing a bulk set — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/first-app.html"><span>Creating your first application</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/modeling-docs.html"><span>Modeling documents</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/access-data.html"><span>Accessing data with Couchbase SDKs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/store-data.html"><span>Storing data</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/find-data.html"><span>Finding data with views</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/advanced-topics.html"><span>Advanced topics in development</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/dev-guide-3.0/bulk-set.html" class="current"><span>Performing a bulk set</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../developer/dev-guide-3.0/memory-errors.html"><span>Handling temporary out of memory errors</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/sync-async-transactions.html"><span>Synchronous and asynchronous transactions</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/transactional-logic.html"><span>Providing transactional logic</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/app-performance.html"><span>Improving application performance</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/thread-safety.html"><span>Thread safety for Couchbase SDKs</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/common-errors.html"><span>Handling common errors</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/troubleshooting.html"><span>Troubleshooting</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/client-library.html"><span>Developing a client library</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
	<h1 class="title topictitle1" id="ariaid-title1">Performing a bulk set</h1>

	<div class="body conbody">
		<p class="p">During development or production you will probably want to add application-specific seed
			data into Couchbase. This may be data you use to test your application during development,
			or it may be application-specific content that is pre-populated, such as catalog data.</p>

		<p class="p">In general, you need three elements in place to do a bulk upload:</p>

		<ul class="ul">
			<li class="li"><p class="p">Set of data you want to upload. This can be cleanly structured information in a
					file, a JSON document, or information in a database.</p>
</li>

			<li class="li"><p class="p">Program in the SDK language of your choice. This program that you write will connect
					to Couchbase Server, read the file or data into memory and then store it to Couchbase
					Server. You program will typically have an event loop to loop through all the
					elements you want to store and store them.</p>
</li>

			<li class="li"><p class="p">Any supporting classes used to represent that data you want to store. In some cases
					you may be storing simple data which can be stored in your loader program as
					primitive types, in which case you do not need to create a class.</p>
</li>

		</ul>

		<p class="p">The following PHP example demonstrates a bulk set of sample data on beers and breweries.
			Sample code and data for this example are at Github: <a class="xref" href="https://github.com/couchbaselabs/couchbase-beers/blob/beernique/import.php" target="_blank">import.php</a> and <a class="xref" href="https://github.com/couchbaselabs/couchbase-beers/tree/beernique/beer-sample" target="_blank">beer and brewey sample data</a>.</p>

		<p class="p">First, here is an example of a JSON record for a beer. This particular beer is in the
				<samp class="ph codeph">beer_#17_Cream_Ale.json</samp> file in the <samp class="ph codeph">beer-sample/beer</samp>
			directory.</p>

		<pre class="pre codeblock"><code><samp class="ph codeph">{
    "_id":"beer_#17_Cream_Ale",
    "brewery":"Big Ridge Brewing",
    "name":"#17 Cream Ale",
    "category":"North American Lager",
    "style":"American-Style Lager",
    "updated":"2010-07-22 20:00:20"
}
</samp></code></pre>

		<p class="p">We also have brewery data with each brewery in a JSON file located in
				<samp class="ph codeph">beer-sample/breweries</samp>. Finally we create the script that reads in the
			directories and stores each file as a record in Couchbase Server:</p>

		<pre class="pre codeblock"><code><samp class="ph codeph">&lt;?php

// Set up Couchbase client object
try {
  $cb = new Couchbase(COUCHBASE_HOST.':'.COUCHBASE_PORT, COUCHBASE_USER, COUCHBASE_PASSWORD, COUCHBASE_BUCKET);
} catch (ErrorException $e) {
  die($e-&gt;getMessage());
}

// import a directory
function import($cb, $dir) {
  $d = dir($dir);
  while (false !== ($file = $d-&gt;read())) {
    if (substr($file, -5) != '.json') continue;
    echo "adding $file\n";
    $json = json_decode(file_get_contents($dir . $file), true);
    unset($json["_id"]);
    echo $cb-&gt;set(substr($file, 0, -5), json_encode($json));
    echo "\n";
  }
}

// import beers and breweries
import($cb, 'beer-sample/beer/');
import($cb, 'beer-sample/breweries/');

?&gt;
</samp></code></pre>

		<p class="p">We first create a Couchbase client, then we declare an <samp class="ph codeph">import</samp> function
			which will read in our files and write them to Couchbase Server. While the import function
			reads each file into memory, we repeat the same set of operations for each file. If the
			file is not a JSON file we convert it into JSON. We also omit the first attribute of ‘_id’
			from the file since we already provide unique file names and use the filename itself as a
			key; therefore we do not need this as a unique identifier. Then we store the value to
			Couchbase Server as JSON and use the filename, minus the.json file extension as the key for
			each record.</p>

	</div>

	
<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/advanced-topics.html">Advanced topics in development</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/memory-errors.html">Handling temporary out of memory errors</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>