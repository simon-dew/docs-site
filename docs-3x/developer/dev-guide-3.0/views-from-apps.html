<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Using views from an application — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/first-app.html"><span>Creating your first application</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/modeling-docs.html"><span>Modeling documents</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/access-data.html"><span>Accessing data with Couchbase SDKs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/store-data.html"><span>Storing data</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/find-data.html"><span>Finding data with views</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/dev-guide-3.0/views.html"><span>Understanding views</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/filter-extract.html"><span>Filtering and extracting data</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/build-index.html"><span>Building an index</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/efficient-lookups.html"><span>Providing efficient lookups</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/order-results.html"><span>Ordering results</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/handle-results.html"><span>Handling result sets</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/built-in-reduce.html"><span>Using built-in reduces</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/compound-keys.html"><span>Using compound keys and group-by functions</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/views-from-apps.html" class="current"><span>Using views from an application</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../developer/dev-guide-3.0/custom-reduces.html"><span>Creating custom reduces</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/reduce-rereduce.html"><span>Understanding custom reduces and rereduce</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/view-errors.html"><span>Error handling for views</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/advanced-topics.html"><span>Advanced topics in development</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/client-library.html"><span>Developing a client library</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
	<h1 class="title topictitle1" id="ariaid-title1">Using views from an application</h1>

	<div class="body conbody">
		<p class="p">When you develop a new application using views, you sometimes need to create a view dynamically
			from your code. For example you may need this when you install your application, when you
			write a test, or when you are building a framework and want to create views and query data
			from the framework. This sections describes you how to do it. When you do the <a class="xref" href="http://docs.couchbase.com/admin/admin/Install/init-setup.html" target="_blank">initial server setup</a>, make sure you install the <a class="xref" href="http://docs.couchbase.com/admin/admin/Misc/sample-bucket-beer.html" target="_blank">beer sample data set</a>.</p>

		<p class="p">For more information about using views from the Java SDK, see <a class="xref" href="http://tugdualgrall.blogspot.de/2012" target="_blank">Tug’s
				Blog</a>.</p>

		<p class="p">The first thing we do in our application is to connect to the cluster from our Couchbase
			client. As a best practice we typically provide a list of URIs to different nodes in the
			cluster in case the initial node we try to connect to is unavailable. By doing so we can
			attempt another initial connection to the cluster at another node:</p>

		<pre class="pre codeblock language-java"><code>import com.couchbase.client.CouchbaseClient;

    List&lt;uri&gt; uris = new LinkedList&lt;uri&gt;();

    uris.add(URI.create("http://127.0.0.1:8091/pools"));

    CouchbaseClient client = null;

    try {

        client = new CouchbaseClient(uris, "beer-sample", "");


        // put your code here
        client.shutdown();
    } catch (Exception e) {
        System.err.println("Error connecting to Couchbase: " + e.getMessage());
        System.exit(0);
    }


&lt;/uri&gt;&lt;/uri&gt;
</code></pre>

		<p class="p">Here we create a list of URIs to different nodes of the cluster; for the sake of
			convenience we are working with a single node cluster. Then we connect to our bucket, which
			in this case is <samp class="ph codeph">beer-sample</samp>.</p>

		<p class="p"><strong class="ph b">Creating View Functions with an SDK</strong></p>

		<p class="p">Couchbase SDKs provide all the methods you need to save, index, and query views. Imagine we
			want to get all the beer names out of our sample database. In this case, our map function
			would appear as follows:</p>

		<pre class="pre codeblock language-javascript"><code>function (doc, meta) {
  if(doc.type &amp;&amp; doc.type == "beer") {
    emit(doc.name, null);
  }
}
</code></pre>

		<p class="p">At first, we import the Java SDK libraries that we need to work with views. Then we can
			create a design document based on the <samp class="ph codeph">DesignDocument</samp> class and also create
			our view as an instance of the <samp class="ph codeph">ViewDesign</samp> class:</p>

		<pre class="pre codeblock language-java"><code>import com.couchbase.client.protocol.views.DesignDocument;
import com.couchbase.client.protocol.views.ViewDesign;

    DesignDocument designDoc = new DesignDocument("dev_beer");

    String viewName = "by_name";
    String mapFunction =
            "function (doc, meta) {\n" +
            "  if(doc.type &amp;&amp; doc.type == \"beer\") {\n" +
            "    emit(doc.name);\n" +
            "  }\n" +
            "}";

    ViewDesign viewDesign = new ViewDesign(viewName,mapFunction);
    designDoc.getViews().add(viewDesign);
    client.createDesignDoc( designDoc );
</code></pre>

		<p class="p">In this case we create a design document named <samp class="ph codeph">dev_beer</samp>, name our actual view <samp class="ph codeph">by_name</samp>,
			and store the map function in a String. We then create a new view provide the constructor
			the name and function. Finally we add this view to our design document and store it to
			Couchbase Server with <samp class="ph codeph">createDesignDoc</samp>.</p>

		<p class="p"><strong class="ph b">Querying View from SDKs</strong></p>

		<p class="p">At this point you can index and query your view. Be aware that when you first create a
			view, whether this in Couchbase Web Console, or via an SDK, the view is in development
			mode. You need to put the into production mode in order to query it:</p>

		<pre class="pre codeblock language-java"><code>import import com.couchbase.client.protocol.views.*;

System.setProperty("viewmode", "development"); // before the connection to Couchbase

// Create connection if needed

View view = client.getView("beer", "by_name");
Query query = new Query();
query.setIncludeDocs(true).setLimit(20);
query.setStale( Stale.FALSE );
ViewResponse result = client.query(view, query);

for(ViewRow row : result) {
  row.getDocument(); // deal with the document/data
}
</code></pre>

		<p class="p">Before we create a Couchbase client instance and connect to the server, we set a system
			property <samp class="ph codeph">viewmode</samp> to <samp class="ph codeph">development</samp> to put the view into
			production mode. Then we query our view and limit the number of documents returned to 20
			items. Finally when we query our view we set the <samp class="ph codeph">stale</samp> parameter to
				<samp class="ph codeph">FALSE</samp> to indicate we want to re-index and include any new or updated
			beers in Couchbase. For more information about the <samp class="ph codeph">stale</samp> parameter and
			index updates, see <a class="xref" href="http://docs.couchbase.com/admin/admin/Views/views-intro.html#index-stale" target="_blank">Index updates and the stale parameter</a>.</p>

		<p class="p">The last part of this code sample is a loop we use to iterate through each item in the
			result set. You can provide any code for handling or outputting individual results
			here.</p>

	</div>

	
<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/find-data.html">Finding data with views</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/compound-keys.html">Using compound keys and group-by functions</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/custom-reduces.html">Creating custom reduces</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>