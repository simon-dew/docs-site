<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>About keys, values and metadata — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/first-app.html"><span>Creating your first application</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/modeling-docs.html"><span>Modeling documents</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/access-data.html"><span>Accessing data with Couchbase SDKs</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/store-data.html"><span>Storing data</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/dev-guide-3.0/keys-values.html" class="current"><span>About keys, values and metadata</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../developer/dev-guide-3.0/write-json.html"><span>Writing JSON documents to Couchbase</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/buckets.html"><span>About data buckets</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/sharding.html"><span>About sharding data</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/manage-buckets.html"><span>Creating and managing buckets</span></a></li><li class="section"><a href="../../developer/dev-guide-3.0/partition-data.html"><span>Partitioning data with buckets</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/find-data.html"><span>Finding data with views</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/advanced-topics.html"><span>Advanced topics in development</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/client-library.html"><span>Developing a client library</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
	<h1 class="title topictitle1" id="ariaid-title1">About keys, values and metadata</h1>

	<div class="body conbody">
		<p class="p">Earlier we briefly described how Couchbase Server stores information; the server stores all
			data as key-value pairs. A value can be a string, image, integers, or serialized objects,
			and valid JSON documents. In general, the Couchbase Server does not attempt to interpret
			any structure for the value you provide.</p>

		<p class="p"></p>

		<section class="section"><h2 class="title sectiontitle">Document IDs </h2>
			<p class="p">Document IDs are assigned by application. A valid
				document ID must:</p>
<div class="p">
					<ul class="ul" id="concept7016__ul_rht_rnm_zs">
						<li class="li">Conform to UTF-8 encoding</li>

						<li class="li">Be no longer than 250 bytes<div class="note note"><span class="notetitle">Note:</span> Note the difference between bytes and
							characters. Most non-Latin characters occupy more than a single
							byte</div>
</li>

					</ul>

				</div>
You are free to choose any ID for your document, so long as they conform to the
			above restrictions. Unlike some other database, Couchbase does not automatically
			generate IDs for you (but see [counter pattern]).</section>

			
		<section class="section"><h2 class="title sectiontitle">Specifying keys</h2><p class="p">Keys are unique identifiers that you provide as a
				parameter when you perform any operation on data. Each document you store in a data
				bucket must have a unique document ID, which is similar to the concept of a SQL primary
				key. The following applies to keys:</p>
<ul class="ul">
				<li class="li"><p class="p">Keys are strings, typically enclosed by quotes for any given SDK.</p>
</li>

				<li class="li"><p class="p">No spaces are allowed in a key.</p>
</li>

				<li class="li"><p class="p">Separators and identifiers are allowed, such as underscore:
					‘person_93847’.</p>
</li>

				<li class="li"><p class="p">A key must be unique within a bucket; if you attempt to store the same key in a
						bucket, it will either overwrite the value or return an error in the case of
							<samp class="ph codeph">add()</samp>.</p>
</li>

				<li class="li"><p class="p">Maximum key size is 250 bytes. Couchbase Server stores all keys in RAM and does not remove these
						keys to free up space in RAM. Take this into consideration when you select
						keys and key length for your application. However, if you use the full
						ejection, keys will be ejected too.</p>
</li>

			</ul>
<p class="p">Key sizes are important if you consider the size of keys stored for tens or hundreds of millions
				of records. One hundred million keys which are 70 Bytes each plus metadata at 54
				Bytes each will require about 23 GB of RAM for document meta data. As of Couchbase
				Server 2.0.1, metadata is 60 Bytes and as of Couchbase Server 2.1.0 it is 54
				Bytes.</p>
<p class="p"></p>
</section>

		<section class="section"><h2 class="title sectiontitle">Specifying values</h2><p class="p">Any value you want to store in Couchbase Server
				will be stored as a document, or as a pure byte string. In the case of JSON documents,
				the JSON syntax enables you to provide context and structure for the data. The following
				applies to values in Couchbase Server:</p>
<ul class="ul">
				<li class="li"><p class="p">In general, values have no implied meaning when stored in the server.</p>
</li>

				<li class="li"><p class="p">Integers have implicit value for particular operations, namely incrementing and
						decrementing. This means Couchbase Server recognizes integers as values that can
						be incremented and decremented.</p>
</li>

				<li class="li"><p class="p">Strings, or serialized objects can be stored.</p>
</li>

				<li class="li"><p class="p">Documents stored in memcached buckets can be up to 1 MB; values stored in
						Couchbase buckets can be up to 20 MB.</p>
</li>

			</ul>
<p class="p">In general it is to your advantage to keep any documents as small as possible; this
				way, they require less RAM, they will require less network bandwidth, and by using
				smaller values Couchbase Server can better distribute the information across
				nodes.</p>
</section>

		<section class="section"><h2 class="title sectiontitle">More on metadata</h2><p class="p">When you store a key-document pair in Couchbase
				Server, it also saves metadata that is associated with the new record. The following
				are the types of metadata:</p>
<ul class="ul">
				<li class="li"><p class="p">Expiration, also known as Time to Live, or TTL.</p>
</li>

				<li class="li"><p class="p">Compare and swap (CAS) value</p>
</li>

				<li class="li"><p class="p">Flags, which are typically SDK-specific and are often used to identify the type
						of data stored, or to specify formatting.</p>
</li>

				<li class="li"><p class="p">Sequence number, for internal server use only. The sequence number is used for
						conflict resolution of keys that are updated concurrently on different clusters.
						This conflict resolution takes place when using Couchbase's cross data center
						replication (XDCR). The sequence number keeps track of how many times a document
						is mutated. For more information about XDCR, see the <a class="xref" href="http://docs.couchbase.com/admin/admin/XDCR/xdcr-intro.html" target="_blank">Cross data center replication</a>.</p>
</li>

			</ul>
<p class="p">CAS values enable you to store information and then require that a client provide
				the correct unique CAS value in order to update it. Be aware that performing a function
				with CAS does slow storing or retrieval. There are some operations that should be fast
				in nature where you do not want to perform with CAS, for instance
					<samp class="ph codeph">append()</samp>. For some SDKs a CAS value is nonetheless required to
				perform the operation. In this case, you can provide 0 as the CAS and the operation will
				execute without comparing the CAS value. For more information, see “Using Couchbase
				SDKs.”</p>
<p class="p">Flags are used by SDKs to perform a variety of information- and SDK-specifc
				function. Typically a Couchbase SDK will use a flag to determine if information should
				be serialized or formatted in a particular way. For instance, in the case of Java, a
				flag can signify the data type of an object you are storing. Some SDKs will expose flags
				for an application to handle; in other SDKs flags may be automatically handled by the
				SDK itself. For more information about the flags unique to your chosen SDK, please refer
				to the SDK’s API reference.</p>
<p class="p">Document metadata is 54 Bytes per item as of Couchbase
				Server 2.1.0 and is 60 Bytes for Couchbase Server 2.0.1. Couchbase Server keeps all
				document metadata and keys in RAM and does not remove them from RAM to free up
				additional space. This means 100 million items with a 70-byte key and 54-byte metadata
				would require approximately 23 GB of RAM at run time.</p>
<p class="p">As discussed previously in
				this guide, you can provide an explicit expiration for a record or let Couchbase assign
				a default. The default expiration for any given record is 0, which signifies indefinite
				storage. Couchbase will keep the item stored until you explicitly perform a
					<samp class="ph codeph">delete()</samp> on that key. Alternately if you remove the entire bucket,
				Couchbase will delete the record. Expiration times are typically set in seconds:</p>
<ul class="ul">
				<li class="li"><p class="p">Items &lt; 30 days: if you want to store an item for thirty days or less, you
						specify the number of seconds until expiration.</p>
</li>

				<li class="li"><p class="p">Items &gt; 30 days: if you want to store an item for thirty days or more, you
						specify the an absolute Unix epoch time. Milliseconds will be rounded up to the
						nearest second. Couchbase Server will delete an item at this time.</p>
</li>

			</ul>
<p class="p">If you provide a time to live in seconds that is greater than the number of seconds
				in 30 days (60 * 60 *24 * 30) Couchbase Server will consider this to be a real Unix
				epoch time value, rather than interpret it as seconds. It will remove the item at that
				epoch
			time.</p>
<p class="p"></p>
</section>

		<section class="section"><h2 class="title sectiontitle">Understanding document expiration</h2><p class="p">Time to live can be a bit
				confusing for developers at first. There are many cases where you may set an expiration
				to be 30 seconds, but the record may still exist on disk after expiration.</p>
<p class="p">There
				are two ways that Couchbase Server will remove items flagged for deletion:</p>
<ul class="ul">
				<li class="li"><p class="p">Lazy Deletion: key are flagged for deletion; after the next request for the key,
						it will be removed. This applies to data in Couchbase and memcached
					buckets.</p>
</li>

				<li class="li"><p class="p">Maintenance Intervals: items flagged as expired will be removed by an automatic
						maintenance process that runs every 60 minutes.</p>
</li>

			</ul>
<p class="p">When Couchbase Server performs lazy deletion, it flags an item as deleted when the
				server receives a delete request; later when a client tries to retrieve the item,
				Couchbase Server will return a message that the key does not exist and actually delete
				the item. Items that are flagged as expired will be removed every 60 minutes by default
				by an automatic maintenance process. To update the interval for this maintenance, you
				would set <samp class="ph codeph">exp_pager_stime</samp>
				:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">./cbconfig localhost:11210 set flush exp_pager_stime 7200
</samp></code></pre>
<p class="p">This
				updates the maintenance program so that it runs every two hours on the default
				bucket.</p>
</section>

	</div>

	
<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/store-data.html">Storing data</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../developer/dev-guide-3.0/write-json.html">Writing JSON documents to Couchbase</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>