<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Bulk operations — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../developer/java-2.1/java-intro.html"><span>Java SDK 2.1</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/java-2.0/java-intro.html"><span>Java SDK 2.0</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dotnet-2.1/dotnet-intro.html"><span>.NET SDK 2.1</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dotnet-2.0/dotnet-intro.html"><span>.NET SDK 2.0</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/dotnet-2.0/overview.html"><span>Overview</span></a></li><li class="section"><a href="../../developer/dotnet-2.0/download-links.html"><span>Download and API Reference</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dotnet-2.0/getting-started.html"><span>Getting started</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dotnet-2.0/managing-connections.html"><span>Managing server connections </span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dotnet-2.0/documents.html"><span>Working with documents</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/dotnet-2.0/storing.html"><span>Creating documents</span></a></li><li class="section"><a href="../../developer/dotnet-2.0/retrieving.html"><span>Retrieving documents</span></a></li><li class="section"><a href="../../developer/dotnet-2.0/updating.html"><span>Updating documents</span></a></li><li class="section"><a href="../../developer/dotnet-2.0/deleting.html"><span>Deleting documents</span></a></li><li class="section"><a href="../../developer/dotnet-2.0/bulk-operations.html" class="current"><span>Bulk operations</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../developer/dotnet-2.0/atomic-operations.html"><span>Atomic operations</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/dotnet-2.0/querying.html"><span>Querying buckets</span></a></li><li class="section"><a href="../../developer/dotnet-2.0/handling-timeouts.html"><span>Handling timeouts</span></a></li><li class="section"><a href="../../developer/dotnet-2.0/setting-up-logging.html"><span>Setting up logging</span></a></li><li class="section"><a href="../../developer/dotnet-2.0/release-notes.html"><span>Release notes</span></a></li></ul></li></ul></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
 <h1 class="title topictitle1" id="ariaid-title1">Bulk operations</h1>

 
 <div class="body conbody"><p class="shortdesc">Bulk operations allow you to upsert or get a set of keys in parallel.</p>

  <p class="p"> The <samp class="ph codeph">IBucket</samp> interface provides two methods (with many overloads) for updating
			and retrieving documents based upon a range of IDs or keys. Internally the client
			processes these keys in parallel taking advantage of the computer architecture of the
			application server and fully utilizing the resources that are available. </p>

  <p class="p">These methods are configurable through the overloads that take a <samp class="ph codeph"><a class="xref" href="http://msdn.microsoft.com/en-us/library/system.threading.tasks.paralleloptions%28v=vs.110%29.aspx" target="_blank">ParallelOptions</a></samp> object and the
    <samp class="ph codeph">range</samp> parameters. Through these parameters you can specify the
    <samp class="ph codeph">MaxDegreeOfParallism</samp>, an optional <samp class="ph codeph"><a class="xref" href="http://msdn.microsoft.com/en-us/library/system.threading.cancellationtoken%28v=vs.110%29.aspx" target="_blank">CancellationToken</a></samp>, and the size of the
   partition you want to be processed per iteration. The overload that does not supply these uses
   the defaults handled internally by the .NET framework.</p>

  <section class="section" id="concept_emk_nhq_44__upsert"><h2 class="title sectiontitle">Upsert</h2>
   
  	<p class="p">Bulk upsert operations enable you to insert or replace a set of documents. The following
				example creates several documents in a <span class="keyword apiname">Dictionary</span> object and then
				inserts them all into the database by using only one <span class="keyword apiname">Upsert()</span>
				operation.</p>

   <pre class="pre codeblock language-csharp"><code>
     using (var bucket = _cluster.OpenBucket())
     {
         var items = new Dictionary&lt;string, dynamic&gt;
         {
             {"CouchbaseBucketTests.Test_Multi_Upsert.String", "string"},
             {"CouchbaseBucketTests.Test_Multi_Upsert.Json", new {Foo = "Bar", Baz = 2}},
             {"CouchbaseBucketTests.Test_Multi_Upsert.Int", 2},
             {"CouchbaseBucketTests.Test_Multi_Upsert.Number", 5.8},
             {"CouchbaseBucketTests.Test_Multi_Upsert.Binary", new[] {0x00, 0x00}}
         };

         var multiUpsert = bucket.Upsert(items);
         foreach (var item in multiUpsert)
         {
             Assert.IsTrue(item.Value.Success);
         }
     }
   </code></pre>

  </section>

  <section class="section" id="concept_emk_nhq_44__get"><h2 class="title sectiontitle">Get</h2>
   
			<p class="p">Bulk get operations enable to you retrieve a set of documents in parallel. The following
				example puts a set of keys into a <samp class="ph codeph">List</samp> object and then retrieves all of
				the corresponding documents by using only one <span class="keyword apiname">Get()</span> operation.</p>

   <pre class="pre codeblock language-csharp"><code>
    using (var bucket = _cluster.OpenBucket())
    {
        var items = new List&lt;string&gt;
        {
            "CouchbaseBucketTests.Test_Multi_Upsert.String",
            "CouchbaseBucketTests.Test_Multi_Upsert.Json",
            "CouchbaseBucketTests.Test_Multi_Upsert.Int",
            "CouchbaseBucketTests.Test_Multi_Upsert.Number",
            "CouchbaseBucketTests.Test_Multi_Upsert.Binary"
        };

        var multiGet = bucket.Get&lt;dynamic&gt;(items);
        foreach (var item in multiGet)
        {
            Assert.IsTrue(item.Value.Success);
        }
    }
   </code></pre>

  </section>

  <section class="section"><h2 class="title sectiontitle">Overloading the parallel options and partition size</h2>
   
   <p class="p">Here is an example of using one of the overloads that takes a <samp class="ph codeph"><a class="xref" href="http://msdn.microsoft.com/en-us/library/system.threading.tasks.paralleloptions%28v=vs.110%29.aspx" target="_blank">ParallelOptions</a></samp> object and
				specifies a <samp class="ph codeph">range</samp> to partition the requests into two requests per
				iteration utilizing a maximum of 2 cores:</p>

   <pre class="pre codeblock language-csharp"><code>
     using (var bucket = _cluster.OpenBucket("beer-sample"))
     {
         var query = bucket.CreateQuery("beer", "brewery_beers");
         var results = bucket.Query&lt;dynamic&gt;(query);

         var keys = results.
             Rows.
             ConvertAll(x =&gt; x.id.Value).
             Cast&lt;string&gt;();

         var multiget = bucket.Get&lt;dynamic&gt;(keys.ToList(), new ParallelOptions
         {
             MaxDegreeOfParallelism = 2
         },
         2);
         Assert.AreEqual(results.TotalRows, multiget.Count);
     }
   </code></pre>

   <p class="p">Note that this is a contrived example and you should use benchmarking and trial and error to
				determine the optimal parallel setting for your particular environment and use case.</p>

  </section>

 </div>

<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../developer/dotnet-2.0/documents.html" title="Couchbase Server is a document database at its core. Keys and values are stored as JSON documents if they are in fact valid JSON; otherwise, they are stored as binary blobs.">Working with documents</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../developer/dotnet-2.0/deleting.html" title="Documents are deleted by unique-identifier (Id) or by passing the document to be deleted into the IBucket.Remove(..) method">Deleting documents</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../developer/dotnet-2.0/atomic-operations.html" title="Besides the basic CRUD operations such as Insert(), Replace() and Remove(), the Couchbase SDK also supports atomic operations on a document.">Atomic operations</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>