<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Working with view queries — Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../../developer/java-2.1/java-intro.html"><span>Java SDK 2.1</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/java-2.0/java-intro.html"><span>Java SDK 2.0</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dotnet-2.1/dotnet-intro.html"><span>.NET SDK 2.1</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dotnet-2.0/dotnet-intro.html"><span>.NET SDK 2.0</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/dotnet-2.0/overview.html"><span>Overview</span></a></li><li class="section"><a href="../../developer/dotnet-2.0/download-links.html"><span>Download and API Reference</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dotnet-2.0/getting-started.html"><span>Getting started</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dotnet-2.0/managing-connections.html"><span>Managing server connections </span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dotnet-2.0/documents.html"><span>Working with documents</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dotnet-2.0/querying.html"><span>Querying buckets</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/dotnet-2.0/view-queries.html" class="current"><span>Working with view queries</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../../developer/dotnet-2.0/n1ql-queries.html"><span>Working with N1QL queries</span></a></li></ul></li><li class="section"><a href="../../developer/dotnet-2.0/handling-timeouts.html"><span>Handling timeouts</span></a></li><li class="section"><a href="../../developer/dotnet-2.0/setting-up-logging.html"><span>Setting up logging</span></a></li><li class="section"><a href="../../developer/dotnet-2.0/release-notes.html"><span>Release notes</span></a></li></ul></li></ul></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
  <h1 class="title topictitle1" id="ariaid-title1">Working with view queries</h1>

 
 <div class="body conbody"><p class="shortdesc">You can use MapReduce views to create queryable secondary and composite indexes in Couchbase Server. </p>

   <p class="p">The Couchbase .NET SDK offers access to all features of the Couchbase View API. Note that before working with the API, a design document and View must exist on the Couchbase Server you are targeting.</p>

   <p class="p">For these examples, we will use the design documents and views that come with the
				<samp class="ph codeph">beer-sample</samp> sample bucket that can be installed directly from the
			Couchbase Management Console. To install the sample buiket, navigate to the console, log
			in, and click the <span class="ph uicontrol">Settings</span> tab. After you have done this, click
				<span class="ph uicontrol">Sample Buckets</span>. Under <span class="ph uicontrol">Available Samples</span>,
			select the <span class="ph uicontrol">beer-sample</span> check box. Then click
				<span class="ph uicontrol">Create</span>.</p>

   <p class="p"><img class="image" id="concept_tvx_nhq_44__image_tj3_r4d_3p" src="images/installing-beer-sample.png"></p>

   <p class="p">After you have the <samp class="ph codeph">beer-sample</samp> sample data and bucket installed, you can run
			some queries. The <samp class="ph codeph">beer-sample</samp> comes with a design document called
				<samp class="ph codeph">beer</samp> and some views defined: <samp class="ph codeph">brewery_beers</samp>,
				<samp class="ph codeph">by_country</samp>, and <samp class="ph codeph">by_location</samp>. We use these in the next
			several examples.</p>

   <p class="p">First a very simple query that fetches the results of the <samp class="ph codeph">brewery_beers</samp> view. The view definition looks like this:</p>

   <div style="margin-bottom: 0;"><strong>brewery_beers view</strong></div><pre class="pre codeblock language-javascript"><code>
function(doc, meta) {
	switch (doc.type) {
		case "brewery":
			emit([meta.id]);
			break;
		case "beer":
			if (doc.brewery_id) {
				emit([doc.brewery_id, meta.id]);
			}
			break;
	}
}
</code></pre>

   <p class="p">What this does is create secondary indexes for every document with a type of
				<samp class="ph codeph">brewery</samp> and a composite index for every document of type
				<samp class="ph codeph">beer</samp>. When this map function runs, it returns a list of all of these
			keys. Here is an example of querying this view using the Couchbase .NET SDK: </p>

   <pre class="pre codeblock language-csharp"><code>
 var query = bucket.CreateQuery("beer", "brewery_beers”, false).
     Limit(5);

 var result = bucket.Query&lt;dynamic&gt;(query);
 foreach (var row in result.Rows)
 {
    Console.WriteLine(row);
 }
   </code></pre>

   <p class="p">First, an <samp class="ph codeph">IViewQuery</samp> object is created by calling the factory method
				<span class="keyword apiname">IBucket.CreateQuery()</span> and passing in <samp class="ph codeph">false</samp> to
			indicate that we want to target a production view. Then we specify the design document to
			use, the view on the design document that we want to query, and the limit on the number of
			rows to return. We then use the <span class="keyword apiname">IBucket.Query()</span> method to execute the
			query and then iterate through the results.</p>

   <p class="p"><samp class="ph codeph">IViewQuery</samp> is a fluent interface that allows a series of methods to be
			chained together. Internally, it’s creating the HTTP request URL that will be sent the
			server and executed. Besides the methods defined in the query above, which are the minimal
			set of methods you must call to make a query, there are several others. The following table
			lists select <samp class="ph codeph">IViewQuery</samp> methods. For a complete list of
				<samp class="ph codeph">IViewQuery</samp> methods, the parameters they take and their return types,
			refer to the API Reference.</p>

   
        
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="concept_tvx_nhq_44__table_e5b_rpd_3p" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap">Table 1. Selected<samp class="ph codeph">IVQuery</samp> methods</span></caption>
          <col style="width:21.50537634408602%">
          <col style="width:78.49462365591397%">
            <thead class="thead" style="text-align:left;">
              <tr class="row">
                <th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d160945e131">Name</th>

                <th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d160945e134">Description</th>

              </tr>

            </thead>

            <tbody class="tbody">
            
            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e131 "><samp class="ph codeph">From</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e134 ">Specify the bucket and the design document to query</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e131 "><samp class="ph codeph">Bucket</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e134 ">Specify the bucket to query</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e131 "><samp class="ph codeph">DesignDoc</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e134 ">Specify the design document to query</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e131 "><samp class="ph codeph">View</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e134 ">Specify the view to query</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e131 "><samp class="ph codeph">Skip</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e134 ">The number of records to skip</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e131 "><samp class="ph codeph">Stale</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e134 ">Whether or not to return stale data or force an index:
								<samp class="ph codeph">StaleMode.False</samp> | <samp class="ph codeph">Ok</samp> |
								<samp class="ph codeph">UpdateAfter</samp></td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e131 "><samp class="ph codeph">Asc</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e134 ">Sort in ascending order by key</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e131 "><samp class="ph codeph">Desc</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e134 ">Sort in descending order by key</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e131 "><samp class="ph codeph">Group</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e134 ">Groups the results from the reduce function into a single row</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e131 "><samp class="ph codeph">GroupLevel</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e134 ">Specify the level of grouping to use</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e131 "><samp class="ph codeph">Limit</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e134 ">The maximum number of rows to return</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e131 "><samp class="ph codeph">Reduce</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e134 ">True to use the reduce method</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e131 "><samp class="ph codeph">ConnectionTimeout</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e134 ">The number of seconds to wait before timing out a request</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e131 "><samp class="ph codeph">RawUri</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e134 ">Returns the internally created HTTP request URL</td>

            </tr>

          </tbody>

        </table>
</div>

     
      
   <p class="p">The <span class="keyword apiname">IBucket.Query()</span> method returns an object implementing the
				<samp class="ph codeph">IViewResult&lt;T&gt;</samp> interface. The following table lists some of the
			members of the <samp class="ph codeph">IViewResult&lt;T&gt;</samp> interface.</p>

   <div class="p">
        
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="concept_tvx_nhq_44__table_mnb_gqd_3p" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap">Table 2. Selected <samp class="ph codeph">IViewResult&lt;T&gt;</samp> interface methods</span></caption>
          <col style="width:22.522522522522525%">
          <col style="width:77.47747747747749%">
          <thead class="thead" style="text-align:left;">
            <tr class="row">
              <th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d160945e327">Name</th>

              <th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d160945e330">Description</th>

            </tr>

          </thead>

          <tbody class="tbody">
            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e327 "><samp class="ph codeph">Error</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e330 ">The error message returned by the View engine</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e327 "><samp class="ph codeph">Message</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e330 ">If the query failed as the result of a server error, a message indicating the
                reason why</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e327 "><samp class="ph codeph">Rows</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e330 ">A List&lt;T&gt; of T, which is the result of the query</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e327 "><samp class="ph codeph">Success</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e330 ">true if the query completed successfully</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e327 "><samp class="ph codeph">StatusCode</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e330 ">The HTTP status code returned by the server</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e327 "><samp class="ph codeph">TotalRows</samp></td>

              <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d160945e330 ">The total rows available; may not match the exact rows returned if Limit is
                called.</td>

            </tr>

          </tbody>

        </table>
</div>

      </div>

   <p class="p">You can iterate over the <samp class="ph codeph">Rows</samp> property if the query was successful or check
			the <samp class="ph codeph">Message</samp> and <samp class="ph codeph">Error</samp> properties if
				<samp class="ph codeph">Success</samp> returns false to determine the reason why the query failed. </p>

 </div>

<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../developer/dotnet-2.0/querying.html" title="Besides the document and atomic operations, Couchbase supports other ways of querying your data: views and N1QL.">Querying buckets</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../developer/dotnet-2.0/n1ql-queries.html" title="Pronounced “nickel”, N1Ql is Couchbase’s next generation language for querying JSON documents. Similar in syntax to traditional SQL found in all relational databases, N1QL is an extended non-first normal form variation that allows you to query nested structures commonly found within the document domain. SDK support for N1QL can be found at these levels: low-level support for ad hoc N1QL queries and at a higher-level abstraction as a Language-Integrated Query (LINQ) provider (currently in development).">Working with N1QL queries</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>