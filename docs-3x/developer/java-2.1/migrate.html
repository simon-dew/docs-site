<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Migrating from Java SDK 1.4.x to 2.x â€” Couchbase Server 3.0/3.1</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../../assets/stylesheets/application.css"><link rel="stylesheet" href="../../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation">
	<!-- Google Tag Manager -->
				<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MVPNN2"
					height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
				<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
					new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
					j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
					'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
					})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
				<!-- End Google Tag Manager -->
				<header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server 3.0/3.1</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/index.html">Documentation Home</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/nosql-databases/downloads">Downloads</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../../admin/Couchbase-intro.html"><span>Introduction</span></a></li><li class="section"><a href="../../admin/Whats-new-3.0.html"><span>What's new in 3.0</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/install-intro.html"><span>Installation and upgrade</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/admin-intro.html"><span>Administration</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../../admin/rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li><li class="section"><a href="../../admin/pdfs.html"><span>PDFs</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/intro.html"><span>Overview</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dev-guide-3.0/concepts.html"><span>Developing applications</span></a></li><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/dev-guide-3.0/old-versions.html"><span>Older SDK versions</span></a><ul class="sub-sections"><li class="section section--has-sub-sections&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;section--active"><a href="../../developer/java-2.1/java-intro.html"><span>Java SDK 2.1</span></a><ul class="sub-sections"><li class="section"><a href="../../developer/java-2.1/overview.html"><span>Overview</span></a></li><li class="section"><a href="../../developer/java-2.1/download-links.html"><span>Download and API Reference</span></a></li><li class="section"><a href="../../developer/java-2.1/migrate.html" class="current"><span>Migrating from Java SDK 1.4.x to 2.x</span></a><ul class="sub-sections"></ul></li><li class="section section--has-sub-sections"><a href="../../developer/java-2.1/getting-started.html"><span>Getting started with the Java SDK</span></a></li><li class="section"><a href="../../developer/java-2.1/managing-connections.html"><span>Managing connections</span></a></li><li class="section"><a href="../../developer/java-2.1/env-config.html"><span>Configuring the environment</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/java-2.1/documents.html"><span>Working with documents</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/java-2.1/querying.html"><span>Querying buckets</span></a></li><li class="section"><a href="../../developer/java-2.1/observables.html"><span>Mastering observables</span></a></li><li class="section"><a href="../../developer/java-2.1/logging.html"><span>Setting up logging</span></a></li><li class="section"><a href="../../developer/java-2.1/release-notes.html"><span>Release notes</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../../developer/java-2.0/java-intro.html"><span>Java SDK 2.0</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dotnet-2.1/dotnet-intro.html"><span>.NET SDK 2.1</span></a></li><li class="section section--has-sub-sections"><a href="../../developer/dotnet-2.0/dotnet-intro.html"><span>.NET SDK 2.0</span></a></li></ul></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
	<h1 class="title topictitle1" id="ariaid-title1">Migrating from Java SDK 1.4.x to 2.x</h1>

	
	<div class="body conbody"><p class="shortdesc">Couchbase recommends that you migrate to the Java 2.x SDK to take advantage of
		enhancements to the SDK as well as new features available in Couchbase Server. The 2.x Java
		SDK is based on the reactive programming model and has a completely different architecture
		that uses a core I/O layer and a Java client layer. It's asynchronous by design and offers
		performance, scalability, and durability enhancements.  </p>

		<p class="p">This guide helps you migrate from the previous generation of the Java SDK (version
				<samp class="ph codeph">1.4.x</samp>) to this new generation SDK (version <samp class="ph codeph">2.x</samp>).</p>

		<p class="p">If you plan on using the synchronous blocking API, you can follow the simple migration
			path. Or, you can follow the optional migration path to fully reactive and asynchronous
			code by using the asynchronous API, which provides the best performance.</p>


		<p class="p">To get the full benefit of using the asynchronous code with this new generation SDK, you need
			to understand how to build asynchronous yet expressive code by leveraging the
				<samp class="ph codeph">Observable</samp> paradigm. To learn more about using observables, see
				<a class="xref" href="observables.html" title="This guide helps you getting up to speed with asynchronous programming and Observable objects in particular. This guide is not tied to the Java SDK exclusively and aims to give you a general understanding of how to build full-stack, asynchronous applications.">Mastering observables</a>.</p>


		<section class="section"><h2 class="title sectiontitle">Getting Started</h2>
			

			<p class="p">The 2.x generation of the Java SDK is a complete rewrite of the 1.x SDK. It is layered
				into <samp class="ph codeph">core-io</samp> and <samp class="ph codeph">java-client</samp> pieces. The
					<samp class="ph codeph">java-client</samp> layer is more abstract and closer to the client. The
					<samp class="ph codeph">core-io</samp> layer is purely asynchronous and message-oriented. It makes
				use of a reactive architecture based on <a class="xref" href="http://netty.io" target="_blank">Netty</a>, the <a class="xref" href="https://github.com/LMAX-Exchange/disruptor/wiki" target="_blank">LMAX Disruptor</a>, and most importantly <a class="xref" href="https://github.com/ReactiveX/RxJava" target="_blank">RxJava</a>.</p>


			<div class="note important"><span class="importanttitle">Important:</span>  The <samp class="ph codeph">core-io</samp> layer is not intended for broad
				consumption. In general, you should focus on using the <samp class="ph codeph">java-client</samp>
				layer in your application. However, for advanced use cases (such as squeezing out the
				very last drop of performance by working with the raw byte stream or building a client
				layer in another language), you can use the <samp class="ph codeph">core-io</samp> layer. </div>


			<p class="p">The client exposes the server-side concepts of a <samp class="ph codeph">Cluster</samp> and
					<samp class="ph codeph">Bucket</samp>s as first-class citizens that replace the previous
					<samp class="ph codeph">CouchbaseClient</samp> class. Each class exposes a <strong class="ph b">synchronous</strong> API
				by default, but an <strong class="ph b">asynchronous</strong> API (based on RxJava <samp class="ph codeph">Observable</samp>
				objects) can be accessed simply by calling <samp class="ph codeph">async()</samp> on either one.</p>


			<p class="p">This split also allows for much more efficient resource utilization. In the past, each
					<samp class="ph codeph">CouchbaseClient</samp> (for each bucket) had its own resources, but
				now they are as shared as much as possible, and the <samp class="ph codeph">Cluster</samp> and
					<samp class="ph codeph">Bucket</samp> references can always be reused.</p>


			<p class="p">To differentiate this rewrite from the previous generation, the <samp class="ph codeph">Maven</samp>
				artifact has been renamed from <samp class="ph codeph">couchbase-client</samp> to
					<samp class="ph codeph">java-client</samp>. It has minimal transitive dependencies (by embedding a
				few internal dependencies like Netty), most essentially RxJava 1.x:</p>


			<pre class="pre codeblock language-xml"><code>&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.couchbase.client&lt;/groupId&gt;
        &lt;artifactId&gt;java-client&lt;/artifactId&gt;
        &lt;version&gt;2.1.6&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>


			<div class="p">
				<div class="note important"><span class="importanttitle">Important:</span> After you've fully migrated, make sure that old dependencies to
						<samp class="ph codeph">couchbase-client</samp> or dependencies introduced in your POM because
					of the <samp class="ph codeph">couchbase-client</samp> have been removed.</div>

			</div>



			<p class="p">You'll most probably want the SDK to perform some logging, which can easily be activated
				by adding a logging framework such as <a class="xref" href="http://logging.apache.org/log4j/2.x/" target="_blank">log4j</a> to your dependencies. For more
				information about configuring logging, see <a class="xref" href="logging.html" title="The Couchbase Java SDK has no hard dependency on a specific logger implementation. It tries to find a logger on the class path and uses that logger if it is supported by the SDK. If no logger implementation is found, the standard JDK logger is used.">Setting up logging</a>.</p>


		</section>


		<section class="section"><h2 class="title sectiontitle">Initializing the connection</h2>
			
			<p class="p">The<samp class="ph codeph"> CouchbaseClient</samp> is replaced by the <samp class="ph codeph">Cluster</samp> and
					<samp class="ph codeph">Bucket</samp> classes, bringing real-world concepts of Couchbase into
				the SDK as first-class citizens. For more information about using these classes, see
					<a class="xref" href="managing-connections.html" title="This section covers the different approaches to connecting and disconnecting, as well as how to configure encryption.">Managing connections</a>. </p>

			<p class="p">Compared to the 1.4.x SDK, when providing a list of nodes from which to bootstrap, you only
				need host names or IP addresses in <samp class="ph codeph">String</samp> form. No need for the URI
				anymore, and no need for the port and pools path either: </p>

			<pre class="pre codeblock language-java"><code>Cluster cluster = CouchbaseCluster.create("192.168.0.1");</code></pre>

			<p class="p">The SDK uses the factory method pattern to create the Cluster object. This pattern is
				heavily used throughout the SDK in place of constructors.</p>


			<p class="p">The <samp class="ph codeph">Cluster</samp> and each <samp class="ph codeph">Bucket</samp> reference must be reused as much
				as possible. Make them singletons, which can be used by multiple threads safely. Here's
				an example that uses a naive helper approach: </p>


			<pre class="pre codeblock language-java"><code>public class CouchbaseHelper {

    //the IPs / hostnames would be obtained from configuration file
    private static final List&lt;String&gt; SEED_IPS = Arrays.asList("192.168.0.1", "192.168.0.2");

    public static final Cluster CLUSTER = CouchbaseCluster.create(SEED_IPS);

    public static final Bucket EXAMPLEBUCKET = CLUSTER.openBucket("example", "p4ssW0rd");
}
            </code></pre>


			<p class="p">You can customize the connection to the <samp class="ph codeph">Cluster</samp> via the
					<samp class="ph codeph">CouchbaseEnvironment</samp> interface (see <a class="xref" href="env-config.html" title="The CouchbaseEnvironment class enables you to configure Java SDK options for bootstrapping, timeouts, reliability, and performance.">Configuring the environment</a>
				for more details): </p>


			<pre class="pre codeblock language-java"><code>public class CouchbaseHelper {

    //the IPs / hostnames would be obtained from configuration file
    private static final List&lt;String&gt; SEED_IPS = Arrays.asList("192.168.0.1", "192.168.0.2");

    //the environment configuration
    private static final CouchbaseEnvironment ENV = DefaultCouchbaseEnvironment.builder()
        .connectTimeout(8000)
        .keepAliveInterval(3600 * 1000)
    .build();

    public static final Cluster CLUSTER = CouchbaseCluster.create(ENV, SEED_IPS);

    public static final Bucket EXAMPLEBUCKET = CLUSTER.openBucket("example", "p4ssW0rd");
}
            </code></pre>

		</section>


		<section class="section"><h2 class="title sectiontitle">Working With Data</h2>
			
			<p class="p">In the new SDK, a new model of data within Couchbase has been introduced: the
					<samp class="ph codeph">Document</samp> class. It encapsulates both the content itself and the
				metadata ( <samp class="ph codeph">id</samp>, <samp class="ph codeph">expiry</samp> and <samp class="ph codeph">cas</samp>
				information). See <a class="xref" href="documents.html" title="The Java SDK offers methods you can use to accomplish the basic CRUD operations of creating, retrieving, updating, and deleting documents.">Working with documents</a> for additional information. </p>

			<p class="p">The SDK has several implementations of <samp class="ph codeph">Document</samp>. By default, most SDK methods
				assume the content is JSON and return a <samp class="ph codeph">JsonDocument</samp>. This kind of
				document uses standardized storing flags that make it compatible with the other
				second generation SDKs in other languages. If you already deal with JSON transcoding
				to domain objects, use the <samp class="ph codeph">RawJsonDocument</samp> instead, which exposes
				the JSON String as content instead of a superfluous <samp class="ph codeph">JsonObject</samp>. </p>

			<div class="note note"><span class="notetitle">Note:</span> To interact with documents stored by an older Java SDK, use the
					<samp class="ph codeph">LegacyDocument</samp> class, which provides 1:1 compatibility with the 1.4
				SDK (but think about migrating to a new implementation after backward compatibility
				isn't required anymore). </div>

			<p class="p">Concerning optimistic lockingâ€”because the CAS is now part of the
					<samp class="ph codeph">Document</samp>, the SDK picks it up if it is non-zero during mutating
				operations. To learn more about mutating operations, see <a class="xref" href="documents-updating.html" title="Describes updating documents by using the replace() or upsert() methods.">Updating documents</a>. </p>

		</section>


		<section class="section"><h2 class="title sectiontitle">Working Asynchronously</h2>
			
			<p class="p"> In the 2.x SDK, asynchronous processing is done via RxJava. The asynchronous API is not
				mixed with the synchronous API, but rather accessible via the <samp class="ph codeph">async()</samp>
				method on <samp class="ph codeph">Cluster</samp> and <samp class="ph codeph">Bucket</samp>. </p>


			<p class="p">The SDK is thread-safe and uses a pool of threads internally for operations (so they are
				effectively processed in a separate thread). Additionally, some Rx operators use one of
				the <samp class="ph codeph">Schedulers</samp> provided by RxJava (meaning it could execute into
				another thread). </p>


			<p class="p">The SDK doesn't use <samp class="ph codeph">Future</samp> objects anymore. For progressive migration
				purposes, you can convert an <samp class="ph codeph">Observable</samp> into a <samp class="ph codeph">Future</samp>
				and vice-versa. Here's an example of how to do that:</p>

			<pre class="pre codeblock language-java"><code>//converting these to/from Future
Observable&lt;String&gt; myStringObservable;
Future&lt;String&gt; myStringFuture;

//this expects exactly one item emitted
Future&lt;String&gt; f = myStringObservable.toBlocking().toFuture();

//when several items expected, use a List
Future&lt;List&lt;String&gt;&gt; f = myStringObservable.toList().toBlocking().toFuture();

//convert back from a Future&lt;String&gt;
Observable&lt;String&gt; o = Observable.from(myStringFuture);
                </code></pre>




		</section>


	</div>

<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../../developer/java-2.1/java-intro.html" title="The Couchbase Java SDK provides synchronous and asynchronous (reactive) interfaces that allow your applications to efficiently interact with a Couchbase Server cluster. It provides capabilities to store, update, and retrieve documents in the database and query the database by using N1QL.">Java SDK 2.1</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../../developer/java-2.1/download-links.html" title="The Java SDK is available on Maven Central or by downloading it as an archive. A Javadoc API reference is also available online.">Download and API Reference</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../../developer/java-2.1/getting-started.html" title="This guide provides a foundational introduction to the Couchbase Java SDK. It shows you how to install the SDK and write a basic sample application that highlights important aspects. After you install the SDK, you can start exploring it on your own or proceed with a tutorial to build a complete, production-grade application.">Getting started with the Java SDK</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">Â© 2011â€“2015 <b class="company-name">Couchbase</b>. All rights reserved.</span><a href="http://support.couchbase.com/">Customer Login</a><a href="http://www.couchbase.com/terms-of-service">Terms of Service</a><a href="http://www.couchbase.com/privacy-policy">Privacy Policy</a></p></footer></div></main><script src="../../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../../';</script><script src="../../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>