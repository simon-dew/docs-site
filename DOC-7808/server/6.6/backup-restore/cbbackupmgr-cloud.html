<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>cbbackupmgr cloud | Couchbase Docs (Staging)</title>
<link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-7808/server/6.6/backup-restore/cbbackupmgr-cloud.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">
<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="6.6">
<meta name="generator" content="Antora 2.3.0">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://simon-dew.github.io/docs-site/DOC-7808/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <form class="navbar-item search">
                  <input type="text" placeholder="Search Docs" class="query" id="search-query" />
                  <button type="button" class="search-btn">
                    <i class="fas fa-search"></i>
                  </button>
                </form>
                <a class="btn btn-primary try-btn" href="https://www.couchbase.com/downloads">
                  Downloads
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<nav class="nav">
</nav>
<aside class="toc sidebar">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/simondew/GitHub/couchbase/backup/docs/modules/backup-restore/pages/cbbackupmgr-cloud.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../index.html">server</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">cbbackupmgr cloud</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Storing cbbackupmgr archive directly in the cloud</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="description"><a class="anchor" href="#description"></a>DESCRIPTION</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document should give you a basic understanding of how to manage cbbackupmgr
archives directly in S3.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tutorial"><a class="anchor" href="#tutorial"></a>TUTORIAL</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="credentials"><a class="anchor" href="#credentials"></a>CREDENTIALS</h3>
<div class="paragraph">
<p>Backing up directly to an external cloud provider will mean that we require
permissions to access the given data store. Each provider has its own way
of authentication; see the sections below on how to authenticate for your
chosen cloud provider.</p>
</div>
<div class="sect3">
<h4 id="aws"><a class="anchor" href="#aws"></a>AWS</h4>
<div class="paragraph">
<p>When using AWS S3, there are multiple different ways that you can supply
credentials to authorize yourself to AWS S3. Below is a list of the
supported techniques:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Providing a set of environment variables including:</p>
<div class="ulist">
<ul>
<li>
<p>AWS_REGION</p>
</li>
<li>
<p>AWS_ACCESS_KEY_ID</p>
</li>
<li>
<p>AWS_SECRET_ACCESS_KEY</p>
</li>
</ul>
</div>
</li>
<li>
<p>Loading credentials from the shared config files located at:</p>
<div class="ulist">
<ul>
<li>
<p>$HOME/.aws/config</p>
</li>
<li>
<p>$HOME/.aws/credentials</p>
</li>
</ul>
</div>
</li>
<li>
<p>Providing static config/credentials using the cli flags:</p>
<div class="ulist">
<ul>
<li>
<p><code>--obj-access-key-id</code></p>
</li>
<li>
<p><code>--obj-region</code></p>
</li>
<li>
<p><code>--obj-secret-access-key</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Setting up cbbackupmgr to interact with AWS should be a very similar process to
setting up the <code>aws-cli</code>. The steps to configure the <code>aws-cli</code> can be found at
<a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html#cli-quick-configuration" class="bare">https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html#cli-quick-configuration</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-cloud-backups"><a class="anchor" href="#configuring-cloud-backups"></a>Configuring cloud backups</h3>
<div class="paragraph">
<p>The first step is to create a backup archive in object store. This can be done with
the <code>config</code> command and only needs to be done once. All other commands will
automatically download the archive meta data in the directory provided via the <code>obj-staging-dir</code>
argument prior to performing any operations; this is done regardless of whether the archive
exists locally because we must ensure the archive in the staging directory is up to date.
Below is an example of how you would configure and archive in AWS S3.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr config -a s3://bucket/archive -r repo --obj-staging-dir /mnt/staging</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Backup repository `repo` created successfully in archive `s3://bucket/archive`</pre>
</div>
</div>
<div class="paragraph">
<p>Assuming your credentials are correct, the archive should now reside directly in the
provided S3 bucket. To verify, you could use the <code>aws-cli</code> to list the contents off the
bucket and they should be identical to that which would exist for a local backup.</p>
</div>
<div class="paragraph">
<p>Although it&#8217;s possible to have cbbackupmgr coexist in the same S3 bucket as other general
purpose storage, we recommend using a bucket which cbbackupmgr has exclusive access too.</p>
</div>
</div>
<div class="sect2">
<h3 id="backing-up-a-cluster"><a class="anchor" href="#backing-up-a-cluster"></a>Backing up a cluster</h3>
<div class="paragraph">
<p>Once an archive is configured performing a backup works in a similar fashion than local
backup. It&#8217;s important to note that when backing up directly to S3 a certain amount of disk
space will be used to stage local meta data files. See OBJECT STORE STAGING DIRECTORY in
<a href="cbbackupmgr-config.html" class="page">cbbackupmgr-config</a> for more information. Below is an example of doing a backup and
storing directly in AWS S3.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr backup -a s3://bucket/archive -r repo --obj-staging-dir /mnt/staging \
  -c http://10.101.101.112:8091 -u Administrator -p password</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Copied all data in 1m2.525397237s (Avg. 51.61KB/Sec)      7303 items / 3.12MB
beer-sample             [===========================================] 100.00%</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Backup successfully completed
Backed up bucket "beer-sample" succeeded
Mutations backedup; 7303, Mutations failed to backup: 0
Deletions backedup: 0, Deletions failed to backup: 0</pre>
</div>
</div>
<div class="paragraph">
<p>Performing incremental backups works exactly as it would if you were performing an incremental
locally; simply rerun the command above and an incremental backup would be created.</p>
</div>
<div class="paragraph">
<p>When choosing the amount of threads to use it&#8217;s important to consider that when backing up to the
cloud, cbbackupmgr buffers data in memory before uploading it. This means that choosing an extremely
large amount of threads when using a poor internet connection could lead to a scenario where your
machine runs out of memory.</p>
</div>
<div class="paragraph">
<p>To learn more about backup options see <a href="cbbackupmgr-backup.html" class="page">cbbackupmgr-backup</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="restoring-a-backup-multiple-incremental-backups"><a class="anchor" href="#restoring-a-backup-multiple-incremental-backups"></a>Restoring a backup / multiple incremental backups</h3>
<div class="paragraph">
<p>Once you have created a backup, restoring it works in a similar way to restoring a local
backup. It&#8217;s worth noting that restoring a backup to a cluster that&#8217;s hosted outside of AWS
is likely to be significantly more expensive than performing a backup (depending on the size of
your dataset). See Costing for more information.</p>
</div>
<div class="paragraph">
<p>Below is an example of restoring a backup that is store in AWS S3.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr restore -a s3://bucket/archive -r repo --obj-staging-dir /mnt/staging \
  -c http://10.101.101.112:8091 -u Administrator -p password</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>(1/1) Restoring backup 2020-03-19T15_35_00.467487218Z
Copied all data in 28.048019272s (Avg. 103.21KB/Sec)     7303 items / 2.82MB
beer-sample             [==========================================] 100.00%</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Restore bucket 'beer-sample' succeeded
Mutations restored: 7303, Mutations failed to restore: 0
Deletions restored: 0, Deletions failed to restore: 0
Skipped due to purge number or conflict resolution: Mutations: 0 Deletions: 0
Restore completed successfully</pre>
</div>
</div>
<div class="sect3">
<h4 id="disk-requirements"><a class="anchor" href="#disk-requirements"></a>Disk Requirements</h4>
<div class="paragraph">
<p>As discussed in OBJECT STORE STAGING DIRECTORY you will be required to provision enough disk
space to store a portion of your overall dataset locally. We recommend that you provision at
least 50GB of disk space or about 10% of you overall dataset as reported by the info.</p>
</div>
</div>
<div class="sect3">
<h4 id="costing"><a class="anchor" href="#costing"></a>Costing</h4>
<div class="paragraph">
<p>Before using the backup/restore/examine sub-commands it&#8217;s worth ensuring that you understand
the costing as related to AWS S3. We recommend that you calculate how much it will cost to
upload/download you dataset using the AWS S3 calculator at <a href="https://calculator.s3.amazonaws.com/index.html" class="bare">https://calculator.s3.amazonaws.com/index.html</a>.</p>
</div>
<div class="sect4">
<h5 id="backup"><a class="anchor" href="#backup"></a>Backup</h5>
<div class="paragraph">
<p>Backing up data from outside/inside AWS S3 is cheap; this is because at the time of writing,
it doesn&#8217;t cost anything to transfer data into S3 (you only pay for the storage/requests).</p>
</div>
</div>
<div class="sect4">
<h5 id="restore"><a class="anchor" href="#restore"></a>Restore</h5>
<div class="paragraph">
<p>Restoring data is another matter, AWS S3 charges users for pulling data from AWS onto the
internet. This means that restoring large datasets can become quite costly if you cluster
is not in AWS. Before performing a restore, use info (as described below in Interrogating
backups) to determine the size of your backup. You can then use this to determine how much
it will cost to restore your backup.</p>
</div>
<div class="paragraph">
<p>At the time of writing, restoring a backup to a cluster stored inside AWS S3 will not be
significantly costly since AWS do not charge for the bandwidth inside AWS. No matter
whether your cluster is hosted in/outside AWS it&#8217;s worth calculating the costs before
performing a restore.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="merging"><a class="anchor" href="#merging"></a>Merging</h3>
<div class="paragraph">
<p>One of the main reasons for merging incremental backups is to save disk space. In AWS S3
space is cheap and bandwidth (to the broader internet) is expensive. This means that there
isn&#8217;t a financial viable reason for merging cloud backups. For this reason merging incremental
backups stored in the cloud will not be supported.</p>
</div>
<div class="paragraph">
<p>Restoring will continue to support applying incremental backups in chronological order in the
same fashion that it&#8217;s would when merging e.g. you will end up with the same data in your
Couchbase cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="interrogating-backups"><a class="anchor" href="#interrogating-backups"></a>Interrogating backups</h3>
<div class="paragraph">
<p>Several tools have been made available for use with archives stored directly in the
cloud, currently these are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>examine <a href="cbbackupmgr-examine.html" class="page">cbbackupmgr-examine</a></p>
</li>
<li>
<p>info <a href="cbbackupmgr-info.html" class="page">cbbackupmgr-info</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="examine"><a class="anchor" href="#examine"></a>Examine</h4>
<div class="paragraph">
<p>Examine can be used to query whether a document with the given key exists in
the given bucket (possibly across multiple backups). The examine subcommand supports
directly querying the data in S3.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr examine -a s3://bucket/archive -r repo --obj-staging-dir /mnt/staging \
  --bucket beer-sample --key '21st_amendment_brewery_cafe'</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Key: 21st_amendment_brewery_cafe
SeqNo: 5
Backup: 2020-01-08T17_21_20.232087665Z
Deleted: false
Size: 27B (key), 29B (meta), 666B (value)
Meta: {"flags":33554432,"cas":1578502228728479744,"revseqno":1,"datatype":1}
Value: {"address":["563 Second Street"],"city":"San Francisco","code":"94107","country":"United States","description":"The 21st Amendment Brewery offers a variety of award winning house made brews and American grilled cuisine in a comfortable loft like setting. Join us before and after Giants baseball games in our outdoor beer garden. A great location for functions and parties in our semi-private Brewers Loft. See you soon at the 21A!","geo":{"accuracy":"ROOFTOP","lat":37.7825,"lon":-122.393},"name":"21st Amendment Brewery Cafe","phone":"1-415-369-0900","state":"California","type":"brewery","updated":"2010-10-24 13:54:07","website":"http://www.21st-amendment.com/"}</pre>
</div>
</div>
<div class="paragraph">
<p>To learn more about examine options see <a href="cbbackupmgr-examine.html" class="page">cbbackupmgr-examine</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="info"><a class="anchor" href="#info"></a>Info</h4>
<div class="paragraph">
<p>The info command can be used to query a broader archive to understand its structure and to gain
an understanding of what data is backed up and where.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr info -a s3://bucket/archive -r repo --obj-staging-dir /mnt/staging</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Name  | Size  | # Backups  |
rift  | 796B  | 1          |</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>+  Backup                          | Size  | Type  | Source                  | Range  | Events  | Aliases  | Complete  |
+  2020-01-08T17_21_20.232087665Z  | 796B  | FULL  | http://172.20.1.1:8091  | N/A    | 0       | 0        | true      |</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>-    Bucket       | Size  | Items  | Mutations  | Tombstones  | Views  | FTS  | Indexes  | CBAS  |
-    beer-sample  | 790B  | 7303   | 7303       | 0           | 1      | 0    | 0        | 0     |</pre>
</div>
</div>
<div class="paragraph">
<p>To learn more about info options see <a href="cbbackupmgr-info.html" class="page">cbbackupmgr-info</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="list"><a class="anchor" href="#list"></a>List</h4>
<div class="paragraph">
<p>Listing backups stored in AWS will not be supported, we suggest that you use the newer
alternative <code>info</code> which will show the same information with additional detail.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="archive-locking"><a class="anchor" href="#archive-locking"></a>Archive Locking</h3>
<div class="paragraph">
<p>It&#8217;s important that only one instance of cbbackupmgr has access to the archive at a time; this is
enforced using a lockfile meaning most of the time you shouldn&#8217;t need to worry about this. However,
there are some situations where cbbackupgmr may fail to ensure exclusive access to the archive:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Another process (on another machine, or the local machine) already has an active lockfile.</p>
</li>
<li>
<p>A stale lockfile exists which belongs to a system with a different hostname.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In cases where cbbackupgmr fails to lock an archive a few simple steps can be taken:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Manually ensure that nobody else is using the archive</p>
</li>
<li>
<p>If you are certain nobody else is using the archive, locate the lockfile in S3 (it has the
format <code>lock-${UUID}.lk</code> and is stored in the top-level of the archive).</p>
</li>
<li>
<p>Remove the lockfile and try to continue using the archive with your own instance of cbbackupmgr.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It&#8217;s extremely important that you only manually remove the lockfile if you a certain that there
isn&#8217;t another instance of cbbackupgmr using the archive. Having two instances of cbbackupmgr running
against the same archive could cause data loss through overlapping key prefixes.</p>
</div>
<div class="paragraph">
<p>Below is an example of an archive which contains a lockfile from a system that crashed where the
lockfile was never cleaned up.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ aws s3 ls s3://backups --recursive
2020-04-27 09:34:10        120 archive/.backup
2020-04-27 09:34:23         34 archive/lock-14eb923b-60a7-480a-849e-8af48e47f9ea.lk
2020-04-27 09:34:10        520 archive/logs/backup-0.log
2020-04-27 09:34:10        651 archive/repo/backup-meta.json</pre>
</div>
</div>
<div class="paragraph">
<p>If we attempt to use cbbackupmgr to create a backup, we should see a message similar to the one
below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr backup -a s3://bucket/archive -r repo --obj-staging-dir /mnt/staging \
  -c 172.20.1.1:8091 -u admin -p password
Error backing up cluster: the process '{PID}' running on '{HOSTNAME}' already holds the lock</pre>
</div>
</div>
<div class="paragraph">
<p>In this case, cbbackupmgr will not remove the lock automatically since it cannot safely determine
whether the other process is active or not. We can use the information about which machine the other
instance of cbbackupmgr is running on to check whether it is active. If this machine has crashed and
that instance of cbbackupmgr is no longer using the archive, we can manually remove the lockfile.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ aws s3 rm s3://backups/archive/lock-14eb923b-60a7-480a-849e-8af48e47f9ea.lk
delete: s3://backups/archive/lock-14eb923b-60a7-480a-849e-8af48e47f9ea.lk</pre>
</div>
</div>
<div class="paragraph">
<p>If we attempt to perform the backup once again we will see that it continues successfully; in the
case that the other machine failed during a backup you may be asked to purge the previous backup
using the <code>--purge</code> flag before you can create a new backup:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ cbbackupmgr backup -a s3://bucket/archive -r repo --obj-staging-dir /mnt/staging \
  -c 172.20.1.1:8091 -u admin -p password</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Copied all data in 1m2.525397237s (Avg. 51.61KB/Sec)      7303 items / 3.12MB
beer-sample             [===========================================] 100.00%</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Backup successfully completed
Backed up bucket "beer-sample" succeeded
Mutations backedup; 7303, Mutations failed to backup: 0
Deletions backedup: 0, Deletions failed to backup: 0</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="compatible-object-stores"><a class="anchor" href="#compatible-object-stores"></a>Compatible Object Stores</h2>
<div class="sectionbody">
<div class="paragraph">
<p>cbbackupmgr is tested against the cloud providers that are supported, however, in some cases it will
work with compatible object stores e.g. Localstack/Scality. It&#8217;s important to note that experience
may be different when interacting with compatible object stores because some have slightly different
behaviors which cbbackupmgr may not explicitly handle.</p>
</div>
<div class="sect2">
<h3 id="aws-2"><a class="anchor" href="#aws-2"></a>AWS</h3>
<div class="paragraph">
<p>It should be possible to use cbbackupmgr with S3 compatible object stores, however, there are some
things that need to be taken into consideration. First an foremost is the features that cbbackupgmr
leverages. Below is a list of S3 API features that cbbackupmgr uses but not all compatible object
stores support:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ListObjectsV2 <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListObjectsV2.html" class="bare">https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListObjectsV2.html</a></p>
</li>
<li>
<p>MultipartUploads <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/mpuoverview.html" class="bare">https://docs.aws.amazon.com/AmazonS3/latest/dev/mpuoverview.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s important that you check whether these features are implemented on your S3 compatible object
store because without them cbbackupmgr will not work as expected.</p>
</div>
<div class="paragraph">
<p>AWS also has a slightly newer virtual addressing style the documentation for which can be found at
<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/VirtualHosting.html" class="bare">https://docs.aws.amazon.com/AmazonS3/latest/dev/VirtualHosting.html</a>. Not all S3 compatible object
stores support this style of addressing. The errors that are returned by the SDK (and therefore
cbbackupmgr) in these cases are not always clear. Before raising a support ticket about cbbackupmgr
not working with an S3 compatible object store you should first try using the
<code>--s3-force-path-style</code> argument. This will force cbbackupmgr to use the old path style addressing.
From our testing with S3 compatible object stores it&#8217;s very common for this flag to be required.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="see-also"><a class="anchor" href="#see-also"></a>SEE ALSO</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="cbbackupmgr-config.html" class="page">cbbackupmgr-config</a>,
<a href="cbbackupmgr-backup.html" class="page">cbbackupmgr-backup</a>,
<a href="cbbackupmgr-restore.html" class="page">cbbackupmgr-restore</a>,
<a href="cbbackupmgr-merge.html" class="page">cbbackupmgr-merge</a>,
<a href="cbbackupmgr-examine.html" class="page">cbbackupmgr-examine</a>
<a href="cbbackupmgr-info.html" class="page">cbbackupmgr-info</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cbbackupmgr"><a class="anchor" href="#cbbackupmgr"></a>CBBACKUPMGR</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Part of the <a href="cbbackupmgr.html" class="page">cbbackupmgr</a> suite</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase_logo_black.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>Â© 2021 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../../_/js/vendor/fontawesome.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
