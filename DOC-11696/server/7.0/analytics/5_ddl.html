<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>Data Definition Language (DDL) | Couchbase Docs (Preview)</title>
<link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-11696/server/7.0/analytics/5_ddl.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="A description of the DDLs in Couchbase Analytics.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.0">
<meta name="page-url" content="/server/7.0/analytics/5_ddl.html">
<meta name="page-nav-header-levels" content="0">
<meta name="generator" content="Antora 3.1.4">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://simon-dew.github.io/docs-site/DOC-11696/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://simon-dew.github.io/docs-site/DOC-11696/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
    <template id="page-versions" style="display: none">
      <select class="version_list" data-component="server">
        <option value="7.2" data-url="../../current/index.html">7.2</option>
        <option value="7.0" data-url="5_ddl.html" selected>7.0</option>
      </select>
    </template>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/simondew/GitHub/couchbase/docs-analytics/modules/analytics/pages/5_ddl.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../introduction/intro.html">server</a></li>
<li class="crumb">Develop</li>
<li class="crumb">Analytics</li>
<li class="crumb">N1QL for Analytics Language Reference</li>
<li class="crumb"><a href="5_ddl.html">Data Definition Language (DDL)</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Data Definition Language (DDL)</h1>
<div class="labels">
<ul></ul>
</div>
<div class="labels">
<ul>
<li class="edition"><a href="https://www.couchbase.com/products/editions">Enterprise Edition</a></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section lists all supported DDL statements in Couchbase Analytics.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A user must have one of the following RBAC roles to be able
to execute DDL statements: Admin, Cluster Admin, Analytics Admin, or Analytics Manager.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
No <code>CREATE</code>/<code>DROP</code> or <code>CONNECT</code>/<code>DISCONNECT</code> statement can
be executed while the cluster topology changes (e.g. during rebalance). The evaluation of such DDL statements will fail
and it can be reattempted after the topology change has completed.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Entities"><a class="anchor" href="#Entities"></a>Entities</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These are the entities that are required to create shadow copies of the Data Service keyspaces.</p>
</div>
<div class="sect2">
<h3 id="Dataverses"><a class="anchor" href="#Dataverses"></a>Analytics Scopes</h3>
<div class="paragraph">
<p>An Analytics scope, or <em>dataverse</em>, is a container for the other Analytics entities
(links, collections, synonyms, indexes).
There is one <code>Default</code> Analytics scope that is available without creating it and that cannot be deleted.
Because the <code>Default</code> Analytics scope is always available, creating an Analytics scope is optional.</p>
</div>
<div class="paragraph">
<p>In Analytics, there is no entity equivalent to a Data service bucket, such as <code>travel-sample</code>:
the Analytics scope is the top-level entity.
To facilitate data sharing between the Data service and Couchbase Analytics,
an Analytics scope name can have one or two parts,
in which the first part represents a Data service bucket and the second part represents a Data service scope&#8201;&#8212;&#8201;this enables you to simulate the hierarchy of buckets and scopes used in the Data service.</p>
</div>
<div class="paragraph">
<p>Similarly, in Couchbase Analytics, there is no entity equivalent to a Data service namespace,
such as the <code>default:</code> namespace.
Analytics scope names cannot contain a colon as a separator.
When creating an Analytics scope and collection to shadow a Data service keyspace, you must simply omit the namespace.</p>
</div>
<div class="paragraph">
<p>Refer to
<a href="#Creating_and_dropping">Create Statements</a>,
<a href="#Alter_statements">Alter Statements</a>,
<a href="#Use_statements">Use Statements</a>, and
<a href="#Drop_statements">Drop Statements</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Datasets"><a class="anchor" href="#Datasets"></a>Analytics Collections</h3>
<div class="paragraph">
<p>An Analytics collection, or <em>dataset</em>, is a collection of data within an Analytics scope.
By default, an Analytics collection is linked to the Data service of the local Couchbase cluster.
This type of Analytics collection may be referred to as a local Analytics collection,
or simply as an Analytics collection without qualification.</p>
</div>
<div class="paragraph">
<p>Local Analytics collections contain a shadow of the data of a keyspace.
An Analytics collection is updated as the keyspace that it shadows is updated.
An Analytics collection can contain the full content of the keyspace or a filtered subset.
Multiple Analytics collections can shadow the same keyspace.
An Analytics collection is created <code>ON</code> a keyspace with an optional filter expression.
The name of the Analytics collection is optional and defaults to the name of the keyspace.
Creating an Analytics collection fails if there is an existing Analytics collection with the same name
in the selected Analytics scope and <code>IF NOT EXISTS</code> is not specified.</p>
</div>
<div class="paragraph">
<p>Refer to
<a href="#Creating_and_dropping">Create Statements</a>,
<a href="#Alter_statements">Alter Statements</a>, and
<a href="#Drop_statements">Drop Statements</a>.</p>
</div>
<div class="sect3">
<h4 id="External_datasets"><a class="anchor" href="#External_datasets"></a>Remotely-Linked Collections and External Collections</h4>
<div class="paragraph">
<p>You can also create Analytics collections on remote links and external links.
These enable you to query data from outside the local Couchbase cluster.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An Analytics collection on a remote link shadows the data from a remote Couchbase cluster to a local Analytics collection.</p>
</li>
<li>
<p>An external Analytics collection reads data directly from an external source, such as Amazon S3,
without shadowing it locally.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Backup and restore only operates on Analytics collections on the local link.
Only the Analytics collection definition is backed up or restored, not the actual data.
Backup and restore excludes Analytics collections on remote links and external links entirely.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before you can create an external Analytics collection, or an Analytics collection on a remote link,
you must first create the appropriate link for your Analytics collection to use.</p>
</div>
<div class="paragraph">
<p>Refer to
<a href="#Remote_external_links">Remote Links and External Links</a>,
<a href="#Creating_and_dropping">Create Statements</a>, and
<a href="#Drop_statements">Drop Statements</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Workbench_datasets"><a class="anchor" href="#Workbench_datasets"></a>Manage Collections with the Analytics Workbench</h4>
<div class="paragraph">
<p>You can use the Analytics Workbench to create or drop Analytics collections on local links, remote links,
and external links; and to connect or disconnect local links and remote links.
Refer to <a href="manage-datasets.html" class="xref page">Managing Collections</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Synonyms"><a class="anchor" href="#Synonyms"></a>Analytics Synonyms</h3>
<div class="paragraph">
<p>An Analytics synonym is an alternative name for an Analytics collection.
You can use a synonym anywhere that you would otherwise use the name of an Analytics collection.
More information on how synonyms are resolved can be found in
<a href="appendix_3_resolution.html" class="xref page">Appendix 3: Variable Bindings and Name Resolution</a>.</p>
</div>
<div class="paragraph">
<p>Refer to
<a href="#Creating_and_dropping">Create Statements</a>,
<a href="#Alter_statements">Alter Statements</a>, and
<a href="#Drop_statements">Drop Statements</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Links"><a class="anchor" href="#Links"></a>Links</h3>
<div class="paragraph">
<p>In Analytics, a link represents a connection to a data source.
The default type of link is a <code>Local</code> link.</p>
</div>
<div class="paragraph">
<p>The <code>Local</code> link represents a connection to the Data service on the local Couchbase cluster,
specifically to all keyspaces available to a specific user on the local cluster.
Every Analytics scope implicitly contains a <code>Local</code> link for all keyspaces in the local cluster that are available to the
current user.</p>
</div>
<div class="paragraph">
<p>In Couchbase Server 7.0 and later, the <code>Local</code> link for each Analytics scope is connected by default.
When you create a new Analytics collection on a connected link, data ingestion to that collection begins immediately.
You can disconnect the <code>Local</code> link to pause data ingestion to the local Analytics collections in that scope.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can always create or drop an Analytics collection on any link,
even if the link is already connected,
and even if the data source already has existing shadow Analytics collections.
If the link is connected when you create a new Analytics collection,
data ingestion to the new shadow Analytics collection starts at once.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Refer to
<a href="#Connecting_and_disconnecting">Connect Statements</a> and
<a href="#Disconnect_statements">Disconnect Statements</a>.</p>
</div>
<div class="sect3">
<h4 id="Remote_external_links"><a class="anchor" href="#Remote_external_links"></a>Remote Links and External Links</h4>
<div class="paragraph">
<p>You can also create remote links and external links.
These enable you to access data from outside the local Couchbase cluster.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A remote link is a link to a remote Couchbase cluster.</p>
</li>
<li>
<p>An external link is a link to an external data source, such as Amazon S3.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After you have created a remote link or an external link,
you must create an Analytics collection on that link to query the data.</p>
</div>
<div class="paragraph">
<p>A remote link is disconnected by default.
When you create a new Analytics collection on a disconnected link,
data ingestion to that collection does not begin immediately.
You must connect the remote link to start data ingestion to the Analytics collections on that link.</p>
</div>
<div class="paragraph">
<p>An external link cannot be connected or disconnected.
An external Analytics collection is available for query as soon as you create it.</p>
</div>
<div class="paragraph">
<p>To create, edit, or delete a remote or external link, you can use the command-line interface or the REST API.
Refer to <a href="#cli:cbcli/couchbase-cli-analytics-link-setup.adoc" class="xref unresolved">couchbase-cli analytics-link-setup</a> or
<a href="rest-links.html" class="xref page">Analytics Links REST API</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Workbench_links"><a class="anchor" href="#Workbench_links"></a>Manage Links with the Analytics Workbench</h4>
<div class="paragraph">
<p>You can also use the Analytics Workbench to create, edit, or delete remote links and external links.
Refer to <a href="manage-links.html" class="xref page">Managing Links</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Indexes"><a class="anchor" href="#Indexes"></a>Indexes</h3>
<div class="paragraph">
<p>An index is a materialized access path for data in an Analytics collection.
You can create more than one index on the same Analytics collection.
Each index name must be unique within an Analytics collection.
Creating an index fails if there is an existing index with the same name
in the target Analytics collection and <code>IF NOT EXISTS</code> is not specified.</p>
</div>
<div class="paragraph">
<p>For each JSON document ingested into an Analytics collection, the system computes the indexed key for each index.
The index key of a secondary index is computed as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The target field values are extracted from the JSON document according to the specified path of fields;</p>
</li>
<li>
<p>For non-numeric typed index fields (i.e., the specified type is <code>STRING</code>),
if the specified type of the field is the same as the actual field value&#8217;s type,
the value becomes part of the indexed key, otherwise the indexed key cannot be built;</p>
</li>
<li>
<p>For numeric typed index fields (i.e., the specified type is <code>DOUBLE</code> or <code>BIGINT</code>),
the actual field value can be cast to the specified type and it becomes part of the indexed key.
If the cast is impossible, the indexed key cannot be built;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After the indexed key has been built, it is inserted into the secondary index.
In case the index key cannot be built, there is no entry made in the index for this object.</p>
</div>
<div class="paragraph">
<p>Secondary indexes are automatically maintained by the system during data ingestion
(i.e., when their corresponding links are connected and populating their Analytics collections).
In addition, they are automatically rebalanced when their shadow Analytics collections are rebalanced.</p>
</div>
<div class="paragraph">
<p>Refer to
<a href="#Creating_and_dropping">Create Statements</a> and
<a href="#Drop_statements">Drop Statements</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Statements"><a class="anchor" href="#Statements"></a>Statements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to queries, N1QL for Analytics (the Couchbase Analytics implementation of SQL&#43;&#43;) supports statements for
data definition, and to connect Couchbase Analytics to Data Service keyspaces or external data sources.</p>
</div>
<h5 id="stmnt" class="discrete">Stmnt</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/Stmnt.png" alt="(SingleStmnt &quot;;&quot;)+ EOF">
</div>
</div>
<h5 id="singlestmnt" class="discrete">SingleStmnt</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/SingleStmnt.png" alt="UseStmnt | SetStmnt | Query | CreateStmnt | DropStmnt | AlterStmnt | ConnectStmnt | DisconnectStmt">
</div>
</div>
<div class="sect2">
<h3 id="Creating_and_dropping"><a class="anchor" href="#Creating_and_dropping"></a>Create Statements</h3>
<div class="paragraph">
<p>The CREATE statement is used to create Analytics scopes, collections, synonyms, and indexes.</p>
</div>
<h5 id="createstmnt" class="discrete">CreateStmnt</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/CreateStmnt.png" alt="CreateScope | CreateCollection | CreateSynonym | CreateIndex | CreateFunction">
</div>
</div>
<div class="sect3">
<h4 id="analytics-scope-specification"><a class="anchor" href="#analytics-scope-specification"></a>Analytics Scope Specification</h4>
<div class="sect4">
<h5 id="createscope"><a class="anchor" href="#createscope"></a>CreateScope</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/CreateScope.png" alt="&quot;CREATE&quot; &quot;ANALYTICS&quot; &quot;SCOPE&quot; ScopeName (&quot;IF&quot; &quot;NOT&quot; &quot;EXISTS&quot;)?">
</div>
</div>
<div class="paragraph">
<p>Synonym for <code>ANALYTICS SCOPE</code>: <code>DATAVERSE</code></p>
</div>
</div>
<div class="sect4">
<h5 id="scopename"><a class="anchor" href="#scopename"></a>ScopeName</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/ScopeName.png" alt="(Identifier &quot;.&quot;)? Identifier">
</div>
</div>
<div class="paragraph">
<p>The <code>ScopeName</code> represents the Analytics scope name.
This may consist of one or two identifiers.
This enables you to create an Analytics scope name with two parts,
as an equivalent to the Data service bucket name and scope name.</p>
</div>
</div>
<div class="sect4">
<h5 id="examples"><a class="anchor" href="#examples"></a>Examples</h5>
<div class="literalblock">
<div class="content">
<pre>CREATE ANALYTICS SCOPE travel;</pre>
</div>
</div>
<div class="paragraph">
<p>Creates an Analytics scope with the name <code>travel</code> to be used to manage other metadata entities.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="analytics-collection-specification"><a class="anchor" href="#analytics-collection-specification"></a>Analytics Collection Specification</h4>
<div class="sect4">
<h5 id="createcollection"><a class="anchor" href="#createcollection"></a>CreateCollection</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/CreateCollection.png" alt="CreateLocalCollection | CreateRemoteLinkedCollection | CreateExternalCollection">
</div>
</div>
</div>
<div class="sect4">
<h5 id="createlocalcollection"><a class="anchor" href="#createlocalcollection"></a>CreateLocalCollection</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/CreateLocalCollection.png" alt="&quot;CREATE&quot; &quot;ANALYTICS&quot; &quot;COLLECTION&quot; (&quot;IF&quot; &quot;NOT&quot; &quot;EXISTS&quot;)? QualifiedName? ( &quot;WITH&quot; ObjectConstructor )? &quot;ON&quot; KeyspaceName ( &quot;WHERE&quot; Expr )?">
</div>
</div>
<div class="paragraph">
<p>Synonym for <code>ANALYTICS COLLECTION</code>: <code>DATASET</code></p>
</div>
</div>
<div class="sect4">
<h5 id="createremotelinkedcollection"><a class="anchor" href="#createremotelinkedcollection"></a>CreateRemoteLinkedCollection</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/CreateRemoteLinkedCollection.png" alt="&quot;CREATE&quot; &quot;ANALYTICS&quot; &quot;COLLECTION&quot; (&quot;IF&quot; &quot;NOT&quot; &quot;EXISTS&quot;)? QualifiedName? ( &quot;WITH&quot; ObjectConstructor )? &quot;ON&quot; KeyspaceName &quot;AT&quot; QualifiedName ( &quot;WHERE&quot; Expr )?">
</div>
</div>
<div class="paragraph">
<p>Synonym for <code>ANALYTICS COLLECTION</code>: <code>DATASET</code></p>
</div>
</div>
<div class="sect4">
<h5 id="createexternalcollection"><a class="anchor" href="#createexternalcollection"></a>CreateExternalCollection</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/CreateExternalCollection.png" alt="&quot;CREATE&quot; &quot;EXTERNAL&quot; &quot;ANALYTICS&quot; &quot;COLLECTION&quot; (&quot;IF&quot; &quot;NOT&quot; &quot;EXISTS&quot;)? QualifiedName CollectionTypeDef?  &quot;ON&quot; Identifier &quot;AT&quot; QualifiedName ( &quot;USING&quot; StringLiteral )? &quot;WITH&quot; ObjectConstructor">
</div>
</div>
<div class="paragraph">
<p>Synonym for <code>ANALYTICS COLLECTION</code>: <code>DATASET</code></p>
</div>
</div>
<div class="sect4">
<h5 id="qualifiedname"><a class="anchor" href="#qualifiedname"></a>QualifiedName</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/QualifiedName.png" alt="(ScopeName &quot;.&quot;)? Identifier">
</div>
</div>
</div>
<div class="sect4">
<h5 id="keyspacename"><a class="anchor" href="#keyspacename"></a>KeyspaceName</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/KeyspaceName.png" alt="Identifier ( &quot;.&quot; Identifier &quot;.&quot; Identifier )?">
</div>
</div>
</div>
<div class="sect4">
<h5 id="collectiontypedef"><a class="anchor" href="#collectiontypedef"></a>CollectionTypeDef</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/CollectionTypeDef.png" alt="&quot;(&quot; CollectionFieldDef (&quot;,&quot; CollectionFieldDef )* &quot;)&quot;">
</div>
</div>
</div>
<div class="sect4">
<h5 id="collectionfielddef"><a class="anchor" href="#collectionfielddef"></a>CollectionFieldDef</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/CollectionFieldDef.png" alt="Identifier TypeReference ( &quot;NOT&quot; &quot;UNKNOWN&quot; )?">
</div>
</div>
</div>
<div class="sect4">
<h5 id="typereference"><a class="anchor" href="#typereference"></a>TypeReference</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/TypeReference.png" alt="&quot;BOOLEAN&quot; | &quot;BIGINT&quot; | &quot;INT&quot; | &quot;DOUBLE&quot; | &quot;STRING&quot;">
</div>
</div>
<div class="paragraph">
<p>The <code>QualifiedName</code> is the full name of the Analytics collection to create.
It consists of an optional Analytics scope name and a name for the Analytics collection.
If no Analytics scope name is given,
the Analytics collection is created in the scope defined by the immediately preceding USE statement,
or the scope defined by the <code>query_context</code> parameter, or the <code>Default</code> Analytics scope,
according to the rules for <a href="appendix_3_resolution.html#Resolving_database_entities" class="xref page">Resolving Database Entities</a>.</p>
</div>
<div class="paragraph">
<p>The <code>QualifiedName</code> may be omitted if you are creating a local Analytics collection,
or an Analytics collection on a remote link,
and the data source is just a bucket name&#8201;&#8212;&#8201;refer to the <code>ON</code> clause below.</p>
</div>
<div class="paragraph">
<p>The <code>ON</code> clause enables you to specify the data source for the Analytics collection.
For a local Analytics collection,
the <code>KeyspaceName</code> in this clause represents the keyspace which this Analytics collection will shadow.
For an Analytics collection on a remote link,
the <code>KeyspaceName</code> in this clause represents a keyspace on the remote Couchbase cluster.
For an external Analytics collection, the <code>Identifier</code> in this clause represents an external data source,
such as an Amazon S3 bucket.</p>
</div>
<div class="paragraph">
<p>The <code>KeyspaceName</code> may consist of a bucket name, followed by an optional scope name and collection name.
It may <em>not</em> contain a namespace&#8201;&#8212;&#8201;the <code>default:</code> namespace is assumed.
If the <code>KeyspaceName</code> contains just a bucket name,
the Data service scope is assumed to be the default scope within that bucket,
and the Data service collection is assumed to be the default collection within that scope.</p>
</div>
<div class="paragraph">
<p>Note also that if the <code>KeyspaceName</code> contains just a bucket name,
the <code>QualifiedName</code> of the Analytics collection may be omitted.
In this case, the bucket name is used as the Analytics collection name.</p>
</div>
<div class="paragraph">
<p>The <code>WITH</code> clause enables you to specify parameters for the Analytics collection.
The <code>ObjectConstructor</code> represents an object containing key-value pairs, one for each parameter.
The following parameters are available.
Note that many of these parameters only apply when creating an external Analytics collection.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>storage-block-compression</strong> <br>
<em>optional</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines the storage compression used for this Analytics collection. This parameter takes a nested object value&#8201;&#8212;&#8201;<code>scheme</code>.<br>
<br>
Possible values for <code>scheme</code> are <code>snappy</code> or <code>none</code>. The default storage compression scheme is <code>snappy</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>format</strong> <br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Only used when creating an external Analytics collection.)<br>
<br>
Specifies the format of the external data. May be one of the following string values:<br>
<br>
<code>json</code>&#8201;&#8212;&#8201;<a href="http://jsonlines.org" target="_blank" rel="noopener">JSON Lines</a><br>
<code>csv</code>&#8201;&#8212;&#8201;<a href="https://tools.ietf.org/html/rfc4180" target="_blank" rel="noopener">Comma-separated values</a><br>
<code>tsv</code>&#8201;&#8212;&#8201;<a href="https://www.iana.org/assignments/media-types/text/tab-separated-values" target="_blank" rel="noopener">Tab-separated values</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enum (json,csv,tsv)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>header</strong> <br>
<em>required</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Only used when creating an external Analytics collection, and only if it has the format CSV or TSV.)<br>
<br>
When <code>true</code>, the first row of the file is skipped.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>redact-warnings</strong> <br>
<em>optional</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Only used when creating an external Analytics collection, and only if it has the format CSV or TSV.)<br>
<br>
When <code>true</code>, sensitive information (such as the file name) is redacted from warning messages.<br>
<strong>Default</strong> : <code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>null</strong> <br>
<em>optional</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Only used when creating an external Analytics collection, and only if it has the format CSV or TSV.)<br>
<br>
The string used in the external Analytics collection to represent a <code>null</code> value. You may escape special characters using a backslash <code>\</code>.<br>
<br>
(Refer also to the <code>NOT UNKNOWN</code> flag in the type definition, described below.)<br>
<strong>Example</strong> : <code>"\\N"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>include</strong> <br>
<em>optional</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Only used when creating an external Analytics collection. May not be used if the <strong>exclude</strong> parameter is present.)<br>
<br>
The names of the files to be included from the external Analytics collection. The file name may include subdirectories of the location specified by the <code>USING</code> clause, described below. Any files that do not match the specification are excluded.<br>
<br>
May contain the same wildcard characters as the <strong>exclude</strong> parameter.<br>
<strong>Example</strong> : <code>["*2018*.json", "*2019*.json"]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string, or array of strings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>exclude</strong> <br>
<em>optional</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Only used when creating an external Analytics collection. May not be used if the <strong>include</strong> parameter is present.)<br>
<br>
The names of the files to be excluded from the external Analytics collection. The file name may include subdirectories of the location specified by the <code>USING</code> clause, described below. Any files that do not match the specification are included.<br>
<br>
May contain the following wildcard characters, in common with the <strong>include</strong> parameter:<br>
<br>
<code>*</code>&#8201;&#8212;&#8201;Matches anything<br>
<code>?</code>&#8201;&#8212;&#8201;Matches any single character<br>
<code>[</code> <em>sequence</em> <code>]</code>&#8201;&#8212;&#8201;Matches any characters in <em>sequence</em><br>
<code>[!</code> <em>sequence</em> <code>]</code>&#8201;&#8212;&#8201;Matches any characters not in <em>sequence</em><br>
<strong>Example</strong> : <code>"*.?sv"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string, or array of strings</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that for an external collection, data in JSON, CSV, or TSV format may be stored in compressed GZIP files, with the extension <code>.gz</code> or <code>.gzip</code>.</p>
</div>
<div class="paragraph">
<p>The <code>WHERE</code> clause is only used when creating an Analytics collection on a local link, or a remote link.
It enables you to filter the documents in the Analytics collection.
The <code>Expr</code> in this clause must be deterministic,
and it may not contain a user-defined function.</p>
</div>
<div class="paragraph">
<p>The <code>AT</code> clause is only used when creating an Analytics collection on a remote link, or an external Analytics collection.
The <code>QualifiedName</code> in this clause is the name of the remote or external link on which the Analytics collection is to be created.
If this <code>QualifiedName</code> contains a scope name,
the statement looks for the link within the specified Analytics scope.
Otherwise, it looks for the link in the same scope as the Analytics collection.</p>
</div>
<div class="paragraph">
<p>The <code>CollectionTypeDef</code> is only used when creating an external Analytics collection,
and only if it has the format CSV or TSV.
It consists of a comma-separated list of field definitions,
which guides the transformation of each CSV or TSV record into a JSON object.
Each field definition consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A name to be assigned to the field.</p>
</li>
<li>
<p>The data type of the field.
This may be any of the <a href="10_data_type.html#PrimitiveTypes" class="xref page">primitive data types</a>,
where <code>INT</code> is an alias for <code>BIGINT</code>.
If this field does not contain a value of this data type, the record is ignored.</p>
</li>
<li>
<p>Optionally, the <code>NOT UNKNOWN</code> flag.
When this flag is present, if this field is <code>missing</code> or <code>null</code>, the record is ignored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Every time a record is ignored because it does not match the type definition, a warning is issued.</p>
</div>
<div class="paragraph">
<p>The <code>USING</code> clause is only used when creating an external Analytics collection.
The expression in this clause must resolve to a string containing a path to the location of the data,
relative to the external data source.</p>
</div>
</div>
<div class="sect4">
<h5 id="examples-2"><a class="anchor" href="#examples-2"></a>Examples</h5>
<div class="literalblock">
<div class="content">
<pre>CREATE ANALYTICS COLLECTION travel.hotels
  ON `travel-sample`.inventory.hotel;

CREATE ANALYTICS COLLECTION travel.airports
  WITH {"storage-block-compression": {"scheme": "snappy"}}
  ON `travel-sample`.inventory.airport;</pre>
</div>
</div>
<div class="paragraph">
<p>This example creates 2 Analytics collections in the <code>travel</code> Analytics scope:
an Analytics collection called <code>hotels</code> on the <code>`travel-sample`.inventory.hotel</code> keyspace,
and an Analytics collection called <code>airports</code> on the <code>`travel-sample`.inventory.airport</code> keyspace.
For the <code>airports</code> Analytics collection, the <code>snappy</code> storage compression scheme is explicitly specified.
Note that back-ticks are necessary for reserved keywords, such as <code>type</code>, or certain operators, such as <code>-</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE ANALYTICS COLLECTION travel.restaurants
  ON `travel-sample`.inventory.landmark
  AT Default.myCbLink WHERE activity = "eat";</pre>
</div>
</div>
<div class="paragraph">
<p>This example creates an Analytics collection in the <code>travel</code> Analytics scope called <code>restaurants</code>, and filters
the content for the Analytics collection by the value of the <code>activity</code> field of the record.
The Analytics collection uses data from the <code>`travel-sample`.inventory.landmark</code> keyspace at the remote
Couchbase cluster which is connected via the remote link called <code>myCbLink</code> in the <code>Default</code> Analytics scope.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE EXTERNAL ANALYTICS COLLECTION travel.customers
ON TravelShop
AT travel.myS3Link
USING "json-data/customers"
WITH {
  "format": "json",
  "include": ["*2018*.json", "*2019*.json"]
};</pre>
</div>
</div>
<div class="paragraph">
<p>This example creates an external Analytics collection in the <code>travel</code> Analytics scope called <code>customers</code>.
The Analytics collection uses data from the Amazon S3 bucket called <code>TravelShop</code>,
which is connected via the link called <code>myS3Link</code> in the <code>travel</code> Analytics scope.</p>
</div>
<div class="paragraph">
<p>The files containing the data are located in <code>json-data/customers</code> and use JSON Lines format.
The only files included are those with the extension <code>.json</code>, and with <code>2018</code> and <code>2019</code> as part of the file name.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE EXTERNAL ANALYTICS COLLECTION travel.bookings(
    id INT NOT UNKNOWN,
    datetime STRING NOT UNKNOWN,
    amount DOUBLE NOT UNKNOWN
    details STRING,
  ) ON TravelShop
AT travel.myS3Link
USING "csv-data/accounts"
WITH {
  "format": "csv",
  "header": true,
  "include": "201[5-9]/*[!234].csv"
};</pre>
</div>
</div>
<div class="paragraph">
<p>This example creates an external Analytics collection in the <code>travel</code> Analytics scope called <code>bookings</code>.
The Analytics collection uses data from the Amazon S3 bucket called <code>TravelShop</code>,
which is connected on the link called <code>myS3Link</code> in the <code>travel</code> Analytics scope.</p>
</div>
<div class="paragraph">
<p>The files containing the data are located in <code>csv-data/accounts</code> and have CSV format.
The only files included are those with the extension <code>.csv</code>, in subdirectories ranging from <code>2015</code> to <code>2019</code>, and whose file name does <em>not</em> end with <code>2</code>, <code>3</code>, or <code>4</code>.</p>
</div>
<div class="paragraph">
<p>Each CSV file is expected to have a header row, which is excluded.
In each row, the first column is expected to be a bigint which cannot be null,
the second column is expected to be a string which cannot be null,
the third column is expected to be a double which cannot be null,
and the fourth column is expected to be a string.
If any of the rows do not meet this data model, they will not be included.
These fields will be given the names <code>id</code>, <code>datetime</code>, <code>amount</code>, and <code>details</code> respectively.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="synonym-specification"><a class="anchor" href="#synonym-specification"></a>Synonym Specification</h4>
<div class="sect4">
<h5 id="createsynonym"><a class="anchor" href="#createsynonym"></a>CreateSynonym</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/CreateSynonym.png" alt="&quot;CREATE&quot; &quot;ANALYTICS&quot; &quot;SYNONYM&quot; QualifiedName (&quot;IF&quot; &quot;NOT&quot; &quot;EXISTS&quot;)? &quot;FOR&quot; QualifiedName">
</div>
</div>
<div class="paragraph">
<p>The first <code>QualifiedName</code> is the full name of the synonym.
It consists of an optional Analytics scope name, followed by an identifier.
If this <code>QualifiedName</code> contains a scope name, the synonym is created within the specified Analytics scope.
Otherwise, the synonym is created in the scope defined by the immediately preceding USE statement,
or the scope defined by the <code>query_context</code> parameter, or the <code>Default</code> Analytics scope,
according to the rules for <a href="appendix_3_resolution.html#Resolving_database_entities" class="xref page">Resolving Database Entities</a>.</p>
</div>
<div class="paragraph">
<p>The <code>FOR</code> clause enables you to specify the target of the synonym.
The <code>QualifiedName</code> in this clause is the full name of an Analytics collection.
Again, it consists of an optional Analytics scope name, followed by an identifier.
If this <code>QualifiedName</code> contains a scope name,
the CREATE ANALYTICS SYNONYM statement looks for the target collection within the specified Analytics scope.
Otherwise, it looks for the target collection in the same scope as the synonym.</p>
</div>
</div>
<div class="sect4">
<h5 id="example"><a class="anchor" href="#example"></a>Example</h5>
<div class="literalblock">
<div class="content">
<pre>CREATE ANALYTICS SYNONYM travel.accommodation FOR hotels;</pre>
</div>
</div>
<div class="paragraph">
<p>This example sets <code>accommodation</code> to be a synonym in the Analytics scope <code>travel</code> for the Analytics collection <code>hotels</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="index-specification"><a class="anchor" href="#index-specification"></a>Index Specification</h4>
<div class="sect4">
<h5 id="createindex"><a class="anchor" href="#createindex"></a>CreateIndex</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/CreateIndex.png" alt="&quot;CREATE&quot; &quot;ANALYTICS&quot;? &quot;INDEX&quot; Identifier (&quot;IF&quot; &quot;NOT&quot; &quot;EXISTS&quot;)? &quot;ON&quot; QualifiedName &quot;(&quot; IndexField ( &quot;,&quot; IndexField )* &quot;)&quot;">
</div>
</div>
</div>
<div class="sect4">
<h5 id="indexfield"><a class="anchor" href="#indexfield"></a>IndexField</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/IndexField.png" alt="NestedField &quot;:&quot; ( &quot;STRING&quot; | &quot;BIGINT&quot; | &quot;DOUBLE&quot; )">
</div>
</div>
</div>
<div class="sect4">
<h5 id="nestedfield"><a class="anchor" href="#nestedfield"></a>NestedField</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/NestedField.png" alt="Identifier ( &quot;.&quot; Identifier )*">
</div>
</div>
<div class="paragraph">
<p>For the CREATE ANALYTICS INDEX statement, the first <code>Identifier</code> is the index name.</p>
</div>
<div class="paragraph">
<p>The <code>QualifiedName</code> identifies the Analytics collection on which the index is built.
It consists of an optional Analytics scope name and the name of the Analytics collection.
If no Analytics scope name is given,
the Analytics collection is assumed to be in the scope defined by the immediately preceding USE statement,
or the scope defined by the <code>query_context</code> parameter, or the <code>Default</code> Analytics scope,
according to the rules for <a href="appendix_3_resolution.html#Resolving_database_entities" class="xref page">Resolving Database Entities</a>.</p>
</div>
<div class="paragraph">
<p>The <code>IndexField</code> consists of a <code>NestedField</code> that specifies a field path into the indexed JSON document,
and a type identifier.</p>
</div>
</div>
<div class="sect4">
<h5 id="examples-3"><a class="anchor" href="#examples-3"></a>Examples</h5>
<div class="literalblock">
<div class="content">
<pre>CREATE ANALYTICS INDEX airport_name_idx on travel.airports (airportname: string);
CREATE ANALYTICS INDEX hotel_name_idx on travel.hotels (name: string);
CREATE ANALYTICS INDEX hotel_loc_idx on travel.hotels (geo.lon: double, geo.lat: double);</pre>
</div>
</div>
<div class="paragraph">
<p>Creates indexes on the identified fields for the specified types.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Use_statements"><a class="anchor" href="#Use_statements"></a>Use Statements</h3>
<div class="paragraph">
<p>The USE statement sets the <code>ScopeName</code> to be the default Analytics scope for the following statement.
If the following statement does not explicitly specify an Analytics scope,
the statement defaults to the the scope defined by the immediately preceding USE statement,
or the scope defined by the <code>query_context</code> parameter, or the <code>Default</code> Analytics scope,
according to the rules for <a href="appendix_3_resolution.html#Resolving_database_entities" class="xref page">Resolving Database Entities</a>.</p>
</div>
<h5 id="usestmnt" class="discrete">UseStmnt</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/UseStmnt.png" alt="&quot;USE&quot; ScopeName">
</div>
</div>
<div class="paragraph">
<p>The USE statement only works in a conjunction with another statement in a single request.</p>
</div>
<h5 id="example-2" class="discrete">Example</h5>
<div class="literalblock">
<div class="content">
<pre>USE travel;</pre>
</div>
</div>
<div class="paragraph">
<p>This example sets <code>travel</code> to be the default Analytics scope for the statement immediately following.</p>
</div>
</div>
<div class="sect2">
<h3 id="Drop_statements"><a class="anchor" href="#Drop_statements"></a>Drop Statements</h3>
<div class="paragraph">
<p>The DROP statement is the inverse of the CREATE statement.
It can be used to drop Analytics scopes, collections, synonyms, and indexes.</p>
</div>
<h5 id="dropstmnt" class="discrete">DropStmnt</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/DropStmnt.png" alt="DropScope | DropCollection | DropSynonym | DropIndex | DropFunction">
</div>
</div>
<h5 id="dropscope" class="discrete">DropScope</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/DropScope.png" alt="&quot;DROP&quot; &quot;ANALYTICS&quot; &quot;SCOPE&quot; ScopeName (&quot;IF&quot; &quot;EXISTS&quot;)?">
</div>
</div>
<div class="paragraph">
<p>Synonym for <code>ANALYTICS SCOPE</code>: <code>DATAVERSE</code></p>
</div>
<h5 id="dropcollection" class="discrete">DropCollection</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/DropCollection.png" alt="&quot;DROP&quot; &quot;ANALYTICS&quot; &quot;COLLECTION&quot; QualifiedName (&quot;IF&quot; &quot;EXISTS&quot;)?">
</div>
</div>
<div class="paragraph">
<p>Synonym for <code>ANALYTICS COLLECTION</code>: <code>DATASET</code></p>
</div>
<h5 id="dropsynonym" class="discrete">DropSynonym</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/DropSynonym.png" alt="&quot;DROP&quot; &quot;ANALYTICS&quot; &quot;SYNONYM&quot; QualifiedName (&quot;IF&quot; &quot;EXISTS&quot;)?">
</div>
</div>
<h5 id="dropindex" class="discrete">DropIndex</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/DropIndex.png" alt="&quot;DROP&quot; &quot;ANALYTICS&quot;? &quot;INDEX&quot; DoubleQualifiedName (&quot;IF&quot; &quot;EXISTS&quot;)?">
</div>
</div>
<h5 id="doublequalifiedname" class="discrete">DoubleQualifiedName</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/DoubleQualifiedName.png" alt="(ScopeName &quot;.&quot;)? Identifier &quot;.&quot; Identifier">
</div>
</div>
<div class="paragraph">
<p>For the DROP ANALYTICS SCOPE statement, the <code>ScopeName</code> is the Analytics scope name.</p>
</div>
<div class="paragraph">
<p>For the DROP ANALYTICS COLLECTION statement, the <code>QualifiedName</code> is the full name of the Analytics collection.
It consists of an optional Analytics scope name and the name of the Analytics collection.</p>
</div>
<div class="paragraph">
<p>For the DROP ANALYTICS SYNONYM statement, the <code>QualifiedName</code> is the full name of the Analytics synonym.
It consists of an optional Analytics scope name and the name of the Analytics synonym.</p>
</div>
<div class="paragraph">
<p>For the DROP ANALYTICS INDEX statement, the <code>DoubleQualifiedName</code> is the full name of the index.
It consists of an optional Analytics scope name, the name of the Analytics collection, and the name of the index.</p>
</div>
<div class="paragraph">
<p>When dropping a collection, synonym, or index, if no Analytics scope name is given,
the database entity is assumed to be in the scope defined by the immediately preceding USE statement,
or the scope defined by the <code>query_context</code> parameter, or the <code>Default</code> Analytics scope,
according to the rules for <a href="appendix_3_resolution.html#Resolving_database_entities" class="xref page">Resolving Database Entities</a>.</p>
</div>
<div class="paragraph">
<p>You cannot drop an Analytics collection if is used by a user-defined function in the same or a different Analytics scope.</p>
</div>
<div class="paragraph">
<p>When you drop an Analytics scope, any user-defined functions in that scope are dropped also.
However, you cannot drop an Analytics scope if there are any user-defined functions in <em>other scopes</em> which depend on
user-defined functions or Analytics collections within the scope being dropped.</p>
</div>
<h5 id="examples-4" class="discrete">Examples</h5>
<div class="literalblock">
<div class="content">
<pre>DROP ANALYTICS SCOPE travel IF EXISTS;</pre>
</div>
</div>
<div class="paragraph">
<p>This example drops the <code>travel</code> Analytics scope, if it already exists.
Dropping an Analytics scope disconnects any links and drops any Analytics collections contained in it.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DROP ANALYTICS COLLECTION travel.restaurants;
DROP ANALYTICS COLLECTION travel.customers;
DROP ANALYTICS COLLECTION travel.bookings;</pre>
</div>
</div>
<div class="paragraph">
<p>This example removes the Analytics collections and all contained data.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DROP ANALYTICS SYNONYM travel.accommodation;</pre>
</div>
</div>
<div class="paragraph">
<p>Drops the synonym.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DROP ANALYTICS INDEX travel.airports.airport_name_idx;
DROP ANALYTICS INDEX travel.hotels.hotel_name_idx;
DROP ANALYTICS INDEX travel.hotels.hotel_loc_idx;</pre>
</div>
</div>
<div class="paragraph">
<p>Drops the indexes.</p>
</div>
</div>
<div class="sect2">
<h3 id="Alter_statements"><a class="anchor" href="#Alter_statements"></a>Alter Statements</h3>
<h5 id="alterstmnt" class="discrete">AlterStmnt</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/AlterStmnt.png" alt="AlterCollectionEnable | AlterCollectionDisable">
</div>
</div>
<h5 id="altercollectionenable" class="discrete">AlterCollectionEnable</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/AlterCollectionEnable.png" alt="&quot;ALTER&quot; &quot;COLLECTION&quot; KeyspaceName &quot;ENABLE&quot; &quot;ANALYTICS&quot; ( &quot;WITH&quot; ObjectConstructor )?">
</div>
</div>
<h5 id="altercollectiondisable" class="discrete">AlterCollectionDisable</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/AlterCollectionDisable.png" alt="&quot;ALTER&quot; &quot;COLLECTION&quot; KeyspaceName &quot;DISABLE&quot; &quot;ANALYTICS&quot;">
</div>
</div>
<div class="paragraph">
<p>The ALTER COLLECTION statements enable you to make a local Data Service keyspace available in Analytics with a single command,
or remove the Data Service keyspace from Analytics with a similar single command.</p>
</div>
<div class="paragraph">
<p>The <code>KeyspaceName</code> specifies the local Data service keyspace that you want to make available in Analytics.
For more details, refer to <a href="#Creating_and_dropping">Create Statements</a>.</p>
</div>
<div class="paragraph">
<p>The <code>WITH</code> clause enables you to provide parameters for the Analytics collection.
The <code>ObjectConstructor</code> represents an object containing key-value pairs, one for each parameter.
For more details, refer to <a href="#Creating_and_dropping">Create Statements</a>.</p>
</div>
<div class="paragraph">
<p>When used with the ENABLE ANALYTICS keywords,
the ALTER COLLECTION statement creates an Analytics scope that corresponds to the specified Data service scope,
and within that Analytics scope, an Analytics collection that corresponds to the specified Data service collection.
(If there is already an Analytics scope with the same name as the specified Data service scope,
the Analytics collection is created within the existing Analytics scope.)
The Analytics collection then uses the Data service collection as its data source.
This is equivalent to running CREATE ANALYTICS SCOPE followed by CREATE ANALYTICS COLLECTION.</p>
</div>
<div class="paragraph">
<p>The name of the automatically-created Analytics scope is made up of the name of the specified Data service bucket,
followed by the name of the specified Data service scope.
The name of the automatically-created Analytics collection is the name of the specified Data service collection.</p>
</div>
<div class="paragraph">
<p>If you specify the default collection within the default scope within the Data service bucket,
the ALTER COLLECTION statement also creates a synonym for the collection within the <code>Default</code> Analytics scope.
The name of the synonym is the same as the specified Data service bucket.
This is equivalent to running CREATE ANALYTICS SYNONYM,
and enables you to refer to the collection using just the bucket name.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If an Analytics scope already exists with the same name as the specified Data service scope,
and it contains an Analytics collection with the same name as the specified Data service collection,
the ALTER COLLECTION statement fails.
Similarly, if an Analytics synonym already exists in the <code>Default</code> scope with the same name
as the specified Data service bucket, the ALTER COLLECTION statement fails.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When used with the DISABLE ANALYTICS keywords, the ALTER COLLECTION statement drops the Analytics collection,
and the synonym for the Analytics collection if it exists, but does not drop the Analytics scope.
This is equivalent to running DROP ANALYTICS COLLECTION, and if necessary DROP ANALYTICS SYNONYM.</p>
</div>
<h5 id="examples-5" class="discrete">Examples</h5>
<div class="literalblock">
<div class="content">
<pre>ALTER COLLECTION `travel-sample`.inventory.airline ENABLE ANALYTICS;</pre>
</div>
</div>
<div class="paragraph">
<p>This example creates an Analytics scope called <code>`travel-sample`.inventory</code>.
Within that scope, it creates an Analytics collection called <code>airline</code>.
The Analytics collection uses the <code>airline</code> collection within the <code>inventory</code> scope in the <code>travel-sample</code> bucket
as its data source.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ALTER COLLECTION `travel-sample` ENABLE ANALYTICS;</pre>
</div>
</div>
<div class="paragraph">
<p>This example creates an Analytics scope called <code>`travel-sample`._default</code>.
Within this scope, it creates an Analytics collection also called <code>_default</code>.
It then creates a synonym <code>travel-sample</code> for this Analytics collection in the <code>Default</code> Analytics scope.
The Analytics collection uses the default collection within the default scope in the <code>travel-sample</code> bucket
as its data source.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ALTER COLLECTION `travel-sample`.inventory.airline DISABLE ANALYTICS;</pre>
</div>
</div>
<div class="paragraph">
<p>This example drops the <code>airline</code> Analytics collection,
but leaves the <code>`travel-sample`.inventory</code> Analytics scope in place.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ALTER COLLECTION `travel-sample` DISABLE ANALYTICS;</pre>
</div>
</div>
<div class="paragraph">
<p>This example drops the <code>travel-sample</code> Analytics synonym and the <code>_default</code> Analytics collection,
but leaves the <code>`travel-sample`._default</code> Analytics scope in place.</p>
</div>
</div>
<div class="sect2">
<h3 id="Connecting_and_disconnecting"><a class="anchor" href="#Connecting_and_disconnecting"></a>Connect Statements</h3>
<div class="paragraph">
<p>The CONNECT statement connects all Analytics collections on the given Analytics links(s)
to their specified data sources, and starts data ingestion.
The CONNECT statement is not applicable to external links.</p>
</div>
<h5 id="connectstmnt" class="discrete">ConnectStmnt</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/ConnectStmnt.png" alt="&quot;CONNECT&quot; &quot;LINK&quot; LinkSpecification ( &quot;WITH&quot; ObjectConstructor )">
</div>
</div>
<h5 id="linkspecification" class="discrete">LinkSpecification</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/LinkSpecification.png" alt="QualifiedName ( &quot;,&quot; QualifiedName )*">
</div>
</div>
<div class="paragraph">
<p>The <code>LinkSpecification</code> is a comma separated list of one or more links to connect.
Each item in the list is the full name of a link,
consisting of (optionally) the name of the Analytics scope where the link was created,
and the name of the link.
For the local link, the name of the link is <code>Local</code>; for remote links,
it is the name given to the link when it was created.
If no Analytics scope name is given,
the link is assumed to be in the scope defined by the immediately preceding USE statement,
or the scope defined by the <code>query_context</code> parameter, or the <code>Default</code> Analytics scope,
according to the rules for <a href="appendix_3_resolution.html#Resolving_database_entities" class="xref page">Resolving Database Entities</a>.</p>
</div>
<div class="paragraph">
<p>The <code>WITH</code> clause enables you to provide parameters for the connection.
The <code>ObjectConstructor</code> represents an object containing key-value pairs, one for each parameter.</p>
</div>
<div class="paragraph">
<p>Only one parameter is currently supported for the connection:
the <code>force</code> parameter, which takes a Boolean value (true / false).
In Couchbase Server 7.0 and later, this parameter is ignored and has no effect.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This parameter is deprecated and will generate a warning if used.
It will be removed in a future version of Couchbase Server.
</td>
</tr>
</table>
</div>
<h5 id="examples-6" class="discrete">Examples</h5>
<div class="literalblock">
<div class="content">
<pre>CONNECT LINK Local;</pre>
</div>
</div>
<div class="paragraph">
<p>This example connects all Analytics collections that use the link <code>Local</code> in the current Analytics scope to their Data
Service keyspaces, and starts shadowing.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CONNECT LINK myCbLink;</pre>
</div>
</div>
<div class="paragraph">
<p>This example connects all Analytics collections on the remote link called <code>myCbLink</code> and starts shadowing.</p>
</div>
</div>
<div class="sect2">
<h3 id="Disconnect_statements"><a class="anchor" href="#Disconnect_statements"></a>Disconnect Statements</h3>
<div class="paragraph">
<p>The DISCONNECT statement is the inverse of the CONNECT statement.
It disconnects all Analytics collections on the given Analytics link(s).
The DISCONNECT statement is not applicable to external links.</p>
</div>
<h5 id="disconnectstmnt" class="discrete">DisconnectStmnt</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/DisconnectStmnt.png" alt="&quot;DISCONNECT&quot; &quot;LINK&quot; LinkSpecification">
</div>
</div>
<h5 id="examples-7" class="discrete">Examples</h5>
<div class="literalblock">
<div class="content">
<pre>DISCONNECT LINK Local;</pre>
</div>
</div>
<div class="paragraph">
<p>This example stops shadowing for all Analytics collections that use the link <code>Local</code> in the current Analytics scope,
and disconnects their Data Service keyspaces.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DISCONNECT LINK myCbLink;</pre>
</div>
</div>
<div class="paragraph">
<p>This example stops shadowing and disconnects all Analytics collections on the remote link called <code>myCbLink</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metadata-introspection"><a class="anchor" href="#metadata-introspection"></a>Metadata Introspection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Metadata entities can be introspected by querying the Analytics collections in the <code>Metadata</code> Analytics scope.
The Metadata Analytics scope contains the Analytics collections <code>Dataverse</code>, <code>Dataset</code>, <code>Synonym</code>, <code>Index</code>, <code>Function</code>, and <code>Link</code>.
Each Analytics collection contains the queryable metadata for each entity type.</p>
</div>
<div class="paragraph">
<p>Because the name of each of these collections is a reserved word in N1QL for Analytics, note that you must delimit the collection name with backticks (&grave;), as shown in the example below.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT VALUE d.DataverseName || '.' || d.DatasetName
FROM Metadata.`Dataset` d
WHERE d.DataverseName &lt;&gt; "Metadata"</pre>
</div>
</div>
<div class="paragraph">
<p>Returns the qualified names of all Analytics collections that are not in the <code>Metadata</code> Analytics scope.
While Analytics scopes, Analytics collections, and indexes
are created and removed by the corresponding CREATE and DROP statements,
and remote links and external links are created and removed by the command-line interface or the REST API,
the lifecycle of local links is managed by the system&#8201;&#8212;&#8201;they are created and removed as needed.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2024 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
