<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>JSON Modelling | Couchbase Docs (Preview)</title>
<link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-11696/java-sdk/current/howtos/json.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="The Java SDK supports multiple options for working with JSON.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="java-sdk">
<meta name="dcterms.identifier" content="3.3">
<meta name="page-url" content="/java-sdk/current/howtos/json.html">
<meta name="page-nav-header-levels" content="0">
<meta name="generator" content="Antora 3.1.4">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://simon-dew.github.io/docs-site/DOC-11696/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://simon-dew.github.io/docs-site/DOC-11696/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="2">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="https://github.com/couchbase/docs-sdk-java/edit/release/3.3/modules/howtos/pages/json.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../hello-world/overview.html">Java SDK</a></li>
<li class="crumb">Working with Data</li>
<li class="crumb"><a href="json.html">JSON</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">JSON Modelling</h1>
<div class="labels">
<ul><li class="guide"><span><i class="far fa-check-square"></i> how-to</span></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div class="sect1">
<h2 id="philosophy"><a class="anchor" href="#philosophy"></a>Philosophy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Couchbase Server is a key-value store that&#8217;s agnostic to what&#8217;s stored, but it&#8217;s very common to store JSON.</p>
</div>
<div class="paragraph">
<p>The Java SDK has these main objectives for JSON:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Be usable 'out-of-the-box'.  A simple JSON library is included, so you can get started right away.  Bonus: it&#8217;s simple to use and very fast!</p>
</li>
<li>
<p>Be agnostic.  Your application may already be using its own JSON representation, and it shouldn&#8217;t be forced to use the built-in JSON library.
We use <a href="https://github.com/FasterXML/jackson">Jackson</a> internally, so if you&#8217;re already using that popular ecosystem&#8217;s annotations you&#8217;re set to go. But you&#8217;re never locked into it, and you can use other libraries like <a href="https://github.com/google/gson/">Gson</a> easily.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started"><a class="anchor" href="#getting-started"></a>Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The examples below assume you&#8217;re familiar with connecting to a Couchbase cluster using the Java SDK, and opening resources.  Please check out <a href="#hello-world:start-using-sdk">the Getting Started guide</a> for help with this.</p>
</div>
<div class="sect2">
<h3 id="inserting-a-simple-object"><a class="anchor" href="#inserting-a-simple-object"></a>Inserting a simple object</h3>
<div class="paragraph">
<p>Let&#8217;s assume we have a very simple JSON structure we want to insert:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java#L158-L161">{ 
  name: "Arthur",
  number: 42
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once we&#8217;ve connected to a Couchbase server and the bucket, scope, and collection that we want to write to, we know that inserting is as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java#L171">collection.upsert("arthur", json);</code></pre>
</div>
</div>
<div class="paragraph">
<p>But how do we model that JSON object?</p>
</div>
<div class="paragraph">
<p>We mentioned the simple JSON library that we ship with the SDK, and let&#8217;s look at this first:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">import com.couchbase.client.java.json.*;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">JsonObject json = JsonObject.create()
  .put("name", "Arthur")
  .put("number", 42);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="retrieving"><a class="anchor" href="#retrieving"></a>Retrieving</h3>
<div class="paragraph">
<p>Couchbase&#8217;s <code>Collection.get()</code> method returns a <code>GetResult</code> object, which can then be converted back into a <code>JsonObject</code>.
In this example, we print the JSON back, and access one of the fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">JsonObject jsonResult = collection.get("arthur")
  .contentAsObject();

System.out.println(jsonResult);
System.out.println(jsonResult.getString("name"));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-javas-map-data-structure"><a class="anchor" href="#using-javas-map-data-structure"></a>Using Java&#8217;s <code>Map</code> data structure</h3>
<div class="paragraph">
<p>The <code>JsonObject</code> is modelled on the classic Java <code>Map</code> data structure, and in fact is backed by one.
So we can easily create an object from an existing Map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">Map&lt;String, Object&gt; map = Map.of( // Java 9+ syntax
  "name", "Arthur",
  "number", 42);

JsonObject json = JsonObject.from(map);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting <code>JsonObject</code> can be inserted as normal.
But most JSON serializers can handle simple objects like a Map already, and ours (backed by Jackson) is no different. So you can simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">collection.upsert("arthur", map);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the data is in Couchbase, it is stored in exactly the same way, that is to say, as the JSON representation we started this example with!</p>
</div>
<div class="paragraph">
<p>So whether we inserted a Map or a JsonObject, we could retrieve it as a JsonObject&#8230;&#8203; or indeed a Map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">Map&lt;String, Object&gt; result = collection.get("arthur")
  .contentAs(Map.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>While you are free to use Map, this is capable of storing any valid Java value, including ones that can&#8217;t be represented as JSON. JsonObject offers validation to make sure that only the relevant <a href="#datatypes">datatypes</a> are stored, which will give you greater diagnostics and robustness.</p>
</div>
</div>
<div class="sect2">
<h3 id="inserting-a-json-string-or-json-file"><a class="anchor" href="#inserting-a-json-string-or-json-file"></a>Inserting a JSON string or <code>.json</code> file</h3>
<div class="paragraph">
<p>If we read the contents of a file to get a JSON string, we can also inflate a JsonObject from that string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">import java.nio.file.Paths;
import java.nio.file.Files;
import java.io.IOException;
import java.nio.charset.StandardCharsets;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">String content  = new String(
  Files.readAllBytes(
    Paths.get(pathToArthurJson)),
  StandardCharsets.UTF_8);
// String content  = Files.readString(Paths.get(pathToArthurJson), StandardCharsets.UTF_8); // Java 11+

JsonObject json = JsonObject.fromJson(content);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This might seem a little clumsy though:
We&#8217;re reading a string, inflating it into a JsonObject, passing it to a serializer which will&#8230;&#8203; turn it back into a string again to send over the network to the Couchbase server!</p>
</div>
<div class="paragraph">
<p>We could instead simply pass it through with the Raw JSON Transcoder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">import com.couchbase.client.java.codec.RawJsonTranscoder;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">collection.upsert("arthur", content,
  UpsertOptions.upsertOptions().transcoder(RawJsonTranscoder.INSTANCE));</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach could also be used to handle JSON created by other libraries such as Gson.
See the <a href="transcoders-nonjson.html#rawjsontranscoder" class="xref page">Transcoder documentation</a> for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="serializing-objects"><a class="anchor" href="#serializing-objects"></a>Serializing objects</h3>
<div class="paragraph">
<p>It&#8217;s common to want to serialize your own objects, rather than creating Json programmatically or textually.
Luckily our built-in JSON serializer makes light work of this task.
Using this simple class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">public class Person {
  public String name;
  
  public int number;
  
  public Person() {} // default constructor needed to deserialize
  
  public Person(String name, int number) {
    this.name = name;
    this.number = number;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We could insert the exact same JSON as before with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">collection.upsert("arthur", new Person("Arthur", 42));</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s now trivial to return the data either as a JsonObject, exactly as we&#8217;ve done before, or indeed as a Person object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">Person person = collection.get("arthur")
  .contentAs(Person.class);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ObjectMapper"><a class="anchor" href="#ObjectMapper"></a>More complex Object to JSON mapping</h3>
<div class="paragraph">
<p>Because the SDK&#8217;s serializer is backed by an industry standard library (Jackson), it is easy to model all kinds of Object to JSON mappings.
Though the SDK automatically uses your version of Jackson when it finds the library on the CLASSPATH, you may wish to be explicit, or use an already configured ObjectMapper, as in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">import com.couchbase.client.java.env.ClusterEnvironment;
import com.couchbase.client.java.codec.JacksonJsonSerializer;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.annotation.JsonProperty;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">ObjectMapper mapper = new ObjectMapper();
mapper.registerModule(new JsonValueModule()); // for JsonObject

ClusterEnvironment env = 
  ClusterEnvironment.builder()
    .jsonSerializer(JacksonJsonSerializer.create(mapper))
    .build();

Cluster cluster = Cluster.connect(
  connectionString,
  ClusterOptions
    .clusterOptions(username, password)
    .environment(env));</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this setup, we can then configure our classes as we wish.
Here, we&#8217;ve just renamed the Java class and its fields in Spanish.
But the generated JSON will have the same fields as before, for easy interoperability:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">public class Persona {
  @JsonProperty("name")
  public String nombre;
  
  @JsonProperty("number")
  public int numero;
  
  // ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="datatypes"><a class="anchor" href="#datatypes"></a>Modelling JSON datatypes in Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;ve only looked at a few datatypes so far, JSON objects <code>{}</code>, strings, and integers. But the full range of JSON types can be expressed, with the obvious mappings to Java.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>string <code>"hello"</code></p>
</li>
<li>
<p>integer <code>123</code></p>
</li>
<li>
<p>float <code>123.456</code></p>
</li>
<li>
<p>boolean: <code>true</code>, <code>false</code></p>
</li>
<li>
<p>object: <code>JavaObject</code>, <code>Map</code></p>
</li>
<li>
<p>array: <code>JavaArray</code>, <code>List</code></p>
</li>
<li>
<p>null</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In general, these values can be inserted as top-level values, or nested within an object or array. Let&#8217;s look at a few examples:</p>
</div>
<div class="sect2">
<h3 id="nested-object"><a class="anchor" href="#nested-object"></a>Nested object</h3>
<div class="paragraph">
<p>This example shows a variety of data types, including a nested array ("possessions") and object ("address"):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">JsonObject arthur = JsonObject.create()
  .put("name", "Arthur")
  .put("number", 42)
  .put("float", 42.0)
  .put("address", JsonObject.create()
    .put("street", "Country Lane")
    .put("number", 155)
    .put("town", "Cottington"))
  .put("harmless", true)
  .put("tea", JsonNull.INSTANCE) // or e.g. (String) null
  .put("possessions",
        JsonArray.from(
          "dressing gown",
          "pyjamas"));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="top-level-values-other-than-jsonobject"><a class="anchor" href="#top-level-values-other-than-jsonobject"></a>Top level values other than JsonObject</h3>
<div class="paragraph">
<p>Although it&#8217;s common to use a JsonObject, or a JsonArray as the inserted value to couchbase, other values are supported.</p>
</div>
<div class="paragraph">
<p>For example, to insert a string value, we could simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">collection.upsert("some-string", "string-value");</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can retrieve this value as usual, with the appropriate <code>.contentAs()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">System.out.println(
  collection.get("some-string")
    .contentAs(String.class));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dates"><a class="anchor" href="#dates"></a>Dates</h3>
<div class="paragraph">
<p>JSON has no built-in representation of dates, so commonly they are represented as one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a string-formatted <a href="https://www.w3.org/TR/NOTE-datetime" target="_blank" rel="noopener">ISO-8601</a> date</p>
</li>
<li>
<p>an offset in seconds or milliseconds from the Unix epoch 1 January 1970 UTC</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While it doesn&#8217;t matter which you choose (as long as you serialize and deserialize your Date object consistently!) it may make sense to store the dates in Couchbase in a format that can be easily manipulated using the <a href="#7.1@server:n1ql:n1ql-language-reference/datefun.adoc" class="xref unresolved">date functions in N1QL</a>.</p>
</div>
<div class="paragraph">
<p>Handily, as we can see on the same page, the
<a href="#7.1@server:n1ql:n1ql-language-reference$datefun.adoc#date-formats" class="xref unresolved">supported date formats</a> are the usual convention in JSON.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at a brief example of how we might implement this, to serialize a new Event class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">public  class Event {
  public String name;
  
  @JsonFormat(shape=JsonFormat.Shape.STRING, pattern="yyyy-MM-dd'T'HH:mm:ss")
  public LocalDateTime date;
  
  // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll need a few extra imports:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">import java.time.*;
import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;
import com.fasterxml.jackson.databind.SerializationFeature;
import com.fasterxml.jackson.annotation.JsonFormat;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we are controlling the serialization carefully, we&#8217;ll also want to register our own <a href="#ObjectMapper">ObjectMapper</a> as above, and additionally configure some of the date handling properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">mapper.registerModule(new JavaTimeModule());
mapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now all this is set up we can simply serialize and deserialize our Event objects exactly as we&#8217;ve done before:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">Event towelday = new Event("Towel Day",
  LocalDateTime.of(2021, Month.MAY, 25, 9, 30));

collection.upsert("towel-day", towelday);

Event event = collection.get("towel-day").contentAs(Event.class);
System.out.println(event.date);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="subdocuments"><a class="anchor" href="#subdocuments"></a>Subdocuments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The JsonObjects work equally well with the <a href="subdocument-operations.html" class="xref page">Sub-Document</a> API.
So taking our original "Arthur" object above, we can insert a simple value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">String string = "value";
collection.mutateIn("arthur",
  Arrays.asList(MutateInSpec.upsert("key", string)));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">{ "name": "Arthur",
  "number": 42,
  "key": "value" }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or we could insert another nested object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">JsonObject object  = JsonObject.create().put("subkey", "subvalue");
collection.mutateIn("arthur",
  Arrays.asList(MutateInSpec.upsert("key", object)));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">{ "name": "Arthur",
  "number": 42,
  "key": {
    "subkey":"subvalue"
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, paths cannot exceed 1024 characters, and cannot be more than 32 levels deep.
DJSON documents with more than 32 nested layers cannot be parsed, atttempting to do so will result in a <code>DocumentTooDeepException</code> exception.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="identifying-the-type-of-arbitrary-json"><a class="anchor" href="#identifying-the-type-of-arbitrary-json"></a>Identifying the type of arbitrary JSON</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Though you will often be mapping objects to JSON according to a defined schema, sometimes you may wish to handle values with unknown types.</p>
</div>
<div class="paragraph">
<p>As we want to interrogate a specific Java object with well-defined semantics, we again want to specify the <a href="#ObjectMapper">ObjectMapper</a> used.</p>
</div>
<div class="paragraph">
<p>We can now convert the result to Jackson&#8217;s <code>JsonNode</code>, and use its rich set of methods to identify and handle arbitrary values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">import com.fasterxml.jackson.databind.JsonNode;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/4b52fe9c4c38bcc46fb7ba50ad816b898e9f122c/modules/howtos/examples/Json.java">GetResult result = collection.get("mystery");

JsonNode node = result.contentAs(JsonNode.class);
if (node.isBoolean()) {
  System.out.println("It's a boolean!");
  if (node.booleanValue()) {
    System.out.println("SUCCESS!");
  }
}
else {
  System.out.println(node.getNodeType());
  // STRING
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="additional-resources"><a class="anchor" href="#additional-resources"></a>Additional Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Read more about the <a href="#7.1@server:learn:data/data.adoc" class="xref unresolved">Couchbase Data Model</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2024 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"SDKs","components":["dotnet-sdk","java-sdk","nodejs-sdk","python-sdk","tableau-connector","sdk-extensions"],"url":"/home/sdk.html","latestVersions":{"dotnet-sdk":"3.3","java-sdk":"3.3","nodejs-sdk":"4.1","python-sdk":"4.0","tableau-connector":"1.x","sdk-extensions":"master"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
