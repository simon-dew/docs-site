<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>SQL++ Support for Couchbase Transactions | Couchbase Docs (Preview)</title>
<link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-11696/cloud/n1ql/n1ql-language-reference/transactions.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="SQL++ offers full support for Couchbase ACID transactions based on optimistic concurrency.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="cloud">
<meta name="dcterms.identifier" content="">
<meta name="page-url" content="/cloud/n1ql/n1ql-language-reference/transactions.html">
<meta name="page-nav-header-levels" content="1">
<meta name="generator" content="Antora 3.1.4">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://simon-dew.github.io/docs-site/DOC-11696/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://simon-dew.github.io/docs-site/DOC-11696/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="https://github.com/simon-dew/docs-devex/edit/capella/modules/n1ql/pages/n1ql-language-reference/transactions.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../index.html">Couchbase Capella</a></li>
<li class="crumb">Develop</li>
<li class="crumb"><a href="../query.html">Query Data with SQL++</a></li>
<li class="crumb"><a href="../advanced.html">Advanced Query Features</a></li>
<li class="crumb"><a href="transactions.html">SQL++ Support for Couchbase Transactions</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">SQL++ Support for Couchbase Transactions</h1>
<div class="labels">
<ul>
<li class="concept"><span><i class="far fa-lightbulb"></i> concept</span></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
SQL++ offers full support for Couchbase ACID transactions based on optimistic concurrency.
</blockquote>
</div>
<div class="paragraph">
<p>A transaction is a group of operations that are either committed to the database together, or are all undone from the database if there&#8217;s a failure.
Refer to <a href="#server:learn:data/transactions.adoc" class="xref unresolved">Transactions</a> for an overview of Couchbase transactions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only DML statements are permitted within a transaction: <a href="insert.html" class="xref page">INSERT</a>, <a href="upsert.html" class="xref page">UPSERT</a>, <a href="delete.html" class="xref page">DELETE</a>, <a href="update.html" class="xref page">UPDATE</a>, <a href="merge.html" class="xref page">MERGE</a>, <a href="selectintro.html" class="xref page">SELECT</a>, <a href="execfunction.html" class="xref page">EXECUTE FUNCTION</a>, <a href="prepare.html" class="xref page">PREPARE</a>, or <a href="execute.html" class="xref page">EXECUTE</a>.</p>
</li>
<li>
<p>The <code>EXECUTE FUNCTION</code> statement is only permitted in a transaction if the user-defined function does not contain any subqueries other than <code>SELECT</code> subqueries.</p>
</li>
<li>
<p>The <code>PREPARE</code> and <code>EXECUTE</code> statements are only permitted in a transaction for the DML statements listed above.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All statements within a transaction are sent to the same Query node.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="statements"><a class="anchor" href="#statements"></a>Statements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SQL++ provides the following statements in support of Couchbase transactions.
Refer to the documentation for each statement for more information and examples.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To begin a transaction, refer to <a href="begin-transaction.html" class="xref page">BEGIN TRANSACTION</a>.</p>
</li>
<li>
<p>To specify transaction settings, refer to <a href="set-transaction.html" class="xref page">SET TRANSACTION</a>.</p>
</li>
<li>
<p>To set a savepoint, refer to <a href="savepoint.html" class="xref page">SAVEPOINT</a>.</p>
</li>
<li>
<p>To rollback a transaction, refer to <a href="rollback-transaction.html" class="xref page">ROLLBACK TRANSACTION</a>.</p>
</li>
<li>
<p>To commit a transaction, refer to <a href="commit-transaction.html" class="xref page">COMMIT TRANSACTION</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="settings-and-parameters"><a class="anchor" href="#settings-and-parameters"></a>Settings and Parameters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Query service provides settings and parameters in support of Couchbase transactions.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting&#160;/ Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#server:settings:query-settings.adoc#txid" class="xref unresolved">txid</a> request-level parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the transaction to which a statement belongs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#server:settings:query-settings.adoc#tximplicit" class="xref unresolved">tximplicit</a> request-level parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies that a statement is a single transaction.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#server:settings:query-settings.adoc#txstmtnum" class="xref unresolved">txstmtnum</a> request-level parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the transaction statement number.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#server:settings:query-settings.adoc#kvtimeout" class="xref unresolved">kvtimeout</a> request-level parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the maximum time to spend on a KV operation within a transaction before timing out.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#server:settings:query-settings.adoc#durability_level" class="xref unresolved">durability_level</a> request-level parameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the transactional durability level.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#server:settings:query-settings.adoc#txtimeout_req" class="xref unresolved">txtimeout</a> request-level parameter<br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the maximum time to spend on a transaction before timing out.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#server:settings:query-settings.adoc#atrcollection_req" class="xref unresolved">atrcollection</a> request-level parameter<br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify where the active transaction record is stored.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition, the <a href="#server:settings:query-settings.adoc#scan_consistency" class="xref unresolved">scan-consistency</a> request-level parameter is used to specify the transactional scan consistency.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-tools"><a class="anchor" href="#query-tools"></a>Query Tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To create a Couchbase transaction using SQL++, you can use the <a href="../../clusters/query-service/query-workbench.html" class="xref page">Query Workbench</a>.</p>
</div>
<div class="paragraph">
<p>Note that some Couchbase SDKs provide APIs to support Couchbase transactions.
For further details, refer to <a href="#server:learn:data/transactions.adoc" class="xref unresolved">Transactions</a> in the Server documentation.</p>
</div>
<div class="sect2">
<h3 id="couchbase-transactions-with-the-query-workbench"><a class="anchor" href="#couchbase-transactions-with-the-query-workbench"></a>Couchbase Transactions with the Query Workbench</h3>
<div class="ulist">
<ul>
<li>
<p>To execute a transaction containing multiple statements, compose the sequence of statements in the Query Editor.
Each statement must be terminated with a semicolon.
After each statement, you must press <span class="keyseq"><kbd>Shift</kbd>+<kbd>Enter</kbd></span> to start a new line <em>without</em> executing the query.
You can then click <b class="button">Execute</b> to execute the transaction.</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>You do not need to specify the <code>txid</code> parameter or the <code>tximplicit</code> parameter.
If you need to specify any other parameters for the Couchbase transaction, you can use the Query Options window.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="monitoring"><a class="anchor" href="#monitoring"></a>Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can monitor active Couchbase transactions using the <code>system:transactions</code> catalog.
For more information, refer to <a href="#server:manage:monitor/monitoring-n1ql-query.adoc#sys-transactions" class="xref unresolved">system:transactions</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="worked-example"><a class="anchor" href="#worked-example"></a>Worked Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This worked example guides you through a complete Couchbase transaction session using SQL++.</p>
</div>
<div class="sect2">
<h3 id="preparation"><a class="anchor" href="#preparation"></a>Preparation</h3>
<div class="paragraph">
<p>The worked example assumes that the supplied <code>travel-sample</code> bucket is installed.
Refer to <a href="../../clusters/data-service/import-data-documents.html#import-overview" class="xref page">Sample Buckets</a> for installation details.</p>
</div>
<div class="paragraph">
<div class="title">Context</div>
<p>For this worked example, set the query context to the <code>tenant_agent_00</code> scope in the travel sample dataset.
For more information, see <a href="../n1ql-intro/queriesandresults.html#query-context" class="xref page">Query Context</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../guides/_images/transactions-context.png" alt="The query context drop-down menu, with the tenant_agent_00 scope selected">
</div>
</div>
<div class="paragraph">
<div class="title">Index</div>
<p>For the purposes of this worked example, you must create a primary index in the keyspace you will be using.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Create a primary index on <code>`travel-sample`.tenant_agent_00.bookings</code>, so that you can query and update the documents in this keyspace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="https://github.com/simon-dew/docs-devex/blob/cb376bc2a05f87d695890908b05b3a6bf793fb46/modules/n1ql/examples/transactions/multiple.n1ql#L12">CREATE PRIMARY INDEX ON bookings;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Parameters</div>
<p>If necessary, set the transaction parameters for this worked example.
In particular, you will turn off durability for the purposes of this example, in order to make sure that there are no problems meeting the transaction durability requirements.</p>
</div>
<div id="tabs-1" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-1-query-workbench" class="tab">
<p>Query Workbench</p>
</li>
</ul>
</div>
<div id="tabs-1-query-workbench--panel" class="tabpanel" aria-labelledby="tabs-1-query-workbench">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Query Options</strong> to display the Query Options window.</p>
</li>
<li>
<p>Open the <strong>Scan Consistency</strong> drop-down list and select <strong>not_bounded</strong>.</p>
</li>
<li>
<p>In the <strong>Transaction Timeout</strong> box, enter <code>120</code>.</p>
</li>
<li>
<p>In the <strong>Named Parameters</strong> section, click the <b class="button">+</b> button to add a named parameter.</p>
</li>
<li>
<p>When the new named parameter appears, enter <code>durability_level</code> in the <strong>name</strong> box and <code>"none"</code> (with double quotes) in the <strong>value</strong> box.</p>
</li>
<li>
<p>Choose <b class="button">Save</b> to save the preferences and return to the Query tab.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="transaction"><a class="anchor" href="#transaction"></a>Transaction</h3>
<div id="ex-1" class="exampleblock">
<div class="title">Example 1. Transaction using the Query Workbench</div>
<div class="content">
<div class="paragraph">
<p>Copy the entire sequence below and paste it into the <a href="../../clusters/query-service/query-workbench.html" class="xref page">Query Workbench</a>, then click <b class="button">Run</b>.</p>
</div>
<div class="listingblock">
<div class="title">Transaction</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="https://github.com/simon-dew/docs-devex/blob/cb376bc2a05f87d695890908b05b3a6bf793fb46/modules/n1ql/examples/transactions/multiple.n1ql">-- Start the transaction
BEGIN WORK;

-- Specify transaction settings
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

-- Create a booking document
UPSERT INTO bookings
VALUES("bf7ad6fa-bdb9-4099-a840-196e47179f03", {
  "date": "07/24/2021",
  "flight": "WN533",
  "flighttime": 7713,
  "price": 964.13,
  "route": "63986"
});

-- Set a savepoint
SAVEPOINT s1;

-- Update the booking document to include a user
UPDATE bookings AS b
SET b.`user` = "0"
WHERE META(b).id = "bf7ad6fa-bdb9-4099-a840-196e47179f03";

-- Check the content of the booking and user
SELECT b.*, u.name
FROM bookings b
JOIN users u
ON b.`user` = META(u).id
WHERE META(b).id = "bf7ad6fa-bdb9-4099-a840-196e47179f03";

-- Set a second savepoint
SAVEPOINT s2;

-- Update the booking documents to change the user
UPDATE bookings AS b
SET b.`user` = "1"
WHERE META(b).id = "bf7ad6fa-bdb9-4099-a840-196e47179f03";

-- Check the content of the booking and user
SELECT b.*, u.name
FROM bookings b
JOIN users u
ON b.`user` = META(u).id
WHERE META(b).id = "bf7ad6fa-bdb9-4099-a840-196e47179f03";

-- Roll back the transaction to the second savepoint
ROLLBACK TRAN TO SAVEPOINT s2;

-- Check the content of the booking and user again
SELECT b.*, u.name
FROM bookings b
JOIN users u
ON b.`user` = META(u).id
WHERE META(b).id = "bf7ad6fa-bdb9-4099-a840-196e47179f03";

-- Commit the transaction
COMMIT WORK;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The results of running the transaction in the Query Workbench are shown below.</p>
</div>
<div class="listingblock no-callouts">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/simon-dew/docs-devex/blob/cb376bc2a05f87d695890908b05b3a6bf793fb46/modules/n1ql/examples/transactions/results.jsonc">[
  {
    "batchQuery": "-- Start the transaction\nBEGIN WORK;",
    "batchQueryResult": [
      {
        "txid": "d3bbf182-1179-42ba-8900-eb20fda69e42" <i class="conum" data-value="1"></i><b>(1)</b>
      }
    ]
  },</code></pre>
</div>
</div>
<div class="paragraph">
<p>Beginning a transaction returns a unique transaction ID <code>txid</code>.</p>
</div>
<div class="listingblock no-callouts">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/simon-dew/docs-devex/blob/cb376bc2a05f87d695890908b05b3a6bf793fb46/modules/n1ql/examples/transactions/results.jsonc">  {
    "batchQuery": "\n\n-- Specify transaction settings\nSET TRANSACTION ISOLATION LEVEL READ COMMITTED;",
    "batchQueryResult": []
  },
  {
    "batchQuery": "\n\n-- Create a booking document\nUPSERT INTO bookings\nVALUES(\"bf7ad6fa-bdb9-4099-a840-196e47179f03\", {\n  \"date\": \"07/24/2021\",\n  \"flight\": \"WN533\",\n  \"flighttime\": 7713,\n  \"price\": 964.13,\n  \"route\": \"63986\"\n});",
    "batchQueryResult": []
  },
  {
    "batchQuery": "\n\n-- Set a savepoint\nSAVEPOINT s1;",
    "batchQueryResult": []
  },
  {
    "batchQuery": "\n\n-- Update the booking document to include a user\nUPDATE bookings AS b\nSET b.`user` = \"0\"\nWHERE META(b).id = \"bf7ad6fa-bdb9-4099-a840-196e47179f03\";",
    "batchQueryResult": []
  },
  {
    "batchQuery": "\n\n-- Check the content of the booking and user\nSELECT b.*, u.name\nFROM bookings b\nJOIN users u\nON b.`user` = META(u).id\nWHERE META(b).id = \"bf7ad6fa-bdb9-4099-a840-196e47179f03\";",
    "batchQueryResult": [
      {
        "date": "07/24/2021",
        "flight": "WN533",
        "flighttime": 7713,
        "name": "Keon Hoppe",
        "price": 964.13,
        "route": "63986",
        "user": "0" <i class="conum" data-value="1"></i><b>(1)</b>
      }
    ]
  },</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before setting the second savepoint, the booking document has user <code>"0"</code>, name <code>"Keon Hoppe"</code>.</p>
</div>
<div class="listingblock no-callouts">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/simon-dew/docs-devex/blob/cb376bc2a05f87d695890908b05b3a6bf793fb46/modules/n1ql/examples/transactions/results.jsonc">  {
    "batchQuery": "\n\n-- Set a second savepoint\nSAVEPOINT s2;",
    "batchQueryResult": []
  },
  {
    "batchQuery": "\n\n-- Update the booking documents to change the user\nUPDATE bookings AS b\nSET b.`user` = \"1\"\nWHERE META(b).id = \"bf7ad6fa-bdb9-4099-a840-196e47179f03\";",
    "batchQueryResult": []
  },
  {
    "batchQuery": "\n\n-- Check the content of the booking and user\nSELECT b.*, u.name\nFROM bookings b\nJOIN users u\nON b.`user` = META(u).id\nWHERE META(b).id = \"bf7ad6fa-bdb9-4099-a840-196e47179f03\";",
    "batchQueryResult": [
      {
        "date": "07/24/2021",
        "flight": "WN533",
        "flighttime": 7713,
        "name": "Rigoberto Bernier",
        "price": 964.13,
        "route": "63986",
        "user": "1" <i class="conum" data-value="1"></i><b>(1)</b>
      }
    ]
  },</code></pre>
</div>
</div>
<div class="paragraph">
<p>After setting the second savepoint and performing an update, the booking document has user <code>"1"</code>, name <code>"Rigoberto Bernier"</code>.</p>
</div>
<div class="listingblock no-callouts">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/simon-dew/docs-devex/blob/cb376bc2a05f87d695890908b05b3a6bf793fb46/modules/n1ql/examples/transactions/results.jsonc">  {
    "batchQuery": "\n\n-- Roll back the transaction to the second savepoint\nROLLBACK TRAN TO SAVEPOINT s2;",
    "batchQueryResult": []
  },
  {
    "batchQuery": "\n\n-- Check the content of the booking and user again\nSELECT b.*, u.name\nFROM bookings b\nJOIN users u\nON b.`user` = META(u).id\nWHERE META(b).id = \"bf7ad6fa-bdb9-4099-a840-196e47179f03\";",
    "batchQueryResult": [
      {
        "date": "07/24/2021",
        "flight": "WN533",
        "flighttime": 7713,
        "name": "Keon Hoppe",
        "price": 964.13,
        "route": "63986",
        "user": "0" <i class="conum" data-value="1"></i><b>(1)</b>
      }
    ]
  },
  {
    "batchQuery": "\n\n-- Commit the transaction\nCOMMIT WORK;",
    "batchQueryResult": []
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>After rolling back to the second savepoint, the booking document again has user <code>"0"</code>, name <code>"Keon Hoppe"</code>.</p>
</div>
</div>
</div>
<div id="ex-2" class="exampleblock">
<div class="title">Example 2. Check the results of <a href="#ex-1">Example 1</a></div>
<div class="content">
<div class="paragraph">
<p>Check the result of committing the transaction.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp" data-source-url="https://github.com/simon-dew/docs-devex/blob/cb376bc2a05f87d695890908b05b3a6bf793fb46/modules/n1ql/examples/transactions/multiple.n1ql#L112-L116">SELECT b.*, u.name
FROM bookings b
JOIN users u
ON b.`user` = META(u).id
WHERE META(b).id = "bf7ad6fa-bdb9-4099-a840-196e47179f03";</code></pre>
</div>
</div>
<div class="listingblock no-callouts">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/simon-dew/docs-devex/blob/cb376bc2a05f87d695890908b05b3a6bf793fb46/modules/n1ql/examples/transactions/results.jsonc#L84-L92">{
  "date": "07/24/2021",
  "flight": "WN533",
  "flighttime": 7713,
  "name": "Keon Hoppe",
  "price": 964.13,
  "route": "63986",
  "user": "0" <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The booking document has been added with the attributes that were present when the transaction was committed.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-links"><a class="anchor" href="#related-links"></a>Related Links</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Blog post: <a href="https://blog.couchbase.com/transactions-n1ql-couchbase-distributed-nosql/" target="_blank" rel="noopener">Couchbase Transactions: Elastic, Scalable, and Distributed</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2024 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Capella","components":["cloud"],"url":"/cloud/index.html","latestVersions":{"cloud":""}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
