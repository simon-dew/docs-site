<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>Store and Process Time Series Data | Couchbase Docs (Preview)</title>
<link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-11696/cloud/n1ql/n1ql-language-reference/time-series.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Couchbase Capella can store and process time series data.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="cloud">
<meta name="dcterms.identifier" content="">
<meta name="page-url" content="/cloud/n1ql/n1ql-language-reference/time-series.html">
<meta name="page-nav-header-levels" content="1">
<meta name="generator" content="Antora 3.1.4">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://simon-dew.github.io/docs-site/DOC-11696/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://simon-dew.github.io/docs-site/DOC-11696/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="https://github.com/simon-dew/docs-devex/edit/capella/modules/n1ql/pages/n1ql-language-reference/time-series.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../../index.html">Couchbase Capella</a></li>
<li class="crumb">Develop</li>
<li class="crumb"><a href="../query.html">Query Data with SQL++</a></li>
<li class="crumb"><a href="../advanced.html">Advanced Query Features</a></li>
<li class="crumb"><a href="time-series.html">Store and Process Time Series Data</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Store and Process Time Series Data</h1>
<div class="labels">
<ul>
<li class="concept"><span><i class="far fa-lightbulb"></i> concept</span></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
Couchbase Capella can store and process time series data.
</blockquote>
</div>
<div class="paragraph">
<p>Time series data is any data which changes over time.
In the case of data management, it refers to data collected frequently, in regular or irregular intervals, from a device or a process.
The changing data is typically numerical, and changes incrementally.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This feature is only available on databases using Couchbase Server 7.2 or later.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-type"><a class="anchor" href="#document-type"></a>Types of Time Series</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A time series may be regular or irregular.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In a regular time series, the data points are collected at regular intervals.
For example, stock ticker prices, or climate data.
If no data is available to collect at that time, data can be stored as <code>null</code>.</p>
<div class="literalblock">
<div class="content">
<pre>Date,Low,High,Mean,Region
2013-1-2,-2,5,1.5,UK
2013-1-1,-2,5,1.5,UK
...</pre>
</div>
</div>
</li>
<li>
<p>In an irregular time series, the data points occur at irregular intervals: that is, you do not know in advance when a data point will be collected.
For example, historical earthquake data, or house sales and prices in an area over time.</p>
<div class="literalblock">
<div class="content">
<pre>Date,Price,District
7/1/97,69950,South
10/1/97,67000,South
6/1/98,71500,South
7/1/98,73000,South
8/1/98,72000,South
...</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-structure"><a class="anchor" href="#document-structure"></a>Structure of Time Series Documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Couchbase Capella, time series data must be stored in time series documents with a specific format, which ensures compact storage and quick processing.
Couchbase time series documents have the following general characteristics.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All date and time values associated with the time series are stored as integers, representing the number of milliseconds since the <a href="https://en.wikipedia.org/wiki/Unix_time">Unix epoch</a>.
The maximum date and time is <a href="https://docs.gtk.org/glib/const.MAXINT64.html">MaxInt64</a> milliseconds&#8201;&#8212;&#8201;that is, <code>(2^63)-1</code>, or approximately 292.5 million years.</p>
</li>
<li>
<p>The data values stored at each time point are stored as values in arrays, not as named fields in objects.
If there are multiple data values at each time point, the order of values must be consistent for all time points.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each time series document must contain the following fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Default name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Schema</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>ts_start</strong><br>
<em>Required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The start date and time of the data in this document.
You can use a different name for this field, but you must then specify the path to the field when you query the data.</p>
</div>
<div class="paragraph">
<p>The start date and time is usually the same as the first time point in the document.
However, this depends on the data, and your data storage strategy.
For example, if each time series document contains a month&#8217;s data, then the start date and time may be exactly at the start of the month, rather than the first time point in the document.</p>
</div>
<div class="paragraph">
<p>If this field is omitted, the document is ignored by time series queries.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Integer (milliseconds since the <a href="https://en.wikipedia.org/wiki/Unix_time">Unix epoch</a>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>ts_end</strong><br>
<em>Required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The end date and time of the data in this document.
You can use a different name for this field, but you must then specify the path to the field when you query the data.</p>
</div>
<div class="paragraph">
<p>The end date and time is usually the same as the last time point in the document.
However, this depends on the data, and your data storage strategy.
For example, if each time series document contains a month&#8217;s data, then the end date and time may be exactly at the end of the month, rather than the last time point in the document.</p>
</div>
<div class="paragraph">
<p>If this field is omitted, the document is ignored by time series queries.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Integer (milliseconds since the <a href="https://en.wikipedia.org/wiki/Unix_time">Unix epoch</a>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>ts_interval</strong><br>
<em>Required</em> for regular time series</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The interval between data points, in milliseconds.
You can use a different name for this field, but you must then specify the path to the field when you query the data.</p>
</div>
<div class="paragraph">
<p>If this field is omitted, the document is assumed to contain an irregular time series.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Integer (milliseconds)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>ts_data</strong><br>
<em>Required</em></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The time series data.
This field must be an array.
Each element in the array represents a single time point.</p>
</div>
<div class="paragraph">
<p>For a regular time series, each element may be a literal representing a single value at that time point, or a nested array containing multiple values for that time point.</p>
</div>
<div class="paragraph">
<p>For an irregular time series, each element must be a nested array.
The first value in the nested array represents the time at that time point, in milliseconds since the <a href="https://en.wikipedia.org/wiki/Unix_time">Unix epoch</a>.
The other values in the nested array represent the data values at that time point.</p>
</div>
<div class="paragraph">
<p>If this field is omitted, the document is ignored by time series queries.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Array, or array of arrays</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The document may contain any other fields you require.</p>
</div>
<div class="paragraph">
<p>As <code>ts_data</code> is usually the largest field, you may consider storing it after other commonly-used fields in the document for faster access.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The date-time values in a time series document may represent values smaller than milliseconds, if required.
You are recommended to use milliseconds for easy compatibility with SQL++ date and time functions.
If you need to use date-time values smaller than milliseconds, you must use a multiplication factor to use the date-time values with date and time functions.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="examples-of-time-series-documents"><a class="anchor" href="#examples-of-time-series-documents"></a>Examples of Time Series Documents</h3>
<div class="exampleblock">
<div class="title">Example 1. Regular time series data with a single data point</div>
<div class="content">
<div class="paragraph">
<p>This document contains invented stock ticker data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "ticker": "BASE",
  "ts_start": 1677730930000,
  "ts_end": 1677730939000,
  "ts_interval": 1000,
  "ts_data": [ 16.30, 16.31, 16.32, 16.33, 16.34,
               16.35, 16.36, 16.37, 16.38, 16.39 ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the document contains a time series start, a time series end, and a time series interval.
The time series interval is 1,000 milliseconds, which means the time points are 1 second apart.</p>
</div>
<div class="paragraph">
<p>Within the time series data, each time point has a single value.
The date and time for each time point is determined by the time series start and the time series interval.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 2. Regular time series data with multiple data points</div>
<div class="content">
<div class="paragraph">
<p>This document contains invented stock ticker data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "ticker": "XYZ",
  "ts_interval": 86400000,
  "ts_start": 1359676800000,
  "ts_end": 1362009600000,
  "ts_data": [
      [ 27.285, 27.595, 27.24, 27.295 ],
      [ 27.64, 27.95, 27.365, 27.61 ],
      // ...
      [ 27.45, 27.605, 27.395, 27.545 ]
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the document contains a time series start, a time series end, and a time series interval.
The time series interval is 86,400,000 milliseconds, which means the time points are 1 day apart.</p>
</div>
<div class="paragraph">
<p>Within the time series data, each time point has four values, representing the daily opening, high, low, and closing stock prices.
The order of values must be consistent for each time point.
The date and time for each time point is determined by the time series start and the time series interval.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 3. Irregular time series data</div>
<div class="content">
<div class="paragraph">
<p>This document contains historical house price data for a neighborhood.
<sup class="footnote" id="_footnote_ogl">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "ts_start": 631152000000,
  "ts_end": 946641600000,
  "ts_data": [
    // ...
    [867715200000, 69950],
    [875664000000, 67000],
    [896659200000, 71500],
    [899251200000, 73000],
    [901929600000, 72000]
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the document contains a time series start and end, but no time series interval.</p>
</div>
<div class="paragraph">
<p>Within the time series data, for each time point, the first value is a date-time stamp.
The second value is the house price.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="storage-strategy"><a class="anchor" href="#storage-strategy"></a>Time Series Data Storage Strategy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To reduce index sizes and increase performance, store your time series data using the largest possible arrays in the smallest number of documents.</p>
</div>
<div class="paragraph">
<p>The optimum size for each time series document depends on the type of queries you need to perform.
If you plan to query the time series data using ranges measured in days, it&#8217;s most efficient to store the time series data in documents which contain a day&#8217;s data.
Likewise, if you plan to query the time series data using ranges measured in hours, you should store the time series data in documents which contain an hour&#8217;s data, and so on.</p>
</div>
<div class="paragraph">
<p>To expand on this: if most of your queries use ranges of 2 to 4 hours, storing your time series data in documents which contain a day&#8217;s data can have an overhead of 80&ndash;90% data discard per document.
In this case, it would be more efficient to store the time series data in documents containing 4 hours' data.</p>
</div>
<div class="paragraph">
<p>The maximum size of a time series document is 20MB.</p>
</div>
<div class="paragraph">
<p>You should also consider data expiration when planning the optimum size for time series documents.
To minimize your storage requirements, you can set the <a href="#server:learn:data/expiration.adoc" class="xref unresolved">expiration</a> for your time series documents.
You can specify expiration at the bucket, collection, or document level, but it applies at the document level&#8201;&#8212;&#8201;when a document expires, all the time series data in that document is deleted.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ingestion"><a class="anchor" href="#ingestion"></a>Ingesting Time Series Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ingesting time series data into Couchbase is usually a multi-stage process, depending on the format of the original data.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Import the raw dataset from a supported format: CSV or JSON.
To do this, you can use
the <a href="../../clusters/data-service/import-data-documents.html" class="xref page">import</a> feature in the Couchbase UI,
or an SDK data parsing library.</p>
</li>
<li>
<p>When the data is imported, transform the imported data to one or more documents with the <a href="#document-structure">Couchbase time series document format</a>.
To do this, use an <a href="insert.html" class="xref page">INSERT SELECT</a> query or an SDK insert operation.</p>
<div class="ulist">
<ul>
<li>
<p>Convert any dates and times to milliseconds since the <a href="https://en.wikipedia.org/wiki/Unix_time">Unix epoch</a>.
To do this, use SQL++ <a href="datefun.html" class="xref page">date-time functions</a>, or date-time functions at the application level.</p>
</li>
<li>
<p>If necessary, set the expiration for the document, according to your data storage strategy.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="incremental-ingestion"><a class="anchor" href="#incremental-ingestion"></a>Incremental Time Series Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As more time series data is generated, you can ingest new data incrementally.
You can import the raw data just as you imported the initial data.</p>
</div>
<div class="paragraph">
<p>To transform the new data into time series documents, use one of these strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the new data does not overlap the date range of any existing time series documents, import the new data into new time series documents.
To do this, use an <a href="insert.html" class="xref page">INSERT SELECT</a> query or an SDK insert operation, just as you did with the initial data.</p>
</li>
<li>
<p>If the new data falls within the date range of an existing document, update an existing time series document.
There are two ways to do this:</p>
<div class="ulist">
<ul>
<li>
<p>Use an <a href="upsert.html" class="xref page">UPSERT SELECT</a> query or an SDK upsert operation to replace an existing time series document.</p>
</li>
<li>
<p>Use an <a href="update.html" class="xref page">UPDATE</a> query or an array-append SDK call using the sub-document API to append the new data to an existing time series document.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="indexes"><a class="anchor" href="#indexes"></a>Indexing Time Series Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To index time series data, you only need to create an index on the time series documents, not on the nested time series data within the documents.
This ensures that indexes of time series data are lean and efficient.</p>
</div>
<div class="paragraph">
<p>If your time series documents are as large as possible, the expiration of time series documents has a minimal impact on index maintenance and index scan.
Conversely, if your time series documents are smaller, index maintenance and scans may be much slower.
For more information, see <a href="#storage-strategy">Time Series Data Storage Strategy</a>.</p>
</div>
<div class="paragraph">
<p>An index on time series documents should include the <code>ts_end</code> field and the <code>ts_start</code> field, along with any other fields you need to index.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="queries"><a class="anchor" href="#queries"></a>Querying Time Series Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To query time series data, Couchbase Capella provides the _TIMESERIES function.
For full details and examples, see <a href="timeseries.html" class="xref page">_TIMESERIES Function</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For these examples, use the following links to download raw time series data to your local system.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../_attachments/regular-time-series.csv" target="_blank" rel="noopener">regular-time-series.csv</a>&#8201;&#8212;&#8201;invented temperature data</p>
</li>
<li>
<p><a href="../_attachments/irregular-time-series.csv" target="_blank" rel="noopener">irregular-time-series.csv</a>&#8201;&#8212;&#8201;historical house price data
<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</li>
</ul>
</div>
<div id="ex-import" class="exampleblock">
<div class="title">Example 4. Import time series data from CSV files</div>
<div class="content">
<div class="paragraph">
<p>Create a scope for the time series data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">CREATE SCOPE `travel-sample`.time IF NOT EXISTS;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create collections for the raw time series data within the new scope.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">CREATE COLLECTION `travel-sample`.time.regular IF NOT EXISTS;
CREATE COLLECTION `travel-sample`.time.irregular IF NOT EXISTS;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <a href="../../clusters/data-service/import-data-documents.html" class="xref page">Import</a> tool to import the irregular time series data:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <span class="menuseq"><b class="menu">Data Tools</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Import</b></span>.</p>
</li>
<li>
<p>In the <strong>Import</strong> tab, select <strong>A Single Collection</strong>.</p>
</li>
<li>
<p>In the <strong>travel-sample</strong> bucket, select the <strong>time</strong> scope and the <strong>irregular</strong> collection.</p>
</li>
<li>
<p>Click <b class="button">Select a file</b> and select <code>irregular-time-series.csv</code>.</p>
</li>
<li>
<p>In <strong>File Type</strong>, make sure <strong>CSV</strong> is selected.</p>
</li>
<li>
<p>In <strong>Document IDs</strong>, make sure <strong>UUID</strong> is selected.</p>
</li>
<li>
<p>Click <b class="button">Import Data File</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Use the <a href="../../clusters/data-service/import-data-documents.html" class="xref page">Import</a> tool to import the regular time series data:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Import</strong> tab, select <strong>A Single Collection</strong>.</p>
</li>
<li>
<p>In the <strong>travel-sample</strong> bucket, select the <strong>time</strong> scope and the <strong>regular</strong> collection.</p>
</li>
<li>
<p>Click <b class="button">Select a file</b> and select <code>regular-time-series.csv</code>.</p>
</li>
<li>
<p>In <strong>File Type</strong>, make sure <strong>CSV</strong> is selected.</p>
</li>
<li>
<p>In <strong>Document IDs</strong>, make sure <strong>UUID</strong> is selected.</p>
</li>
<li>
<p>Click <b class="button">Import Data File</b>.</p>
</li>
</ol>
</div>
</div>
</div>
<div id="ex-regular-insert" class="exampleblock">
<div class="title">Example 5. Convert regular time series data to a time series document</div>
<div class="content">
<div class="paragraph">
<p>For this example, set the query context to the <code>time</code> scope in the travel sample dataset.
For more information, see <a href="../n1ql-intro/queriesandresults.html#query-context" class="xref page">Query Context</a>.</p>
</div>
<div class="paragraph">
<p>First, create a primary index on the imported regular time series data so that you can query it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">CREATE PRIMARY INDEX ON regular;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a collection to contain the converted regular time series data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">CREATE COLLECTION weather;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following query takes the imported regular time series data and converts it to a time series document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">INSERT INTO weather
  (KEY _k, VALUE _v, OPTIONS {"expiration": 60*60*24*30})
SELECT "temp:mean:2013" _k,
  {"region":      r.Region,
   "ts_start":    MIN(timestamp),
   "ts_end":      MAX(timestamp),
   "ts_interval": 1000*60*60*24,
   "ts_data":     ARRAY t[1] FOR t IN
                  ARRAY_AGG([timestamp, r.Mean])
                  END} _v
FROM regular AS r
LET timestamp = STR_TO_MILLIS(r.Date, "YYYY-MM-DD")
WHERE timestamp
  BETWEEN STR_TO_MILLIS("2013-01-01", "YYYY-MM-DD")
      AND STR_TO_MILLIS("2013-11-30", "YYYY-MM-DD")
GROUP BY r.Region
RETURNING *;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The raw data is regular, with an interval of
1 day.
The query sets the time series interval accordingly.</p>
</div>
<div class="paragraph">
<p>The ARRAY_AGG function aggregates the required time series into a single time series data array.
Within the time series data array, each time point is constructed as a nested array, containing the date-time stamp and the mean temperature data.</p>
</div>
<div class="paragraph">
<p>As this is a regular time series, the ARRAY operator then strips out the date-time stamps to save storage space.
This two-step process ensures that the time series data points are preserved in the correct order.</p>
</div>
</div>
</div>
<div id="ex-irregular-insert" class="exampleblock">
<div class="title">Example 6. Convert irregular time series data to a time series document</div>
<div class="content">
<div class="paragraph">
<p>For this example, set the query context to the <code>time</code> scope in the travel sample dataset.
For more information, see <a href="../n1ql-intro/queriesandresults.html#query-context" class="xref page">Query Context</a>.</p>
</div>
<div class="paragraph">
<p>First, create a primary index on the imported irregular time series data so that you can query it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">CREATE PRIMARY INDEX ON irregular;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a collection to contain the converted irregular time series data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">CREATE COLLECTION housing;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following query takes the imported irregular time series data and converts it to a time series document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">INSERT INTO housing
  (KEY _k, VALUE _v, OPTIONS {"expiration": 60*60*24*30})
SELECT "sales:prices:2000s" _k,
  {"district": i.District,
   "ts_start": MIN(timestamp),
   "ts_end":   MAX(timestamp),
   "ts_data":  ARRAY_AGG([timestamp, i.Price])} _v
FROM irregular AS i
LET timestamp = STR_TO_MILLIS(i.Date, "2/1/06")
WHERE timestamp
  BETWEEN STR_TO_MILLIS("2000", "YYYY")
      AND STR_TO_MILLIS("2009", "YYYY")
GROUP BY i.District
RETURNING *;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The raw data is irregular, so the query does not set the time series interval.</p>
</div>
<div class="paragraph">
<p>Within the time series data array, each time point is constructed as a nested array, containing the date-time stamp and the house price data.</p>
</div>
</div>
</div>
<div id="ex-index" class="exampleblock">
<div class="title">Example 7. Create indexes for time series data</div>
<div class="content">
<div class="paragraph">
<p>For this example, set the query context to the <code>time</code> scope in the travel sample dataset.
For more information, see <a href="../n1ql-intro/queriesandresults.html#query-context" class="xref page">Query Context</a>.</p>
</div>
<div class="paragraph">
<p>The following query creates an index for the time series data created in <a href="#ex-regular-insert">Example 5</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">CREATE INDEX idx_mean_temp ON weather(region, ts_end, ts_start);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following query creates an index for the time series data created in <a href="#ex-irregular-insert">Example 6</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">CREATE INDEX idx_sales_prices ON housing(district, ts_end, ts_start);</code></pre>
</div>
</div>
</div>
</div>
<div id="ex-update" class="exampleblock">
<div class="title">Example 8. Add time series data to an existing time series document</div>
<div class="content">
<div class="paragraph">
<p>For this example, set the query context to the <code>time</code> scope in the travel sample dataset.
For more information, see <a href="../n1ql-intro/queriesandresults.html#query-context" class="xref page">Query Context</a>.</p>
</div>
<div class="paragraph">
<p>The following query appends new data to an existing regular time series document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">UPDATE weather AS w
USE KEYS "temp:mean:2013"
SET w.ts_data = ARRAY_CONCAT(w.ts_data, ARRAY_FLATTEN((
  SELECT RAW ARRAY t[1] FOR t IN
        ARRAY_AGG([timestamp, r.Mean])
        END
  FROM import AS r
  LET timestamp = STR_TO_MILLIS(r.Date, "YYYY-MM-DD")
  WHERE timestamp
    BETWEEN STR_TO_MILLIS("2013-12-01", "YYYY-MM-DD")
        AND STR_TO_MILLIS("2013-12-31", "YYYY-MM-DD")), 1)),
  w.ts_end = STR_TO_MILLIS("2013-12-31", "YYYY-MM-DD"),
  meta(w).expiration = meta(w).expiration
RETURNING *;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ARRAY_CONCAT and ARRAY_FLATTEN functions append the newly imported data to the existing time series data.</p>
</div>
<div class="paragraph">
<p>The newly imported data is converted by a subquery, which aggregates the mean temperature figures into a single time series data array, as in <a href="#ex-regular-insert">Example 5</a>.</p>
</div>
<div class="paragraph">
<p>The query sets the end date and time for the time series to the end of the year 2013.
See <a href="#ex-regular-end">Example 9</a> and <a href="#ex-irregular-end">Example 10</a> for other ways to set the end date and time for the time series.</p>
</div>
<div class="paragraph">
<p>The query specifies that the updated time series document should keep its current time-to-live.</p>
</div>
</div>
</div>
<div id="ex-regular-end" class="exampleblock">
<div class="title">Example 9. Update regular time series end date and time</div>
<div class="content">
<div class="paragraph">
<p>For this example, set the query context to the <code>time</code> scope in the travel sample dataset.
For more information, see <a href="../n1ql-intro/queriesandresults.html#query-context" class="xref page">Query Context</a>.</p>
</div>
<div class="paragraph">
<p>The following query updates the end date and time of a regular time series document to match the date-time stamp of the last time point.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">UPDATE weather AS w
USE KEYS "temp:mean:2013"
SET w.ts_end = w.ts_start +
 (w.ts_interval * ARRAY_LENGTH(w.ts_data))
RETURNING w.ts_end;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To calculate the end date and time, the query multiplies the time series interval by the number of time points in the time series data, and adds the result to the start date and time.</p>
</div>
</div>
</div>
<div id="ex-irregular-end" class="exampleblock">
<div class="title">Example 10. Update irregular time series end date and time</div>
<div class="content">
<div class="paragraph">
<p>For this example, set the query context to the <code>time</code> scope in the travel sample dataset.
For more information, see <a href="../n1ql-intro/queriesandresults.html#query-context" class="xref page">Query Context</a>.</p>
</div>
<div class="paragraph">
<p>The following query updates the end date and time of an irregular time series document to match the date-time stamp of the last time point.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sqlpp hljs" data-lang="sqlpp">UPDATE housing AS h
USE KEYS "sales:prices:2000s"
SET h.ts_end = h.ts_data[-1][0]
RETURNING h.ts_end;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To determine the end date and time, the query takes the first element (the date-time stamp) from the last time point in the time series data.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-links"><a class="anchor" href="#related-links"></a>Related Links</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Querying time series data: <a href="timeseries.html" class="xref page">_TIMESERIES Function</a></p>
</li>
<li>
<p>How-to guide: <a href="../../guides/import.html" class="xref page">Import Data with an SDK</a></p>
</li>
</ul>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Contains HM Land Registry data © Crown copyright and database right 2021. This data is licensed under the Open Government Licence v3.0.
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2024 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Capella","components":["cloud"],"url":"/cloud/index.html","latestVersions":{"cloud":""}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
