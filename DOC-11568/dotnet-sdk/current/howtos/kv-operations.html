<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>Key Value Operations | Couchbase Docs (Preview)</title>
<link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-11568/dotnet-sdk/current/howtos/kv-operations.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="Key Value Operations">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="dotnet-sdk">
<meta name="dcterms.identifier" content="3.3">
<meta name="page-url" content="/dotnet-sdk/current/howtos/kv-operations.html">
<meta name="page-nav-header-levels" content="0">
<meta name="generator" content="Antora 3.1.4">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://simon-dew.github.io/docs-site/DOC-11568/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://simon-dew.github.io/docs-site/DOC-11568/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="2">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="https://github.com/couchbase/docs-sdk-dotnet/edit/release/3.3/modules/howtos/pages/kv-operations.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../hello-world/overview.html">.NET SDK</a></li>
<li class="crumb">Working with Data</li>
<li class="crumb"><a href="kv-operations.html">Key Value Operations</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Key Value Operations</h1>
<div class="labels">
<ul><li class="guide"><span><i class="far fa-check-square"></i> how-to</span></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div class="sect1">
<h2 id="documents"><a class="anchor" href="#documents"></a>Documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <em>document</em> refers to an entry in the database (other databases may refer to the same concept as a <em>row</em>).
A document has an ID (<em>primary key</em> in other databases), which is unique to the document and by which it can be located.
The document also has a value which contains the actual application data.
See <a href="../concept-docs/documents.html" class="xref page">the concept guide to <em>Documents</em></a> for a deeper dive into documents in the Couchbase Data Platform.
Or read on, for a hands-on introduction to working with documents from the .NET SDK.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="crud-operations"><a class="anchor" href="#crud-operations"></a>CRUD Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The core interface to Couchbase Server is simple KV operations on full documents.
Make sure you&#8217;re familiar with the basics of authorization and connecting to a Cluster from the <a href="../hello-world/start-using-sdk.html" class="xref page">Start Using the SDK section</a>.
We&#8217;re going to expand on the short <em>Upsert</em> example we used there, adding options as we move through the various CRUD operations.
Here is the <em>Insert</em> operation at its simplest:</p>
</div>
<div class="listingblock">
<div class="title">Insert</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Couchbase.Examples/KvOperations.cs#L21-L27">var document = new {foo = "bar", bar = "foo"};
try {
    var result = await collection.InsertAsync("document-key", document);
}
catch (DocumentExistsException) {
    Console.WriteLine("Document already exists");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Options may be added to operations:</p>
</div>
<div class="listingblock">
<div class="title">Insert (with options)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Couchbase.Examples/KvOperations.cs#L33-L46">try {
    var document = new {foo = "bar", bar = "foo"};

    var result = await collection.InsertAsync("document-key", document,
        options =&gt;
        {
            options.Expiry(TimeSpan.FromDays(1));
            options.Timeout(TimeSpan.FromSeconds(5));
        }
    );
}
catch (DocumentExistsException) {
    // handle exception
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Setting a Compare and Swap (CAS) value is a form of optimistic locking - dealt with in depth in the <a href="concurrent-document-mutations.html" class="xref page">CAS page</a>.
Here we just note that the CAS is a value representing the current state of an item; each time the item is modified, its CAS changes.
The CAS value is returned as part of a document’s metadata whenever a document is accessed.
Without explicitly setting it, a newly-created document would have a CAS value of <em>0</em>.</p>
</div>
<div class="paragraph">
<p><em>Timeout</em> is an optional parameter which in the .NET SDK has a type value of <code>TimeSpan</code>.
Timeout sets the timeout value for the underlying network connection.
We will add to these options for the <em>Replace</em> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Couchbase.Examples/KvOperations.cs#L52-L64">var previousResult = await collection.GetAsync("document-key");
var cas = previousResult.Cas;

var document = new {foo = "bar", bar = "foo"};

var result = await collection.ReplaceAsync("document-key", document,
    options =&gt;
    {
        options.Cas(cas);
        options.Expiry(TimeSpan.FromMinutes(1));
        options.Timeout(TimeSpan.FromSeconds(5));
    }
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Expiration sets an explicit time to live (TTL) for a document.
We&#8217;ll discuss modifying <code>Expiration</code> in more details <a href="#expiration-ttl">below</a>.
For a discussion of item (Document) <em>vs</em> Bucket expiration, see the
<a href="#7.1@server:learn:buckets-memory-and-storage/expiration.adoc#expiration-ttl" class="xref unresolved">Expiration Overview page</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Couchbase.Examples/KvOperations.cs#L70-L78">var document = new { foo = "bar", bar = "foo" };
var result = await collection.UpsertAsync("document-key", document,
    options =&gt;
    {
        options.Expiry(TimeSpan.FromMinutes(1));
        options.Durability(PersistTo.One, ReplicateTo.One);
        options.Timeout(TimeSpan.FromSeconds(5));
    }
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we have add <em>Durability</em> options, namely <code>PersistTo</code> and <code>ReplicateTo</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="durability"><a class="anchor" href="#durability"></a>Durability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Couchbase Server releases before 6.5, Durability was set with these two options&#8201;&#8212;&#8201;see the <a href="#https://docs.couchbase.com/dotnet-sdk/2.7/durability.html" class="xref unresolved">6.0 Durability documentation</a>&#8201;&#8212;&#8201;covering  how many replicas the operation must be propagated to and how many persisted copies of the modified record must exist.
If 6.5 or above is being used, you can take advantage of the <a href="../concept-docs/durability-replication-failure-considerations.html#durable-writes" class="xref page">Durable Write</a> feature,
in which Couchbase Server will only return success to the SDK after the requested replication level has been achieved.
The three replication levels are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Majority</code> - The server will ensure that the change is available in memory on the majority of configured replicas.</p>
</li>
<li>
<p><code>MajorityAndPersistToActive</code> - Majority level, plus persisted to disk on the active node.</p>
</li>
<li>
<p><code>PersistToMajority</code> - Majority level, plus persisted to disk on the majority of configured replicas.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The options are in increasing levels of safety.
Note that nothing comes for free - for a given node, waiting for writes to storage is considerably slower than waiting for it to be available in-memory.
These trade offs, as well as which settings may be tuned, are discussed in the <a href="../concept-docs/durability-replication-failure-considerations.html#durable-writes" class="xref page">durability page</a>.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates using the newer durability features available in Couchbase server 6.5 onwards.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Couchbase.Examples/KvOperations.cs#L85-L93">var document = new { foo = "bar", bar = "foo" };
var result = await collection.UpsertAsync("document-key", document,
    options =&gt;
    {
        options.Expiry(TimeSpan.FromMinutes(1));
        options.Durability(DurabilityLevel.Majority);
        options.Timeout(TimeSpan.FromSeconds(5));
    }
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a version of Couchbase Server earlier than 6.5 is being used then the application can fall-back to <a href="../concept-docs/durability-replication-failure-considerations.html#older-server-versions" class="xref page">'client verified' durability</a>.
Here the SDK will do a simple poll of the replicas and only return once the requested durability level is achieved.</p>
</div>
<div class="paragraph">
<p>To stress, durability is a useful feature but should not be the default for most applications, as there is a performance consideration,
and the default level of safety provided by Couchbase will be reasonable for the majority of situations.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Sub-Document Operations</div>
<div class="paragraph">
<p>All of these operations involve fetching the complete document from the Cluster.
Where the number of operations or other circumstances make bandwidth a significant issue, the SDK can work on just a specific <em>path</em> of the document with <a href="subdocument-operations.html" class="xref page">Sub-Docunent Operations</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="retrieving-full-documents"><a class="anchor" href="#retrieving-full-documents"></a>Retrieving full documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using the <code>GetAsync()</code> method with the document key can be done in a similar fashion to the other operations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Couchbase.Examples/KvOperations.cs#L104-L107">var previousResult = await collection.UpsertAsync("string-key", "string value");

var result = await collection.GetAsync("string-key");
var content = result.ContentAs&lt;String&gt;();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Timeout can also be set - as in the earlier <code>Insert</code> example:</p>
</div>
<div class="listingblock">
<div class="title">Get (with options)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Couchbase.Examples/KvOperations.cs#L113-L119">var result = await collection.GetAsync("string-key",
    options =&gt;
    {
        options.Timeout(TimeSpan.FromSeconds(5));
    }
);
var content = result.ContentAs&lt;string&gt;();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="removing"><a class="anchor" href="#removing"></a>Removing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When removing a document, you will have the same concern for durability as with any additive modification to the Bucket:</p>
</div>
<div class="listingblock">
<div class="title">Remove (with options)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Couchbase.Examples/KvOperations.cs#L182-L190">var previousResult = await collection.GetAsync("document-key");

await collection.RemoveAsync("document-key",
    options =&gt;
    {
        options.Cas(previousResult.Cas);
        options.Timeout(TimeSpan.FromSeconds(5));
    }
);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="expiration-ttl"><a class="anchor" href="#expiration-ttl"></a>Expiration / TTL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, Couchbase documents do not expire, but transient or temporary data may be needed for user sessions, caches, or other temporary documents.
Using <code>Touch()</code>, you can set expiration values on documents to handle transient data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Couchbase.Examples/KvOperations.cs#L125">await collection.TouchAsync("document-key", TimeSpan.FromSeconds(10));</code></pre>
</div>
</div>
<div class="paragraph">
<p>A network timeout can be set with the optional <code>TouchOptions()</code>, in the same fashion as earlier examples on this page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Couchbase.Examples/KvOperations.cs#L131-L136">await collection.TouchAsync("document-key", TimeSpan.FromSeconds(30),
    options =&gt;
    {
        options.Timeout(TimeSpan.FromSeconds(5));
    }
);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the absolute value of the expiry is less than 30 days (such as <code>60 * 60 * 24 * 30</code>), it is considered an <em>offset</em>.
If the value is greater, it is considered an <em>absolute time stamp</em>.
For more on expiration see the <a href="../concept-docs/documents.html#setting-document-expiration" class="xref page">expiration section</a> of our documents discussion doc.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you are using the overloads that take <code>IDocument</code>, note that the <code>IDocument.Expiry</code> property assumes ms (milli-seconds), and is converted to seconds before being sent to the server.
All other overloads take a <code>TimeSpan</code> or an <code>uint</code>, and assume an expiry in seconds
A time of zero will set the document to never expire
(a negative number will set expiry to immediate&#8201;&#8212;&#8201;creating a <a href="#7.1@server:learn:buckets-memory-and-storage/storage.adoc#tombstones" class="xref unresolved">tombstone</a>).
Values above 0ms but below 1000ms are rounded up to one second before being sent to the server&#8201;&#8212;&#8201;<em>if you are using .NET SDK 3.0.4 or later</em>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="atomic-counters"><a class="anchor" href="#atomic-counters"></a>Atomic Counters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The value of a document can be increased or decreased atomically using <code>Binary.Increment()</code> and <code>Binary.Decrement()</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Increment &amp; Decrement are considered part of the ‘binary’ API and as such may still be subject to change
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Increment</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Couchbase.Examples/KvOperations.cs#L142-L143">// increment binary value by 1, if document doesn’t exist, seed it at 1
await collection.Binary.IncrementAsync("binary-key");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Increment (with options)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Couchbase.Examples/KvOperations.cs#L149-L156">await collection.Binary.IncrementAsync("binary-key",
options =&gt;
    {
        options.Delta(1);
        options.Initial(1000);
        options.Timeout(TimeSpan.FromSeconds(5));
    }
);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Decrement</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Couchbase.Examples/KvOperations.cs#L162-L163">// decrement binary value by 1, if document doesn’t exist, seed it at 1
await collection.Binary.DecrementAsync("binary-key");</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Decrement (with options)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Couchbase.Examples/KvOperations.cs#L169-L176">await collection.Binary.DecrementAsync("binary-key",
    options =&gt;
    {
        options.Delta(1);
        options.Initial(1000);
        options.Timeout(TimeSpan.FromSeconds(5));
    }
);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Setting the document expiry time only works when a document is created, and it is not possible to update the expiry time of an existing counter document with the Increment method&#8201;&#8212;&#8201;to do this during an increment, use with the <code>Touch()</code> method.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="atomicity-across-data-centers"><a class="anchor" href="#atomicity-across-data-centers"></a>Atomicity Across Data Centers</h3>
<div class="paragraph">
<p>If you are using <a href="#7.1@server:manage:manage-xdcr/xdcr-management-overview.adoc" class="xref unresolved">Cross Data Center Replication</a> (XDCR), be sure to avoid modifying the same counter in more than one datacenter.
If the same counter is modified in multiple datacenters between replications, the counter will no longer be atomic, and its value can change in unspecified ways.</p>
</div>
<div class="paragraph">
<p>A counter must be incremented or decremented by only a single datacenter.
Each datacenter must have its own set of counters that it uses&#8201;&#8212;&#8201;a possible implementation would be including a datacenter name in the counter document ID.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scoped-kv-operations"><a class="anchor" href="#scoped-kv-operations"></a>Scoped KV Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to perform scoped key value operations on named <a href="#7.1@server:learn:data/scopes-and-collections.adoc" class="xref unresolved"><code>Collections</code></a> with <em>Couchbase Server release 7.0</em> onwards.</p>
</div>
<div class="paragraph">
<p>Here is an example showing an upsert in the <code>users</code> collection, which lives in the <code>travel-sample.tenant_agent_00</code> keyspace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Couchbase.Examples/KvOperations.cs#L198-L203">var agentScope = await bucket.ScopeAsync("tenant_agent_00");
var usersCollection = await agentScope.CollectionAsync("users");

var content = new { name = "John Doe", preferred_email = "johndoe111@test123.test" };

var result = await usersCollection.UpsertAsync("user-key", content);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="additional-resources"><a class="anchor" href="#additional-resources"></a>Additional Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Working on just a specific path within a JSON document will reduce network bandwidth requirements - see the <a href="subdocument-operations.html" class="xref page">Sub-Document</a> pages.</p>
</div>
<div class="paragraph">
<p>Another way of increasing network performance is to <em>pipeline</em> operations with <a href="concurrent-async-apis.html#batching" class="xref page">Batching Operations</a>.</p>
</div>
<div class="paragraph">
<p>As well as various <a href="../concept-docs/data-model.html" class="xref page">Formats</a> of JSON, Couchbase can work directly with <a href="../concept-docs/nonjson.html" class="xref page">arbitary bytes, or binary format</a>.</p>
</div>
<div class="paragraph">
<p>Our <a href="n1ql-queries-with-sdk.html" class="xref page">Query Engine</a> enables retrieval of information using the SQL-like syntax of SQL++ (formerly N1QL).</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"SDKs","components":["dotnet-sdk","java-sdk","nodejs-sdk","python-sdk","sdk-extensions"],"url":"/home/sdk.html","latestVersions":{"dotnet-sdk":"3.3","java-sdk":"3.3","nodejs-sdk":"4.1","python-sdk":"4.0","sdk-extensions":"master"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
