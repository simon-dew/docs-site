<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>Importing Data | Couchbase Docs (Preview)</title>
<link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-11568/server/current/guides/import.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="How to import documents into Couchbase.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/guides/import.html">
<meta name="page-nav-header-levels" content="0">
<meta name="generator" content="Antora 3.1.4">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://simon-dew.github.io/docs-site/DOC-11568/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://simon-dew.github.io/docs-site/DOC-11568/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="2">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="https://github.com/simon-dew/docs-devex/edit/release/7.2/modules/guides/pages/import.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../introduction/intro.html">Couchbase Server</a></li>
<li class="crumb">Develop</li>
<li class="crumb"><a href="intro.html">Developer Guides</a></li>
<li class="crumb"><a href="import.html">Importing Data</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Importing Data</h1>
<div class="labels">
<ul><li class="guide"><span><i class="far fa-check-square"></i> how-to</span></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>How to import documents into Couchbase.<br>
This
guide
is for Couchbase Server.
For Couchbase Capella, see <a href="../../../cloud/guides/import.html" class="xref page">Import Data with an SDK</a>.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Importing data can be done from the Couchbase Server UI,
via the <a href="#tools:cbimport.adoc" class="xref unresolved">cbimport</a> command-line tool shipped with Couchbase Server,
or using the SDK to script the process.</p>
</div>
<div class="paragraph">
<p>Data load essentially consists of the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prepare data in some well known format such as Comma Separated Values (.csv) or JSON documents.</p>
</li>
<li>
<p>Parse this data, and iterate over each document.</p>
</li>
<li>
<p>Connect to your Couchbase instance.</p>
</li>
<li>
<p>Connect to the appropriate bucket, scope, and collection.</p>
</li>
<li>
<p>Decide on the key for this document (could be an ID, a sequence number, or some combination of fields).</p>
</li>
<li>
<p>Do any additional processing if required.</p>
</li>
<li>
<p>Insert the document.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="couchbase-clients"><a class="anchor" href="#couchbase-clients"></a>Couchbase Clients</h3>
<div class="paragraph">
<p>Clients access data by connecting to a Couchbase cluster over the network.
The most common type of client is a Couchbase SDK, which is a full programmatic API that enables applications to take the best advantage of Couchbase.
This developer guide focuses on the most commonly-used SDKs, but full explanations and reference documentation for all SDKs is available.</p>
</div>
<div class="paragraph">
<p>The command line clients also provide a quick and streamlined interface for simple access and are suitable if you just want to access an item without writing any code.
For this guide, we are especially interested in the <code>cbimport</code> tool.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>With some editions, the command line clients are provided as part of the installation of Couchbase Server.
Assuming a default installation, you can find them in the following location, depending on your operating system:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Linux
</td>
<td class="hdlist2">
<p><code>/opt/couchbase/bin</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Windows
</td>
<td class="hdlist2">
<p><code>C:\Program Files\Couchbase\Server\bin</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
macOS
</td>
<td class="hdlist2">
<p><code>/Applications/Couchbase Server.app/Contents/Resources/couchbase-core/bin</code></p>
</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Couchbase Server UI also offers a graphical interface to <code>cbimport</code>.</p>
</div>
<div class="paragraph">
<p>Read the following for further information about the clients available for importing data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#tools:cbimport.adoc" class="xref unresolved">cbimport</a></p>
</li>
<li>
<p><a href="../../../home/sdk.html" class="xref page">SDK Clients</a></p>
</li>
<li>
<p><a href="../manage/import-documents/import-documents.html" class="xref page">Couchbase Server UI</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preparing-the-data"><a class="anchor" href="#preparing-the-data"></a>Preparing the Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To prepare the data, extract or generate your data in an appropriate data format.</p>
</div>
<div class="paragraph">
<p>The following are well supported for export as well as by <code>cbimport</code> and the module ecosystems of all Couchbase SDKs.</p>
</div>
<div id="tabs-1" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-1-csv" class="tab">
<p>CSV</p>
</li>
<li id="tabs-1-tsv" class="tab">
<p>TSV</p>
</li>
<li id="tabs-1-json" class="tab">
<p>JSON</p>
</li>
<li id="tabs-1-jsonl" class="tab">
<p>JSONL</p>
</li>
</ul>
</div>
<div id="tabs-1-csv--panel" class="tabpanel" aria-labelledby="tabs-1-csv">
<div class="paragraph">
<p>Comma Separated Values (.csv) are easily exported from many spreadsheet and database applications.</p>
</div>
<div class="paragraph">
<p>Ensure that the first row is a header row containing the names of the columns within the document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csv hljs" data-lang="csv" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/howtos/examples/import.csv">id,type,name
20001,airline,CSV-air-1
20002,airline,CSV-air-2</code></pre>
</div>
</div>
</div>
<div id="tabs-1-tsv--panel" class="tabpanel" aria-labelledby="tabs-1-tsv">
<div class="paragraph">
<p>Tab Separated Values (.tsv) are a common variant of CSV files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-tsv hljs" data-lang="tsv" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/howtos/examples/import.tsv">id	type	name
20011	airline	TSV-air-1
20012	airline	TSV-air-2</code></pre>
</div>
</div>
</div>
<div id="tabs-1-json--panel" class="tabpanel" aria-labelledby="tabs-1-json">
<div class="paragraph">
<p>JSON (.json) files are especially well suited to import into Couchbase, as it is the default native datatype.</p>
</div>
<div class="paragraph">
<p>A .json file contains only one single value, so to give flexibility to import one or many values, format this as an <strong>array</strong> of the values you want to store.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/howtos/examples/import.json">[
	{"id":20021, "type":"airline", "name":"JSON-air-1"},
	{"id":20022, "type":"airline", "name":"JSON-air-2"},
	{"id":20023, "type":"airline", "name":"JSON-air-3"}
]</code></pre>
</div>
</div>
</div>
<div id="tabs-1-jsonl--panel" class="tabpanel" aria-labelledby="tabs-1-jsonl">
<div class="paragraph">
<p>JSON Lines (.json) also known as NDJSON is a common format for streaming JSON, with one JSON object per line of text.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/howtos/examples/import.jsonl">{"id":20031, "type":"airline", "name":"JSONL-air-1"}
{"id":20032, "type":"airline", "name":"JSONL-air-2"}
{"id":20033, "type":"airline", "name":"JSONL-air-3"}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-cbimport"><a class="anchor" href="#using-cbimport"></a>Using <code>cbimport</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using <a href="#tools:cbimport.adoc" class="xref unresolved">cbimport</a> is straightforward.
Ensure you have the path to the command line clients in Couchbase Server in your path.</p>
</div>
<div class="paragraph">
<p>You can import all of the data formats described above.</p>
</div>
<div id="tabs-2" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-2-csv" class="tab">
<p>CSV</p>
</li>
<li id="tabs-2-tsv" class="tab">
<p>TSV</p>
</li>
<li id="tabs-2-json" class="tab">
<p>JSON</p>
</li>
<li id="tabs-2-jsonl" class="tab">
<p>JSONL</p>
</li>
</ul>
</div>
<div id="tabs-2-csv--panel" class="tabpanel" aria-labelledby="tabs-2-csv">
<div class="paragraph">
<p>To import a CSV file using <code>cbimport csv</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>--dataset</code> argument to specify the CSV file.</p>
</li>
<li>
<p>Use the <code>--cluster</code>, <code>--username</code>, and <code>--password</code> arguments to specify your connection details.</p>
</li>
<li>
<p>Use the <code>--bucket</code> and <code>--scope-collection-exp</code> arguments to specify the bucket, scope, and collection as required.</p>
</li>
<li>
<p>Use the <code>--generate-key</code> argument to specify an ID for the imported documents.</p>
</li>
</ol>
</div>
<hr>
<div class="paragraph">
<p>The following example imports a local CSV file, generating IDs such as <code>airline_1234</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">cbimport csv \
  --dataset file://./import.csv \
  --cluster localhost --username Administrator --password password \
  --bucket travel-sample --scope-collection-exp inventory.airline \
  --generate-key %type%_%id%</code></pre>
</div>
</div>
</div>
<div id="tabs-2-tsv--panel" class="tabpanel" aria-labelledby="tabs-2-tsv">
<div class="paragraph">
<p>To import a TSV file using <code>cbimport csv</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>--dataset</code> argument to specify the TSV file.</p>
</li>
<li>
<p>Use the <code>--field-separator</code> argument to specify the field separation character, such as <code>"\t"</code> for tab.</p>
</li>
<li>
<p>Use the <code>--cluster</code>, <code>--username</code>, and <code>--password</code> arguments to specify your connection details.</p>
</li>
<li>
<p>Use the <code>--bucket</code> and <code>--scope-collection-exp</code> arguments to specify the bucket, scope, and collection as required.</p>
</li>
<li>
<p>Use the <code>--generate-key</code> argument to specify an ID for the imported documents.</p>
</li>
</ol>
</div>
<hr>
<div class="paragraph">
<p>The following example imports a local TSV file, generating IDs such as <code>airline_1234</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">cbimport csv \
  --dataset file://./import.tsv --field-separator "\t" \
  --cluster localhost --username Administrator --password password \
  --bucket travel-sample --scope-collection-exp inventory.airline \
  --generate-key %type%_%id%</code></pre>
</div>
</div>
</div>
<div id="tabs-2-json--panel" class="tabpanel" aria-labelledby="tabs-2-json">
<div class="paragraph">
<p>To import a JSON file using <code>cbimport json</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>--dataset</code> argument to specify the JSON file.</p>
</li>
<li>
<p>Set the <code>--format</code> argument to <code>list</code>.</p>
</li>
<li>
<p>Use the <code>--cluster</code>, <code>--username</code>, and <code>--password</code> arguments to specify your connection details.</p>
</li>
<li>
<p>Use the <code>--bucket</code> and <code>--scope-collection-exp</code> arguments to specify the bucket, scope, and collection as required.</p>
</li>
<li>
<p>Use the <code>--generate-key</code> argument to specify an ID for the imported documents.</p>
</li>
</ol>
</div>
<hr>
<div class="paragraph">
<p>The following example imports a local JSON file, generating IDs such as <code>airline_1234</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">cbimport json \
  --dataset file://./import.json --format list \
  --cluster localhost --username Administrator --password password \
  --bucket travel-sample --scope-collection-exp inventory.airline \
  --generate-key %type%_%id%</code></pre>
</div>
</div>
</div>
<div id="tabs-2-jsonl--panel" class="tabpanel" aria-labelledby="tabs-2-jsonl">
<div class="paragraph">
<p>To import a CSV file using <code>cbimport json</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>--dataset</code> argument to specify the JSONL file.</p>
</li>
<li>
<p>Set the <code>--format</code> argument to <code>lines</code>.</p>
</li>
<li>
<p>Use the <code>--cluster</code>, <code>--username</code>, and <code>--password</code> arguments to specify your connection details.</p>
</li>
<li>
<p>Use the <code>--bucket</code> and <code>--scope-collection-exp</code> arguments to specify the bucket, scope, and collection as required.</p>
</li>
<li>
<p>Use the <code>--generate-key</code> argument to specify an ID for the imported documents.</p>
</li>
</ol>
</div>
<hr>
<div class="paragraph">
<p>The following example imports a local JSONL file, generating IDs such as <code>airline_1234</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">cbimport json \
  --dataset file://./import.jsonl --format lines \
  --cluster localhost --username Administrator --password password \
  --bucket travel-sample --scope-collection-exp inventory.airline \
  --generate-key %type%_%id%</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="importing-using-an-sdk"><a class="anchor" href="#importing-using-an-sdk"></a>Importing Using an SDK</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While <code>cbimport</code> accomplishes all the necessary steps in a single command, as above,
using an SDK gives you more flexibility and control.
However all the same considerations apply, so let us look at those in turn.</p>
</div>
<div class="sect2">
<h3 id="parsing-the-import-into-an-array-or-stream-of-records"><a class="anchor" href="#parsing-the-import-into-an-array-or-stream-of-records"></a>Parsing the Import into an Array or Stream of Records</h3>
<div class="paragraph">
<p>The details of how to parse the import data vary depending on the chosen input format, and the most appropriate library for your SDK.</p>
</div>
<div class="sect3">
<h4 id="parsing-csv-and-tsv-data"><a class="anchor" href="#parsing-csv-and-tsv-data"></a>Parsing CSV and TSV Data</h4>
<div id="tabs-3" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-3-net" class="tab">
<p>.NET</p>
</li>
<li id="tabs-3-java" class="tab">
<p>Java</p>
</li>
<li id="tabs-3-node-js" class="tab">
<p>Node.js</p>
</li>
<li id="tabs-3-python" class="tab">
<p>Python</p>
</li>
</ul>
</div>
<div id="tabs-3-net--panel" class="tabpanel" aria-labelledby="tabs-3-net">
<div class="paragraph">
<p>To parse CSV and TSV data, use the <a href="https://joshclose.github.io/CsvHelper/" target="_blank" rel="noopener">CsvHelper</a> library.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Import.csx">using CsvHelper;
using CsvHelper.Configuration;
using System.Globalization;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Import.csx">public async Task importCSV(string filename)
{
    using (var reader = new StreamReader(filename))
    using (var csv = new CsvReader(reader, CultureInfo.InvariantCulture))
    {
        var records = csv.GetRecords&lt;dynamic&gt;();
        foreach (dynamic record in records) {
            await upsertDocument(record);
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Import.csx">public async Task importTSV(string filename)
{
    using (var reader = new StreamReader("import.tsv"))
    using (var tsv = new CsvReader(reader,
        new CsvConfiguration(CultureInfo.InvariantCulture)
            { Delimiter = "\t" }))
    {
        var records = tsv.GetRecords&lt;dynamic&gt;();
        foreach (dynamic record in records) {
            await upsertDocument(record);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
</div>
<div id="tabs-3-java--panel" class="tabpanel" aria-labelledby="tabs-3-java">
<div class="paragraph">
<p>To parse CSV and TSV data, use the <a href="http://opencsv.sourceforge.net/" target="_blank" rel="noopener">opencsv</a> library.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/841c6e7ca8bd2052fa246a284cb63285e8de7c18/modules/howtos/examples/Import.java">import com.opencsv.*;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/841c6e7ca8bd2052fa246a284cb63285e8de7c18/modules/howtos/examples/Import.java">public void importCSV() {
  try (CSVReaderHeaderAware csv = new CSVReaderHeaderAware(
      new FileReader("modules/howtos/examples/import.csv"))) {
          
    Map&lt;String, String&gt; row;
    while ((row = csv.readMap()) != null) {
      upsertRow(row);
    }
  }
  catch (java.io.FileNotFoundException e) {
    System.out.println("handle FileNotFoundException...");
  }
  catch (java.io.IOException e) {
    System.out.println("handle IOException...");
  }
  catch (com.opencsv.exceptions.CsvValidationException e) {
    System.out.println("handle CsvValidationException...");
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/841c6e7ca8bd2052fa246a284cb63285e8de7c18/modules/howtos/examples/Import.java">public void importTSV() {
  CSVParser parser =
    new CSVParserBuilder()
    .withSeparator('\t')
    .withIgnoreQuotations(true)
    .build();
  
  try (CSVReaderHeaderAware tsv =
      new CSVReaderHeaderAwareBuilder(
        new FileReader("modules/howtos/examples/import.tsv"))
      .withCSVParser(parser)
      .build()) {

    Map&lt;String, String&gt; row;
    while ((row = tsv.readMap()) != null) {
      upsertRow(row);
    }
  }
  // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using the <strong>Reactor API</strong> then, as OpenCSV doesn&#8217;t have a built-in converter,
use the <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html#generate-java.util.concurrent.Callable-java.util.function.BiFunction-java.util.function.Consumer-"><code>Flux::generate</code></a> method to convert the CSV or TSV file into a stream:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/841c6e7ca8bd2052fa246a284cb63285e8de7c18/modules/howtos/examples/Import.java">public void importCSV_batch() {
  
  Flux&lt;Map&lt;String,String&gt;&gt; rows = Flux.generate(
    
    () -&gt; new CSVReaderHeaderAware(
      new FileReader("modules/howtos/examples/import.csv")),
    
    (state, sink) -&gt; {
      try {
        Map&lt;String,String&gt; row = state.readMap();
        if (row == null) { sink.complete(); }
        else { sink.next(row); }
        return state;
      }
      catch (Exception e) { throw new RuntimeException(e); }
    },
    state -&gt; {
      try { state.close(); }
      catch (Exception e) { throw new RuntimeException(e); }
    }
  );

  Flux&lt;MutationResult&gt; results = 
    rows
    .map(row -&gt; preprocess(row))
    .flatMap(doc -&gt; reactiveCollection.upsert(doc.getId(), doc.getContent()))
    .doOnNext(System.out::println);

  results.blockLast(Duration.ofSeconds(60));
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/841c6e7ca8bd2052fa246a284cb63285e8de7c18/modules/howtos/examples/Import.java">public void importTSV_batch() {

  Flux&lt;Map&lt;String,String&gt;&gt; rows = Flux.generate(
    
    () -&gt; {
      CSVParser parser =
        new CSVParserBuilder()
        .withSeparator('\t')
        .withIgnoreQuotations(true)
        .build();
      return
        new CSVReaderHeaderAwareBuilder(
          new FileReader("modules/howtos/examples/import.tsv"))
        .withCSVParser(parser)
        .build();
    },
    
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
</div>
<div id="tabs-3-node-js--panel" class="tabpanel" aria-labelledby="tabs-3-node-js">
<div class="paragraph">
<p>To parse CSV and TSV data, use the <a href="https://csv.js.org/parse/" target="_blank" rel="noopener">csv-parse</a> library.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-nodejs hljs" data-lang="nodejs" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/howtos/examples/import.js">const { parse: csvParser } = require('csv-parse');</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-nodejs hljs" data-lang="nodejs" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/howtos/examples/import.js">const csvStream = (filename) =&gt;
  fs.createReadStream(filename)
  .pipe(
      csvParser({columns: true}))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-nodejs hljs" data-lang="nodejs" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/howtos/examples/import.js">const tsvStream = (filename) =&gt;
  fs.createReadStream(filename)
    .pipe(
      csvParser({
        columns: true,
        delimiter: '\t'}))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
</div>
<div id="tabs-3-python--panel" class="tabpanel" aria-labelledby="tabs-3-python">
<div class="paragraph">
<p>To parse CSV and TSV data, use the <a href="https://docs.python.org/3/library/csv.html" target="_blank" rel="noopener">csv</a> library.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python" data-source-url="https://github.com/couchbase/docs-sdk-python/blob/0cb1a2b78691286855d8999e8f22362c665cd0dc/modules/howtos/examples/import.py">import csv</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python" data-source-url="https://github.com/couchbase/docs-sdk-python/blob/0cb1a2b78691286855d8999e8f22362c665cd0dc/modules/howtos/examples/import.py">def csv_import(filename):
    with open(filename, newline='') as csvfile:
        reader = csv.DictReader(csvfile)
        for row in reader:
            upsert(row)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python" data-source-url="https://github.com/couchbase/docs-sdk-python/blob/0cb1a2b78691286855d8999e8f22362c665cd0dc/modules/howtos/examples/import.py">def tsv_import(filename):
    with open(filename, newline='') as tsvfile:
        reader = csv.DictReader(tsvfile, delimiter='\t')
        for row in reader:
            upsert(row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="parsing-json-and-jsonl-data"><a class="anchor" href="#parsing-json-and-jsonl-data"></a>Parsing JSON and JSONL Data</h4>
<div id="tabs-4" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-4-net" class="tab">
<p>.NET</p>
</li>
<li id="tabs-4-java" class="tab">
<p>Java</p>
</li>
<li id="tabs-4-node-js" class="tab">
<p>Node.js</p>
</li>
<li id="tabs-4-python" class="tab">
<p>Python</p>
</li>
</ul>
</div>
<div id="tabs-4-net--panel" class="tabpanel" aria-labelledby="tabs-4-net">
<div class="paragraph">
<p>To parse JSON and JSONL data, use <a href="https://www.newtonsoft.com/json" target="_blank" rel="noopener">Newtonsoft</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Import.csx">using Newtonsoft.Json;
using Newtonsoft.Json.Linq;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Import.csx">public async Task importJSON(string filename)
{
    using (var reader = new StreamReader("import.json"))
    {
        var jsonReader = new JsonTextReader(reader);
        JArray arr = (JArray)JToken.ReadFrom(jsonReader);
        
        foreach (JObject record in arr)
        {
            await upsertDocument(record);
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Import.csx">public async Task importJSONL(string filename)
{
    using (var reader = new StreamReader("import.jsonl"))
    {
        var jsonlReader = new JsonTextReader(reader)
        {
            SupportMultipleContent = true
        };
        while (jsonlReader.Read())
        {
            var record = (JObject)JToken.ReadFrom(jsonlReader);
            await upsertDocument(record);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
</div>
<div id="tabs-4-java--panel" class="tabpanel" aria-labelledby="tabs-4-java">
<div class="paragraph">
<p>To parse <strong>JSON</strong> data, read the file as a string, then use the built-in Couchbase <a href="../../../java-sdk/current/howtos/json.html" class="xref page">JSON</a> handling to parse the result into an array of JSON objects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/841c6e7ca8bd2052fa246a284cb63285e8de7c18/modules/howtos/examples/Import.java">import com.couchbase.client.java.json.*;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/841c6e7ca8bd2052fa246a284cb63285e8de7c18/modules/howtos/examples/Import.java">public void importJSON() {
  try {
    String content  = new String(
      Files.readAllBytes( // read whole document into memory
        Paths.get("modules/howtos/examples/import.json")),
      StandardCharsets.UTF_8);
    
    for (Object row: JsonArray.fromJson(content)) {
      JsonObject json = ((JsonObject) row);
      upsertRow(json.toMap());
    }
  }
  catch (java.io.FileNotFoundException e) {
    System.out.println("handle FileNotFoundException...");
  }
  catch (java.io.IOException e) {
    System.out.println("handle IOException...");
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using the <strong>Reactor API</strong> then, once you&#8217;ve read the JSON array, use the <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html#fromIterable-java.lang.Iterable-"><code>Flux::fromIterable</code></a> method to convert it into streams:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/841c6e7ca8bd2052fa246a284cb63285e8de7c18/modules/howtos/examples/Import.java">public void importJSON_batch() {

  try {
    String content  = new String(
      Files.readAllBytes( // read whole document into memory
        Paths.get("modules/howtos/examples/import.json")),
      StandardCharsets.UTF_8);
    
    Flux&lt;MutationResult&gt; results = 
      Flux.fromIterable(JsonArray.fromJson(content))
        .map(row -&gt; ((JsonObject) row).toMap())
        .map(map -&gt; preprocess(map))
        .flatMap(doc -&gt; reactiveCollection.upsert(doc.getId(), doc.getContent()))
        .doOnNext(System.out::println);

    results.blockLast(Duration.ofSeconds(60));
  }
  // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To parse <strong>JSONL</strong> data: do the same, but read the file line-by-line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/841c6e7ca8bd2052fa246a284cb63285e8de7c18/modules/howtos/examples/Import.java">public void importJSONL() {
  try (BufferedReader br =
        new BufferedReader(
          new FileReader("modules/howtos/examples/import.jsonl"))) {
            
      String line;
      while ((line = br.readLine()) != null) {
        Map&lt;String,Object&gt; row =
          JsonObject.fromJson(line).toMap();
          
        upsertRow(row);
    }
  }
  // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using the <strong>Reactor API</strong> then open the JSONL file as a stream using the <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html#using-java.util.concurrent.Callable-java.util.function.Function-java.util.function.Consumer-"><code>Flux::using</code></a> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/841c6e7ca8bd2052fa246a284cb63285e8de7c18/modules/howtos/examples/Import.java">public void importJSONL_batch() {

  Flux&lt;String&gt; lines = Flux.using(
    () -&gt; Files.lines(Paths.get("modules/howtos/examples/import.jsonl")),
    Flux::fromStream,
    BaseStream::close);

  Flux&lt;MutationResult&gt; results =
    lines
        .map(line -&gt; JsonObject.fromJson(line).toMap())
        .map(map -&gt; preprocess(map))
        .flatMap(doc -&gt; reactiveCollection.upsert(doc.getId(), doc.getContent()))
        .doOnNext(System.out::println);

  results.blockLast(Duration.ofSeconds(60));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
</div>
<div id="tabs-4-node-js--panel" class="tabpanel" aria-labelledby="tabs-4-node-js">
<div class="paragraph">
<p>Use the <a href="https://github.com/uhop/stream-json" target="_blank" rel="noopener">stream-json</a> library.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
stream-json formats its output with a <code>{ key: &#8230;&#8203;, value: &#8230;&#8203;}</code> wrapper, so we need to map the stream into the expected format.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-nodejs hljs" data-lang="nodejs" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/howtos/examples/import.js">const stream = require('stream'); 

// for JSON
const StreamArray = require('stream-json/streamers/StreamArray')

// for JsonL
const {parser: jsonlParser} = require('stream-json/jsonl/Parser');</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-nodejs hljs" data-lang="nodejs" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/howtos/examples/import.js">const map = (f) =&gt;
  new stream.Transform({
    objectMode: true,
    transform: (obj, _, next) =&gt; next(null, f(obj))
  })
  
const jsonStream = (filename) =&gt;
  fs.createReadStream(filename)
    .pipe(StreamArray.withParser())
    .pipe(map(obj =&gt; obj.value))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-nodejs hljs" data-lang="nodejs" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/howtos/examples/import.js">const jsonlStream = (filename) =&gt;
  fs.createReadStream(filename)
    .pipe(jsonlParser())
    .pipe(map(obj =&gt; obj.value))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
</div>
<div id="tabs-4-python--panel" class="tabpanel" aria-labelledby="tabs-4-python">
<div class="paragraph">
<p>Use the <a href="https://docs.python.org/3/library/json.html" target="_blank" rel="noopener">json</a> library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python" data-source-url="https://github.com/couchbase/docs-sdk-python/blob/0cb1a2b78691286855d8999e8f22362c665cd0dc/modules/howtos/examples/import.py">import json</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python" data-source-url="https://github.com/couchbase/docs-sdk-python/blob/0cb1a2b78691286855d8999e8f22362c665cd0dc/modules/howtos/examples/import.py">def json_import(filename):
    with open(filename) as jsonfile:
        data = json.load(jsonfile)
        for row in data:
            upsert(row)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python" data-source-url="https://github.com/couchbase/docs-sdk-python/blob/0cb1a2b78691286855d8999e8f22362c665cd0dc/modules/howtos/examples/import.py">def jsonl_import(filename):
    with open(filename) as jsonlfile:
        for line in jsonlfile:
            row = json.loads(line)
            upsert(row)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="connecting-to-the-couchbase-server"><a class="anchor" href="#connecting-to-the-couchbase-server"></a>Connecting to the Couchbase Server</h3>
<div class="paragraph">
<p>First, you need the connection details for the Couchbase server.</p>
</div>
<div class="paragraph">
<p>Now decide which bucket and <a href="../tutorials/buckets-scopes-and-collections.html" class="xref page">scope and collection</a> you want to import to, and create them if they don&#8217;t already exist.</p>
</div>
<div id="tabs-5" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-5-net" class="tab">
<p>.NET</p>
</li>
<li id="tabs-5-java" class="tab">
<p>Java</p>
</li>
<li id="tabs-5-node-js" class="tab">
<p>Node.js</p>
</li>
<li id="tabs-5-python" class="tab">
<p>Python</p>
</li>
</ul>
</div>
<div id="tabs-5-net--panel" class="tabpanel" aria-labelledby="tabs-5-net">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Import.csx">var cluster = await Cluster.ConnectAsync(
    "couchbase://localhost",
    "Administrator", "password");
var bucket =  await cluster.BucketAsync("travel-sample");
var scope = await bucket.ScopeAsync("inventory");
var _collection = await scope.CollectionAsync("airline");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
<div class="paragraph">
<p>For more information, refer to <a href="../../../dotnet-sdk/current/howtos/managing-connections.html" class="xref page">Managing Connections using the .NET SDK with Couchbase Server</a>.</p>
</div>
</div>
<div id="tabs-5-java--panel" class="tabpanel" aria-labelledby="tabs-5-java">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/841c6e7ca8bd2052fa246a284cb63285e8de7c18/modules/howtos/examples/Import.java">Cluster cluster = Cluster.connect(
  connectionString,
  ClusterOptions
    .clusterOptions(username, password));

Bucket bucket = cluster.bucket(bucketName);
Scope scope = bucket.scope("inventory");

collection = scope.collection("airline");</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using the <a href="../../../java-sdk/current/howtos/concurrent-async-apis.html#reactive-programming-with-reactor" class="xref page">Reactive API</a>, then use the reactive collection instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/841c6e7ca8bd2052fa246a284cb63285e8de7c18/modules/howtos/examples/Import.java">reactiveCollection = collection.reactive();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
<div class="paragraph">
<p>For more information, refer to <a href="../../../java-sdk/current/howtos/managing-connections.html" class="xref page">Managing Connections using the Java SDK with Couchbase Server</a>.</p>
</div>
</div>
<div id="tabs-5-node-js--panel" class="tabpanel" aria-labelledby="tabs-5-node-js">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-nodejs hljs" data-lang="nodejs" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/howtos/examples/import.js">const cluster = await couchbase.connect('couchbase://localhost', {
  username: 'Administrator',
  password: 'password',
})

const bucket = cluster.bucket('travel-sample')
const collection = bucket.scope('inventory').collection('airline')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
<div class="paragraph">
<p>For more information, refer to <a href="../../../nodejs-sdk/current/howtos/managing-connections.html" class="xref page">Managing Connections using the Node.js SDK with Couchbase Server</a>.</p>
</div>
</div>
<div id="tabs-5-python--panel" class="tabpanel" aria-labelledby="tabs-5-python">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python" data-source-url="https://github.com/couchbase/docs-sdk-python/blob/0cb1a2b78691286855d8999e8f22362c665cd0dc/modules/howtos/examples/import.py">cluster = Cluster(
    "couchbase://localhost",
    authenticator=PasswordAuthenticator(
        "Administrator", "password"))

bucket = cluster.bucket("travel-sample")

collection = bucket.scope("inventory").collection("airline")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
<div class="paragraph">
<p>For more information, refer to <a href="../../../python-sdk/current/howtos/managing-connections.html" class="xref page">Managing Connections using the Python SDK with Couchbase Server</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="inserting-the-documents"><a class="anchor" href="#inserting-the-documents"></a>Inserting the Documents</h3>
<div class="paragraph">
<p>Having processed each imported document, you can insert it into the keyspace.
Couchbase is a key-value store, and the document is the value, so before you can insert the document, you need to determine the key.</p>
</div>
<div class="paragraph">
<p>To insert an imported document into the keyspace:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Specify the key. This could be as simple as extracting the <code>id</code> field from the document, or using an incrementing sequence number.</p>
</li>
<li>
<p>Do any additional processing, for example calculating fields, or adding metadata about the importer.</p>
</li>
<li>
<p>Finally, use an upsert operation to the store the document.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use <code>upsert</code> rather than <code>insert</code> to upload the document even if the target key already has a value.
This means that in the case of any error, it is easy to make any required tweaks to the import file and re-run the whole import.
</td>
</tr>
</table>
</div>
<div id="tabs-6" class="openblock tabs is-sync is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="tabs-6-net" class="tab">
<p>.NET</p>
</li>
<li id="tabs-6-java" class="tab">
<p>Java</p>
</li>
<li id="tabs-6-node-js" class="tab">
<p>Node.js</p>
</li>
<li id="tabs-6-python" class="tab">
<p>Python</p>
</li>
</ul>
</div>
<div id="tabs-6-net--panel" class="tabpanel" aria-labelledby="tabs-6-net">
<div class="paragraph">
<p>To store the data, hook the prepared data into an <code>upsert</code> routine.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As CsvHelper and Newtonsoft generate different outputs, we&#8217;ve provided some overloaded options that work for either.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp" data-source-url="https://github.com/couchbase/docs-sdk-dotnet/blob/33e79fe47bd6497fca95b1c4d8dbd992908a6056/modules/howtos/examples/Import.csx">// CsvHelper emits `dynamic` records
public async Task upsertDocument(dynamic record) {
    // define the key
    string key = record.type + "_" + record.id;

    // do any additional processing
    record.importer = ".NET SDK";

    // upsert the document
    await _collection.UpsertAsync(key, record);

    // any required logging
    Console.WriteLine(key);
}

// Newtonsoft.Json.Linq emits `JObjects`
public async Task upsertDocument(JObject record) {
    // define the key
    string key = record["type"] + "_" + record["id"];

    // do any additional processing
    record["importer"] = ".NET SDK";
    
    // upsert the document
    await _collection.UpsertAsync(key, record);
    
    // any required logging
    Console.WriteLine(key);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
<div class="paragraph">
<p>For more information, refer to <a href="../../../dotnet-sdk/current/howtos/kv-operations.html" class="xref page">Key Value Operations</a>.</p>
</div>
</div>
<div id="tabs-6-java--panel" class="tabpanel" aria-labelledby="tabs-6-java">
<div class="paragraph">
<p>To store the data, hook the prepared data into an <code>upsert</code> routine.
For the blocking API, use the method below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/841c6e7ca8bd2052fa246a284cb63285e8de7c18/modules/howtos/examples/Import.java">public void upsertRow(Map row) {
  
  JsonDocument doc = preprocess(row);
  
  String key = doc.getId();
  Object value = doc.getContent();
  
  // upsert the document
  collection.upsert(key, value);
  
  // any required logging
  System.out.println(key);
  System.out.println(value);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>Reactive API</strong> examples above already include a call to <code>ReactiveCollection::upsert</code>.</p>
</div>
<div class="paragraph">
<p>In both cases, you must provide a preprocess routine which returns a key-value tuple object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/841c6e7ca8bd2052fa246a284cb63285e8de7c18/modules/howtos/examples/Import.java">class JsonDocument {
  private final String id;
  private final JsonObject content;

  public JsonDocument(String id, JsonObject content) {
    this.id = id;
    this.content = content;
  }

  public String getId() {
    return id;
  }

  public JsonObject getContent() {
    return content;
  }

  @Override
  public String toString() {
    return "JsonDocument{id='" + id + "', content=" + content + "}";
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java" data-source-url="https://github.com/couchbase/docs-sdk-java/blob/841c6e7ca8bd2052fa246a284cb63285e8de7c18/modules/howtos/examples/Import.java">public JsonDocument preprocess(Map row) {
  Map value = new HashMap(row);

  // define the KEY
  String key = value.get("type") + "_" + value.get("id");

  // do any additional processing
  value.put("importer", "Java SDK");
  
  return new JsonDocument(key, JsonObject.from(value));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
<div class="paragraph">
<p>For more information, refer to <a href="../../../java-sdk/current/howtos/kv-operations.html" class="xref page">Key Value Operations</a>.</p>
</div>
</div>
<div id="tabs-6-node-js--panel" class="tabpanel" aria-labelledby="tabs-6-node-js">
<div class="paragraph">
<p>To iterate the prepared data stream, use a simple <code>for</code> loop in the same way as an array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-nodejs hljs" data-lang="nodejs" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/howtos/examples/import.js">const importStream = async (stream) =&gt; {
  for await (const doc of stream) {
    upsertDocument(doc)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hook the prepared stream in to an <code>upsertDocument</code> routine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-nodejs hljs" data-lang="nodejs" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/howtos/examples/import.js">const upsertDocument = async (doc) =&gt; {
  try {
    // Build the key
    const key = `${doc.type}_${doc.id}`
    
    // Do any processing, logging etc.
    doc.importer = "import.js"
    console.log(key, doc)
    
    // Upsert the document
    await collection.upsert(key, doc)
  }
  catch (error) {
    // Error handling, retry, logging etc.
    console.error(error)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
<div class="paragraph">
<p>For more information, refer to <a href="../../../nodejs-sdk/current/howtos/kv-operations.html" class="xref page">Key Value Operations</a>.</p>
</div>
</div>
<div id="tabs-6-python--panel" class="tabpanel" aria-labelledby="tabs-6-python">
<div class="paragraph">
<p>To store the data, define functions to determine the key, and process the value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python" data-source-url="https://github.com/couchbase/docs-sdk-python/blob/0cb1a2b78691286855d8999e8f22362c665cd0dc/modules/howtos/examples/import.py">def key(row):
    return "{type}_{id}".format(**row)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python" data-source-url="https://github.com/couchbase/docs-sdk-python/blob/0cb1a2b78691286855d8999e8f22362c665cd0dc/modules/howtos/examples/import.py">def process(row):
    row["importer"] = "Python SDK"
    return row</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hook the prepared data into an <code>upsertDocument</code> routine which uses these functions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python" data-source-url="https://github.com/couchbase/docs-sdk-python/blob/0cb1a2b78691286855d8999e8f22362c665cd0dc/modules/howtos/examples/import.py">def upsert(row):
    k = key(row)
    v = process(row)
    print(k, v)
    collection.upsert(k, v)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, refer to <a href="../../../python-sdk/current/howtos/kv-operations.html" class="xref page">Key Value Operations</a>.</p>
</div>
<div class="paragraph">
<p>Note that the Python SDK offers a set of batch operations which are marked as <em>volatile</em> as of SDK 3.2.3, which may be more efficient. Here&#8217;s a brief example for CSV:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python" data-source-url="https://github.com/couchbase/docs-sdk-python/blob/0cb1a2b78691286855d8999e8f22362c665cd0dc/modules/howtos/examples/import.py"># multi operations volatile as of SDK 3.2.3
def csv_import_multi(filename):
    with open(filename, newline='') as csvfile:
        reader = csv.DictReader(csvfile)
        data = { key(row): process(row) for row in reader }
        print(data)
        collection.upsert_multi(data)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Click the <span class="icon"><i class="fa fa-github"></i></span> View button to see any code sample in context.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-links"><a class="anchor" href="#related-links"></a>Related Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Reference and information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="../manage/import-documents/import-documents.html" class="xref page">Couchbase Server UI</a> offers a graphical view of documents, to check your imports interactively.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>How-to guides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="kv-operations.html" class="xref page">Key-Value Operations</a> guide shows how to read and update the data you have imported.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Key-Value Operations with SDKs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#c-sdk:howtos:kv-operations.adoc" class="xref unresolved">C</a>
| <a href="../../../dotnet-sdk/current/howtos/kv-operations.html" class="xref page">.NET</a>
| <a href="#go-sdk:howtos:kv-operations.adoc" class="xref unresolved">Go</a>
| <a href="../../../java-sdk/current/howtos/kv-operations.html" class="xref page">Java</a>
| <a href="../../../nodejs-sdk/current/howtos/kv-operations.html" class="xref page">Node.js</a>
| <a href="#php-sdk:howtos:kv-operations.adoc" class="xref unresolved">PHP</a>
| <a href="../../../python-sdk/current/howtos/kv-operations.html" class="xref page">Python</a>
| <a href="#ruby-sdk:howtos:kv-operations.adoc" class="xref unresolved">Ruby</a>
| <a href="#scala-sdk:howtos:kv-operations.adoc" class="xref unresolved">Scala</a></p>
</li>
</ul>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
