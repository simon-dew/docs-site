<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>Appendix 2: Performance Tuning | Couchbase Docs (Preview)</title>
<link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-11568/server/current/analytics/appendix_2_parameters.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="A description of Couchbase Analytics query performance tuning.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/analytics/appendix_2_parameters.html">
<meta name="page-nav-header-levels" content="0">
<meta name="generator" content="Antora 3.1.4">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://simon-dew.github.io/docs-site/DOC-11568/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://simon-dew.github.io/docs-site/DOC-11568/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
    <template id="page-versions" style="display: none">
      <select class="version_list" data-component="server">
        <option value="7.6" data-url="../../7.6/introduction/intro.html">7.6 Prerelease</option>
        <option value="7.2" data-url="appendix_2_parameters.html" selected>7.2</option>
      </select>
    </template>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/simondew/GitHub/couchbase/docs-analytics/modules/analytics/pages/appendix_2_parameters.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../index.html">server</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Appendix 2: Performance Tuning</h1>
<div class="labels">
<ul></ul>
</div>
<div class="labels">
<ul>
<li class="edition"><a href="https://www.couchbase.com/products/editions">Enterprise Edition</a></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <code>SET</code> statement can be used to override some cluster-wide configuration parameters for a specific request:</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="setstmnt"><a class="anchor" href="#setstmnt"></a>SetStmnt</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/SetStmnt.png" alt="SetStmnt">
</div>
</div>
<div class="paragraph">
<p>As parameter identifiers are qualified names (containing a '.') they have to be escaped using backticks (``).
Note that changing query parameters will not affect query correctness but only impact performance
characteristics, such as response time and throughput.</p>
</div>
</div>
<div class="sect1">
<h2 id="Parallelism_parameter"><a class="anchor" href="#Parallelism_parameter"></a>Parallelism Parameter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The system can execute each request using multiple cores on multiple machines (a.k.a., partitioned parallelism)
in a cluster. A user can manually specify the maximum execution parallelism for a request to scale it up and down
using the following parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>compiler.parallelism</strong>: the maximum number of CPU cores can be used to process a query.
There are three cases of the value <em>p</em> for compiler.parallelism:</p>
<div class="ulist">
<ul>
<li>
<p><em>p</em> &lt; 0 or <em>p</em> &gt; the total number of cores in a cluster:  the system will use all available cores in the
cluster;</p>
</li>
<li>
<p><em>p</em> = 0 (the default):  the system will use the storage parallelism (the number of partitions of stored datasets)
as the maximum parallelism for query processing;</p>
</li>
<li>
<p>all other cases:  the system will use the user-specified number as the maximum number of CPU cores to use for
executing the query.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="literalblock">
<div class="title">Example</div>
<div class="content">
<pre>SET `compiler.parallelism` "16";

SELECT c.name AS cname, o.orderno AS orderno
FROM customers c JOIN orders o ON c.custid = o.custid;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Memory_parameters"><a class="anchor" href="#Memory_parameters"></a>Memory Parameters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the system, each blocking runtime operator such as join, group-by and order-by
works within a fixed memory budget, and can gracefully spill to disks if
the memory budget is smaller than the amount of data they have to hold.
A user can manually configure the memory budget of those operators within a query.
The supported configurable memory parameters are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>compiler.groupmemory</strong>: the memory budget that each parallel group-by operator instance can use;
32MB is the default budget.</p>
</li>
<li>
<p><strong>compiler.sortmemory</strong>: the memory budget that each parallel sort operator instance can use;
32MB is the default budget.</p>
</li>
<li>
<p><strong>compiler.joinmemory</strong>: the memory budget that each parallel hash join operator instance can use;
32MB is the default budget.</p>
</li>
<li>
<p><strong>compiler.windowmemory</strong>: the memory budget that each parallel window aggregate operator instance can use;
32MB is the default budget.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For each memory budget value, you can use a 64-bit integer value
with a 1024-based binary unit suffix (for example, B, KB, MB, GB).
If there is no user-provided suffix, "B" is the default suffix. See the following examples.</p>
</div>
<div class="literalblock">
<div class="title">Example</div>
<div class="content">
<pre>SET `compiler.groupmemory` "64MB";

SELECT c.custid, COUNT(*)
FROM customers c
GROUP BY c.custid;</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Example</div>
<div class="content">
<pre>SET `compiler.sortmemory` "67108864";

SELECT VALUE o
FROM orders AS o
ORDER BY ARRAY_LENGTH(o.items) DESC;</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Example</div>
<div class="content">
<pre>SET `compiler.joinmemory` "132000KB";

SELECT c.name AS cname, o.ordeno AS orderno
FROM customers c JOIN orders o ON c.custid = o.custid;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Parallel_sort_parameter"><a class="anchor" href="#Parallel_sort_parameter"></a>Parallel Sort Parameter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following parameter enables you to activate or deactivate full parallel sort for order-by operations.</p>
</div>
<div class="paragraph">
<p>When full parallel sort is inactive (<code>false</code>), each existing data partition is sorted (in parallel),
and then all data partitions are merged into a single node.</p>
</div>
<div class="paragraph">
<p>When full parallel sort is active (<code>true</code>), the data is first sampled, and then repartitioned
so that each partition contains data that is greater than the previous partition.
The data in each partition is then sorted (in parallel),
but the sorted partitions are not merged into a single node.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>compiler.sort.parallel</strong>: A boolean specifying whether full parallel sort is active (<code>true</code>) or inactive (<code>false</code>).
The default value is <code>false</code>.</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="title">Example</div>
<div class="content">
<pre>SET `compiler.sort.parallel` "true";

SELECT VALUE o
FROM orders AS o
ORDER BY ARRAY_LENGTH(o.items) DESC;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ArrayIndexFlag"><a class="anchor" href="#ArrayIndexFlag"></a>Array Index Parameter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following parameter enables you to choose whether the query optimizer should replace applicable data scans with array index lookups.</p>
</div>
<div class="paragraph">
<p>When this setting is <code>true</code>, the query optimizer attempts to utilize array indexes if they are available.
You can set this property to <code>false</code> to make query optimizer skip array indexes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>compiler.arrayindex</strong>: A boolean specifying whether array indexes will be considered as an access method for applicable queries.
The default value is <code>true</code>.</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="title">Example</div>
<div class="content">
<pre>SET `compiler.arrayindex` "false";

SELECT o.orderno
FROM orders o
WHERE SOME i IN o.items
SATISFIES i.price = 19.91;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="CBO_parameters"><a class="anchor" href="#CBO_parameters"></a>Cost-Based Optimizer Parameters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following parameters enable you to specify the behavior of the cost-based optimizer.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>compiler.queryplanshape</strong>: A string specifying the shape of the query plan produced by the query compiler for multi-way hash join queries.
Three settings are available for this parameter: <code>zigzag</code>, <code>leftdeep</code>, and <code>rightdeep</code>.</p>
<div class="ulist">
<ul>
<li>
<p><code>zigzag</code>&#8201;&#8212;&#8201;The smaller input is the build side of the hash join, and the larger input is the probe side.
This is the default value, and provides a balance between speed and memory usage.</p>
</li>
<li>
<p><code>leftdeep</code>&#8201;&#8212;&#8201;After the first join, previous join results are always on the build side of the hash join, and base collections are always on the probe side.
This saves memory, but is potentially slower.</p>
</li>
<li>
<p><code>rightdeep</code>&#8201;&#8212;&#8201; After the first join, base collections are always on the build side of the hash join, and previous join results are always on the probe side.
This is potentially quicker, but uses more memory.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>compiler.forcejoinorder</strong>: A boolean specifying whether joins should be performed in the order in which they are specified in the query.
The default value is <code>false</code>, meaning the cost-based optimizer chooses the optimal join order.</p>
</li>
<li>
<p><strong>compiler.cbo</strong>: A boolean specifying whether the cost-based optimizer should be activated or not.
Setting this to <code>false</code> turns off the cost-based optimizer entirely.
The default value is <code>true</code>.</p>
</li>
</ul>
</div>
<h5 id="example" class="discrete">Example</h5>
<div class="paragraph">
<p>The following example explicitly specifies the zigzag plan shape for a multi-join query, even though this is the default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SET `compiler.queryplanshape` "zigzag";

SELECT nation, o_year, sum(amount) AS sum_profit
FROM (SELECT n.n_name AS nation,
      DATE_PART_STR(o.o_orderdate, 'year'),
      l.l_extendedprice * (1 - l.l_discount) -
      ps.ps_supplycost * l.l_quantity as amount
      FROM part p, supplier s, lineitem l,
           partsupp ps, orders o, nation n
      WHERE s.s_suppkey = l.l_suppkey
        AND ps.ps_suppkey = l.l_suppkey
        AND s.s_suppkey = ps.ps_suppkey
        AND ps.ps_partkey = l.l_partkey
        AND p.p_partkey = l.l_partkey
        AND p.p_partkey = ps.ps_partkey
        AND o.o_orderkey = l.l_orderkey
        AND s.s_nationkey = n.n_nationkey
        AND p.p_name LIKE '%green%') AS profit
GROUP BY nation, o_year
ORDER BY nation, o_year DESC;</pre>
</div>
</div>
<div class="paragraph">
<p>This produces a query plan which can be represented as follows.
For each hash join, the left side is the build side and the right side is the probe side.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/plan-zigzag.svg" alt="Representation of multi-join query plan, with some hash joins on build side and some on probe side">
</div>
</div>
<div class="paragraph">
<p>Note that the bottom three hash joins have base collections as their build side, but the top two hash joins have join results as their build side.</p>
</div>
<h5 id="example-2" class="discrete">Example</h5>
<div class="paragraph">
<p>The following example specifies the left deep plan shape.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SET `compiler.queryplanshape` "leftdeep";</pre>
</div>
</div>
<div class="paragraph">
<p>A left deep plan for the query above can be represented as follows.
For each hash join, the left side is the build side and the right side is the probe side.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/plan-leftdeep.svg" alt="Representation of multi-join query plan, with all hash joins on the build side">
</div>
</div>
<h5 id="example-3" class="discrete">Example</h5>
<div class="paragraph">
<p>The following example specifies the right deep plan shape.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SET `compiler.queryplanshape` "rightdeep";</pre>
</div>
</div>
<div class="paragraph">
<p>A right deep plan for the query above can be represented as follows.
For each hash join, the left side is the build side and the right side is the probe side.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/plan-rightdeep.svg" alt="Representation of multi-join query plan, with all hash joins on the probe side">
</div>
</div>
<h5 id="example-4" class="discrete">Example</h5>
<div class="paragraph">
<p>The following example forces the cost-based optimizer to use the order of joins specified in the query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SET `compiler.forcejoinorder` "true";</pre>
</div>
</div>
<h5 id="example-5" class="discrete">Example</h5>
<div class="paragraph">
<p>The following example turns the cost-based optimizer off.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SET `compiler.cbo` "false";</pre>
</div>
</div>
<h5 id="example-6" class="discrete">Example</h5>
<div class="paragraph">
<p>The following example turns the cost-based optimizer on again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SET `compiler.cbo` "true";</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="CBO_hints"><a class="anchor" href="#CBO_hints"></a>Cost-Based Optimizer Hints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can supply hints to the cost-based optimizer using a hint comment.
These enable you to specify the behavior of the cost-based optimizer for individual queries.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Generally speaking, you should rely on the optimizer to generate the query plan.
Optimizer hints may be useful in specific situations where the optimizer is not able to come up with the preferred plan.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="productivity_hint"><a class="anchor" href="#productivity_hint"></a>Productivity Hint</h3>
<div class="paragraph">
<p>The <code>productivity</code> hint can help the cost-based optimizer get a better join cardinality estimate for foreign key to foreign key joins.</p>
</div>
<div class="paragraph">
<p>This hint is used within the join predicate.
If the join is on a composite key, then this hint needs to be provided just once on any of the join&#8217;s predicates.</p>
</div>
<div class="paragraph">
<p>The hint requires two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: A collection or alias.</p>
</li>
<li>
<p><strong>productivity</strong>: How many matching objects are expected from a join with the specified collection.</p>
</li>
</ul>
</div>
<h5 id="example-7" class="discrete">Example</h5>
<div class="paragraph">
<p>In this example, the hint specifies that for each object of <code>n</code> we expect to get 600 matching objects resulting from joining <code>n</code> with <code>c</code>, that is, each <code>n</code> will produce 600 <code>c</code> matches.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT c.*
FROM customers c, nations n
WHERE c.nationkey /*+ productivity n 600.0 */ = n.nationkey;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hashjoin_hint"><a class="anchor" href="#hashjoin_hint"></a>Hash Join Hint</h3>
<div class="paragraph">
<p>The <code>hashjoin</code> hint can be used in a join predicate to force a hash join.</p>
</div>
<div class="paragraph">
<p>The hint requires you to specify which side of the hash join the identified collection or alias should be on: the <code>build</code> side or the <code>probe</code> side.</p>
</div>
<div class="paragraph">
<p>The hint requires one parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: A base collection or alias.
The base collection or alias may be from a previous join result.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the parameter is valid, the cost-based optimizer only considers using a hash join plan with the specified collection.</p>
</div>
<div class="paragraph">
<p>If the parameter is invalid or not specified, the cost-based optimizer ignores the hint, generates a warning, and then tries all possible join methods.</p>
</div>
<h5 id="example-8" class="discrete">Example</h5>
<div class="paragraph">
<p>This example specifies that the <code>orders</code> collection (<code>o</code>) should be on the build side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT count(*)
FROM orders o
JOIN (SELECT c.*
      FROM customers c, nations n
      WHERE c.nationkey = n.nationkey) AS cn
ON cn.custid /*+ hashjoin build (o) */ = o.custid;</pre>
</div>
</div>
<h5 id="example-9" class="discrete">Example</h5>
<div class="paragraph">
<p>This example specifies that the subquery containing the <code>customers</code> collection (<code>c</code>) should be on the build side.
This is equivalent to specifying that the <code>orders</code> collection (<code>o</code>) should be on the probe side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT count(*)
FROM orders o
JOIN (SELECT c.*
      FROM customers c, nations n
      WHERE c.nationkey = n.nationkey) AS cn
ON cn.custid /*+ hashjoin build (c) */ = o.custid;</pre>
</div>
</div>
<h5 id="example-10" class="discrete">Example</h5>
<div class="paragraph">
<p>This example specifies that the subquery containing the <code>nations</code> collection (<code>n</code>) should be on the build side.
This is equivalent to specifying that the <code>orders</code> collection (<code>o</code>) should be on the probe side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT count(*)
FROM orders o
JOIN (SELECT c.*
      FROM customers c, nations n
      WHERE c.nationkey = n.nationkey) AS cn
  ON cn.custid /*+ hashjoin build (n) */ = o.custid;</pre>
</div>
</div>
<h5 id="example-11" class="discrete">Example</h5>
<div class="paragraph">
<p>This example specifies that the <code>orders</code> collection (<code>o</code>) should be on the probe side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT count(*)
FROM orders o
JOIN (SELECT c.*
      FROM customers c, nations n
      WHERE c.nationkey = n.nationkey) AS cn
  ON cn.custid /*+ hashjoin probe (o) */ = o.custid;</pre>
</div>
</div>
<h5 id="example-12" class="discrete">Example</h5>
<div class="paragraph">
<p>This example specifies that the subquery containing the <code>customers</code> collection (<code>c</code>) should be on the probe side.
This is equivalent to specifying that the <code>orders</code> collection (<code>o</code>) should be on the build side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT count(*)
FROM orders o
JOIN (SELECT c.*
      FROM customers c, nations n
      WHERE c.nationkey = n.nationkey) AS cn
ON cn.custid /*+ hashjoin probe (c) */ = o.custid;</pre>
</div>
</div>
<h5 id="example-13" class="discrete">Example</h5>
<div class="paragraph">
<p>This example specifies that the subquery containing the <code>nations</code> collection (<code>n</code>) should be on the probe side.
This is equivalent to specifying that the <code>orders</code> collection (<code>o</code>) should be on the build side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT count(*)
FROM orders o
JOIN (SELECT c.*
      FROM customers c, nations n
      WHERE c.nationkey = n.nationkey) AS cn
ON cn.custid /*+ hashjoin probe (n) */ = o.custid;</pre>
</div>
</div>
<h5 id="example-14" class="discrete">Example</h5>
<div class="paragraph">
<p>This example generates a warning because <code>cn</code> is not a base collection.
The hint is ignored, and all possible join orders and join methods are considered.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT count(*)
FROM orders o
JOIN (SELECT c.*
      FROM customers c, nations n
      WHERE c.nationkey = n.nationkey) AS cn
  ON cn.custid /*+ hashjoin build (cn) */ = o.custid;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hash_bcast_hint"><a class="anchor" href="#hash_bcast_hint"></a>Hash Broadcast Hint</h3>
<div class="paragraph">
<p>By default, Analytics uses a partitioned-parallel hash join strategy to parallelize the execution of an equi-join.
In this approach both sides of the join are repartitioned (if necessary) on a hash of the join key;
potentially matching data items thus arrive at the same partition to be joined locally.
This strategy is robust, but not always the fastest when one of the join sides is low cardinality and
the other is high cardinality (since it scans and potentially moves the data from both sides).
This special case can be better handled by broadcasting (replicating) the smaller side to all data partitions
of the larger side and not moving the data from the other (larger) side.
Analytics provides the <code>hash-bcast</code> join hint to enable this strategy.
This hint forces one side of the join to be replicated while the other retains its original partitioning.</p>
</div>
<div class="paragraph">
<p>The hint may have one optional parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: A base collection or alias which should be broadcast for the join.
The base collection or alias may be from a previous join result.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the parameter is valid, the cost-based optimizer only tries the broadcast plan with the specified collection.</p>
</div>
<div class="paragraph">
<p>If the parameter is not specified, the cost-based optimizer tries two broadcast plans, broadcast left and broadcast right.</p>
</div>
<div class="paragraph">
<p>If the parameter is invalid, the cost-based optimizer ignores the hint, generates a warning, and then tries all possible join methods.</p>
</div>
<h5 id="example-15" class="discrete">Example</h5>
<div class="paragraph">
<p>This example specifies that the query should use a broadcast plan, but does not specify which side should be on the broadcast side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT count(*)
FROM orders o
JOIN (SELECT c.*
      FROM customers c, nations n
      WHERE c.nationkey = n.nationkey) AS cn
ON cn.custid /*+ hash-bcast */ = o.custid;</pre>
</div>
</div>
<h5 id="example-16" class="discrete">Example</h5>
<div class="paragraph">
<p>This example specifies that the subquery containing the <code>customers</code> collection (<code>c</code>) should be on the broadcast side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT count(*)
FROM orders o
JOIN (SELECT c.*
      FROM customers c, nations n
      WHERE c.nationkey = n.nationkey) AS cn
ON cn.custid /*+ hash-bcast (c) */ = o.custid;</pre>
</div>
</div>
<h5 id="example-17" class="discrete">Example</h5>
<div class="paragraph">
<p>This example specifies that the subquery containing the <code>nations</code> collection (<code>n</code>) should be on the broadcast side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT count(*)
FROM orders o
JOIN (SELECT c.*
      FROM customers c, nations n
      WHERE c.nationkey = n.nationkey) AS cn
ON cn.custid /*+ hash-bcast (n) */ = o.custid;</pre>
</div>
</div>
<h5 id="example-18" class="discrete">Example</h5>
<div class="paragraph">
<p>This example specifies that the <code>orders</code> collection (<code>o</code>) should be on the broadcast side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT count(*)
FROM orders o
JOIN (SELECT c.*
      FROM customers c, nations n
      WHERE c.nationkey = n.nationkey) AS cn
ON cn.custid /*+ hash-bcast (o) */ = o.custid;</pre>
</div>
</div>
<h5 id="example-19" class="discrete">Example</h5>
<div class="paragraph">
<p>This example generates a warning because <code>cn</code> is not a base collection.
The hint is ignored, and all possible join orders and join methods are considered.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT count(*)
FROM orders o
JOIN (SELECT c.*
      FROM customers c, nations n
      WHERE c.nationkey = n.nationkey) AS cn
ON cn.custid /*+ hash-bcast (cn) */ = o.custid;</pre>
</div>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
