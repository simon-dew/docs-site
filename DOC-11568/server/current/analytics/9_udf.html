<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>User-Defined Functions | Couchbase Docs (Preview)</title>
<link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-11568/server/current/analytics/9_udf.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="A description of user-defined functions in Couchbase SQL++ for Analytics.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="server">
<meta name="dcterms.identifier" content="7.2">
<meta name="page-url" content="/server/current/analytics/9_udf.html">
<meta name="page-nav-header-levels" content="0">
<meta name="generator" content="Antora 3.1.4">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://simon-dew.github.io/docs-site/DOC-11568/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://simon-dew.github.io/docs-site/DOC-11568/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
    <template id="page-versions" style="display: none">
      <select class="version_list" data-component="server">
        <option value="7.6" data-url="../../7.6/introduction/intro.html">7.6 Prerelease</option>
        <option value="7.2" data-url="9_udf.html" selected>7.2</option>
      </select>
    </template>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/simondew/GitHub/couchbase/docs-analytics/modules/analytics/pages/9_udf.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../index.html">server</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">User-Defined Functions</h1>
<div class="labels">
<ul></ul>
</div>
<div class="labels">
<ul>
<li class="edition"><a href="https://www.couchbase.com/products/editions">Enterprise Edition</a></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In SQL++ for Analytics, user-defined functions enable you to name and reuse complex or repetitive expressions, including subqueries, in order to simplify your queries.</p>
</div>
<div class="paragraph">
<p>Each user-defined function belongs to an Analytics scope.
Within an Analytics scope, a function is uniquely identified by its <em>function signature</em>: that is, its name and the number of parameters it takes.
You can create more than one function with the same name in the same Analytics scope, as long as each function has a different number of parameters.</p>
</div>
<div class="paragraph">
<p>You can query the <code>Function</code> Analytics collection within the <code>Metadata</code> Analytics scope to get metadata about all existing user-defined functions.
Note that FUNCTION is a reserved keyword, so you need to delimit the name of the <code>Function</code> collection with backticks (&grave;).</p>
</div>
<div class="paragraph">
<p>You can&#8217;t create a function in the <code>Metadata</code> scope.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-function"><a class="anchor" href="#creating-a-function"></a>Creating a Function</h2>
<div class="sectionbody">
<h5 id="createfunction" class="discrete">CreateFunction</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/CreateFunction.png" alt="CreateInternalFunction | CreateExternalFunction">
</div>
</div>
<div class="paragraph">
<p>The CREATE ANALYTICS FUNCTION command enables you to create a user-defined function.
There are two types of user-defined function: <em>internal</em> functions, which are defined using SQL++ for Analytics expressions; and <em>external</em> functions, which are defined using an external language.</p>
</div>
<div class="sect2">
<h3 id="internal-functions"><a class="anchor" href="#internal-functions"></a>Internal Functions</h3>
<h5 id="createinternalfunction" class="discrete">CreateInternalFunction</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/CreateInternalFunction.png" alt="&quot;CREATE&quot; ( &quot;OR&quot; &quot;REPLACE&quot; )? &quot;ANALYTICS&quot; &quot;FUNCTION&quot; QualifiedName &quot;(&quot; FunctionParameters? &quot;)&quot; (&quot;IF&quot; &quot;NOT&quot; &quot;EXISTS&quot;)? &quot;{&quot; Query &quot;}&quot;">
</div>
</div>
<div class="paragraph">
<p>This syntax enables you to create an internal user-defined function.</p>
</div>
</div>
<div class="sect2">
<h3 id="function-name"><a class="anchor" href="#function-name"></a>Function Name</h3>
<h5 id="qualifiedname" class="discrete">QualifiedName</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/QualifiedName.png" alt="(ScopeName &quot;.&quot;)? Identifier">
</div>
</div>
<h5 id="scopename" class="discrete">ScopeName</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/ScopeName.png" alt="(Identifier &quot;.&quot;)? Identifier">
</div>
</div>
<div class="paragraph">
<p>The <code>QualifiedName</code> specifies the name of the function to create.
It consists of an optional scope name, followed by an identifier which represents the local name of the function.</p>
</div>
<div class="paragraph">
<p>The optional <code>ScopeName</code> specifies the Analytics scope where the function is located.
It may consist of one or two identifiers, separated by a dot.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t specify an Analytics scope, then the scope containing the function is resolved according to the following rules:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If there is a preceding USE statement, the function is located in the Analytics scope specified by the USE statement.</p>
</li>
<li>
<p>Otherwise, if the <a href="appendix_3_resolution.html#Query_context" class="xref page">query_context</a> parameter is set, the function is located in the Analytics scope specified by the query context.</p>
</li>
<li>
<p>Otherwise, the function is located in the <code>Default</code> Analytics scope.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="parameter-list"><a class="anchor" href="#parameter-list"></a>Parameter List</h3>
<h5 id="functionparameters" class="discrete">FunctionParameters</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/FunctionParameters.png" alt="Identifier ( &quot;,&quot; Identifier )* | &quot;&#8230;&#8203;&quot;">
</div>
</div>
<div class="paragraph">
<p>The parameter list specifies parameters for the function.
It is delimited by parentheses <code>()</code>.
You can specify named parameters for the function using a comma-separated list of identifiers.</p>
</div>
<div class="paragraph">
<p>If you specify named parameters for the function, then you must call the function with exactly the same number of arguments at execution time.
If you specify no parameters, then you must call the function with no arguments.</p>
</div>
<div class="paragraph">
<p>To create a variadic function, that is, a function which you can call with any number of arguments or none, specify <code>...</code> as the only parameter.</p>
</div>
</div>
<div class="sect2">
<h3 id="function-body"><a class="anchor" href="#function-body"></a>Function Body</h3>
<h5 id="query" class="discrete">Query</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/Query.png" alt="Expr | Selection">
</div>
</div>
<div class="paragraph">
<p>The function body defines the function.
It is delimited by braces <code>{}</code>.
It may contain any valid expression or subquery.</p>
</div>
<div class="paragraph">
<p>If you specified named parameters for the function, you can use these in the function body to represent arguments which are passed to the function at execution time.
If you specified that the function is variadic, any arguments passed to the function at execution time are held in an array named <code>args</code>.</p>
</div>
<div class="paragraph">
<p>The function body may refer to other Analytics collections, or to other functions in the same or other Analytics scopes.
If an Analytics scope name was explicitly specified when creating the function, then that scope is the default scope for function calls or collection references within the function body.</p>
</div>
<div class="paragraph">
<p>Note that recursive function invocation is not permitted.
The function body may not refer to itself, nor to another user-defined function which calls this function indirectly.</p>
</div>
</div>
<div class="sect2">
<h3 id="checking-for-an-existing-function-and-replacing-a-function"><a class="anchor" href="#checking-for-an-existing-function-and-replacing-a-function"></a>Checking for an Existing Function and Replacing a Function</h3>
<div class="paragraph">
<p>The optional <code>IF NOT EXISTS</code> keywords enable you to check whether a user-defined function exists before creating it,
and the optional <code>OR REPLACE</code> keywords enable you to redefine the function.</p>
</div>
<div class="paragraph">
<p>If a function with the same signature already exists within the specified Analytics scope, then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the <code>OR REPLACE</code> keywords are present, the existing function is replaced.</p>
</li>
<li>
<p>If the <code>OR REPLACE</code> keywords are not present, then:</p>
<div class="ulist">
<ul>
<li>
<p>If the <code>IF NOT EXISTS</code> keywords are present, the statement does nothing and completes without error.</p>
</li>
<li>
<p>If the <code>IF NOT EXISTS</code> keywords are not present, an error is generated.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that if the statement contains both the <code>OR REPLACE</code> keywords and the <code>IF NOT EXISTS</code> keywords, an error is generated.</p>
</div>
</div>
<div class="sect2">
<h3 id="internal-function-examples"><a class="anchor" href="#internal-function-examples"></a>Internal Function Examples</h3>
<div class="paragraph">
<p>For simplicity, none of these examples implement any data validation.</p>
</div>
<h5 id="example-1-variadic-function" class="discrete">Example 1: Variadic function</h5>
<div class="paragraph">
<p>This statement creates a function called <code>to_celsius</code>, which converts Fahrenheit to Celsius.
The function is variadic.</p>
</div>
<div class="paragraph">
<p>For purposes of illustration, this expression converts just the first argument supplied at execution time,
which is stored in the first member in the <code>args</code> array.
A more realistic variadic function would make use of all the supplied arguments.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE ANALYTICS FUNCTION to_celsius(...) { (args[0] - 32) * 5/9 };</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Test</div>
<div class="content">
<pre>to_celsius(100);</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Result</div>
<div class="content">
<pre>[
  37.77777777777778
]</pre>
</div>
</div>
<h5 id="example-2-variadic-function-with-extra-arguments" class="discrete">Example 2: Variadic function with extra arguments</h5>
<div class="paragraph">
<p>This statement creates a function called <code>to_fahrenheit</code>, which converts Celsius to Fahrenheit.
The function is variadic.</p>
</div>
<div class="paragraph">
<p>For purposes of illustration, this expression converts just the first argument supplied at execution time,
which is stored in the first member in the <code>args</code> array.
A more realistic variadic function would make use of all the supplied arguments.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE ANALYTICS FUNCTION to_fahrenheit(...) { (args[0] * 9/5) + 32 };</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Test</div>
<div class="content">
<pre>to_fahrenheit(100, "ignore this");</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Result</div>
<div class="content">
<pre>[
  212
]</pre>
</div>
</div>
<div class="paragraph">
<p>As the function is variadic, you can use any number of arguments when you call the function.
Arguments which are not used by the function expression are ignored.</p>
</div>
<h5 id="example-3-function-with-fixed-parameters" class="discrete">Example 3: Function with fixed parameters</h5>
<div class="paragraph">
<p>The following statement creates a function called <code>rstr</code>, which returns the specified number of characters from the right of a string.
The expression expects two named arguments: <code>vString</code>, which is the string to work with, and <code>vLen</code>, which is the number of characters to return.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE ANALYTICS FUNCTION rstr(vString, vLen) { substr(vString, length(vString) - vLen, vLen) };</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Test</div>
<div class="content">
<pre>rstr("Couchbase", 4);</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Result</div>
<div class="content">
<pre>[
  "base"
]</pre>
</div>
</div>
<h5 id="example-4-function-with-fixed-parameters-and-extra-arguments" class="discrete">Example 4: Function with fixed parameters and extra arguments</h5>
<div class="paragraph">
<p>The following statement creates a function called <code>lstr</code>, which returns the specified number of characters from the left of a string.
The expression expects two named arguments: <code>vString</code>, which is the string to work with, and <code>vLen</code>, which is the number of characters to return.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE ANALYTICS FUNCTION lstr(vString, vLen) { substr(vString, 0, vLen) };</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Test</div>
<div class="content">
<pre>lstr("Couchbase", 5, "ignore this");</pre>
</div>
</div>
<div class="paragraph">
<p>This function returns an error.
As the arguments were specified by the function definition, you must use the same number of arguments when you call the function.
If you supply the wrong number of arguments, an error is generated.</p>
</div>
<h5 id="example-5-function-with-no-parameters" class="discrete">Example 5: Function with no parameters</h5>
<div class="paragraph">
<p>This statement creates a function which returns the mathematical constant &phi;.
The function takes no arguments.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE ANALYTICS FUNCTION phi() { 2 * sin(radians(54)) };</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Test</div>
<div class="content">
<pre>phi();</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Result</div>
<div class="content">
<pre>[
  1.618033988749895
]</pre>
</div>
</div>
<h5 id="example-6-replace-a-function" class="discrete">Example 6: Replace a function</h5>
<div class="paragraph">
<p>The following statement redefines the function so that it calculates &phi; using a different method.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE OR REPLACE ANALYTICS FUNCTION phi() { (1 + sqrt(5)) / 2 };</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Test</div>
<div class="content">
<pre>phi();</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Result</div>
<div class="content">
<pre>[
  1.618033988749895
]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="external-functions"><a class="anchor" href="#external-functions"></a>External Functions</h3>
<div class="paragraph">
<p><span class="status">Developer Preview</span></p>
</div>
<div class="paragraph">
<p>In Couchbase Server 7.0 you can create external user-defined functions using Python code. This is a Developer Preview
feature. For further details see <a href="appendix_5_python.html" class="xref page">Appendix 5: Python UDFs</a>.</p>
</div>
<h5 id="createexternalfunction" class="discrete">CreateExternalFunction</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/CreateExternalFunction.png" alt="&quot;CREATE&quot; ( &quot;OR&quot; &quot;REPLACE&quot; )? &quot;ANALYTICS&quot; &quot;FUNCTION&quot; QualifiedName &quot;(&quot; FunctionParameters? &quot;)&quot; (&quot;IF&quot; &quot;NOT&quot; &quot;EXISTS&quot;)? &quot;AS&quot; StringLiteral(&quot;,&quot; StringLiteral)* &quot;AT&quot; QualifiedName(&quot;WITH&quot; ObjectConstructor)? ">
</div>
</div>
<div class="paragraph">
<p>The syntax for the function name, the parameter list, and the <code>OR REPLACE</code> and <code>IF NOT EXISTS</code> keywords is the same as for <a href="#internal-functions">creating an internal function</a>.</p>
</div>
<h5 id="stringliteral" class="discrete">StringLiteral</h5>
<div class="paragraph">
<p>The external language specific identifier for the function to be bound to the created SQL++ for Analytics function. For example, a function name or part of a fully qualified method name.
The exact usage will depend on each external language&#8217;s features and requirements.</p>
</div>
<h5 id="qualifiedname-2" class="discrete">QualifiedName</h5>
<div class="paragraph">
<p>The name of a previously created SQL++ for Analytics library created via the Libraries REST API. This is parsed as an identifier and should not be quoted.</p>
</div>
<h5 id="objectconstructor" class="discrete">ObjectConstructor</h5>
<div class="paragraph">
<p>An object constructor with one or more of the following keys and values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>null-call</code>: <code>true</code> if the function should be called if one or more arguments are <code>unknown</code>, <code>false</code> otherwise. Defaults to <code>false</code>.</p>
</li>
<li>
<p><code>deterministic</code>: <code>true</code> if the function returns the same output for the same input always and as such can be cached. <code>false</code> if it should be computed every time. Defaults to <code>true</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Python UDFs allow you to utilize your Python code from SQL++ for Analytics as a normal function. Each Python function is defined from
within a Library. Libraries belong to Scopes and are created by uploads to the UDF API endpoint. They contain a set of
Python modules along with the dependencies of those modules.</p>
</div>
</div>
<div class="sect2">
<h3 id="external-function-examples"><a class="anchor" href="#external-function-examples"></a>External Function Examples</h3>
<div class="paragraph">
<p><span class="status">Developer Preview</span></p>
</div>
<h5 id="example-7-create-an-external-python-function" class="discrete">Example 7: Create an external Python function</h5>
<div class="paragraph">
<p>Python UDFs use an identifier in the form of <code>module</code>, <code>function</code> or <code>module</code>, <code>class.method</code>. This example is of the
latter form.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE ANALYTICS FUNCTION sentiment(a)
  AS "sentiment_mod", "sent_model.sentiment" AT pylib;</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Test</div>
<div class="content">
<pre>sentiment("beef");</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Result</div>
<div class="content">
<pre>[
  "eh"
]</pre>
</div>
</div>
<h5 id="example-8-create-an-external-python-function-with-options" class="discrete">Example 8: Create an external Python function with options</h5>
<div class="paragraph">
<p>The same example as above, but with <code>null-call</code> set to <code>true</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE ANALYTICS FUNCTION sentiment(a)
  AS "sentiment_mod", "sent_model.sentiment" AT pylib;
  WITH { "null-call": true }</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Test</div>
<div class="content">
<pre>sentiment(null);</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Result</div>
<div class="content">
<pre>[
  null
]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="calling-a-function"><a class="anchor" href="#calling-a-function"></a>Calling a Function</h2>
<div class="sectionbody">
<h5 id="ordinaryfunctioncall" class="discrete">OrdinaryFunctionCall</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/OrdinaryFunctionCall.png" alt="">
</div>
</div>
<div class="paragraph">
<p>You can invoke a user-defined function in the same way as any other ordinary function.
You may optionally prefix the name of the function with the <code>ScopeName</code> of the Analytics scope containing the function.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t specify an Analytics scope when calling a function, then the scope containing the function is resolved according to the following rules:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the function call is enclosed within the function body of another user-defined function, the scope is that of the enclosing function.</p>
</li>
<li>
<p>Otherwise, if there is a preceding USE statement, the Analytics scope is specified by the USE statement.</p>
</li>
<li>
<p>Otherwise, if the <a href="appendix_3_resolution.html#Query_context" class="xref page">query_context</a> parameter is set, the Analytics scope is specified by the query context.</p>
</li>
<li>
<p>Otherwise, use the <code>Default</code> Analytics scope.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Having determined the scope, Analytics tries to find a user-defined function with the same function signature within that scope.
If a user-defined function cannot be found, Analytics tries to find a built-in function with the same function name.
If a built-in function cannot be found, the function call fails.</p>
</div>
<div class="sect2">
<h3 id="examples"><a class="anchor" href="#examples"></a>Examples</h3>
<div class="paragraph">
<p>The examples in this section assume that you are using an Analytics scope called <code>Commerce</code>.
Refer to <a href="appendix_4_examples.html" class="xref page">Appendix 4: Example Data</a> to install this example data.</p>
</div>
<div class="paragraph">
<p>You can use the <a href="5_ddl.html#Use_statements" class="xref page">USE statement</a>
to set the default scope for the statement immediately following.</p>
</div>
<div class="literalblock">
<div class="title">Example</div>
<div class="content">
<pre>USE Commerce;</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, use the <strong>query context</strong>
drop-down list at the top right of the Query Editor to select <code>Commerce</code> as the default scope for the following examples.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/workbench-context-set.png" alt="The query context drop-down menu with 'Commerce' selected">
</div>
</div>
<h5 id="example-9-function-with-subquery" class="discrete">Example 9: Function with subquery</h5>
<div class="paragraph">
<p>The following statement creates a function called <code>nameSearch</code>, which selects the customer name from all documents with the specified ID in the <code>customers</code> collection.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>CREATE ANALYTICS FUNCTION nameSearch(customerId) {
  (SELECT VALUE c.name
  FROM customers AS c
  WHERE c.custid = customerId)[0]
}</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Test</div>
<div class="content">
<pre>SELECT VALUE nameSearch("C25");</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Result</div>
<div class="content">
<pre>[
  "M. Sinclair"
]</pre>
</div>
</div>
<h5 id="example-10-call-a-user-defined-function" class="discrete">Example 10: Call a user-defined function</h5>
<div class="paragraph">
<p>The following query uses the <code>nameSearch</code> function as a projection expression in a SELECT query.
Compare this with example Q3.29 in the section on <a href="3_query.html#Subqueries" class="xref page">Subqueries</a>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT o.orderno, o.custid,
      nameSearch(o.custid) AS name
FROM orders AS o, o.items AS i
WHERE i.itemno = 120;</pre>
</div>
</div>
<div class="literalblock">
<div class="title">Result</div>
<div class="content">
<pre>[
    {
        "orderno": 1003,
        "custid": "C31",
        "name": "B. Pruitt"
    },
    {
        "orderno": 1006,
        "custid": "C41",
        "name": "R. Dodge"
    }
]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dropping-a-function"><a class="anchor" href="#dropping-a-function"></a>Dropping a Function</h2>
<div class="sectionbody">
<h5 id="dropfunction" class="discrete">DropFunction</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/DropFunction.png" alt="&quot;DROP&quot; &quot;ANALYTICS&quot; &quot;FUNCTION&quot; QualifiedName &quot;(&quot; FunctionParameters? &quot;)&quot; ( &quot;IF&quot; &quot;EXISTS&quot; )?">
</div>
</div>
<div class="paragraph">
<p>The DROP ANALYTICS FUNCTION statement enables you to delete a user-defined function.</p>
</div>
<div class="paragraph">
<p>You cannot delete a user-defined function if there are any other user-defined functions which call this function, in this Analytics scope or any other Analytics scope.</p>
</div>
<div class="sect2">
<h3 id="function-name-2"><a class="anchor" href="#function-name-2"></a>Function Name</h3>
<h5 id="qualifiedname-3" class="discrete">QualifiedName</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/QualifiedName.png" alt="(ScopeName &quot;.&quot;)? Identifier">
</div>
</div>
<h5 id="scopename-2" class="discrete">ScopeName</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/ScopeName.png" alt="(Identifier &quot;.&quot;)? Identifier">
</div>
</div>
<div class="paragraph">
<p>The <code>QualifiedName</code> specifies the name of the function to delete.
It consists of an optional scope name, followed by an identifier which represents the local name of the function.</p>
</div>
<div class="paragraph">
<p>The optional <code>ScopeName</code> specifies the Analytics scope where the function is located.
It may consist of one or two identifiers, separated by a dot.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t specify an Analytics scope, then the scope containing the function is resolved according to the same rules that are used when creating a user-defined function.</p>
</div>
</div>
<div class="sect2">
<h3 id="parameter-list-2"><a class="anchor" href="#parameter-list-2"></a>Parameter List</h3>
<h5 id="functionparameters-2" class="discrete">FunctionParameters</h5>
<div class="imageblock">
<div class="content">
<img src="_images/diagrams/FunctionParameters.png" alt="Identifier ( &quot;,&quot; Identifier )* | &quot;&#8230;&#8203;&quot;">
</div>
</div>
<div class="paragraph">
<p>When you drop a function, you must specify the same number of parameters that you specified when you created the function,
or specify <code>...</code> if you are dropping a variadic function.</p>
</div>
</div>
<div class="sect2">
<h3 id="checking-for-an-existing-function"><a class="anchor" href="#checking-for-an-existing-function"></a>Checking for an Existing Function</h3>
<div class="paragraph">
<p>The optional <code>IF EXISTS</code> keywords enable you to check whether the specified function or scope exists before dropping it.
If these keywords are present, and the function scope or function name are unknown,
the statement does nothing and completes without error.</p>
</div>
<div class="paragraph">
<p>If these keywords are not present, and the function scope or function name are unknown, an error is generated.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-2"><a class="anchor" href="#examples-2"></a>Examples</h3>
<div class="paragraph">
<p>Again, the examples in this section assume that you are using an Analytics scope called <code>Commerce</code>.
Refer to <a href="appendix_4_examples.html" class="xref page">Appendix 4: Example Data</a> to install this example data.</p>
</div>
<div class="paragraph">
<p>You can use the <a href="5_ddl.html#Use_statements" class="xref page">USE statement</a>
to set the default scope for the statement immediately following.</p>
</div>
<div class="literalblock">
<div class="title">Example</div>
<div class="content">
<pre>USE Commerce;</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, use the <strong>query context</strong>
drop-down list at the top right of the Query Editor to select <code>Commerce</code> as the default scope for the following example.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/workbench-context-set.png" alt="The query context drop-down menu with 'Commerce' selected">
</div>
</div>
<h5 id="example-11-drop-a-function" class="discrete">Example 11: Drop a Function</h5>
<div class="paragraph">
<p>This statement drops the function named <code>nameSearch</code>, if it exists.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DROP ANALYTICS FUNCTION nameSearch(customerId) IF EXISTS;</pre>
</div>
</div>
<div class="paragraph">
<p>You can run the following query to check that the function is no longer available.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT * FROM Metadata.`Function`;</pre>
</div>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"Server","components":["server"],"url":"/home/server.html","latestVersions":{"server":"7.2"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
