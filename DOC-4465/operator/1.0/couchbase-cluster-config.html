<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>About the CouchbaseCluster Configuration File | Couchbase Docs (Staging)</title>
    <link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-4465/operator/1.2/couchbase-cluster-config.html">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="schema.dcterms" href="https://purl.org/dc/terms/">
    <meta name="dcterms.subject" content="operator">
    <meta name="dcterms.identifier" content="1.0">
    <meta name="generator" content="Antora 1.1.1">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" id="topbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://www.couchbase.com"><img src="../../_/img/logo.svg" alt="Couchbase"></a>
        <button class="navbar-burger" data-target="topbar-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="topbar-menu" class="navbar-menu">
        <div class="navbar-start">
          <div class="navbar-item has-dropdown">
            <a class="navbar-link" href="https://simon-dew.github.io/docs-site/DOC-4465">Docs</a>
            <div class="navbar-dropdown explore">
              <div class="title">Couchbase Documentation Overview</div>
              <div class="cols">
                <ul>
                  <li class="heading"><a href="../../server/6.0/introduction/intro.html">Server</a></li>
                  <li><a href="../../server/6.0/n1ql/n1ql-language-reference/index.html">N1QL</a></li>
                  <li><a href="../../server/6.0/fts/full-text-intro.html">Full Text Search</a></li>
                  <li><a href="../../server/6.0/analytics/introduction.html">Analytics</a></li>
                  <li><a href="../../server/6.0/eventing/eventing-overview.html">Eventing</a></li>
                  <li><a href="../1.2/overview.html">Autonomous Operator</a></li>
                </ul>
                <ul>
                  <li class="heading">Mobile</li>
                  <li><a href="../../couchbase-lite/2.5/index.html">Lite</a></li>
                  <li><a href="../../sync-gateway/2.5/index.html">Sync Gateway</a></li>
                </ul>
                <ul class="two-cols">
                  <li class="heading"><a href="../../server/6.0/sdk/overview.html">SDKs</a></li>
                  <li><a href="../../c-sdk/2.10/start-using-sdk.html">C</a></li>
                  <li><a href="../../dotnet-sdk/2.7/start-using-sdk.html">.NET</a></li>
                  <li><a href="../../go-sdk/1.5/start-using-sdk.html">Go</a></li>
                  <li><a href="../../java-sdk/2.7/start-using-sdk.html">Java</a></li>
                  <li><a href="../../nodejs-sdk/2.6/start-using-sdk.html">Node.js</a></li>
                  <li><a href="../../php-sdk/2.6/start-using-sdk.html">PHP</a></li>
                  <li><a href="../../python-sdk/2.5/start-using-sdk.html">Python</a></li>
                </ul>
                <ul>
                  <li class="heading"><a href="../../server/6.0/connectors/intro.html">Connectors</a></li>
                  <li><a href="../../elasticsearch-connector/4.0/index.html">Elasticsearch</a></li>
                  <li><a href="../../server/6.0/connectors/hadoop-1.2/hadoop.html">Hadoop</a></li>
                  <li><a href="../../kafka-connector/3.4/index.html">Kafka</a></li>
                  <li><a href="../../spark-connector/2.2/index.html">Spark</a></li>
                  <li><a href="../../talend-connector/index.html">Talend</a></li>
                  <li><a href="../../server/6.0/connectors/odbc-jdbc-drivers.html">ODBC/JDBC</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="navbar-item has-dropdown">
            <a class="navbar-link component" href="overview.html"><span class="title">Autonomous Operator</span> <span class="version">1.0</span></a>
            <div class="navbar-dropdown versions">
              <div class="cols">
                <ul>
                  <li><a class="navbar-item" href="../1.2/couchbase-cluster-config.html">Autonomous Operator 1.2</a></li>
                  <li><a class="navbar-item" href="../1.1/couchbase-cluster-config.html">Autonomous Operator 1.1</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <a class="btn red-btn" href="https://www.couchbase.com/downloads">Downloads</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body container">
<nav class="nav">
<div class="nav-menu">
<ul class="nav-list">
  <li class="nav-item is-active" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="overview.html">Introduction</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="whats-new.html">What&#8217;s New?</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Getting Started</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="prerequisite-and-setup.html">System Requirements</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="best-practices.html">Guidelines and Best Practices</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Deploying the Operator</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="install-kubernetes.html">Installing on Kubernetes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="install-openshift.html">Installing on OpenShift</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="operator-config.html">About the Operator Deployment Settings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="kubernetes-rbac.html">About Kubernetes RBAC</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Managing the Operator</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="list-and-describe.html">Monitoring Kubernetes Resources</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="services.html">Monitoring Services</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-path is-active" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="deploying-couchbase.html">Deploying Couchbase Server</a>
    </span>
<ul class="nav-list">
  <li class="nav-item is-current-page is-active" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="couchbase-cluster-config.html">Couchbase Configuration Settings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="networking.html">About Kubernetes Networking</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="xdcr.html">Using XDCR</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="tls.html">Configuring TLS</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="accessing-couchbase.html">Accessing the Couchbase User Interfaces</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="persisted-volumes-guide.html">About Persistent Volumes</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="persisted-volumes-setup.html">Setting Up Persistent Volumes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="persisted-volumes-zoning-guide.html">Persistent Volume Zoning Guide</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="server-groups.html">Using Server Groups</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="couchbase-clients.html">Using Couchbase Clients</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="running-couchbase.html">Managing Couchbase Server</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="updating-couchbase.html">Modifying a Couchbase Deployment</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="scaling-couchbase.html">Scaling a Couchbase Deployment</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="node-recovery.html">Recovering From a Node Failure</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="delete-couchbase-cluster.html">Deleting a Couchbase Deployment</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="backup-and-restore.html">Backing up and Restoring a Couchbase Deployment</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="conditions-and-events.html">Monitoring Couchbase Events</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="cluster-status-guide.html">Monitoring Couchbase Cluster Status</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Troubleshooting</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="logs-troubleshooting.html">Viewing and Retrieving Logs</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Tools</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="cbopctl.html">cbopctl</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="cbopinfo.html">cbopinfo</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="demo.html">Couchbase Deployment Tutorial</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="release-notes.html">Release Notes</a>
    </span>
  </li>
</ul>
  </li>
</ul>
</div>
</nav>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
<main class="article" data-ceiling="topbar">
  <div class="article-banner">
    <p>A newer version of this documentation is available.</p>
    <a class="btn" href="../1.2/couchbase-cluster-config.html">View Latest</a>
  </div>
  <div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="overview.html">Autonomous Operator</a></li>
    <li class="crumb"><a href="deploying-couchbase.html">Deploying Couchbase Server</a></li>
    <li class="crumb"><a href="couchbase-cluster-config.html">Couchbase Configuration Settings</a></li>
  </ul>
</nav>
  </div>
<article class="doc">
<h1 class="page">About the CouchbaseCluster Configuration File</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>To use the Couchbase Autonomous Operator to deploy a Couchbase Server cluster, you need to create a CouchbaseCluster configuration file that describes how the cluster should be configured and maintained by the Operator. Like all Kubernetes configurations, Couchbase Server clusters are defined using either YAML or JSON (YAML is preferred by Kubernetes) and then pushed into Kubernetes.</p>
</div>
<div class="listingblock">
<div class="title">The following sample CouchbaseCluster configuration file lists all of the available configuration parameters:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: couchbase.com/v1
kind: CouchbaseCluster
metadata:
  name: cb-example
  namespace: default
spec:
  baseImage: couchbase/server
  version: enterprise-5.5.1
  paused: false
  antiAffinity: true
  tls:
    static:
      member:
        serverSecret: couchbase-server-tls
      operatorSecret: couchbase-operator-tls
  authSecret: my-secret
  exposeAdminConsole: true
  adminConsoleServices:
    - data
  exposedFeatures:
    - xdcr
  softwareUpdateNotifications: true
  serverGroups:
    - us-east-1a
    - us-east-1b
    - us-east-1c
  securityContext:
    runAsUser: 1000
    runAsNonRoot: true
    fsGroup: 1000
  disableBucketManagement: false
  cluster:
    dataServiceMemoryQuota: 256
    indexServiceMemoryQuota: 256
    searchServiceMemoryQuota: 256
    eventingServiceMemoryQuota: 256
    analyticsServiceMemoryQuota: 1024
    indexStorageSetting: default
    autoFailoverTimeout: 120
    autoFailoverMaxCount: 3
    autoFailoverOnDataDiskIssues: true
    autoFailoverOnDataDiskIssuesTimePeriod: 120
    autoFailoverServerGroup: false
  buckets:
    - name: default
      type: couchbase
      memoryQuota: 1024
      replicas: 1
      ioPriority: high
      evictionPolicy: value-eviction
      conflictResolution: seqno
      enableFlush: true
      enableIndexReplica: false
  servers:
    - size: 1
      name: all_services
      services:
        - data
        - index
        - query
        - search
        - eventing
        - analytics
      serverGroups:
        - us-east-1a
      pod:
        couchbaseEnv:
          - name: ENV1
            value: value
        resources:
          limits:
            cpu: 4
            memory: 8Gi
            storage: 100Gi
          requests:
            cpu: 2
            memory: 8Gi
            storage: 50Gi
        labels:
          couchbase_services: all
        nodeSelector:
          instanceType: large
        tolerations:
          - key: app
            operator: Equal
            value: cbapp
            effect: NoSchedule
        automountServiceAccountToken: false
        volumeMounts:
          default: couchbase
          data:  couchbase
          index: couchbase
          analytics:
            - couchbase
            - couchbase
  volumeClaimTemplates:
    - metadata:
        name: couchbase
      spec:
        storageClassName: "standard"
        resources:
          requests:
            storage: 1Gi</code></pre>
</div>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="top-level-definitions"><a class="anchor" href="#top-level-definitions"></a>Top-Level Definitions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following are the top-level parameters for a CouchbaseCluster configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: couchbase.com/v1
kind: CouchbaseCluster
metadata:
  name: cb-example
  namespace: default</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="apiversion"><a class="anchor" href="#apiversion"></a>apiversion</h3>
<div class="paragraph">
<p>This field specifies the API version for the Couchbase integration. As the integration changes over time, you can change the API version whenever new features are added. For any given release, the API versions that are supported by that Operator will be specified in the documentation. It is recommended that you upgrade to the latest API version whenever possible.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> This field is required and must be set to a valid API Version. The value of this field cannot be changed after the cluster is created.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="kind"><a class="anchor" href="#kind"></a>kind</h3>
<div class="paragraph">
<p>This field specifies that this Kubernetes configuration will use the custom Couchbase controller to manage the cluster.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> This field is required and must always be set to <code>CouchbaseCluster</code>. The value of this field cannot be changed after the cluster is created.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="metadata"><a class="anchor" href="#metadata"></a>metadata</h3>
<div class="paragraph">
<p>Allows setting a name for the Couchbase cluster and a namespace that the cluster should be deployed in.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> A name is highly recommended, but not required. If values are not set in the metadata field then defaults will be set. The value of <code>name</code> will be autogenerated and the value of <code>namespace</code> will be set to <code>default</code>. The value of these fields cannot be changed after the cluster is created.</p>
</div>
</blockquote>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spec"><a class="anchor" href="#spec"></a>spec</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the top-level parameters related to a Couchbase cluster deployment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  baseImage: couchbase/server
  version: enterprise-5.5.1
  paused: false
  antiAffinity: true
  tls:
    static:
      member:
        serverSecret: couchbase-server-tls
      operatorSecret: couchbase-operator-tls
  authSecret: my-auth-secret
  exposeAdminConsole: true
  adminConsoleServices:
    - data
  exposedFeatures:
    - xdcr
  softwareUpdateNotifications: true
  serverGroups:
    - us-east-1a
    - us-east-1b
    - us-east-1c
  securityContext:
    runAsUser: 1000
    runAsNonRoot: true
    fsGroup: 1000
  disableBucketManagement: false</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="baseimage"><a class="anchor" href="#baseimage"></a>baseImage</h3>
<div class="paragraph">
<p>This field specifies the image that should be used.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>baseImage</code> field is required and should be set to <code>couchbase/server</code> unless you want Kubernetes to pull the Couchbase Server docker container from a different location. The value of this field cannot be changed after the cluster is created.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="version"><a class="anchor" href="#version"></a>version</h3>
<div class="paragraph">
<p>This field specifies the version number of Couchbase Server to install. This should match an available version number in the Couchbase Docker repository. It may never be changed to a lower version number than the version that is currently running.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>version</code> field is required and should be set to the version of Couchbase Server that should be used to build the cluster. The value of this field cannot be changed after the cluster is created.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="paused"><a class="anchor" href="#paused"></a>paused</h3>
<div class="paragraph">
<p>This field specifies whether or not the Operator is currently managing this cluster. This parameter should generally be set to <code>true</code>, but may be set to <code>false</code> if you decide to make manual changes to the cluster. By disabling the Operator you can change the cluster configuration without having to worry about the Operator reverting the changes. However, before re-enabling the Operator, ensure that the Kubernetes configuration matches the cluster configuration.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>paused</code> field is not required and defaults to <code>false</code> if not specified.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="antiaffinity"><a class="anchor" href="#antiaffinity"></a>antiAffinity</h3>
<div class="paragraph">
<p>This field specifies whether or not two pods in this cluster can be deployed on the same Kubernetes node. In a production setting this parameter should always be set to <code>true</code> in order to reduce the chance of data loss in case a Kubernetes node crashes.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>antiAffinity</code> field is not required and defaults to <code>false</code> if not specified. The value of this field cannot be changed after the cluster is created.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="tls"><a class="anchor" href="#tls"></a>tls</h3>
<div class="paragraph">
<p>This field is optional and controls whether the Operator uses TLS for communication with the cluster. It also sets the TLS certificates that are used by Couchbase clients and XDCR. Refer to the <a href="tls.html" class="page">TLS documentation</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="authsecret"><a class="anchor" href="#authsecret"></a>authSecret</h3>
<div class="paragraph">
<p>This field specifies the name of a Kubernetes Secret that should be used as the user name and password of the Couchbase super-user.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>authSecret</code> field is required and should reference the name of a <a href="https://kubernetes.io/docs/concepts/configuration/secret/">Kubernetes Secret</a> that already exists. The value of this field cannot be changed after the cluster is created.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="exposeadminconsole"><a class="anchor" href="#exposeadminconsole"></a>exposeAdminConsole</h3>
<div class="paragraph">
<p>This field specifies whether or not the Couchbase Server Web Console should be exposed externally. Exposing the web console is done using a NodePort service and the port for the service can be found in the describe output when describing this cluster. This parameter may be changed while the cluster is running and the Operator will create/destroy the NodePort service as appropriate.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>exposeAdminConsole</code> field is not required and defaults to <code>false</code> if not specified.  If set to <code>true</code> the specification must also have the <a href="#adminconsoleservices">adminConsoleServices</a> property defined.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="adminconsoleservices"><a class="anchor" href="#adminconsoleservices"></a>adminConsoleServices</h3>
<div class="paragraph">
<p>When the Couchbase Server Web Console is exposed with the <a href="#exposeadminconsole">exposeAdminConsole</a> property, by default, opening a browser session to the Web Console will be automatically load balanced across all pods in the cluster to provide high availability. However, the Web Console will display different features based on the services that are running on the particular pod that it&#8217;s connected to.</p>
</div>
<div class="paragraph">
<p>This property allows the UI service to be constrained to pods running one or more specific services. The services that you specify are subtractive in nature — they will only identify pods running all of those services — so care must be used. For example, if the cluster is deployed with multi-dimensional scaling, the data service on one set of pods, and the analytics service on another mutually exclusive set, then specifying <code>data</code> and <code>analytics</code> as your Web Console services list would result in the Web Console not being accessible — no pods match all the constraints, i.e. no pods are running both the data and analytics services.</p>
</div>
<div class="paragraph">
<p>If you require access to a specific pod running a specific service, this can also be achieved by using the <code>admin</code> option of the <a href="#exposedfeatures">exposedFeatures</a> property.  This will allow access via a node port. You must connect directly to the IP address of the node that the pod is running on. The assigned node port is available via the cluster status structure returned by <code>kubectl describe</code>, or via the output of <code>kubectl get services</code>. Refer to the <a href="services.html" class="page">services documentation</a> for more information.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>adminConsoleServices</code> list is not required and defaults to an empty list. Valid item names are <code>data</code>, <code>index</code>, <code>query</code>, <code>search</code>, <code>eventing</code>, and <code>analytics</code>, and must be unique. An empty list means that any node in the cluster may be chosen when connecting to the Couchbase Server Web Console.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="exposedfeatures"><a class="anchor" href="#exposedfeatures"></a>exposedFeatures</h3>
<div class="paragraph">
<p>This field specified a list of per-pod features to expose on the cluster network (as opposed to the pod network).  These define sets of ports which are required to support the specified features.  The supported values are as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">admin</dt>
<dd>
<p>Exposes the admin API and UI</p>
</dd>
<dt class="hdlist1">xdcr</dt>
<dd>
<p>Exposes the ports necessary to support XDCR via L3 connectivity at the cluster network layer.</p>
</dd>
<dt class="hdlist1">client</dt>
<dd>
<p>Exposes all client services.  These include data, views, query, full text search, analytics.</p>
</dd>
</dl>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>exposedFeatures</code> list is optional, no feature sets are exposed to the cluster network if unset.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="softwareupdatenotifications"><a class="anchor" href="#softwareupdatenotifications"></a>softwareUpdateNotifications</h3>
<div class="paragraph">
<p>This field specifies whether or not software update notifications are displayed in the Couchbase UI.  This provides a visual indication as to whether a software update is available and should be applied in order to increase functionality or fix defects.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>softwareUpdateNotifications</code> field is optional and defaults to false if not specified.  This setting can be modified at any point in the cluster life-cycle.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="servergroups_main"><a class="anchor" href="#servergroups_main"></a>serverGroups</h3>
<div class="paragraph">
<p>Setting the server groups field enables automatic management of Couchbase server groups.  The end user is responsible for adding labels to thier Kubernetes nodes which will be used to evenly distribute nodes across server groups so the cluster is tolerant to the loss of an entire data center (or any other desired failure domain).  Nodes are labelled with a key of <code>failure-domain.beta.kubernetes.io/zone</code> and an arbitrary name string.  Multiple nodes may have the same server group to allow multiple pods to be scheduled there regardless of anti-affinity settings.  An example of applying the label is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl label nodes ip-172-16-0-10 failure-domain.beta.kubernetes.io/zone=us-east-1a</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the list of server groups to use is explicit the end user has flexibility in controlling exactly where pods will be scheduled e.g. one cluster may reside in one set of server groups, and another cluster in another set of server groups.</p>
</div>
<div class="paragraph">
<p>At present the scheduling simply stripes pods across the server groups; each new pod is run in a server group with the fewest existing cluster members.  This is performed on a per-server configuration basis to ensure individual classes of servers are equally distributed for high-availability.  For each class of server configuration you may choose override the set of server groups to schedule across; see the documentation under the <code>spec.servers.serverGroups</code> configuration key.</p>
</div>
<div class="paragraph">
<p>The server group feature also not support service redistribution at this time, so scaling the set of server groups will not result in any pods being 'moved' to make best use of the new topology or evacuated from a removed server group.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>serverGroups</code> field is optional.  If set pods will be scheduled across the specified set of server groups.  The server groups must be set at cluster creation time, and currently should be assumed to be immutable.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="securitycontext"><a class="anchor" href="#securitycontext"></a>securityContext</h3>
<div class="paragraph">
<p>This field is a Kubernetes PodSecurityContext object which is attached to all pods that are created by the Operator. If unspecified, this will default to the <code>couchbase</code> user, mount attached volumes as that user, and ensure that the containers are running as non-root. You may override the default behavior if using a custom container image or for testing purposes.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>securityContext</code> field is optional. If set, this will be attached to all new pods that are created by the Operator. This field should not be modified during the cluster lifecycle.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="disablebucketmanagement"><a class="anchor" href="#disablebucketmanagement"></a>disableBucketManagement</h3>
<div class="paragraph">
<p>This field specifies whether to ignore the bucket configuration. When <code>disableBucketManagement</code> is set to <code>false</code> (the default), the Operator will have sole control over creating the buckets that are specified in the configuration (and deleting the buckets that are not).</p>
</div>
<div class="paragraph">
<p>If set to <code>true</code>, the creation and deletion of buckets must be done manually using the the Couchbase Server Web Console, CLI, REST API, or SDK. Even if buckets are specified in the configuration, as long as <code>disableBucketManagement</code> is set to <code>false</code>, the Operator will not create or delete any buckets.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>disableBucketManagement</code> field is optional and defaults to <code>false</code>.</p>
</div>
</blockquote>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spec-cluster"><a class="anchor" href="#spec-cluster"></a>spec.cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the various Couchbase cluster settings. This section is not meant to encompass every setting that is configurable on Couchbase. Cluster settings not mentioned here can be managed manually.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  cluster:
    dataServiceMemoryQuota: 4096
    indexServiceMemoryQuota: 1024
    searchServiceMemoryQuota: 2048
    eventingServiceMemoryQuota: 256
    analyticsServiceMemoryQuota: 1024
    indexStorageSetting: plasma
    autoFailoverTimeout: 120
    autoFailoverMaxCount: 3
    autoFailoverOnDataDiskIssues: true
    autoFailoverOnDataDiskIssuesTimePeriod: 120
    autoFailoverServerGroup: false</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="dataservicememoryquota"><a class="anchor" href="#dataservicememoryquota"></a>dataServiceMemoryQuota</h3>
<div class="paragraph">
<p>The amount of memory to assign to the data service if it is present on a specific Couchbase node. The amount of memory is defined in Megabytes (MB).</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>dataServiceMemoryQuota</code> field is required and must be set to be greater than or equal to 256. Keep in mind that the sum of all memory quotas must be no more than 80% of a pod&#8217;s available memory.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="indexservicememoryquota"><a class="anchor" href="#indexservicememoryquota"></a>indexServiceMemoryQuota</h3>
<div class="paragraph">
<p>The amount of memory to assign to the index service if it is present on a specific Couchbase node. The amount of memory is defined in Megabytes (MB).</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>indexServiceMemoryQuota</code> field is required and must be set to be greater than or equal to 256. Keep in mind that the sum of all memory quotas must be no more than 80% of a pod&#8217;s available memory.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="searchservicememoryquota"><a class="anchor" href="#searchservicememoryquota"></a>searchServiceMemoryQuota</h3>
<div class="paragraph">
<p>The amount of memory to assign to the search service if it is present on a specific Couchbase node. The amount of memory is defined in Megabytes (MB). This parameter defaults to 256 MB if it is not set.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>searchServiceMemoryQuota</code> field is required and must be set to be greater than or equal to 256. Keep in mind that the sum of all memory quotas must be no more than 80% of a pod&#8217;s available memory.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="eventingservicememoryquota"><a class="anchor" href="#eventingservicememoryquota"></a>eventingServiceMemoryQuota</h3>
<div class="paragraph">
<p>The amount of memory to assign to the eventing service if present on a specific Couchbase node in Mi.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>eventingServiceMemoryQuota</code> field is required and must be set to be greater than or equal to 256. Keep in mind that the sum of all memory quotas must be no more than 80% of a pods available memory.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="analyticsservicememoryquota"><a class="anchor" href="#analyticsservicememoryquota"></a>analyticsServiceMemoryQuota</h3>
<div class="paragraph">
<p>The amount of memory to assign to the analytics service if present on a specific Couchbase node in Mi.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>analyticsServiceMemoryQuota</code> field is required and must be set to be greater than or equal to 1024. Keep in mind that the sum of all memory quotas must be no more than 80% of a pods available memory.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="indexstoragesetting"><a class="anchor" href="#indexstoragesetting"></a>indexStorageSetting</h3>
<div class="paragraph">
<p>Specifies the backend storage type to use for the index service. If the cluster already contains a Couchbase Server instance running the index service, then this parameter cannot be changed until all Couchbase instances running the index service are removed.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>indexStorageSetting</code> is required and must be set to either <code>plasma</code> or <code>memory-optimized</code>. The value of this field can only be changed if there are no index nodes in the cluster.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="autofailovertimeout"><a class="anchor" href="#autofailovertimeout"></a>autoFailoverTimeout</h3>
<div class="paragraph">
<p>Specifies the auto-failover timeout in seconds. The Operator relies on the CouchbaseCluster to auto-failover nodes before removing them, so setting this field to an appropriate value is important.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>autoFailoverTimeout</code> is required and must be in the range 5-3600</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="autofailovermaxcount"><a class="anchor" href="#autofailovermaxcount"></a>autoFailoverMaxCount</h3>
<div class="paragraph">
<p>Specifies the maximum number of failover events we can tolerate before manual intervention is required.  If a bucket as 2 replicas we can tolerate 2 pods failing over.  Applies to entire server groups also.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>autoFailoverMaxCount</code> is required and must be in the range 1-3</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="autofailoverondatadiskissues"><a class="anchor" href="#autofailoverondatadiskissues"></a>autoFailoverOnDataDiskIssues</h3>
<div class="paragraph">
<p>Specifies whether a node will automatically fail over on data disk issues.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>autoFailoverOnDataDiskIssues</code> is required and must be <code>true</code> or <code>false</code>.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="autofailoverondatadiskissuestimeperiod"><a class="anchor" href="#autofailoverondatadiskissuestimeperiod"></a>autoFailoverOnDataDiskIssuesTimePeriod</h3>
<div class="paragraph">
<p>Specifies the time period to wait before automatically failing over a node experiencing data disk issues.  This field&#8217;s units are in seconds.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>autoFailoverOnDataDiskIssuesTimePeriod</code> is only required if <code>autoFailoverOnDataDiskIssues</code> is also set to <code>true</code>.  Must be in the range 5-3600</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="autofailoverservergroup"><a class="anchor" href="#autofailoverservergroup"></a>autoFailoverServerGroup</h3>
<div class="paragraph">
<p>Specifies whether the cluster will automatically failover an entire server group.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>autoFailoverServerGroup</code> is optional, defaulting to false.</p>
</div>
</blockquote>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spec-buckets"><a class="anchor" href="#spec-buckets"></a>spec.buckets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes one or more buckets that must be created in the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you remove an already specified bucket from the configuration, the Operator will delete that bucket from the cluster.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  buckets:
    - name: default
      type: couchbase
      memoryQuota: 1024
      replicas: 1
      ioPriority: high
      evictionPolicy: value-eviction
      conflictResolution: seqno
      enableFlush: true
      enableIndexReplica: false</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="name"><a class="anchor" href="#name"></a>name</h3>
<div class="paragraph">
<p>This field specifies the name of the bucket. This parameter is required when specifying a bucket.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>name</code> is required and must be a string using characters and numbers. The value of this field cannot be changed after the bucket is created.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="type"><a class="anchor" href="#type"></a>type</h3>
<div class="paragraph">
<p>This field specifies the type of bucket to create. This parameter can be set to <code>couchbase</code>, <code>ephemeral</code>, or <code>memcached</code>. If the type is not specified, it defaults to <code>couchbase</code>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>type</code> is required and must be set to either <code>couchbase</code>, <code>ephemeral</code>, or <code>memcached</code>. The value of this field cannot be changed after the bucket is created.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="memoryquota"><a class="anchor" href="#memoryquota"></a>memoryQuota</h3>
<div class="paragraph">
<p>This field specifies the amount of memory to allocate to this bucket in Megabytes (MB). If the quota is not specified, it defaults to 100.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>memoryQuota</code> is required and must be set to greater than or equal to 100.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="replicas"><a class="anchor" href="#replicas"></a>replicas</h3>
<div class="paragraph">
<p>This field specifies the number of replicas that should be created for this bucket. This value may be set between 0 and 3 inclusive. If the number is not set, it defaults to 1. Note that this parameter has no effect for the memcached bucket type.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>replicas</code> field is required for buckets with type <code>couchbase</code> and <code>ephemeral</code> and must be set between 0 and 3. Memcached buckets will ignore values in this field. Changing the value of this field will cause a rebalance to occur.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="iopriority"><a class="anchor" href="#iopriority"></a>ioPriority</h3>
<div class="paragraph">
<p>This field sets the IO priority of background threads for this bucket. This option is valid for Couchbase and Ephemeral buckets only. Memcached buckets will ignore values in this field.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>ioPriority</code> is required for buckets with type <code>couchbase</code> and <code>ephemeral</code> and must be set to either <code>high</code> or <code>low</code>. Memcached buckets will ignore values in this field. Changing the value of this field will cause downtime while the bucket is restarted.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="evictionpolicy"><a class="anchor" href="#evictionpolicy"></a>evictionPolicy</h3>
<div class="paragraph">
<p>This field sets the memory-cache eviction policy for this bucket. This option is valid for Couchbase and Ephemeral buckets only.</p>
</div>
<div class="paragraph">
<p>Couchbase buckets support either <code>valueOnly</code> or <code>fullEviction</code>. Specifying the <code>valueOnly</code> policy means that each key stored in this bucket must be kept in memory. This is the default policy; using this policy improves the performance of key-value operations, but limits the maximum size of the bucket. Specifying the <code>fullEviction</code> policy means that the performance is impacted for key-value operations, but the maximum size of the bucket is unbounded.</p>
</div>
<div class="paragraph">
<p>Ephemeral buckets support either <code>noEviction</code> or <code>nruEviction</code>.
Specifying <code>noEviction</code> means that the bucket will not evict items from the cache if the cache is full. This type of eviction policy should be used for in-memory database use cases.</p>
</div>
<div class="paragraph">
<p>Specifying <code>nruEviction</code> means that items not recently used will be evicted from memory when all the memory in the bucket is used. This type of eviction policy should be used for caching use cases.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>evictionPolicy</code> is required for buckets with type <code>couchbase</code> and <code>ephemeral</code>. Memcached buckets will ignore values in this field. Changing the value of this field will cause downtime while the bucket is restarted.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="conflictresolution"><a class="anchor" href="#conflictresolution"></a>conflictResolution</h3>
<div class="paragraph">
<p>This field specifies the bucket&#8217;s conflict resolution mechanism which is to be used if a conflict occurs during cross-datacenter replication (XDCR). There are two supported mechanisms: sequence-based and timestamp-based.</p>
</div>
<div class="paragraph">
<p>The sequence-based conflict resolution mechanism selects the document that has been updated the greatest number of times since the last sync. For example, if one cluster has updated a document twice since the last sync, and the other cluster has updated the document three times, the document updated three times is selected regardless of the specific times at which these updates took place.</p>
</div>
<div class="paragraph">
<p>The timestamp-based conflict resolution mechanism selects the document with the most recent timestamp. This is only supported when all of the clocks on all of the nodes are fully synchronized.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>conflictResolution</code> field is required for buckets with type <code>couchbase</code> and <code>ephemeral</code> and can be set to either <code>seqno</code> or <code>lww</code>. Memcached buckets will ignore values in this field. The value of this field cannot be changed after the bucket has been created.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="enableflush"><a class="anchor" href="#enableflush"></a>enableFlush</h3>
<div class="paragraph">
<p>This field specifies whether or not to enable the flush command on this bucket. This parameter defaults to <code>false</code> if it is not specified. This parameter only affects Couchbase and Ephemeral buckets.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>enableFlush</code> field can be set to either <code>true</code> or <code>false</code>. If this parameter is not specified, it defaults to <code>false</code>.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="enableindexreplica"><a class="anchor" href="#enableindexreplica"></a>enableIndexReplica</h3>
<div class="paragraph">
<p>This field specifies whether or not to enable view index replicas for this bucket. This parameter defaults to <code>false</code> if it is not specified. This parameter only affects Couchbase buckets.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>enableIndexReplica</code> field is required for buckets with type <code>couchbase</code> and can be set to either <code>true</code> or <code>false</code>. Memcached and Ephemeral buckets will ignore values in this field.</p>
</div>
</blockquote>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spec-servers"><a class="anchor" href="#spec-servers"></a>spec.servers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You must specify at least one - but possibly multiple - node specifications. A node specification is used to allow multi-dimensional scaling of a Couchbase cluster with Kubernetes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  servers:
  - size: 1
    name: all_services
    services:
      - data
      - index
      - query
      - search
      - eventing
      - analytics
    serverGroups:
      - us-east-1a
    pod:
      couchbaseEnv:
        - name: CB_ENV_VAR
          value: value
      resources:
        limits:
          cpu: 4
          memory: 8Gi
          storage: 100Gi
        requests:
          cpu: 2
          memory: 8Gi
          storage: 50Gi
      labels:
        couchbase_services: all
      nodeSelector:
        instanceType: large
      tolerations:
        - key: app
          operator: Equal
          value: cbapp
          effect: NoSchedule</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Specification rules:</em> The <code>servers</code> portion of the specification is required and must always contain at least one server definition. There must also be at least one definition that contains the data service.</p>
</div>
<div class="sect2">
<h3 id="size"><a class="anchor" href="#size"></a>size</h3>
<div class="paragraph">
<p>This field specifies the number of nodes of this type that should be in the cluster. This allows the user to scale up different parts of the cluster as necessary. If this parameter is changed at runtime, the Operator will <a href="scaling-couchbase.html" class="page">automatically scale the cluster</a>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>size</code> is required and can be set to greater than or equal to 1.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="name-2"><a class="anchor" href="#name-2"></a>name</h3>
<div class="paragraph">
<p>This field specifies a name for this group of servers.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>name</code> field is required and must be unique in comparison to the <code>name</code> field of other server definitions. The value of this field cannot be changed after a server has been defined.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="services"><a class="anchor" href="#services"></a>services</h3>
<div class="paragraph">
<p>This field specifies a list of services that should be run on nodes of this type. Users can specify <code>data</code>, <code>index</code>, <code>query</code>, <code>search</code>, <code>eventing</code> and <code>analytics</code> in the list. At least one service must be specified and all clusters must contain at least one node specification that includes the data service.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The <code>services</code> list is required and must contain at least one service. Valid values for services are <code>data</code>, <code>index</code>, <code>query</code>, <code>search</code>, <code>eventing</code> and <code>analytics</code>. The values of this list cannot be changed after a server has been defined.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="servergroups"><a class="anchor" href="#servergroups"></a>serverGroups</h3>
<div class="paragraph">
<p>This controls the set of server groups to schedule pods in.  Functionality is identical to that defined in the top level specification, but overrides it and allows the end user to specify exactly where pods of individual server/service configuration are scheduled.  See the <a href="#servergroups_main">main documentation</a> for details.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spec-servers-pod"><a class="anchor" href="#spec-servers-pod"></a>spec.servers.pod</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The pod policy defines settings that apply to all pods deployed with this node configuration. A pod always contains a single running instance of Couchbase Server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  servers:
  - pod:
      couchbaseEnv:
        - name: CB_ENV_VAR
          value: value
      resources:
        limits:
          cpu: 4
          memory: 8Gi
          storage: 100Gi
        requests:
          cpu: 2
          memory: 8Gi
          storage: 50Gi
      labels:
        couchbase_services: all
      nodeSelector:
        instanceType: large
      tolerations:
        - key: app
          operator: Equal
          value: cbapp
          effect: NoSchedule
      volumeMounts:
        default: couchbase
        data:  couchbase
        index: couchbase
        analytics:
          - couchbase
          - couchbase</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="couchbaseenv"><a class="anchor" href="#couchbaseenv"></a>couchbaseEnv</h3>
<div class="paragraph">
<p>This field specifies the environment variables (as key-values pairs) that should be set when the pod is started. This section is optional.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The value of this field cannot be changed after a server has been defined.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="resources"><a class="anchor" href="#resources"></a>resources</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  servers:
  - pod:
      resources:
        limits:
          cpu: 2
          memory: 8Gi
          storage: 100Gi
        requests:
          cpu: 1.5
          memory: 8Gi
          storage: 50Gi</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">limits</dt>
<dd>
<p>This field lets you reserve resources on a specific node. It defines the maximum amount of CPU, memory, and storage the pods created in this node specification will reserve.</p>
</dd>
<dt class="hdlist1">requests</dt>
<dd>
<p>This field lets you reserve resources on a specific node. The requests section defines the minimum amount of CPU, memory, and storage the pods created in this node specification will reserve.</p>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In general, CPU limits are specified as the number of threads required on physical hardware (vCPUs if in the cloud), and memory is specified in bytes. Refer to the Kubernetes documentation for more information about <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/">managing compute resources</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="labels"><a class="anchor" href="#labels"></a>labels</h3>
<div class="paragraph">
<p>Labels are key-value pairs that are attached to objects in Kubernetes. They are intended to specify identifying attributes of objects that are meaningful to the user and do not directly imply semantics to the core system. Labels can be used to organize and select subsets of objects. They do not need to be unique across multiple objects. This section is optional.</p>
</div>
<div class="paragraph">
<p>Labels added in this section will apply to all pods added in this cluster. Note that by default we add the following labels to each pod, which should not be overridden.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>app:couchbase
couchbase_cluster:&lt;metadata:name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>In the sample configuration file referenced in this topic, the label would be <code>couchbase_cluster:cb-example</code>.</p>
</div>
<div class="paragraph">
<p>The label for the first pod is of the format: <code>couchbase_node: &lt;metadata:name&gt;-&lt;gen node id&gt;</code>.</p>
</div>
<div class="paragraph">
<p>In the sample configuration file referenced in this topic, the label for the first pod would be <code>couchbase_node:cb-example-0000</code>.</p>
</div>
<div class="paragraph">
<p>For more information, see the Kubernetes documentation about <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/">labels</a>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The value of this field cannot be changed after a server has been defined.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="nodeselector"><a class="anchor" href="#nodeselector"></a>nodeSelector</h3>
<div class="paragraph">
<p>This field specifies a key-value map of the constraints on node placement for pods. For a pod to be eligible to run on a node, the node must have each of the indicated key-value pairs as labels (it can have additional labels as well). If this section is not specified, then Kubernetes will place the pod on any available node. For more information, see the Kubernetes documentation about <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#label-selectors">label selectors</a>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The value of this field cannot be changed after a server has been defined.</p>
</div>
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="tolerations"><a class="anchor" href="#tolerations"></a>tolerations</h3>
<div class="paragraph">
<p>This field specifies conditions upon which a node should not be selected when deploying a pod. From the sample configuration file referenced in this topic, you can see that any node with a label <code>app:cbapp</code> should not be allowed to run the pod defined in this node specification. You might do this if you have nodes dedicated for running an application using Couchbase where you don&#8217;t want the database and application to be running on the same node. For more information about tolerations, see the Kubernetes documentation on <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/">taints and tolerations</a>. The tolerations section is optional.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><em>Field rules:</em> The value of this field cannot be changed after a server has been defined.</p>
</div>
</blockquote>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spec-servers-pod-volumemounts"><a class="anchor" href="#spec-servers-pod-volumemounts"></a>spec.servers.pod.volumeMounts</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  servers:
  - pod:
      volumeMounts:
        default: couchbase
        data:  couchbase
        index: couchbase
        analytics:
          - couchbase
          - couchbase</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>VolumeMounts</code> configuration specifies the claims to use for the storage that is used by the Couchbase Server cluster.</p>
</div>
<div class="sect2">
<h3 id="default"><a class="anchor" href="#default"></a>default</h3>
<div class="paragraph">
<p>This field is required when using persistent volumes. The value specifies the name of the <code>volumeClaimTemplate</code> that is used to create a persisted volume for the <code>default</code> path. This is always <code>/opt/couchbase/var/lib/couchbase</code>. The claim must match the name of a <code>volumeClaimTemplate</code> within the spec.</p>
</div>
</div>
<div class="sect2">
<h3 id="data"><a class="anchor" href="#data"></a>data</h3>
<div class="paragraph">
<p>This field is the name of the <code>volumeClaimTemplate</code> that is used to create a persisted volume for the <code>data</code> path. When specified, the data path will be <code>/mnt/data</code>. The claim must match the name of a <code>volumeClaimTemplate</code> within the spec. If this field is not specified, then a volume will not be created and the data directory will be part of the "default" volume claim.</p>
</div>
</div>
<div class="sect2">
<h3 id="index"><a class="anchor" href="#index"></a>index</h3>
<div class="paragraph">
<p>This field is the name of the <code>volumeClaimTemplate</code> that is used to create a persisted volume for the <code>index</code> path. When specified, the index path will be <code>/mnt/index</code>. The claim must match the name of a <code>volumeClaimTemplate</code> within the spec. If this field is not specified, then a volume will not be created and the data directory will be part of the "default" volume claim.</p>
</div>
</div>
<div class="sect2">
<h3 id="analytics"><a class="anchor" href="#analytics"></a>analytics</h3>
<div class="paragraph">
<p>This field is the name of the <code>volumeClaimTemplate</code> that is used to create a persisted volume for the <code>analytics</code> paths. When specified, the analytics paths will be <code>/mnt/analytics-00</code> (where <code>00</code> denotes the first path), with all subsequent paths having incrementing values. The claim must match the name of a <code>volumeClaimTemplate</code> within the spec. If this field is not specified, then a volume will not be created and the data directory will be part of the "default" volume claim.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spec-volumeclaimtemplates"><a class="anchor" href="#spec-volumeclaimtemplates"></a>spec.volumeClaimTemplates</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  volumeClaimTemplates:
    - metadata:
        name: couchbase
      spec:
        storageClassName: "standard"
        resources:
          requests:
            storage: 1Gi</code></pre>
</div>
</div>
<div class="paragraph">
<p>Defines a template of a persistent volume claim. At runtime, the Operator will create a persistent volume from this template for each pod. Claims can request volumes from various types of storage systems as identified by the storage class name.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spec-volumeclaimtemplates-metadata"><a class="anchor" href="#spec-volumeclaimtemplates-metadata"></a>spec.volumeClaimTemplates.metadata</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="name-3"><a class="anchor" href="#name-3"></a>name</h3>
<div class="paragraph">
<p>The metadata name identifies the claim template. This name is used by the <code>volumeMounts</code> to reference which template to fulfill the mount request.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spec-volumeclaimtemplates-spec"><a class="anchor" href="#spec-volumeclaimtemplates-spec"></a>spec.volumeClaimTemplates.spec</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="storageclassname"><a class="anchor" href="#storageclassname"></a>storageClassName</h3>
<div class="paragraph">
<p>The <code>storageClassName</code> is required by the claim. A <code>storageClassName</code> provides a way for administrators to describe the classes of storage they offer. If no <code>storageClassName</code> is specified, then the default storage class is used.</p>
</div>
<div class="paragraph">
<p>Refer to the Kubernetes documentation for more information about <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/">storage classes</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="resources-2"><a class="anchor" href="#resources-2"></a>resources</h3>
<div class="paragraph">
<p>The minimum resources the volume should have. Only the storage requests are valid in this context.</p>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/logo.svg" alt="Couchbase">
          </a>
        </div>
        <div class="contact">
          <p class="address">3250 Olcott Street
Santa Clara, CA 95054
United States</p>
          <a href="https://www.couchbase.com/contact" class="btn white-btn">Contact Us</a>
          <a class="tel" href="tel:1-650-417-7500">1-650-417-7500</a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Company</span></li>
          <li><a href="https://www.couchbase.com/about">About</a></li>
          <li><a href="https://www.couchbase.com/leadership">Leadership</a></li>
          <li><a href="https://www.couchbase.com/news-and-press-releases">News &amp; Press</a></li>
          <li><a href="https://www.couchbase.com/careers">Careers</a></li>
          <li><a href="https://www.couchbase.com/resources/events">Events</a></li>
          <li><a href="https://www.couchbase.com/contact">Contact Us</a></li>
          <li><a href="https://www.couchbase.com/request-pricing">Pricing</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Support</span></li>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://www.couchbase.com/services">Professional Services</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support Login</a></li>
          <li><a href="https://learn.couchbase.com/store" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Quicklinks</span></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Online Training</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
          <li><a href="https://www.couchbase.com/nosql-resources/why-nosql">Why NoSQL</a></li>
          <li><a href="https://www.couchbase.com/resources/security">Security</a></li>
          <li><a href="https://www.couchbase.com/resources/gdpr">GDPR</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://plus.google.com/+CouchbaseServer" class="icon">
              <svg width="50px" height="50px" viewBox="36.72 225.573 542.326 343.67"><path d="m209.02 363.05v68.732h93.212c-15.065 44.252-37.662 68.732-93.212 68.732-56.492 0-100.74-46.135-100.74-102.63s44.252-102.63 100.74-102.63c30.129 0 48.96 10.357 66.849 25.422 14.123-14.123 13.182-16.006 48.96-49.902-31.071-28.246-71.557-45.194-115.81-45.194-95.096-0.94-172.3 76.266-172.3 171.36s77.206 172.3 172.3 172.3c142.17 0 177.01-124.28 165.71-206.2-33.896-1e-3 -165.71-1e-3 -165.71-1e-3zm310.71 3.766v-59.317h-42.369v59.317h-61.2v42.369h61.2v61.2h42.369v-61.2h59.317v-42.369h-59.317z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2018 COUCHBASE All rights reserved.</span>
      <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
      <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
      <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
      <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
