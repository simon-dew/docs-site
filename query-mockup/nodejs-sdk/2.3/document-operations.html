<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>CRUD Document Operations using the Node.js SDK with Couchbase Server | Couchbase Docs (Staging)</title>
    <link rel="canonical" href="https://simon-dew.github.io/docs-site/query-mockup/nodejs-sdk/2.6/document-operations.html">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="schema.dcterms" href="https://purl.org/dc/terms/">
    <meta name="dcterms.subject" content="nodejs-sdk">
    <meta name="dcterms.identifier" content="2.3">
    <meta name="generator" content="Antora 1.1.1">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" id="topbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://www.couchbase.com"><img src="../../_/img/logo.svg" alt="Couchbase"></a>
        <button class="navbar-burger" data-target="topbar-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="topbar-menu" class="navbar-menu">
        <div class="navbar-start">
          <div class="navbar-item has-dropdown">
            <a class="navbar-link" href="https://simon-dew.github.io/docs-site/query-mockup">Docs</a>
            <div class="navbar-dropdown explore">
              <div class="title">Couchbase Documentation Overview</div>
              <div class="cols">
                <ul>
                  <li class="heading"><a href="../../server/6.0/introduction/intro.html">Server</a></li>
                  <li><a href="../../server/6.0/n1ql/n1ql-language-reference/index.html">N1QL</a></li>
                  <li><a href="../../server/6.0/fts/full-text-intro.html">Full Text Search</a></li>
                  <li><a href="../../server/6.0/analytics/introduction.html">Analytics</a></li>
                  <li><a href="../../server/6.0/eventing/eventing-overview.html">Eventing</a></li>
                  <li><a href="#">Autonomous Operator</a></li>
                </ul>
                <ul>
                  <li class="heading">Mobile</li>
                  <li><a href="../../couchbase-lite/2.5/index.html">Lite</a></li>
                  <li><a href="../../sync-gateway/2.5/index.html">Sync Gateway</a></li>
                </ul>
                <ul class="two-cols">
                  <li class="heading"><a href="../../server/6.0/sdk/overview.html">SDKs</a></li>
                  <li><a href="../../c-sdk/2.10/start-using-sdk.html">C</a></li>
                  <li><a href="../../dotnet-sdk/2.7/start-using-sdk.html">.NET</a></li>
                  <li><a href="../../go-sdk/1.5/start-using-sdk.html">Go</a></li>
                  <li><a href="../../java-sdk/2.7/start-using-sdk.html">Java</a></li>
                  <li><a href="../../nodejs-sdk/2.6/start-using-sdk.html">Node.js</a></li>
                  <li><a href="../../php-sdk/2.6/start-using-sdk.html">PHP</a></li>
                  <li><a href="../../python-sdk/2.5/start-using-sdk.html">Python</a></li>
                </ul>
                <ul>
                  <li class="heading"><a href="../../server/6.0/connectors/intro.html">Connectors</a></li>
                  <li><a href="../../elasticsearch-connector/4.0/index.html">Elasticsearch</a></li>
                  <li><a href="../../server/6.0/connectors/hadoop-1.2/hadoop.html">Hadoop</a></li>
                  <li><a href="../../kafka-connector/3.4/index.html">Kafka</a></li>
                  <li><a href="../../spark-connector/2.2/index.html">Spark</a></li>
                  <li><a href="#">Talend</a></li>
                  <li><a href="../../server/6.0/connectors/odbc-jdbc-drivers.html">ODBC/JDBC</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="navbar-item has-dropdown">
            <a class="navbar-link component" href="start-using-sdk.html"><span class="title">Node.js SDK</span> <span class="version">2.3</span></a>
            <div class="navbar-dropdown versions">
              <div class="cols">
                <ul>
                  <li><a class="navbar-item" href="../2.6/document-operations.html">Node.js SDK 2.6</a></li>
                  <li><a class="navbar-item" href="../2.5/document-operations.html">Node.js SDK 2.5</a></li>
                  <li><a class="navbar-item" href="../2.4/document-operations.html">Node.js SDK 2.4</a></li>
                  <li><a class="navbar-item" href="../2.2/document-operations.html">Node.js SDK 2.2</a></li>
                  <li><a class="navbar-item" href="../2.1/introduction.html">Node.js SDK 2.1</a></li>
                </ul>
                <ul class="related">
                  <li><a class="navbar-item" href="../../c-sdk/2.10/document-operations.html">C SDK</a></li>
                  <li><a class="navbar-item" href="../../dotnet-sdk/2.7/document-operations.html">.NET SDK</a></li>
                  <li><a class="navbar-item" href="../../go-sdk/1.5/document-operations.html">Go SDK</a></li>
                  <li><a class="navbar-item" href="../../java-sdk/2.7/document-operations.html">Java SDK</a></li>
                  <li><a class="navbar-item" href="../../php-sdk/2.6/document-operations.html">PHP SDK</a></li>
                  <li><a class="navbar-item" href="../../python-sdk/2.5/document-operations.html">Python SDK</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <a class="btn red-btn" href="https://www.couchbase.com/downloads">Downloads</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body container">
<nav class="nav">
<div class="nav-menu">
<ul class="nav-list">
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Hello World!</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="start-using-sdk.html">Start Using the SDK</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="sample-application.html">Sample Application</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="sample-app-backend.html">Sample App Backend</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="webui-cli-access.html">Browser and CLI Access</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-path is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Working with Data</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="core-operations.html">Core Operations</a>
    </span>
  </li>
  <li class="nav-item is-current-page is-active" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="document-operations.html">Document Operations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="subdocument-operations.html">Sub-Document Operations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="datastructures.html">Data Structures</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="n1ql-query.html">Querying with N1QL</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="n1ql-queries-with-sdk.html">N1QL from the SDK</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="full-text-search-overview.html">Full Text Search</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="full-text-searching-with-sdk.html">Searching from the SDK</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="view-queries-with-sdk.html">MapReduce Views</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="async-programming.html">Asynchronous Programming</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="batching-operations.html">Batching Operations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="durability.html">Durability</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="concurrent-mutations-cluster.html">Concurrent Document Mutations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="nonjson.html">Non-JSON Documents</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Deployment Environments</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="managing-connections.html">Managing Connections</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="managing-clusters.html">Managing Clusters</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="compatibility-versions-features.html">Compatibility</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Settings, Error Handling &amp; Diagnostics</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="client-settings.html">Client Settings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="handling-error-conditions.html">Handling Errors</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="failure-considerations.html">Failure Considerations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="collecting-information-and-logging.html">Collecting Information</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Project Docs</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="relnotes-nodejs-sdk.html#version-2-3-7-22-august-2017">Release Notes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="compatibility-versions-features.html">Compatibility</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="sdk-licenses.html">Licenses</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="get-involved.html">Get involved</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="https://docs.couchbase.com/home/contribute/index.html">Improve the Docs</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
</div>
</nav>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
<main class="article" data-ceiling="topbar">
  <div class="article-banner">
    <p>A newer version of this documentation is available.</p>
    <a class="btn" href="../2.6/document-operations.html">View Latest</a>
  </div>
  <div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="start-using-sdk.html">Node.js SDK</a></li>
    <li class="crumb">Working with Data</li>
    <li class="crumb"><a href="document-operations.html">Document Operations</a></li>
  </ul>
</nav>
<div class="tools" role="navigation">
  <ul>
    <li class="tool edit"><a href="https://github.com/couchbase/docs-sdk-nodejs/edit/release/2.3/modules/ROOT/pages/document-operations.adoc" title="Edit Page" target="_blank" rel="noopener">Edit</a></li>
  </ul>
</div>
  </div>
<article class="doc">
<h1 class="page">CRUD Document Operations using the Node.js SDK with Couchbase Server</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>You can access documents in Couchbase using the <code class="api">Bucket</code> class (constructed via <code>cluster.openBucket()</code>).
You can retrieve documents using the <code class="api">get()</code> and <code class="api">lookupIn</code> methods, and mutate documents using the <code class="api">upsert()</code>, <code class="api">insert()</code>, <code class="api">replace()</code>, and <code class="api">mutateIn()</code> methods.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-input-types"><a class="anchor" href="#document-input-types"></a>Document Input Types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Documents can be anything convertible to JSON (<code>JSON.stringify</code>).
Simply pass the object or array to the mutation operation, and the SDK will convert it to JSON and store it on the server.
Do not pass already-serialized JSON to the SDK, as the SDK will serialize it again.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="callbacks-for-operations"><a class="anchor" href="#callbacks-for-operations"></a>Callbacks for operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Due to the non-blocking nature of the node.js SDK and node.js in general, the results of all operations are signalled by callbacks.
Callbacks are specified as the last parameter to any operation.
The callback signature is generally</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">function(err, result) {
    if (err) {
        console.error("Got error!: %j", err);
    } else {
        console.log("Got result: %j", result);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="additional-options"><a class="anchor" href="#additional-options"></a>Additional Options</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Additional options may be passed to some methods using an object.</p>
</div>
<div class="paragraph">
<p><em>Mutation</em> operations (<code class="api">upsert</code>, <code class="api">insert</code>, <code class="api">replace</code>, <code class="api">mutate_in</code>) operations also accept a <a href="core-operations.html#expiry" class="page">TTL (expiry)</a> value (<code class="param">expiry</code>) which will instruct the server to delete the document after a given amount of time.
This option is useful for transient data (such as sessions).
By default documents do not expire.
See <a href="core-operations.html#expiry" class="page">Expiration Overview</a> for more information on expiration.</p>
</div>
<div class="paragraph">
<p>Some mutation operations can also accept a <a href="concurrent-mutations-cluster.html" class="page">CAS</a> (<code class="param">cas</code>) value to protect against concurrent updates to the same document.
See <a href="concurrent-mutations-cluster.html" class="page">CAS</a> for a description on how to use CAS values in your application.
Note that the CAS value is represented internally as <code>Buffer</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-and-updating-full-documents"><a class="anchor" href="#creating-and-updating-full-documents"></a>Creating and updating full documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Documents may be created and updated using the <code class="api">Bucket.upsert()</code>, <code class="api">Bucket.insert()</code>, and <code class="api">Bucket.replace()</code> family of methods.
Read more about the difference between these methods at <a href="core-operations.html#crud-overview" class="page">Primitive Key-Value Operations</a> in the Couchbase developer guide.</p>
</div>
<div class="paragraph">
<p>These methods accept two mandatory arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="param">key</code>: The ID of the document to modify.
This should be a string.</p>
</li>
<li>
<p><code class="param">value</code>: The desired new value of the document.
This may be anything that can be serialized as JSON.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional options can be specified in the options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="param">cas</code>: The CAS value for the document.
If the CAS on the server does not match the CAS supplied to the method, the operation will fail with a <code class="api">couchbase.exceptions.KeyExistsError</code> error.
See <a href="concurrent-mutations-cluster.html" class="page">Concurrent Document Mutations</a> for more information on the usage of CAS values.</p>
</li>
<li>
<p><code class="param">expiry</code>: Specify the expiry time for the document.
If specified, the document will expire and no longer exist after the given number of seconds.
See <a href="core-operations.html#expiry" class="page">Expiration Overview</a> for more information.</p>
</li>
<li>
<p><code class="param">persist_to</code>, <code class="param">replicate_to</code>: Specify <a href="durability.html" class="page">durability requirements</a> for the operations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the operation is complete the callback will be invoked, and if successful, the <code>result</code> (the second callback argument) will contain the new <a href="concurrent-mutations-cluster.html" class="page">CAS</a> value of the document.
If the document was not mutated successfully, the callback&#8217;s first argument (<code>err</code>) will contain appropriate error information.
See <a href="handling-error-conditions.html" class="page">Handling Exceptions and Other Errors with the Node.js SDK in Couchbase</a> for more information on error types and how to handle them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">bucket.insert('document_name', {'some': 'value'}, function(err, result) {
    if (!err) {
        console.log("stored document successfully. CAS is %j", result.cas);
    } else {
        console.error("Couldn't store document: %j", err);
    }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output on success:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>stored document successfully. CAS is "216000820675072"</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Couldn't store document: {"message":"The key already exists in the server. If you have supplied a CAS then the key exists with a CAS value different than specified","code":12}</pre>
</div>
</div>
<div class="paragraph">
<p>If the document being inserted already exists, the error will be set and its <code class="var">code</code> field will be set to <code class="var">couchbase.errors.keyAlreadyExists</code>.
If your application simply wants to set the value ignoring whether it exists or not, use the <code class="api">upsert()</code> method.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="retrieving-full-documents"><a class="anchor" href="#retrieving-full-documents"></a>Retrieving full documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Documents may be retrieved using the <code class="api">Bucket.get()</code> method.
The <code class="api">get()</code> method requires the document ID to retrieve, and the callback to invoke with the result of the operation.</p>
</div>
<div class="paragraph">
<p>When the operation is complete the callback is invoked.
If successful, you may access actual document may be access by using <code>result.value</code> and the CAS using <code>result.cas</code>.</p>
</div>
<div class="paragraph">
<p>The document will be a native javascript type resulting from the parsing of the stored server value.</p>
</div>
<div class="paragraph">
<p>Upon failure, the error (first callback argument) will be populate with an appropriate <code>code</code> and <code>message</code>.
If the document does not exist, the <code>code</code> will be <code class="var">couchbase.errors.keyNotFound</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">bucket.get('document_id', function(err, result) {
    if (err) {
        if (err.code == couchbase.errors.keyNotFound) {
            console.log('Key does not exist');
        } else {
            console.log('Some other error occurred: %j', err);
        }
    } else {
        console.log('Retrieved document with value: %j', result.value);
        console.log('CAS is %j', result.cas);
    }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sample output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Retrieved document with value: ["Hello","World"]
CAS is "166079006573056"</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="removing-full-documents"><a class="anchor" href="#removing-full-documents"></a>Removing full documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Documents may be removed using the <code class="api">Bucket.remove()</code> method.
This method takes the document ID as a mandatory positional:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="param">key</code>: The ID of the document to remove</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some additional options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="param">cas</code>: Only remove the document if the <a href="concurrent-mutations-cluster.html" class="page">CAS</a> has not changed.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="modifying-expiraton"><a class="anchor" href="#modifying-expiraton"></a>Modifying expiraton</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="core-operations.html#expiry" class="page">Document expiration</a> can be performed using the <code class="api">Bucket.touch()</code> and <code class="api">Bucket.getAndTouch</code> methods.
You can also set the <code class="param">expiry</code> parameter for methods which support it:</p>
</div>
<div class="listingblock">
<div class="title">expiry with upsert</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">bucket.upsert('deleteMe', {'delete': 'me'}, {'expiry': 1}, function(err){
    bucket.get('deleteMe', function(err, result) {
        console.log('Have item: %j', result.value);
        console.log('Will attempt get later on..');
        setTimeout(function(){
            bucket.get('deleteMe', function(err, result){
                console.log('Got error: %s', err.message);
            })
        }, 3500);
    })
});</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Have item: {"delete":"me"}
Will attempt get later on..
Got error: The key does not exist on the server</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Using getAndTouch</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">bucket.getAndTouch('some_document', 2, function(err, result) {
    console.log('Got value: %j', result.value);
    console.log('Will try again..');
    setTimeout(function(err, result){
        bucket.get('some_document', function(err, result) {
            console.error('Got error: %s', err.message);
        });
    }, 3000);
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="atomic-document-modifications"><a class="anchor" href="#atomic-document-modifications"></a>Atomic document modifications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Additional atomic document modifications can be performing using the node.js SDK.
You can modify a <a href="core-operations.html#devguide_kvcore_append_prepend_generic" class="page">counter document</a> using the <code class="api">Bucket.counter()</code> method.
You can also use the <code class="api">Bucket.append</code> and <code class="api">Bucket.prepend</code> methods to perform raw byte concatenation</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="batching-operations"><a class="anchor" href="#batching-operations"></a>Batching Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All operations performed in the node.js SDK are inherently batched between event loop iterations.
In simple terms, this means that there is no added network performance for using any form of multi operation.</p>
</div>
<div class="paragraph">
<p>As a convenience, the node.js SDK provides an <code class="api">Bucket.getMulti</code> which accepts multiple keys and returns their results.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="operating-with-sub-documents"><a class="anchor" href="#operating-with-sub-documents"></a>Operating with sub-documents</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Sub-Document API is available starting Couchbase Server version 4.5.
See <a href="subdocument-operations.html" class="page">Sub-Document Operations</a> for an overview.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sub-document operations save network bandwidth by allowing you to specify <em>paths</em> of a document to be retrieved or updated.
The document is parsed on the server and only the relevant sections (indicated by <em>paths</em>) are transferred between client and server.
You can execute <a href="subdocument-operations.html" class="page">sub-document</a> operations in the node.js SDK using the <code class="api">Bucket.mutateIn</code>, and <code class="api">Bucket.lookupIn</code> methods.</p>
</div>
<div class="paragraph">
<p>Each of these methods accepts a <code class="param">key</code> as its mandatory first argument and returns a builder object which can be used to add one or more <em>command specifications</em> specifying a specifying an operation and a document field operand.
To submit the operation, invoke the <code class="api">execute()</code> method on the builder, passing it the callback to be invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">bucket.lookupIn('some_document').
    get('path.to.get').
    exists('check.path.exists').
    execute(function(err, fragment) {
    // ...
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The callback function is invoked with an <code>error</code> and a <code>fragment</code>.
The fragment is a <code class="api">DocumentFragment</code> object containing the fragments of the document (corresponding to each path).
In contrast with a normal callback which returns a single error and result, each operation in the builder has its own result and status.
You can use <code>fragment.contentByIndex</code> or <code>fragment.content(path)</code> or <code>fragment.contentByIndex(index)</code> to retrieve the result for an individual path/command.
If a path has an error, the SDK will throw an exception.</p>
</div>
<div class="paragraph">
<p>Unlike other operations as well, both the <code>error</code> and <code>fragment</code> can be set.
If the <code>error</code> is set, and <code>error.code</code> is <code class="var">couchbase.errors.checkResults</code> then it means that at least one command has failed.
If the top-level error code is something else, it means that the document itself could not be accessed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">bucket.lookupIn('some_document').
    get('path.to.get').
    exists('check.path.exists').
    execute(function(err, result) {
    if (!err || err.code == couchbase.errors.checkResults) {
        for (var i = 0; i &lt; 2; i++) {
            try {
                console.log('Result for path index %d: %j', i, result.contentByIndex(i));
            } catch (e) {
                console.error('Error for path index %d: %s', i, e.message);
            }
        }
    } else {
        console.error("Couldn't access document: %s", err.message);
    }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also mutate documents in a similar manner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">bucket.mutateIn('some_document').
    upsert('path.to.upsert', 'value', true).
    remove('path.to.del').
    execute(function(err, frag) {
    if (!err || err.code == couchbase.errors.checkResults) {
        for (var i = 0; i &lt; 2; i++) {
            try {
                frag.contentByIndex(i);
            } catch (e) {
                console.error('Error for index %d: %s', i, e.message);
            }
        }
    } else {
        console.error('Top-level document error: %j', err)
    }
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="formats-and-non-json-documents"><a class="anchor" href="#formats-and-non-json-documents"></a>Formats and Non-JSON Documents</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See <a href="nonjson.html" class="page">Non-JSON Documents</a> for a general overview of using non-JSON documents with Couchbase
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All JavaScript types which can be represented as JSON may be passed unmodified to a storage function, and be received via the <code class="api">get</code> method without any additional modifications.</p>
</div>
<div class="paragraph">
<p>You can implement a custom transcoder if you would like to serialize documents to/from a format other than JSON, or if you would like to interact with other SDKs which use non-JSON serialization formats.
See <code class="api">Bucket.setTranscoder()</code>.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/logo.svg" alt="Couchbase">
          </a>
        </div>
        <div class="contact">
          <p class="address">3250 Olcott Street
Santa Clara, CA 95054
United States</p>
          <a href="https://www.couchbase.com/contact" class="btn white-btn">Contact Us</a>
          <a class="tel" href="tel:1-650-417-7500">1-650-417-7500</a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Company</span></li>
          <li><a href="https://www.couchbase.com/about">About</a></li>
          <li><a href="https://www.couchbase.com/leadership">Leadership</a></li>
          <li><a href="https://www.couchbase.com/news-and-press-releases">News &amp; Press</a></li>
          <li><a href="https://www.couchbase.com/careers">Careers</a></li>
          <li><a href="https://www.couchbase.com/resources/events">Events</a></li>
          <li><a href="https://www.couchbase.com/contact">Contact Us</a></li>
          <li><a href="https://www.couchbase.com/request-pricing">Pricing</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Support</span></li>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://www.couchbase.com/services">Professional Services</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support Login</a></li>
          <li><a href="https://learn.couchbase.com/store" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Quicklinks</span></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Online Training</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
          <li><a href="https://www.couchbase.com/nosql-resources/why-nosql">Why NoSQL</a></li>
          <li><a href="https://www.couchbase.com/resources/security">Security</a></li>
          <li><a href="https://www.couchbase.com/resources/gdpr">GDPR</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://plus.google.com/+CouchbaseServer" class="icon">
              <svg width="50px" height="50px" viewBox="36.72 225.573 542.326 343.67"><path d="m209.02 363.05v68.732h93.212c-15.065 44.252-37.662 68.732-93.212 68.732-56.492 0-100.74-46.135-100.74-102.63s44.252-102.63 100.74-102.63c30.129 0 48.96 10.357 66.849 25.422 14.123-14.123 13.182-16.006 48.96-49.902-31.071-28.246-71.557-45.194-115.81-45.194-95.096-0.94-172.3 76.266-172.3 171.36s77.206 172.3 172.3 172.3c142.17 0 177.01-124.28 165.71-206.2-33.896-1e-3 -165.71-1e-3 -165.71-1e-3zm310.71 3.766v-59.317h-42.369v59.317h-61.2v42.369h61.2v61.2h42.369v-61.2h59.317v-42.369h-59.317z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2018 COUCHBASE All rights reserved.</span>
      <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
      <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
      <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
      <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
