<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Build an Ionic Plugin with Couchbase Lite on Android | Couchbase Docs (Staging)</title>
    <link rel="canonical" href="https://simon-dew.github.io/docs-site/query-mockup/tutorials/hotel-lister/android.html">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="schema.dcterms" href="https://purl.org/dc/terms/">
    <meta name="dcterms.subject" content="tutorials">
    <meta name="dcterms.identifier" content="master">
    <meta name="generator" content="Antora 1.1.1">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" id="topbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://www.couchbase.com"><img src="../../_/img/logo.svg" alt="Couchbase"></a>
        <button class="navbar-burger" data-target="topbar-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="topbar-menu" class="navbar-menu">
        <div class="navbar-start">
          <div class="navbar-item has-dropdown">
            <a class="navbar-link" href="https://simon-dew.github.io/docs-site/query-mockup">Docs</a>
            <div class="navbar-dropdown explore">
              <div class="title">Couchbase Documentation Overview</div>
              <div class="cols">
                <ul>
                  <li class="heading"><a href="../../server/6.0/introduction/intro.html">Server</a></li>
                  <li><a href="../../server/6.0/n1ql/n1ql-language-reference/index.html">N1QL</a></li>
                  <li><a href="../../server/6.0/fts/full-text-intro.html">Full Text Search</a></li>
                  <li><a href="../../server/6.0/analytics/introduction.html">Analytics</a></li>
                  <li><a href="../../server/6.0/eventing/eventing-overview.html">Eventing</a></li>
                  <li><a href="../../operator/1.2/overview.html">Autonomous Operator</a></li>
                </ul>
                <ul>
                  <li class="heading">Mobile</li>
                  <li><a href="../../couchbase-lite/2.5/index.html">Lite</a></li>
                  <li><a href="../../sync-gateway/2.5/index.html">Sync Gateway</a></li>
                </ul>
                <ul class="two-cols">
                  <li class="heading"><a href="../../server/6.0/sdk/overview.html">SDKs</a></li>
                  <li><a href="../../c-sdk/2.10/start-using-sdk.html">C</a></li>
                  <li><a href="../../dotnet-sdk/2.7/start-using-sdk.html">.NET</a></li>
                  <li><a href="../../go-sdk/1.5/start-using-sdk.html">Go</a></li>
                  <li><a href="../../java-sdk/2.7/start-using-sdk.html">Java</a></li>
                  <li><a href="../../nodejs-sdk/2.6/start-using-sdk.html">Node.js</a></li>
                  <li><a href="../../php-sdk/2.6/start-using-sdk.html">PHP</a></li>
                  <li><a href="../../python-sdk/2.5/start-using-sdk.html">Python</a></li>
                </ul>
                <ul>
                  <li class="heading"><a href="../../server/6.0/connectors/intro.html">Connectors</a></li>
                  <li><a href="../../elasticsearch-connector/4.0/index.html">Elasticsearch</a></li>
                  <li><a href="../../server/6.0/connectors/hadoop-1.2/hadoop.html">Hadoop</a></li>
                  <li><a href="../../kafka-connector/3.4/index.html">Kafka</a></li>
                  <li><a href="../../spark-connector/2.2/index.html">Spark</a></li>
                  <li><a href="../../talend-connector/index.html">Talend</a></li>
                  <li><a href="../../server/6.0/connectors/odbc-jdbc-drivers.html">ODBC/JDBC</a></li>
                </ul>
              </div>
            </div>
          </div>
          <a class="navbar-item component" href="../index.html"><span class="title">Session Storage with Couchbase</span></a>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <a class="btn red-btn" href="https://www.couchbase.com/downloads">Downloads</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body container">
<nav class="nav">
<div class="nav-menu">
<ul class="nav-list">
  <li class="nav-item is-active" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/introduction.html">Introduction</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../mobile-travel-sample/installation/index.html">Backend Installation</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/installation/manual.html">Manual</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/installation/docker.html">Docker (Local)</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/installation/cloud.html">Cloud (RightScale)</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Swift</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/swift/installation/travel-mobile-app.html">Installation</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/java/design/data-modeling.html">Data Modeling</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/swift/develop/mvp-architecture.html">MVP Architecture</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/swift/develop/the-basics.html">The Basics</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/swift/develop/security.html">Security</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/swift/develop/sync.html">Sync</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/swift/develop/pre-built-database.html">Pre-built database</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/swift/develop/query.html">Query</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/swift/develop/full-text-search.html">Full Text Search</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Android</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/java/installation/travel-mobile-app.html">Installation</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/java/design/data-modeling.html">Data Modeling</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/java/develop/mvp-architecture.html">MVP Architecture</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/java/develop/the-basics.html">The Basics</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/java/develop/security.html">Security</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/java/develop/sync.html">Sync</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/java/develop/pre-built-database.html">Pre-built database</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/java/develop/query.html">Query</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../mobile-travel-sample/java/develop/full-text-search.html">Full Text Search</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
</div>
</nav>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
<main class="article" data-ceiling="topbar">
  <div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../index.html">Session Storage with Couchbase</a></li>
    <li class="crumb"><a href="android.html">Build an Ionic Plugin with Couchbase Lite on Android</a></li>
  </ul>
</nav>
<div class="tools" role="navigation">
  <ul>
    <li class="tool edit"><a href="https://github.com/couchbaselabs/hotel-lister-cordova/edit/tutorials/modules/hotel-lister/pages/android.adoc" title="Edit Page" target="_blank" rel="noopener">Edit</a></li>
  </ul>
</div>
  </div>
<article class="doc">
<h1 class="page">Build an Ionic Plugin with Couchbase Lite on Android</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this tutorial, you will learn how to use Couchbase Lite in a Cordova application.</p>
</div>
<div class="paragraph">
<p>The sample project is a Cordova web application that allows users to query for and display a list of hotels stored in a Couchbase Lite database.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ionic-listing-hotels.png" alt="ionic listing hotels" width="250">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture"><a class="anchor" href="#architecture"></a>Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The user Interface is a web app written in Javascript using Ionic and is rendered within a WebView. The business logic and data model is written in native Java.
The data model uses Couchbase Lite as the embedded data persistence layer.
The <a href="https://cordova.apache.org/docs/en/latest/guide/hybrid/plugins/index.html">Cordova Plugin API</a> acts as the bridging layer between the JavaScript and the native Java worlds . The plugin exposes a Javascript API to the web app.</p>
</div>
<div class="paragraph">
<p>This architecture allows you to write the User Interface code once for both iOS and Android apps while leveraging Couchbase Lite&#8217;s native Android framework for data management.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/arch-android.jpg" alt="arch android" width="400">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-model"><a class="anchor" href="#data-model"></a>Data Model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The data model for the app is very straightforward.
There is one type of document:
the <em>"hotel"</em> document which contains the details of each hotel.
Those documents have a <code>"type": "hotel"</code> property.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/data-model.png" alt="data model" width="400">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pre-requisites"><a class="anchor" href="#pre-requisites"></a>Pre-requisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This tutorial requires the following components and versions to run successfully.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Android Studio 3.0 or above</p>
</li>
<li>
<p>Android SDK 19 or above</p>
</li>
<li>
<p>Couchbase Lite 2.1.0 and above</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The tutorial also assumes that the reader has a basic understanding of developing apps with Cordova and Java.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started"><a class="anchor" href="#getting-started"></a>Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>The User Interface has already been implemented in the starter project.
You will add the code to persist and query data.</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the Ionic and Cordova CLIs which are tools that are required for building and managing Ionic and Cordova based apps.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">npm install -g ionic cordova</code></pre>
</div>
</div>
</li>
<li>
<p>Download the <a href="_attachments/starter-project.zip">starter project</a>.</p>
</li>
<li>
<p>Unzip <strong>starter-project.zip</strong>.</p>
</li>
<li>
<p>Open the <strong>starter-project/</strong> directory in the JavaScript editor of your choice (for example, <a href="https://code.visualstudio.com/">Visual Studio Code</a> or <a href="https://www.jetbrains.com/webstorm/">WebStorm</a>).</p>
</li>
<li>
<p>The User Interface code is located in <strong>HotelLister/src/pages/home/</strong>.</p>
</li>
<li>
<p>Run the following commands in your Terminal.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd HotelLister
npm install</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>npm install</code> command installs dependencies.</p>
</div>
</li>
<li>
<p>To deploy the app to an Android emulator, run the following.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ionic cordova emulate android</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you get the following error message "Could not find an installed version of Gradle either in Android Studio, or on your system to install the gradle wrapper." you can install Gradle using Homebrew with <code>brew install gradle</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You should see an empty list view as shown below.</p>
<div class="imageblock">
<div class="content">
<img src="_images/ionic-empty-list.png" alt="ionic empty list" width="250">
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the next section, you will setup the Cordova plugin which is the first step for establishing communication between native code and JavaScript.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cordova-plugin-setup"><a class="anchor" href="#cordova-plugin-setup"></a>Cordova Plugin Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With <a href="https://cordova.apache.org/docs/en/latest/guide/hybrid/plugins/index.html">Cordova Plugins</a>, you can write native code and have access to it from JavaScript.
Plugins provide access to device and platform functionality that is ordinarily unavailable to web-based apps.</p>
</div>
<div class="paragraph">
<p>In this section you will create a new plugin called <strong>cordova-plugin-hotel-lister</strong> to implement data persistence using Couchbase Lite&#8217;s Java API.</p>
</div>
<div class="paragraph">
<p>The plugin code will be added to the <strong>cordova-plugin-hotel-lister</strong> folder which resides alongside the <strong>HotelLister</strong> folder.</p>
</div>
<div class="paragraph">
<p>The starter project contains a file at <strong>cordova-plugin-hotel-lister/src/android/Utils.java</strong> that will be used in a later section to unzip the pre-built database.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new file at <strong>cordova-plugin-hotel-lister/plugin.xml</strong> with the following.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;plugin xmlns="http://apache.org/cordova/ns/plugins/1.0"
        xmlns:android="http://schemas.android.com/apk/res/android"
        id="cordova-plugin-hotel-lister" version="0.0.1"&gt;
  &lt;name&gt;cordova-plugin-hotel-lister&lt;/name&gt;
  &lt;description&gt;An Cordova plugin for the Hotel Lister application to implement data persistence using Couchbase Lite.&lt;/description&gt;
  &lt;license&gt;Couchbase CE / https://www.couchbase.com/binaries/content/assets/website/legal/ce-license-agreement.pdf&lt;/license&gt;

  &lt;engines&gt;
    &lt;engine name="cordova" version="&gt;=3.0.0"/&gt;
  &lt;/engines&gt;

  &lt;js-module src="www/hotel-lister.js" name="HotelLister"&gt;
    &lt;clobbers target="window.plugins.HotelLister" /&gt;
  &lt;/js-module&gt;

  &lt;platform name="android"&gt;
    &lt;config-file target="res/xml/config.xml" parent="/*"&gt;
      &lt;feature name="HotelLister"&gt;
        &lt;param name="android-package" value="com.hotellister.HotelLister"/&gt;
      &lt;/feature&gt;
    &lt;/config-file&gt;

    &lt;source-file
            src="src/android/HotelLister.java"
            target-dir="src/com/hotellister/" /&gt;
    &lt;source-file
            src="src/android/Utils.java"
            target-dir="src/com/hotellister/" /&gt;
  &lt;/platform&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>id="cordova-plugin-hotel-lister"</code> attribute is the plugin name which will be used later to import it in the Ionic project.</p>
</li>
<li>
<p>The <code>&lt;js-module&gt;&lt;/js-module&gt;</code> XML tag declares the location of the file that will declare the JavaScript interface.</p>
</li>
<li>
<p>The <code>&lt;platform name="android"&gt;&lt;/platform&gt;</code> XML tag declares the location of the Java files to hold the native code.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Create a new file at <strong>cordova-plugin-hotel-lister/package.json</strong> with the following.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
  "name": "cordova-plugin-hotel-lister",
  "version": "0.0.1",
  "description": "A Cordova plugin for the Hotel Lister app.",
  "cordova": {
    "id": "cordova-plugin-hotel-lister",
    "platforms": [
      "android",
      "ios"
    ]
  },
  "engines": [
    {
      "name": "cordova",
      "version": "&gt;=3.0.0"
    }
  ],
  "author": "Couchbase &lt;mobile@couchbase.com&gt;",
  "license": "Couchbase CE / https://www.couchbase.com/binaries/content/assets/website/legal/ce-license-agreement.pdf"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This file describes the plugin.</p>
</div>
</li>
<li>
<p>Create a new file at <strong>cordova-plugin-hotel-lister/www/hotel-lister.js</strong>.
This file defines the JS API with which a Cordova/Ionic web app may interact with this plugin.
Generally, this means that the plugin binds to the window element and by doing so, grants access to its parent project through simple JavaScript references.
Add the following to your <strong>hotel-lister.js</strong> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">var exec = require('cordova/exec');

var hotelLister = {
  /* code will be added here later */
};

module.exports = hotelLister;</code></pre>
</div>
</div>
</li>
<li>
<p>Create a new file at <strong>cordova-plugin-hotel-lister/src/android/HotelLister.java</strong> with the following. This file provides the native Java implementation corresponding to the APIs defined in <strong>hotel-lister.js</strong>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.hotellister;

import android.content.Context;

import org.apache.cordova.CallbackContext;
import org.apache.cordova.CordovaInterface;
import org.apache.cordova.CordovaPlugin;
import org.apache.cordova.CordovaWebView;
import org.json.JSONArray;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

public class HotelLister extends CordovaPlugin {

    @Override
    public void initialize(CordovaInterface cordova, CordovaWebView webView) {
        super.initialize(cordova, webView);
    }

    @Override
    public boolean execute(String action, JSONArray args, final CallbackContext callbackContext) {
        return false;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Cordova Plugin is instantiated when it is first called in the JavaScript WebView app.
The <code>pluginInitialized()</code> method includes the startup code.
The <code>exec</code> method marshals requests from the JavaScipt to the Java side.
Refer to the <a href="https://cordova.apache.org/docs/en/latest/guide/platforms/android/plugin.html#plugin-initialization-and-lifetime">Plugin Lifecycle documentation</a> for more details.</p>
</div>
</li>
<li>
<p>To verify that your plugin is ready to work as expected, you have to install it in your <strong>HotelLister</strong> project.
To do so, run the following commands from the root of the <strong>starter-project</strong> folder.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd HotelLister
cordova plugin add ../cordova-plugin-hotel-lister/</code></pre>
</div>
</div>
<div class="paragraph">
<p>If successful, you should see the following in the output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Adding cordova-plugin-hotel-lister to package.json
Saved plugin info for "cordova-plugin-hotel-lister" to config.xml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="couchbase-lite-setup"><a class="anchor" href="#couchbase-lite-setup"></a>Couchbase Lite Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To import Couchbase Lite in the Android Studio project, add it as a gradle dependency in the <code>dependencies</code> section of <strong>HotelLister/platforms/android/app/build.gradle</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    implementation fileTree(dir: 'libs', include: '*.jar')
    // SUB-PROJECT DEPENDENCIES START
    implementation(project(path: ":CordovaLib"))
    compile "com.android.support:support-annotations:27.+"
    // SUB-PROJECT DEPENDENCIES END
    implementation 'com.couchbase.lite:couchbase-lite-android:2.1.0'
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="database-setup"><a class="anchor" href="#database-setup"></a>Database Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In our example, we will start with a pre-built Couchbase Lite database that contains a bunch of hotel documents.
We will make our queries against the documents in this database.
Note that in a real world application, the data could be synced down from other Couchbase Lite clients or from Sync Gateway in the cloud.</p>
</div>
<div class="paragraph">
<p>The pre-built database needs to be added to the Android Studio project.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download <a href="_attachments/travel-sample.cblite2.zip">travel-sample.cblite2.zip</a> and drag it over to <strong>HotelLister/platforms/android/app/src/main/assets/</strong>.</p>
</li>
<li>
<p>We will use the singleton pattern to setup the database instance.
Create a new file at <strong>cordova-plugin-hotel-lister/src/android/DatabaseManager.java</strong> and insert the following.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.hotellister;

import android.content.Context;

import com.couchbase.lite.CouchbaseLiteException;
import com.couchbase.lite.Database;
import com.couchbase.lite.DatabaseConfiguration;
import com.couchbase.lite.FullTextIndex;
import com.couchbase.lite.FullTextIndexItem;
import com.couchbase.lite.IndexBuilder;

public class DatabaseManager {

    private static String DB_NAME = "travel-sample";

    private static Database database;
    private static DatabaseManager instance = null;

    private DatabaseManager(Context context) {
        if (!Database.exists("travel-sample", context.getFilesDir())) {
            String assetFile = String.format("%s.cblite2.zip", DB_NAME);
            Utils.installPrebuiltDatabase(context, assetFile);
        }
        DatabaseConfiguration configuration = new DatabaseConfiguration(context);
        try {
            database = new Database(DB_NAME, configuration);
        } catch (CouchbaseLiteException e) {
            e.printStackTrace();
        }
    }

    public static DatabaseManager getSharedInstance(Context context) {
        if (instance == null) {
            instance = new DatabaseManager(context);
        }
        return instance;
    }

    public static Database getDatabase() {
        if (instance == null) {
            try {
                throw new Exception("Must call getSharedInstance first");
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
        return database;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You first check if a database named "travel-sample" exists.
If it doesn&#8217;t exist, <strong>the travel-sample.cblite2</strong> database file that was bundled with the app is copied to the default Couchbase Lite directory.
The database is then opened and the database instance is set.</p>
</div>
</li>
<li>
<p>When adding a new Java file, it must be referenced in the plugin&#8217;s configuration file.
Insert the following as a child to the <code>&lt;platform name="android"&gt;&lt;/platform&gt;</code> element in <strong>cordova-plugin-hotel-lister/plugin.xml</strong>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;source-file
        src="src/android/DatabaseManager.java"
        target-dir="src/com/hotellister/" /&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Next, add the following instance variable in <strong>HotelLister.java</strong>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private Database database;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the following Java imports to the top of <strong>HotelLister.java</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.couchbase.lite.CouchbaseLiteException;
import com.couchbase.lite.DataSource;
import com.couchbase.lite.Database;
import com.couchbase.lite.Expression;
import com.couchbase.lite.Meta;
import com.couchbase.lite.Query;
import com.couchbase.lite.QueryBuilder;
import com.couchbase.lite.Result;
import com.couchbase.lite.ResultSet;
import com.couchbase.lite.SelectResult;</code></pre>
</div>
</div>
</li>
<li>
<p>Then, update the <code>initialize</code> method in <strong>HotelLister.java</strong> with the following to set the <code>database</code> instance property.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public void initialize(CordovaInterface cordova, CordovaWebView webView) {
    super.initialize(cordova, webView);
    Context context = cordova.getContext();
    DatabaseManager.getSharedInstance(context);
    this.database = DatabaseManager.getDatabase();
}</code></pre>
</div>
</div>
</li>
<li>
<p>To test your changes, you must re-install the Cordova plugin from <strong>cordova-plugin-hotel-lister</strong> to <strong>HotelLister</strong>.
Run the following commands from the root of the <strong>starter-project</strong> folder.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd HotelLister
cordova plugin rm cordova-plugin-hotel-lister
cordova plugin add ../cordova-plugin-hotel-lister/</code></pre>
</div>
</div>
</li>
<li>
<p>Build the project.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ionic cordova emulate android</code></pre>
</div>
</div>
<div class="paragraph">
<p>The application should run successfully. You will still see an empty screen because at this stage, the Couchbase Lite database is initialized but you haven&#8217;t run any queries to fetch data from the database.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the next section, you will use this Database variable to query hotels from the pre-built database.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="listing-hotels"><a class="anchor" href="#listing-hotels"></a>Listing Hotels</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, you will add the functionality to list hotels from the database.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Insert a new method called <code>queryHotels</code> in <strong>cordova-plugin-hotel-lister/src/android/HotelLister.java</strong>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private List&lt;Result&gt; queryHotels() {
    String DOC_TYPE = "hotel";

    Query query = QueryBuilder
        .select(
            SelectResult.expression(Meta.id),
            SelectResult.property("address"),
            SelectResult.property("phone"),
            SelectResult.property("name")
        )
        .from(DataSource.database(database))
        .where(
            Expression.property("type")
                .equalTo(Expression.string(DOC_TYPE))
        );

    try {
        ResultSet resultSet = query.execute();
        return resultSet.allResults();
    } catch (CouchbaseLiteException e) {
        e.printStackTrace();
        return null;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method queries for the <code>address</code>, <code>phone</code> and <code>name</code> properties of documents where the <code>type</code> property is <code>hotel</code>.</p>
</div>
</li>
<li>
<p>You can now call this method from the <code>execute</code> method in <strong>cordova-plugin-hotel-lister/src/android/HotelLister.java</strong>.</p>
<div class="paragraph">
<p>Whatever is dispatched to the plugin with JavaScript&#8217;s exec function is passed into the plugin class&#8217;s execute method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
public boolean execute(String action, JSONArray args, final CallbackContext callbackContext) {
    if ("queryHotels".equals(action)) {
        List&lt;Result&gt; resultList = queryHotels();
        ArrayList&lt;Map&lt;String,Object&gt;&gt; arrayList = new ArrayList&lt;&gt;();
        assert resultList != null;
        for (Result result : resultList) {
            Map&lt;String,Object&gt; map = result.toMap();
            arrayList.add(map);
        }
        JSONArray jsonArray = new JSONArray(arrayList);
        callbackContext.success(jsonArray);
        return true;
    }
    return false;
}</code></pre>
</div>
</div>
</li>
<li>
<p>Next, you will update the plugin&#8217;s JavaScript interface. In <strong>cordova-plugin-hotel-lister/www/hotel-lister.js</strong>, replace the <code>/* code will be added here later */</code> comment with the following.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">queryHotels: function(successCallback, errorCallback) {
  exec(successCallback, errorCallback, 'HotelLister', 'queryHotels');
},</code></pre>
</div>
</div>
</li>
<li>
<p>You can now call the <code>queryHotels</code> method in the Ionic project.
Add the following to the <code>constructor</code> method in <strong>HotelLister/src/pages/home/home.ts</strong>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">this.platform.ready().then(() =&gt; {
  window.plugins.HotelLister.queryHotels((hotels) =&gt; {
    console.log(hotels);
    this.hotels = hotels;
  });
});</code></pre>
</div>
</div>
</li>
<li>
<p>To test your changes, you must re-install the Cordova plugin from <strong>cordova-plugin-hotel-lister</strong> to <strong>HotelLister</strong>.
Run the following commands from the root of the <strong>start-project</strong> folder</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd HotelLister
cordova plugin rm cordova-plugin-hotel-lister
cordova plugin add ../cordova-plugin-hotel-lister/</code></pre>
</div>
</div>
</li>
<li>
<p>Build and run.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ionic cordova emulate android</code></pre>
</div>
</div>
</li>
<li>
<p>You should now see the list of hotels.</p>
<div class="imageblock">
<div class="content">
<img src="_images/ionic-listing-hotels.png" alt="ionic listing hotels" width="250">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Well done!</strong> You have learned how to create a Cordova plugin to use Couchbase Lite&#8217;s native APIs and import the plugin in an Ionic project!</p>
</div>
<div class="paragraph">
<p>You can find a working copy of the <strong>completed project</strong> in the <a href="_attachments/final-project.zip">final project</a> zip file. To build and run the final project, follow the instructions outlined in the <a href="#getting-started">Getting Started</a> section.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/logo.svg" alt="Couchbase">
          </a>
        </div>
        <div class="contact">
          <p class="address">3250 Olcott Street
Santa Clara, CA 95054
United States</p>
          <a href="https://www.couchbase.com/contact" class="btn white-btn">Contact Us</a>
          <a class="tel" href="tel:1-650-417-7500">1-650-417-7500</a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Company</span></li>
          <li><a href="https://www.couchbase.com/about">About</a></li>
          <li><a href="https://www.couchbase.com/leadership">Leadership</a></li>
          <li><a href="https://www.couchbase.com/news-and-press-releases">News &amp; Press</a></li>
          <li><a href="https://www.couchbase.com/careers">Careers</a></li>
          <li><a href="https://www.couchbase.com/resources/events">Events</a></li>
          <li><a href="https://www.couchbase.com/contact">Contact Us</a></li>
          <li><a href="https://www.couchbase.com/request-pricing">Pricing</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Support</span></li>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://www.couchbase.com/services">Professional Services</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support Login</a></li>
          <li><a href="https://learn.couchbase.com/store" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Quicklinks</span></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Online Training</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
          <li><a href="https://www.couchbase.com/nosql-resources/why-nosql">Why NoSQL</a></li>
          <li><a href="https://www.couchbase.com/resources/security">Security</a></li>
          <li><a href="https://www.couchbase.com/resources/gdpr">GDPR</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://plus.google.com/+CouchbaseServer" class="icon">
              <svg width="50px" height="50px" viewBox="36.72 225.573 542.326 343.67"><path d="m209.02 363.05v68.732h93.212c-15.065 44.252-37.662 68.732-93.212 68.732-56.492 0-100.74-46.135-100.74-102.63s44.252-102.63 100.74-102.63c30.129 0 48.96 10.357 66.849 25.422 14.123-14.123 13.182-16.006 48.96-49.902-31.071-28.246-71.557-45.194-115.81-45.194-95.096-0.94-172.3 76.266-172.3 171.36s77.206 172.3 172.3 172.3c142.17 0 177.01-124.28 165.71-206.2-33.896-1e-3 -165.71-1e-3 -165.71-1e-3zm310.71 3.766v-59.317h-42.369v59.317h-61.2v42.369h61.2v61.2h42.369v-61.2h59.317v-42.369h-59.317z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2018 COUCHBASE All rights reserved.</span>
      <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
      <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
      <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
      <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
