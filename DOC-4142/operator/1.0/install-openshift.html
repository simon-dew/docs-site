<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Installing on OpenShift | Couchbase Docs (Staging)</title>
    <link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-4142/operator/1.1/install-openshift.html">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="schema.dcterms" href="https://purl.org/dc/terms/">
    <meta name="dcterms.subject" content="operator">
    <meta name="dcterms.identifier" content="1.0">
    <meta name="generator" content="Antora 1.1.1">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" id="topbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://www.couchbase.com"><img src="../../_/img/logo.svg" alt="Couchbase"></a>
        <button class="navbar-burger" data-target="topbar-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="topbar-menu" class="navbar-menu">
        <div class="navbar-start">
          <div class="navbar-item has-dropdown">
            <a class="navbar-link" href="https://simon-dew.github.io/docs-site/DOC-4142">Docs</a>
            <div class="navbar-dropdown explore">
              <div class="title">Couchbase Documentation Overview</div>
              <div class="cols">
                <ul>
                  <li class="heading"><a href="../../server/5.5/introduction/intro.html">Server</a></li>
                  <li><a href="../../server/5.5/n1ql/n1ql-language-reference/index.html">N1QL</a></li>
                  <li><a href="../../server/5.5/fts/full-text-intro.html">Full Text Search</a></li>
                  <li><a href="../../server/5.5/analytics/introduction.html">Analytics <small>(Developer Preview)</small></a></li>
                  <li><a href="../../server/5.5/eventing/eventing-overview.html">Eventing</a></li>
                  <li><a href="../1.1/overview.html">Autonomous Operator</a></li>
                </ul>
                <ul>
                  <li class="heading">Mobile</li>
                  <li><a href="../../couchbase-lite/2.1/index.html">Lite</a></li>
                  <li><a href="../../sync-gateway/2.1/index.html">Sync Gateway</a></li>
                </ul>
                <ul class="two-cols">
                  <li class="heading"><a href="../../server/5.5/sdk/overview.html">SDKs</a></li>
                  <li><a href="../../c-sdk/2.8/start-using-sdk.html">C</a></li>
                  <li><a href="../../dotnet-sdk/2.6/start-using-sdk.html">.NET</a></li>
                  <li><a href="../../go-sdk/1.4/start-using-sdk.html">Go</a></li>
                  <li><a href="../../java-sdk/2.6/start-using-sdk.html">Java</a></li>
                  <li><a href="../../nodejs-sdk/2.5/start-using-sdk.html">Node.js</a></li>
                  <li><a href="../../php-sdk/2.4/start-using-sdk.html">PHP</a></li>
                  <li><a href="../../python-sdk/2.4/start-using-sdk.html">Python</a></li>
                </ul>
                <ul>
                  <li class="heading"><a href="../../server/5.5/connectors/intro.html">Connectors</a></li>
                  <li><a href="../../elasticsearch-connector/3.0/index.html">Elasticsearch</a></li>
                  <li><a href="../../server/5.5/connectors/hadoop-1.2/hadoop.html">Hadoop</a></li>
                  <li><a href="../../kafka-connector/3.4/index.html">Kafka</a></li>
                  <li><a href="../../spark-connector/2.2/index.html">Spark</a></li>
                  <li><a href="../../talend-connector/index.html">Talend</a></li>
                  <li><a href="../../server/5.5/connectors/odbc-jdbc-drivers.html">ODBC/JDBC</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="navbar-item has-dropdown">
            <a class="navbar-link component" href="overview.html"><span class="title">Autonomous Operator</span> <span class="version">1.0</span></a>
            <div class="navbar-dropdown versions">
              <div class="cols">
                <ul>
                  <li><a class="navbar-item" href="../1.1/install-openshift.html">Autonomous Operator 1.1</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <a class="btn red-btn" href="https://www.couchbase.com/downloads">Downloads</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body container">
<nav class="nav">
<div class="nav-menu">
<ul class="nav-list">
  <li class="nav-item is-active" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="overview.html">Introduction</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Getting Started</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="prerequisite-and-setup.html">System Requirements</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="best-practices.html">Guidelines and Best Practices</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-path is-active" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Deploying the Operator</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="install-kubernetes.html">Installing on Kubernetes</a>
    </span>
  </li>
  <li class="nav-item is-current-page is-active" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="install-openshift.html">Installing on OpenShift</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="operator-config.html">About the Operator Deployment Settings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="kubernetes-rbac.html">About Kubernetes RBAC</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Managing the Operator</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="list-and-describe.html">Monitoring Kubernetes Resources</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="services.html">Monitoring Services</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="deploying-couchbase.html">Deploying Couchbase Server</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="couchbase-cluster-config.html">Couchbase Configuration Settings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="networking.html">About Kubernetes Networking</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="xdcr.html">Using XDCR</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="tls.html">Configuring TLS</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="accessing-couchbase.html">Accessing the Couchbase User Interfaces</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="persisted-volumes-guide.html">About Persistent Volumes</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="persisted-volumes-setup.html">Setting Up Persistent Volumes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="persisted-volumes-zoning-guide.html">Persistent Volume Zoning Guide</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="server-groups.html">Using Server Groups</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="couchbase-clients.html">Using Couchbase Clients</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="running-couchbase.html">Managing Couchbase Server</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="updating-couchbase.html">Modifying a Couchbase Deployment</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="scaling-couchbase.html">Scaling a Couchbase Deployment</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="node-recovery.html">Recovering From a Node Failure</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="delete-couchbase-cluster.html">Deleting a Couchbase Deployment</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="backup-and-restore.html">Backing up and Restoring a Couchbase Deployment</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="conditions-and-events.html">Monitoring Couchbase Events</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="cluster-status-guide.html">Monitoring Couchbase Cluster Status</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Troubleshooting</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="logs-troubleshooting.html">Viewing and Retrieving Logs</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Tools</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="cbopctl.html">cbopctl</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="cbopinfo.html">cbopinfo</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="demo.html">Couchbase Deployment Tutorial</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="release-notes.html">Release Notes</a>
    </span>
  </li>
</ul>
  </li>
</ul>
</div>
</nav>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
<main class="article" data-ceiling="topbar">
  <div class="article-banner">
    <p>A newer version of this documentation is available.</p>
    <a class="btn" href="../1.1/install-openshift.html">View Latest</a>
  </div>
  <div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="overview.html">Autonomous Operator</a></li>
    <li class="crumb">Deploying the Operator</li>
    <li class="crumb"><a href="install-openshift.html">Installing on OpenShift</a></li>
  </ul>
</nav>
  </div>
<article class="doc">
<h1 class="page">Installing on OpenShift</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide walks through the recommended procedure for installing the Couchbase Autonomous Operator on a Red Hat OpenShift project.</p>
</div>
<div class="ulist">
<div class="title">This guide assumes the following:</div>
<ul>
<li>
<p>You have a working knowledge of OpenShift and Kubernetes</p>
</li>
<li>
<p>You are installing on a new OpenShift cluster</p>
</li>
<li>
<p>You have access to an OpenShift user that has cluster-admin privileges (<code>system:admin</code> in this guide)</p>
</li>
<li>
<p>You have access to a standard OpenShift user without cluster-admin privileges (<code>developer</code> in this guide)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you have an OpenShift environment that already has a custom setup (non-default), you should be able to modify a few of the parameters in the various commands and configuration files mentioned in this guide in order to fit your requirements.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This guide makes certain assumptions about the role-based access control (RBAC) settings in your OpenShift environment. Refer to the  <a href="kubernetes-rbac.html" class="page">RBAC documentation</a> before you install the Operator, as your OpenShift environment may differ from the environment upon which this guide is based.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Download the Operator <a href="https://www.couchbase.com/downloads">package</a> and unpack it on the same computer where you normally run <code>oc</code>.</p>
</div>
<div class="paragraph">
<p>The Operator package contains YAML configuration files and command-line tools that you will use to install the Operator.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
After you unpack the download, the resulting directory will be titled something like <code>couchbase-autonomous-operator-openshift.x.x-linux_x86_64</code>. Make sure to <code>cd</code> into this directory before you run the commands in this guide.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-an-openshift-project"><a class="anchor" href="#create-an-openshift-project"></a>Create an OpenShift Project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first thing that you need to do is use a standard OpenShift user to create a <a href="https://docs.openshift.com/container-platform/latest/architecture/core_concepts/projects_and_users.html#projects">project</a> where the Operator will reside:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc login -u developer</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc new-project operator-example-namespace</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc logout</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the standard user is <code>developer</code>, and the project is <code>operator-example-namespace</code>. Later in this guide you will give <code>developer</code> the ability to manage the Operator and the Couchbase Server clusters in <code>operator-example-namespace</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="install-the-custom-resource-definition"><a class="anchor" href="#install-the-custom-resource-definition"></a>Install the Custom Resource Definition</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The next step in setting up the Operator is to install the CouchbaseCluster custom resource definition (CRD). The Operator can do this for you automatically (<a href="install-kubernetes.html" class="page">as it does when installing on open source Kubernetes</a>), but in OpenShift it&#8217;s better to do it manually because installing a CRD is a cluster-level operation and requires cluster-level permissions that should not be given to typical users.</p>
</div>
<div class="paragraph">
<p>To install the CRD, log in as an OpenShift user that has cluster-admin privileges (in this case <code>system:admin</code>) and run the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc login -u system:admin</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc create -f crd.yaml</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You only need to install the CRD once. After that, you can create the Operator in any OpenShift project.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-an-imagepullsecret"><a class="anchor" href="#create-an-imagepullsecret"></a>Create an imagePullSecret</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat recommends that all containers that run in OpenShift be built with Red Hat Enterprise Linux. Couchbase provides these images to users through the Red Hat Container Catalog. Using this catalog requires creating an imagePullSecret so that Docker knows where to look for images. To create an imagePullSecret for the Red Hat Container Catalog, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc create secret docker-registry rh-catalog --docker-server=registry.connect.redhat.com \
  --docker-username=&lt;rhel-username&gt; --docker-password=&lt;rhel-password&gt; --docker-email=&lt;docker-email&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-a-role-and-service-account-for-the-operator"><a class="anchor" href="#create-a-role-and-service-account-for-the-operator"></a>Create a Role and Service Account for the Operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need to create a <a href="https://docs.openshift.com/container-platform/latest/architecture/additional_concepts/authorization.html#roles">role</a> in OpenShift that allows the Operator to access the resources that it needs to run. Since the Operator might run in many different projects, it&#8217;s best to create a <em>cluster role</em> because you can assign that role to a <a href="https://docs.openshift.com/container-platform/latest/dev_guide/service_accounts.html">service account</a> in any OpenShift project.</p>
</div>
<div class="paragraph">
<p>To create the cluster role for the Operator, run the following command as the <code>system:admin</code> user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc create -f cluster-role-sa.yaml</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You only need to create the cluster role once.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After the cluster role is created, you need to create a service account in the project where you are installing the Operator, and then assign the cluster role to that service account using a <a href="https://docs.openshift.com/container-platform/latest/admin_guide/manage_rbac.html">role binding</a>:</p>
</div>
<div class="paragraph">
<p>To create the service account:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc create serviceaccount couchbase-operator --namespace operator-example-namespace</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we need to register our imagePullSecret with the service account that runs the operator so that it can pull images from the Red Hat Container Catalog.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc secrets add serviceaccount/couchbase-operator secrets/rh-catalog --for=pull
oc secrets add serviceaccount/default secrets/rh-catalog --for=pull</code></pre>
</div>
</div>
<div class="paragraph">
<p>To assign the cluster role to the service account:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc create clusterrolebinding couchbase-operator-rolebinding --clusterrole couchbase-operator --serviceaccount operator-example-namespace:couchbase-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>A service account is used as opposed to a traditional user for the Operator because service accounts are meant to be used for processes running in OpenShift.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To set up a service account for the Operator in another OpenShift project, repeat these steps again in that project.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-a-role-for-a-user"><a class="anchor" href="#create-a-role-for-a-user"></a>Create a Role for a User</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since the <code>developer</code> user needs to be able to create and delete the Couchbase cluster, you need to create another cluster role with permissions to handle the management of the CouchbaseCluster resource.</p>
</div>
<div class="paragraph">
<p>Run the following command to create the cluster role for <code>developer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc create -f cluster-role-user.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, you need to allow <code>developer</code> to be able to manage the CouchbaseCluster resource in the <code>operator-example-namespace</code> project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc create rolebinding couchbasecluster-developer-rolebinding --clusterrole couchbasecluster --user developer --namespace operator-example-namespace</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if you want <code>developer</code> to be able to manage CouchbaseCluster objects in all projects, then you can run the following command instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc create clusterrolebinding couchbasecluster-developer-rolebinding --clusterrole couchbasecluster --user developer</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you want to create role bindings for multiple users either at the cluster or namespace level, they will need to have unique names. In the previous examples, if you were to create a role binding for user <code>alice</code>, you&#8217;d use the name <code>couchbasecluster-alice</code> in place of <code>couchbasecluster-developer</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-the-operator"><a class="anchor" href="#create-the-operator"></a>Create the Operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At this point you can now use the <code>developer</code> user to create the Operator in the <code>operator-example-namespace</code> project. To create and start the Operator, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc logout
oc login -u developer
oc create -f operator.yaml -n operator-example-namespace</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running this command downloads the Operator Docker image (specified in the <code>operator.yaml</code> file) and creates a <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">deployment</a>, which manages a single instance of the Operator. The Operator uses a deployment so that it can restart if the pod it&#8217;s running in dies.</p>
</div>
<div class="paragraph">
<p>After you run the <code>oc create</code> command, it generally takes less than a minute for OpenShift to deploy the Operator and for the Operator to be ready to run.</p>
</div>
<div class="sect2">
<h3 id="check-the-status-of-the-deployment"><a class="anchor" href="#check-the-status-of-the-deployment"></a>Check the Status of the Deployment</h3>
<div class="paragraph">
<p>You can use the following command to check on the status of the deployment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc get deployments -l app=couchbase-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you run the previous command immediately after the Operator is deployed, the output will look something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">NAME                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
couchbase-operator   1         1         1            0           10s</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the deployment is called <code>couchbase-operator</code>. The <code>DESIRED</code> field in the output shows that this deployment will create one pod running the Operator. The <code>CURRENT</code> field shows that one Operator pod has been created. However, the <code>AVAILABLE</code> field indicates that the pod is not ready yet since its value is 0 and not 1. That means that the Operator is still establishing a connection to the Kubernetes master node to allow it to get updates on CouchbaseCluster objects. Once the Operator has completed this task, it will be able to start managing Couchbase Server clusters and the status will be shown as <code>AVAILABLE</code>.</p>
</div>
<div class="paragraph">
<p>You should continue to poll the status of the Operator until the output looks similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">NAME                 DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
couchbase-operator   1         1         1            1           47s</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="check-the-status-of-the-operator"><a class="anchor" href="#check-the-status-of-the-operator"></a>Check the Status of the Operator</h3>
<div class="paragraph">
<p>You can use the following command to verify that the Operator has started successfully:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc get pods -l app=couchbase-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the Operator is up and running, the command returns an output where the <code>READY</code> field shows <code>1/1</code>, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">NAME                                  READY   STATUS   RESTARTS   AGE
couchbase-operator-1917615544-t5mhp   1/1     Running  0          57s</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also check the logs to confirm that the Operator is up and running. Look for the message: <code>starting couchbaseclusters controller</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc logs couchbase-operator-1917615544-t5mhp</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">time="2018-04-25T03:01:56Z" level=info msg="Obtaining resource lock" module=main
time="2018-04-25T03:01:56Z" level=info msg="Starting event recorder" module=main
time="2018-04-25T03:01:56Z" level=info msg="Attempting to be elected the couchbase-operator leader" module=main
time="2018-04-25T03:02:13Z" level=info msg="I'm the leader, attempt to start the operator" module=main
time="2018-04-25T03:02:13Z" level=info msg="Creating the couchbase-operator controller" module=main
time="2018-04-25T03:02:13Z" level=info msg="Event(v1.ObjectReference{Kind:\"Endpoints\", Namespace:\"default\", Name:\"couchbase-operator\", UID:\"9b86c750-47e7-11e8-866e-080027b2a68d\", APIVersion:\"v1\", ResourceVersion:\"23482\", FieldPath:\"\"}): type: 'Normal' reason: 'LeaderElection' couchbase-operator-75ddfdbdb5-bz7ng became leader" module=event_recorder
time="2018-04-25T03:02:13Z" level=info msg="starting couchbaseclusters controller"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next-steps"><a class="anchor" href="#next-steps"></a>Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Install the <a href="cbopctl.html" class="page">cbopctl</a> command line tool and use it to <a href="deploying-couchbase.html" class="page">deploy a Couchbase Server cluster</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quick-start-script"><a class="anchor" href="#quick-start-script"></a>Quick Start Script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The script below has been parameterized for clarity and relies on a set of environment variables that may be tailored to the individual OpenShift environment being deployed in. These variables correspond to the resources being created and used in order to deploy the Operator. These are explained below:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">NAMESPACE</dt>
<dd>
<p>The Kubernetes namespace/OpenShift project to run the Operator in. This can be changed to any project you have access to.</p>
</dd>
<dt class="hdlist1">ADMIN_ACCOUNT</dt>
<dd>
<p>The administrator account which has the ability to install custom resource definitions and create role bindings which grant privilege escalation.</p>
</dd>
<dt class="hdlist1">OPERATOR_SERVICE_ACCOUNT</dt>
<dd>
<p>The service account the Operator should run as. This can be changed to any valid Kubernetes name, however, is scoped to the namespace it is deployed in so it must be unique in that context.</p>
<div class="paragraph">
<p>This value is also used when creating the Operator deployment, see the documentation for the <a href="operator-config.html" class="page">serviceAccountName parameter</a>.</p>
</div>
</dd>
<dt class="hdlist1">OPERATOR_CLUSTER_ROLE</dt>
<dd>
<p>The role for the Operator to inherit that grants access to create and delete required resources. This name is hard coded in the resource YAML file used in this example.</p>
</dd>
<dt class="hdlist1">OPERATOR_CLUSTER_ROLE_BINDING</dt>
<dd>
<p>The name for the rule which binds the operator role and service account to a namespace. This can be changed to any unique name in the namespace.</p>
</dd>
<dt class="hdlist1">USER_ACCOUNT</dt>
<dd>
<p>The user account that is used to create and manage CouchbaseCluster resources. This can be changed to any valid user name.</p>
</dd>
<dt class="hdlist1">USER_CLUSTER_ROLE</dt>
<dd>
<p>The role for the user to inherit that grants access to create and delete required resources. This name is hard coded in the resource YAML file used in this example.</p>
</dd>
<dt class="hdlist1">USER_CLUSTER_ROLE_BINDING</dt>
<dd>
<p>The name for the rule which binds the user role and account to a name space. This can be changed to any unique name in the namespace.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>All steps listed here are fully explained below. If they fail, please consult the relevant documentation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Evnvironment specific variables
ADMIN_ACCOUNT=system:admin
USER_ACCOUNT=developer
NAMESPACE=operator-example-namespace

# Namespace specific variables, you may need to change these to avoid
# name space collisions
OPERATOR_SERVICE_ACCOUNT=couchbase-operator
OPERATOR_CLUSTER_ROLE_BINDING=couchbase-operator-rolebinding
USER_CLUSTER_ROLE_BINDING=couchbasecluster-developer-rolebinding

# Constant variables (defined in web based resources)
OPERATOR_CLUSTER_ROLE=couchbase-operator
USER_CLUSTER_ROLE=couchbasecluster

# As an unprivileged user create a project to run the Operator in and a
# service account to run the Operator as
oc login -u ${USER_ACCOUNT}
oc new-project ${NAMESPACE}
oc create serviceaccount ${OPERATOR_SERVICE_ACCOUNT} --namespace ${NAMESPACE}
oc logout

# As a privileged user create the custom resource definition, roles and bind
# them to the service and user accounts
oc login -u ${ADMIN_ACCOUNT}
oc create -f crd.yaml
oc create -f cluster-role-sa.yaml
oc create -f cluster-role-user.yaml
oc create clusterrolebinding ${OPERATOR_CLUSTER_ROLE_BINDING} --clusterrole ${OPERATOR_CLUSTER_ROLE} --serviceaccount ${NAMESPACE}:${OPERATOR_SERVICE_ACCOUNT}
oc create rolebinding ${USER_CLUSTER_ROLE_BINDING} --clusterrole ${USER_CLUSTER_ROLE} --user ${USER_ACCOUNT} --namespace ${NAMESPACE}
oc logout

# To enable automatic installation of images from the Red Hat Container Catalog,
# you will require a Red Hat account and configure a kubernetes secret with your
# Red Hat username and password. Once you create your secret you must assign it
# to the couchbase-operator and default service accounts.
oc create secret docker-registry rh-catalog --docker-server=registry.connect.redhat.com \
  --docker-username=&lt;rhel-username&gt; --docker-password=&lt;rhel-password&gt; --docker-email=&lt;docker-email&gt;
oc secrets add serviceaccount/couchbase-operator secrets/rh-catalog --for=pull
oc secrets add serviceaccount/default secrets/rh-catalog --for=pull

# Deploy the Operator as an unprivileged user
oc login -u ${USER_ACCOUNT}
oc create -f operator.yaml -n ${NAMESPACE}
oc logout</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="uninstalling-the-operator"><a class="anchor" href="#uninstalling-the-operator"></a>Uninstalling the Operator</h2>
<div class="sectionbody">
<div class="olist arabic">
<div class="title">Uninstalling the Operator is a two-step process:</div>
<ol class="arabic">
<li>
<p>Delete the Operator.</p>
<div class="paragraph">
<p>You can delete the Operator as the <code>developer</code> or <code>system:admin</code> user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">kubectl delete deployment couchbase-operator</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Deleting the Operator from a namespace will not remove or affect any Couchbase pods in your Kubernetes cluster.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Delete the CRD.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can only delete the CRD as the <code>system:admin</code> user.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Make sure the Operator has been deleted from all other OpenShift projects in the cluster before you delete the CRD. Once the Operator has been deleted, run the following command to delete the CRD:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc delete crd couchbaseclusters.couchbase.com</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/logo.svg" alt="Couchbase">
          </a>
        </div>
        <div class="contact">
          <p class="address">2440 West El Camino Real
Mountain View, CA 94040
United States</p>
          <a href="https://www.couchbase.com/contact" class="btn white-btn">Contact Us</a>
          <a class="tel" href="tel:1-650-417-7500">1-650-417-7500</a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Company</span></li>
          <li><a href="https://www.couchbase.com/about">About</a></li>
          <li><a href="https://www.couchbase.com/leadership">Leadership</a></li>
          <li><a href="https://www.couchbase.com/news-and-press-releases">News &amp; Press</a></li>
          <li><a href="https://www.couchbase.com/careers">Careers</a></li>
          <li><a href="https://www.couchbase.com/resources/events">Events</a></li>
          <li><a href="https://www.couchbase.com/contact">Contact Us</a></li>
          <li><a href="https://www.couchbase.com/request-pricing">Pricing</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Support</span></li>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://www.couchbase.com/services">Professional Services</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support Login</a></li>
          <li><a href="https://training.couchbase.com" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Quicklinks</span></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://training.couchbase.com/online" target="_blank" rel="noopener">Online Training</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
          <li><a href="https://www.couchbase.com/nosql-resources/why-nosql">Why NoSQL</a></li>
          <li><a href="https://www.couchbase.com/resources/security">Security</a></li>
          <li><a href="https://www.couchbase.com/resources/gdpr">GDPR</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://plus.google.com/+CouchbaseServer" class="icon">
              <svg width="50px" height="50px" viewBox="36.72 225.573 542.326 343.67"><path d="m209.02 363.05v68.732h93.212c-15.065 44.252-37.662 68.732-93.212 68.732-56.492 0-100.74-46.135-100.74-102.63s44.252-102.63 100.74-102.63c30.129 0 48.96 10.357 66.849 25.422 14.123-14.123 13.182-16.006 48.96-49.902-31.071-28.246-71.557-45.194-115.81-45.194-95.096-0.94-172.3 76.266-172.3 171.36s77.206 172.3 172.3 172.3c142.17 0 177.01-124.28 165.71-206.2-33.896-1e-3 -165.71-1e-3 -165.71-1e-3zm310.71 3.766v-59.317h-42.369v59.317h-61.2v42.369h61.2v61.2h42.369v-61.2h59.317v-42.369h-59.317z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2018 COUCHBASE All rights reserved.</span>
      <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
      <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
      <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
      <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
