<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Managing beers | Couchbase Docs (Staging)</title>
    <link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-4142/php-sdk/2.6/start-using-sdk.html">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="schema.dcterms" href="https://purl.org/dc/terms/">
    <meta name="dcterms.subject" content="php-sdk">
    <meta name="dcterms.identifier" content="2.1">
    <meta name="generator" content="Antora 1.1.1">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" id="topbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://www.couchbase.com"><img src="../../_/img/logo.svg" alt="Couchbase"></a>
        <button class="navbar-burger" data-target="topbar-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="topbar-menu" class="navbar-menu">
        <div class="navbar-start">
          <div class="navbar-item has-dropdown">
            <a class="navbar-link" href="https://simon-dew.github.io/docs-site/DOC-4142">Docs</a>
            <div class="navbar-dropdown explore">
              <div class="title">Couchbase Documentation Overview</div>
              <div class="cols">
                <ul>
                  <li class="heading"><a href="../../server/5.5/introduction/intro.html">Server</a></li>
                  <li><a href="../../server/5.5/n1ql/n1ql-language-reference/index.html">N1QL</a></li>
                  <li><a href="../../server/5.5/fts/full-text-intro.html">Full Text Search</a></li>
                  <li><a href="../../server/5.5/analytics/introduction.html">Analytics <small>(Developer Preview)</small></a></li>
                  <li><a href="../../server/5.5/eventing/eventing-overview.html">Eventing</a></li>
                  <li><a href="#">Autonomous Operator</a></li>
                </ul>
                <ul>
                  <li class="heading">Mobile</li>
                  <li><a href="../../couchbase-lite/2.1/index.html">Lite</a></li>
                  <li><a href="../../sync-gateway/2.1/index.html">Sync Gateway</a></li>
                </ul>
                <ul class="two-cols">
                  <li class="heading"><a href="../../server/5.5/sdk/overview.html">SDKs</a></li>
                  <li><a href="../../c-sdk/2.8/start-using-sdk.html">C</a></li>
                  <li><a href="../../dotnet-sdk/2.6/start-using-sdk.html">.NET</a></li>
                  <li><a href="../../go-sdk/1.4/start-using-sdk.html">Go</a></li>
                  <li><a href="../../java-sdk/2.6/start-using-sdk.html">Java</a></li>
                  <li><a href="../../nodejs-sdk/2.5/start-using-sdk.html">Node.js</a></li>
                  <li><a href="../../php-sdk/2.4/start-using-sdk.html">PHP</a></li>
                  <li><a href="../../python-sdk/2.4/start-using-sdk.html">Python</a></li>
                </ul>
                <ul>
                  <li class="heading"><a href="../../server/5.5/connectors/intro.html">Connectors</a></li>
                  <li><a href="../../elasticsearch-connector/3.0/index.html">Elasticsearch</a></li>
                  <li><a href="../../server/5.5/connectors/hadoop-1.2/hadoop.html">Hadoop</a></li>
                  <li><a href="../../kafka-connector/3.4/index.html">Kafka</a></li>
                  <li><a href="../../spark-connector/2.2/index.html">Spark</a></li>
                  <li><a href="#">Talend</a></li>
                  <li><a href="../../server/5.5/connectors/odbc-jdbc-drivers.html">ODBC/JDBC</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="navbar-item has-dropdown">
            <a class="navbar-link component" href="php-intro.html"><span class="title">PHP SDK</span> <span class="version">2.1</span></a>
            <div class="navbar-dropdown versions">
              <div class="cols">
                <ul>
                  <li><a class="navbar-item" href="../2.6/start-using-sdk.html">PHP SDK 2.6</a></li>
                  <li><a class="navbar-item" href="../2.5/start-using-sdk.html">PHP SDK 2.5</a></li>
                  <li><a class="navbar-item" href="../2.4/start-using-sdk.html">PHP SDK 2.4</a></li>
                  <li><a class="navbar-item" href="../2.3/start-using-sdk.html">PHP SDK 2.3</a></li>
                  <li><a class="navbar-item" href="../2.2/start-using-sdk.html">PHP SDK 2.2</a></li>
                </ul>
                <ul class="related">
                  <li><a class="navbar-item" href="../../c-sdk/2.8/manage-beers.html">C SDK</a></li>
                  <li><a class="navbar-item" href="../../dotnet-sdk/2.6/manage-beers.html">.NET SDK</a></li>
                  <li><a class="navbar-item" href="../../go-sdk/1.4/manage-beers.html">Go SDK</a></li>
                  <li><a class="navbar-item" href="../../java-sdk/2.6/manage-beers.html">Java SDK</a></li>
                  <li><a class="navbar-item" href="../../nodejs-sdk/2.5/manage-beers.html">Node.js SDK</a></li>
                  <li><a class="navbar-item" href="../../python-sdk/2.4/manage-beers.html">Python SDK</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <a class="btn red-btn" href="https://www.couchbase.com/downloads">Downloads</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body container">
<nav class="nav">
<div class="nav-menu">
<ul class="nav-list">
  <li class="nav-item is-current-path is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="php-intro.html">PHP SDK 2.0/2.1</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="overview.html">Overview</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="download-links.html">Download and API Reference</a>
    </span>
  </li>
  <li class="nav-item is-current-path is-active" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="getting-started.html">Getting Started</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="hello-couchbase.html">Hello Couchbase Example</a>
    </span>
  </li>
  <li class="nav-item is-current-path is-active" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="tutorial-intro.html">Tutorial</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="prep.html">Preparations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="bootstrapping-app.html">Bootstrapping the application</a>
    </span>
  </li>
  <li class="nav-item is-current-page is-active" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="manage-beers.html">Managing beers</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="tutorial-wrap.html">Wrapping Up</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="managing-connections.html">Managing server connections</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="documents.html">Working with documents</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="op-basics.html">Operation basics</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="storing.html">Creating documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="retrieving.html">Retrieving documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="updating.html">Updating documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="deleting.html">Deleting documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="bulk-operations.html">Bulk operations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="atomic-operations.html">Atomic operations</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="querying.html">Querying buckets</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="view-queries.html">Working with view queries</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="n1ql-queries.html">Working with N1QL queries</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="handling-timeouts.html">Handling timeouts</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="handling-errors.html">Handling errors</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="logging.html">Setting up logging</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="performance-tuning.html">Performance tuning</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="release-notes.html">Release notes</a>
    </span>
  </li>
</ul>
  </li>
</ul>
</div>
</nav>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
<main class="article" data-ceiling="topbar">
  <div class="article-banner">
    <p>A newer version of this documentation is available.</p>
    <a class="btn" href="../2.6/start-using-sdk.html">View Latest</a>
  </div>
  <div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="php-intro.html">PHP SDK</a></li>
    <li class="crumb"><a href="php-intro.html">PHP SDK 2.0/2.1</a></li>
    <li class="crumb"><a href="getting-started.html">Getting Started</a></li>
    <li class="crumb"><a href="tutorial-intro.html">Tutorial</a></li>
    <li class="crumb"><a href="manage-beers.html">Managing beers</a></li>
  </ul>
</nav>
<div class="tools" role="navigation">
  <ul>
    <li class="tool edit"><a href="https://github.com/couchbase/docs-sdk-php/edit/release/2.1/modules/ROOT/pages/manage-beers.adoc" title="Edit Page" target="_blank" rel="noopener">Edit</a></li>
  </ul>
</div>
  </div>
<article class="doc">
<h1 class="page">Managing beers</h1>
<div class="quoteblock abstract">
<blockquote>
First task is to show a list of beers in a table.
</blockquote>
</div>
<div class="paragraph">
<p>The table itself will contain the name of the beer and links to the brewery as well as buttons to edit or delete the beer.
We’ll implement interactive filtering on the table later as well.
The following code should be inserted after the <code>/</code> action to keep everything in order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-markup hljs" data-lang="markup">$app-&gt;get('/beers', function() use ($app, $cb) {
    // Load all beers from the beer/by_name view
    $results = $cb-&gt;query(
        CouchbaseViewQuery::from("beer", "by_name")
            -&gt;limit(INDEX_DISPLAY_LIMIT)
    );

    $beers = array();
    // Iterate over the returned rows
    foreach($results['rows'] as $row) {
        // Load the full document by the ID
        $doc = $cb-&gt;get($row['id']);
        if($doc) {
            // Decode the JSON string into a PHP array
            $doc = json_decode($doc-&gt;value, true);
            $beers[] = array(
                'name' =&gt; $doc['name'],
                'brewery' =&gt; $doc['brewery_id'],
                'id' =&gt; $row['id']
            );
        }

    }

    // Render the template and pass on the beers array
    return $app['twig']-&gt;render('beers/index.twig.html', compact('beers'));
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>We’re making use of our previously defined view <code>beer/by_name</code>.
We also pass in a <code>limit</code> option to make sure we don’t load all documents returned by the view.
The <code>results</code> variable stores the view response and contains the actual data inside the <code>rows</code> element.
We can then iterate over the data set, but since the view only returns the document ID and we need more information, we fetch the full document through the <code>get()</code> method.
If it actually finds a document by the given ID, we convert the JSON string to a PHP array and add it to the list of beers.
The list is then passed on to the template to display it.</p>
</div>
<div class="paragraph">
<p>The corresponding template <code>beers/index.twig.html</code> looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-markup hljs" data-lang="markup">{% extends "layout.twig.html" %}

{% block content %}
&lt;h3&gt;Browse Beers&lt;/h3&gt;

&lt;form class="navbar-search pull-left"&gt;
  &lt;input id="beer-search" type="text" class="search-query" placeholder="Search for Beers"&gt;
&lt;/form&gt;

&lt;table id="beer-table" class="table table-striped"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Name&lt;/th&gt;
      &lt;th&gt;Brewery&lt;/th&gt;
      &lt;th&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      {% for beer in beers %}
        &lt;tr&gt;
          &lt;td&gt;&lt;a href="/beersample-php/beers/show/{{beer.id}}"&gt;{{beer.name}}&lt;/a&gt;&lt;/td&gt;
          &lt;td&gt;&lt;a href="/beersample-php/breweries/show/{{beer.brewery}}"&gt;To Brewery&lt;/a&gt;&lt;/td&gt;
          &lt;td&gt;
            &lt;a class="btn btn-small btn-warning" href="/beersample-php/beers/edit/{{beer.id}}"&gt;Edit&lt;/a&gt;
            &lt;a class="btn btn-small btn-danger" href="/beersample-php/beers/delete/{{beer.id}}"&gt;Delete&lt;/a&gt;
          &lt;/td&gt;
        &lt;/tr&gt;
      {% endfor %}
    &lt;/tbody&gt;
  &lt;/table&gt;
{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Aside from normal HTML table markup, we make use of the <code>{% for beer in beers %}</code> block to loop over the beers array.
We then print out each row and show the name of the beer, the link to the brewery and also buttons to edit and delete the beer.
We’ll implement these methods in a minute.</p>
</div>
<div class="paragraph">
<p>The next action we’re going to implement is the <code>show</code> action.
When you click on a beer, it should display all attributes from the JSON document in a table so we can inspect them properly.
Since everything is stored in one document, we just need to fetch it by the given ID, decode it from the JSON string and pass it on to the view.
Very straightforward and performant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$app-&gt;get('/beers/show/{id}', function($id) use ($app, $cb) {
    // Get the beer by its ID
    $beer = $cb-&gt;get($id);
    if($beer) {
       // If a document was found, decode it
       $beer = json_decode($beer-&gt;value, true);
       $beer['id'] = $id;
    } else {
       // Redirect if no document was found
       return $app-&gt;redirect('/beers');
    }

    // Render the template and pass the beer to it
    return $app['twig']-&gt;render(
        'beers/show.twig.html',
        compact('beer')
    );
});</pre>
</div>
</div>
<div class="paragraph">
<p>The template iterates over the JSON attributes and prints their name and value accordingly.
Note that some documents can contain nested values which is not covered here.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-langugage-markup hljs" data-lang="langugage-markup">{% extends "layout.twig.html" %}

{% block content %}
&lt;h3&gt;Show Details for Beer "{{beer.name}}"&lt;/h3&gt;
&lt;table class="table table-striped"&gt;
    &lt;tbody&gt;
       {% for key,attribute in beer %}
        &lt;c:forEach items="${beer}" var="item"&gt;
            &lt;tr&gt;
                &lt;td&gt;&lt;strong&gt;{{key}}&lt;/strong&gt;&lt;/td&gt;
                &lt;td&gt;{{attribute}}&lt;/td&gt;
            &lt;/tr&gt;
          &lt;/c:forEach&gt;
          {% endfor %}
    &lt;/tbody&gt;
&lt;/table&gt;
{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next action we’re going to implement is the <code>delete</code> action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">$app-&gt;get('/beers/delete/{id}', function($id) use ($app, $cb) {
    // Delete the Document by its ID
    $cb-&gt;delete($id);
    // Redirect to the Index action
    return $app-&gt;redirect('/beersample-php/beers');
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the <code>delete</code> call is very similar to the previous <code>get</code> method.
After the document has been deleted, we redirect to the index action.
If we’d like to, we could get more sophisticated in here.
For example, good practice would be to fetch the document first and check if the document type is <code>beer</code> to make sure only beers are deleted here.
Also, it would be appropriate to return a error message if the document didn’t exist previously.
Note that there is no template needed because we redirect immediately after deleting the document.</p>
</div>
<div class="paragraph">
<p>Since we can now show and delete beers, its about time to make them editable as well.
We now need to implement two different actions here.
One to load the data set and one to actually handle the <code>POST</code> response.
Take note that this demo code is not really suited for production, but it should give you a solid idea on how to implement the basics with Couchbase.
In a production app, you need to add validation here to make sure only valid data is stored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">// Show the beer form
$app-&gt;get('/beers/edit/{id}', function($id) use ($app, $cb) {
    // Fetch the document
    $beer = $cb-&gt;get($id);
    if($beer) {
        // Decode the document
       $beer = json_decode($beer-&gt;value, true);
       $beer['id'] = $id;
    } else {
        // Redirect if no document was found
       return $app-&gt;redirect('/beers');
    }

    // Pass the document on to the template
    return $app['twig']-&gt;render(
        'beers/edit.twig.html',
        compact('beer')
    );
});

// Store submitted Beer Data (POST /beers/edit/&lt;ID&gt;)
$app-&gt;post('/beers/edit/{id}', function(Request $request, $id) use ($app, $cb) {
    // Extract the POST form data out of the request
    $data = $request-&gt;request;

    $newbeer = array();
    // Iterate over the POSTed fields and extract their content.
    foreach($data as $name =&gt; $value) {
        $name = str_replace('beer_', '', $name);
        $newbeer[$name] = $value;
    }

    // Add the type field
    $newbeer['type'] = 'beer';

    // Encode it to a JSON string and save it back
    $cb-&gt;upsert($id, json_encode($newbeer));

    // Redirect to show the beers details
    return $app-&gt;redirect('/beersample-php/beers/show/' . $id);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The missing link between the <code>GET</code> and <code>POST</code> handlers is the form itself.
The template is called <code>edit.twig.html</code> and looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-markup hljs" data-lang="markup">{% extends "layout.twig.html" %}

{% block content %}
&lt;h3&gt;Edit Beer&lt;/h3&gt;

&lt;form method="post" action="/beersample-php/beers/edit/{{beer.id}}"&gt;
    &lt;fieldset&gt;
      &lt;legend&gt;General Info&lt;/legend&gt;
      &lt;div class="span12"&gt;
        &lt;div class="span6"&gt;
          &lt;label&gt;Name&lt;/label&gt;
          &lt;input type="text" name="beer_name" placeholder="The name of the beer." value="{{beer.name}}"&gt;

          &lt;label&gt;Description&lt;/label&gt;
          &lt;input type="text" name="beer_description" placeholder="A short description." value="{{beer.description}}"&gt;
        &lt;/div&gt;
        &lt;div class="span6"&gt;
          &lt;label&gt;Style&lt;/label&gt;
          &lt;input type="text" name="beer_style" placeholder="Bitter? Sweet? Hoppy?" value="{{beer.style}}"&gt;

          &lt;label&gt;Category&lt;/label&gt;
          &lt;input type="text" name="beer_category" placeholder="Ale? Stout? Lager?" value="{{beer.category}}"&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/fieldset&gt;
    &lt;fieldset&gt;
        &lt;legend&gt;Details&lt;/legend&gt;
        &lt;div class="span12"&gt;
            &lt;div class="span6"&gt;
              &lt;label&gt;Alcohol (ABV)&lt;/label&gt;
              &lt;input type="text" name="beer_abv" placeholder="The beer's ABV" value="{{beer.abv}}"&gt;

              &lt;label&gt;Biterness (IBU)&lt;/label&gt;
              &lt;input type="text" name="beer_ibu" placeholder="The beer's IBU" value="{{beer.ibu}}"&gt;
            &lt;/div&gt;
            &lt;div class="span6"&gt;
              &lt;label&gt;Beer Color (SRM)&lt;/label&gt;
              &lt;input type="text" name="beer_srm" placeholder="The beer's SRM" value="{{beer.srm}}"&gt;

              &lt;label&gt;Universal Product Code (UPC)&lt;/label&gt;
              &lt;input type="text" name="beer_upc" placeholder="The beer's UPC" value="{{beer.upc}}"&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/fieldset&gt;
    &lt;fieldset&gt;
        &lt;legend&gt;Brewery&lt;/legend&gt;
        &lt;div class="span12"&gt;
            &lt;div class="span6"&gt;
              &lt;label&gt;Brewery&lt;/label&gt;
              &lt;input type="text" name="beer_brewery_id" placeholder="The brewery" value="{{beer.brewery_id}}"&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/fieldset&gt;
    &lt;div class="form-actions"&gt;
        &lt;button type="submit" class="btn btn-primary"&gt;Save changes&lt;/button&gt;
    &lt;/div&gt;
&lt;/form&gt;
{% endblock %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The only special part in the form are the Twig blocks like <code>{{beer.brewery_id}}</code>.
They allow us to easily include the actual value from the field (when there is one).
You can now change the values in the input fields, hit <code>Save changes</code> and see the updated document either in the web application or through the Couchbase Admin UI.</p>
</div>
<div class="paragraph">
<p>There is one last thing we want to implement here.
You may have noticed that the <code>index</code> page lists all beers but also has a search box on the top.
Currently, it won’t work because the back end is not yet implemented.
The JavaScript is already in place in the <code>assets/js/beersample.js</code> file, so look through it if you are interested.
It just does an AJAX request against the server with the given search value, expects a JSON response and iterates over it while replacing the original table rows with the new ones.</p>
</div>
<div class="paragraph">
<p>We need to implement nearly the same view code as in the <code>index</code> action, but this time we make use of two more view query parameters that allow us to only return the range of documents we need:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">$app-&gt;get('/beers/search', function(Request $request) use ($app, $cb) {
    // Extract the search value
    $input = strtolower($request-&gt;query-&gt;get('value'));

    // Query the view
    $q = CouchbaseViewQuery::from('beer', 'by_name')
        -&gt;limit(INDEX_DISPLAY_LIMIT)
        -&gt;range($input, $input . '\uefff');
    $results = $cb-&gt;query($q);

    $beers = array();
    // Iterate over the resulting rows
    foreach($results['rows'] as $row) {
        // Load the corresponding document
        $doc = $cb-&gt;get($row['id']);
        if($doc) {
            // If the doc is found, decode it.
            $doc = json_decode($doc-&gt;value, true);
            $beers[] = array(
                'name' =&gt; $doc['name'],
                'brewery' =&gt; $doc['brewery_id'],
                'id' =&gt; $row['id']
            );
        }

    }
    // Return a JSON formatted response of all beers for the JavaScript code.
    return $app-&gt;json($beers, 200);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>limit</code> method specifies the maximum number of documents to return.
The <code>range</code> method defines start and end keys for the search.
The special character concatenated to the end key, <code>'\uefff'</code> , means "end." Using this character assures that only documents beginning with the given search string are returned.
This is a little trick that comes in very handy from time to time.</p>
</div>
<div class="paragraph">
<p>The rest is very similar to the <code>index</code> action so we’ll skip the discussion for that.
Also, we don’t need a template here because we can return the JSON response directly.</p>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/logo.svg" alt="Couchbase">
          </a>
        </div>
        <div class="contact">
          <p class="address">2440 West El Camino Real
Mountain View, CA 94040
United States</p>
          <a href="https://www.couchbase.com/contact" class="btn white-btn">Contact Us</a>
          <a class="tel" href="tel:1-650-417-7500">1-650-417-7500</a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Company</span></li>
          <li><a href="https://www.couchbase.com/about">About</a></li>
          <li><a href="https://www.couchbase.com/leadership">Leadership</a></li>
          <li><a href="https://www.couchbase.com/news-and-press-releases">News &amp; Press</a></li>
          <li><a href="https://www.couchbase.com/careers">Careers</a></li>
          <li><a href="https://www.couchbase.com/resources/events">Events</a></li>
          <li><a href="https://www.couchbase.com/contact">Contact Us</a></li>
          <li><a href="https://www.couchbase.com/request-pricing">Pricing</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Support</span></li>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://www.couchbase.com/services">Professional Services</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support Login</a></li>
          <li><a href="https://training.couchbase.com" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Quicklinks</span></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://training.couchbase.com/online" target="_blank" rel="noopener">Online Training</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
          <li><a href="https://www.couchbase.com/nosql-resources/why-nosql">Why NoSQL</a></li>
          <li><a href="https://www.couchbase.com/resources/security">Security</a></li>
          <li><a href="https://www.couchbase.com/resources/gdpr">GDPR</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://plus.google.com/+CouchbaseServer" class="icon">
              <svg width="50px" height="50px" viewBox="36.72 225.573 542.326 343.67"><path d="m209.02 363.05v68.732h93.212c-15.065 44.252-37.662 68.732-93.212 68.732-56.492 0-100.74-46.135-100.74-102.63s44.252-102.63 100.74-102.63c30.129 0 48.96 10.357 66.849 25.422 14.123-14.123 13.182-16.006 48.96-49.902-31.071-28.246-71.557-45.194-115.81-45.194-95.096-0.94-172.3 76.266-172.3 171.36s77.206 172.3 172.3 172.3c142.17 0 177.01-124.28 165.71-206.2-33.896-1e-3 -165.71-1e-3 -165.71-1e-3zm310.71 3.766v-59.317h-42.369v59.317h-61.2v42.369h61.2v61.2h42.369v-61.2h59.317v-42.369h-59.317z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2018 COUCHBASE All rights reserved.</span>
      <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
      <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
      <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
      <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
