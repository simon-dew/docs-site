<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>CRUD Document Operations Using the PHP SDK with Couchbase Server | Couchbase Docs (Staging)</title>
    <link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-4142/php-sdk/2.6/document-operations.html">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="schema.dcterms" href="https://purl.org/dc/terms/">
    <meta name="dcterms.subject" content="php-sdk">
    <meta name="dcterms.identifier" content="2.4">
    <meta name="generator" content="Antora 1.1.1">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" id="topbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://www.couchbase.com"><img src="../../_/img/logo.svg" alt="Couchbase"></a>
        <button class="navbar-burger" data-target="topbar-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="topbar-menu" class="navbar-menu">
        <div class="navbar-start">
          <div class="navbar-item has-dropdown">
            <a class="navbar-link" href="https://simon-dew.github.io/docs-site/DOC-4142">Docs</a>
            <div class="navbar-dropdown explore">
              <div class="title">Couchbase Documentation Overview</div>
              <div class="cols">
                <ul>
                  <li class="heading"><a href="../../server/5.5/introduction/intro.html">Server</a></li>
                  <li><a href="../../server/5.5/n1ql/n1ql-language-reference/index.html">N1QL</a></li>
                  <li><a href="../../server/5.5/fts/full-text-intro.html">Full Text Search</a></li>
                  <li><a href="../../server/5.5/analytics/introduction.html">Analytics <small>(Developer Preview)</small></a></li>
                  <li><a href="../../server/5.5/eventing/eventing-overview.html">Eventing</a></li>
                  <li><a href="#">Autonomous Operator</a></li>
                </ul>
                <ul>
                  <li class="heading">Mobile</li>
                  <li><a href="../../couchbase-lite/2.1/index.html">Lite</a></li>
                  <li><a href="../../sync-gateway/2.1/index.html">Sync Gateway</a></li>
                </ul>
                <ul class="two-cols">
                  <li class="heading"><a href="../../server/5.5/sdk/overview.html">SDKs</a></li>
                  <li><a href="../../c-sdk/2.8/start-using-sdk.html">C</a></li>
                  <li><a href="../../dotnet-sdk/2.6/start-using-sdk.html">.NET</a></li>
                  <li><a href="../../go-sdk/1.4/start-using-sdk.html">Go</a></li>
                  <li><a href="../../java-sdk/2.6/start-using-sdk.html">Java</a></li>
                  <li><a href="../../nodejs-sdk/2.5/start-using-sdk.html">Node.js</a></li>
                  <li><a href="../../php-sdk/2.4/start-using-sdk.html">PHP</a></li>
                  <li><a href="../../python-sdk/2.4/start-using-sdk.html">Python</a></li>
                </ul>
                <ul>
                  <li class="heading"><a href="../../server/5.5/connectors/intro.html">Connectors</a></li>
                  <li><a href="../../elasticsearch-connector/3.0/index.html">Elasticsearch</a></li>
                  <li><a href="../../server/5.5/connectors/hadoop-1.2/hadoop.html">Hadoop</a></li>
                  <li><a href="../../kafka-connector/3.4/index.html">Kafka</a></li>
                  <li><a href="../../spark-connector/2.2/index.html">Spark</a></li>
                  <li><a href="#">Talend</a></li>
                  <li><a href="../../server/5.5/connectors/odbc-jdbc-drivers.html">ODBC/JDBC</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="navbar-item has-dropdown">
            <a class="navbar-link component" href="start-using-sdk.html"><span class="title">PHP SDK</span> <span class="version">2.4</span></a>
            <div class="navbar-dropdown versions">
              <div class="cols">
                <ul>
                  <li><a class="navbar-item" href="../2.6/document-operations.html">PHP SDK 2.6</a></li>
                  <li><a class="navbar-item" href="../2.5/document-operations.html">PHP SDK 2.5</a></li>
                  <li><a class="navbar-item" href="../2.3/document-operations.html">PHP SDK 2.3</a></li>
                  <li><a class="navbar-item" href="../2.2/document-operations.html">PHP SDK 2.2</a></li>
                  <li><a class="navbar-item" href="../2.1/php-intro.html">PHP SDK 2.1</a></li>
                </ul>
                <ul class="related">
                  <li><a class="navbar-item" href="../../c-sdk/2.8/document-operations.html">C SDK</a></li>
                  <li><a class="navbar-item" href="../../dotnet-sdk/2.6/document-operations.html">.NET SDK</a></li>
                  <li><a class="navbar-item" href="../../go-sdk/1.4/document-operations.html">Go SDK</a></li>
                  <li><a class="navbar-item" href="../../java-sdk/2.6/document-operations.html">Java SDK</a></li>
                  <li><a class="navbar-item" href="../../nodejs-sdk/2.5/document-operations.html">Node.js SDK</a></li>
                  <li><a class="navbar-item" href="../../python-sdk/2.4/document-operations.html">Python SDK</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <a class="btn red-btn" href="https://www.couchbase.com/downloads">Downloads</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body container">
<nav class="nav">
<div class="nav-menu">
<ul class="nav-list">
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Hello World!</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="start-using-sdk.html">Start Using the SDK</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="sample-application.html">Sample Application</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="sample-app-backend.html">Sample App Backend</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="webui-cli-access.html">Browser and CLI Access</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Users and Security</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="sdk-authentication-overview.html">Authentication</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="sdk-user-management-overview.html">User Management</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="sdk-user-management-example.html">Sample Code</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="encryption.html">Field Level Encryption</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="encrypting-using-sdk.html">Field Level Encryption from the PHP SDK</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-path is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Working with Data</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="core-operations.html">Core Operations</a>
    </span>
  </li>
  <li class="nav-item is-current-page is-active" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="document-operations.html">Document Operations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="subdocument-operations.html">Sub-Document Operations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="datastructures.html">Data Structures</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="n1ql-query.html">Querying with N1QL</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="n1ql-queries-with-sdk.html">N1QL from the SDKs</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="scan-consistency-examples.html">Using Scan Consistency</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="full-text-search-overview.html">Full Text Search</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="full-text-searching-with-sdk.html">Searching from the SDK</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="view-queries-with-sdk.html">MapReduce Views</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="async-programming.html">Asynchronous Programming</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="batching-operations.html">Batching Operations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="durability.html">Durability</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="concurrent-mutations-cluster.html">Concurrent Document Mutations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="sdk-xattr-overview.html">Extended Attributes</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="sdk-xattr-example.html">Sample Code</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="nonjson.html">Non-JSON Documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="compression-intro.html">Compression</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Deployment Environments</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="managing-connections.html">Managing Connections</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="managing-clusters.html">Managing Clusters</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="compatibility-versions-features.html">Compatibility</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Settings, Error Handling &amp; Diagnostics</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="client-settings.html">Client Settings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="handling-error-conditions.html">Handling Errors</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="failure-considerations.html">Failure Considerations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="collecting-information-and-logging.html">Collecting Information</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="threshold-logging.html">Threshold Logging</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="tracing-from-the-sdk.html">Tracing from the SDK</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Project Docs</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="relnotes-php-sdk.html#version-2-4-7-7-june-2018">Release Notes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="compatibility-versions-features.html">Compatibility</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="sdk-licenses.html">Licenses</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="get-involved.html">Get involved</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="https://docs.couchbase.com/home/contribute/index.html">Improve the Docs</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
</div>
</nav>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
<main class="article" data-ceiling="topbar">
  <div class="article-banner">
    <p>A newer version of this documentation is available.</p>
    <a class="btn" href="../2.6/document-operations.html">View Latest</a>
  </div>
  <div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="start-using-sdk.html">PHP SDK</a></li>
    <li class="crumb">Working with Data</li>
    <li class="crumb"><a href="document-operations.html">Document Operations</a></li>
  </ul>
</nav>
<div class="tools" role="navigation">
  <ul>
    <li class="tool edit"><a href="https://github.com/couchbase/docs-sdk-php/edit/release/2.4/modules/ROOT/pages/document-operations.adoc" title="Edit Page" target="_blank" rel="noopener">Edit</a></li>
  </ul>
</div>
  </div>
<article class="doc">
<h1 class="page">CRUD Document Operations Using the PHP SDK with Couchbase Server</h1>
<div class="sect1">
<h2 id="operationbasics"><a class="anchor" href="#operationbasics"></a>Operation Basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Operations use basic PHP data types and most of the PHP data types that can be serialized via the JSON functions are supported by default.
Recursive structures cannot be serialized.
You may alternatively implement your own transcoders which modify the method by which your documents are serialized to Couchbase.
See <a href="nonjson.html#transcoders" class="page">Transcoders</a> for more details.</p>
</div>
<div class="paragraph">
<p>If an operation is successful, it will return <code class="api">CouchbaseMetaDoc</code> that contains the <code class="var">value</code> of the document (if returned by operation) as well as the <a href="concurrent-mutations-cluster.html" class="page"><code class="var">cas</code></a> value.
If an operation fails, a <code class="api">CouchbaseException</code> is thrown, which may then be caught.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creatingdocuments"><a class="anchor" href="#creatingdocuments"></a>Creating and Updating Full Documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can create documents by using the <code class="api">insert()</code> or <code class="api">upsert()</code> methods and update them using the <code class="api">replace()</code> method.
See <a href="core-operations.html#crud-overview" class="page">Primitive Key-Value Operations</a> for more details.</p>
</div>
<div class="paragraph">
<p>The following example shows how to create a new document with the <code>insert()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">$res = $myBucket-&gt;insert('document_name', array('some'=&gt;'value'));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can specify additional options as a third argument to the <code class="api">insert</code>, <code class="api">upsert</code>, and <code class="api">replace</code> functions.
The options are specified as an associative array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">$bucket-&gt;upsert($key, $doc, array("expiry" =&gt; 300));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Allowed options are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="param">cas</code>: The CAS value for the document.
If the CAS on the server does not match the CAS supplied to the method, the operation will fail with a <code class="api">CouchbaseException</code> with a code of <code class="api">COUCHBASE_KEY_EEXISTS</code> error.
See <a href="concurrent-mutations-cluster.html" class="page">Concurrent Document Mutations</a> for more information on using the CAS values.
Keep in mind that this case applies only to <code class="api">replace()</code></p>
</li>
<li>
<p><code class="param">expiry</code>: Specifies the expiry time for the document.
If specified, the document will expire and no longer exist after the given number of seconds.
See <a href="core-operations.html#expiry" class="page">Expiration Overview</a> for more information.</p>
</li>
<li>
<p><code class="param">persist_to</code>, <code class="param">replicate_to</code>: Specifies <a href="durability.html" class="page">durability requirements</a> for the operations.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="retrieving-documents"><a class="anchor" href="#retrieving-documents"></a>Retrieving Documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can retrieve documents by using the <code>get()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">var_dump($bucket-&gt;get("new_document"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sample output from the example is as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>object(CouchbaseMetaDoc)#6 (4) {
  ["error"]=&gt;
  NULL
  ["value"]=&gt;
  object(stdClass)#5 (1) {
    ["foo"]=&gt;
    string(3) "bar"
  }
  ["flags"]=&gt;
  int(33554438)
  ["cas"]=&gt;
  string(9) "eh5m98g0k"
}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="api">get()</code> method returns a <code class="api">CouchbaseMetaDoc</code> object.
To get the actual value, use the object&#8217;s <code class="api">value</code> property.
The <a href="concurrent-mutations-cluster.html" class="page">CAS value</a> is encoded as a string and accessible through <code class="api">cas</code> property.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Items stored as associative arrays (such as <code>$bucket-&gt;upsert(docid, array("prop1" =&gt; "value1"))</code> are retrieved as PHP <code class="api">stdObject</code> objects; you must reference fields using <code>$result-&gt;value-&gt;property</code> rather than <code>$result-&gt;value["property"]</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In some instances you may wish to read from a replica node when the <a href="failure-considerations.html" class="page">active node is unavailable</a>.
This can be done using the <code class="api">getFromReplica()</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="removing-documents"><a class="anchor" href="#removing-documents"></a>Removing Documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can delete documents by using the <code class="api">remove()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">$bucket-&gt;remove('document_name');</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may pass a second argument containing options to the <code class="api">remove()</code> method.
This is passed as an array with the option name as the key and the option value as the array value.
Recognized options are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="param">cas</code>: Specify the <a href="concurrent-mutations-cluster.html" class="page">CAS value</a> to use.
This will ensure that the document is not removed if the CAS value differs.
You may obtain the CAS value from <code class="api">CouchbaseMetaDoc::cas</code>, as a return value of a successful operation.</p>
</li>
<li>
<p><code class="param">persist_to</code>, <code class="param">replicate_to</code>: Specify <a href="durability.html" class="page">durability requirements</a>.
In this case, the SDK will check that the items have been properly <em>deleted</em> from the replicas.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="modifying-the-expiration"><a class="anchor" href="#modifying-the-expiration"></a>Modifying the Expiration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Setting <a href="core-operations.html#expiry" class="page">Document expiration</a> can be performed using the <code class="api">touch()</code> and <code class="api">getAndTouch</code> methods.
These methods accept an expiry value as their second parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">$cb-&gt;upsert('expires', "i'm getting old...", array("expiry" =&gt; 5));
sleep(6)
$cb-&gt;get('expires');</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>PHP Fatal error:  Uncaught exception 'CouchbaseException' with message 'LCB_KEY_ENOENT: The key does not exist on the server' in [CouchbaseNative]/CouchbaseBucket.class.php:196
Stack trace:
#0 [CouchbaseNative]/CouchbaseBucket.class.php(196): _CouchbaseBucket-&gt;get('expires', Array)
#1 /private/tmp/dummy.php(7): CouchbaseBucket-&gt;get('expires')
#2 {main}
  thrown in [CouchbaseNative]/CouchbaseBucket.class.php on line 196</pre>
</div>
</div>
<div class="paragraph">
<p>Document expiration can also be set using the <code class="api">upsert</code> family of methods which accept an optional <code class="param">expiry</code> key in their options arrays.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="batching"><a class="anchor" href="#batching"></a>Batching Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="batching-operations.html" class="page">Bulk operations</a> may help you perform operations more efficiently and quicker by optimizing how commands are sent on the network.</p>
</div>
<div class="paragraph">
<p>Bulk operations may be performed by passing an array as the first argument to one of the <code class="api">get()</code>, <code class="api">upsert()</code>, <code class="api">insert()</code>, <code class="api">replace()</code> and other key-value methods.</p>
</div>
<div class="paragraph">
<p>When these methods are passed an array as input, they return an array as output, with the array containing document IDs as its keys and their respective <code class="api">CouchbaseMetaDoc</code> objects as values.</p>
</div>
<div class="paragraph">
<p>This method works identically to its singular counterpart but instead accepts an array of keys to retrieve and returns an object where the object key matches your document ID and the object value is the result that you would normally expect to see from a singular operation.</p>
</div>
<div class="paragraph">
<p>For the <code class="api">upsert()</code> family of methods, the top-level array value is a container for <em>options</em>.
The most important option is <code class="param">value</code> which contains the actual value to be used as the document.</p>
</div>
<div class="paragraph">
<p>The following example shows how to insert and retrieve multiple documents.
The structure of each document is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "email": &lt;....&gt;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Storing multiple documents</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">$results = $bucket-&gt;upsert(array(
    'foo' =&gt; array('value' =&gt; array('email' =&gt; 'foo@foo.com')),
    'bar' =&gt; array('value' =&gt; array('email' =&gt; 'bar@bar.com')),
    'baz' =&gt; array('value' =&gt; array('email' =&gt; 'baz@baz.com'))
    ));
foreach ($results as $docid =&gt; $metadoc) {
    echo("$docid =&gt; $metadoc-&gt;cas\n");
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">Output</div>
<div class="content">
<pre>foo =&gt; 2gywu3yq6s
bar =&gt; 2hcxy0srv8
baz =&gt; 2hcxy0srv8</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Retrieving multiple documents</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">$results = $bucket-&gt;upsert(array("foo", "bar", "baz"));
    foreach ($results as $docid =&gt; $metadoc) {
    // Each document itself has a 'propname'
    echo "Result for $docid\n";
    var_dump($metadoc-&gt;value);
    echo "\n";
}</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">Output</div>
<div class="content">
<pre>Result for foo
object(stdClass)#7 (1) {
  ["email"]=&gt;
  string(11) "foo@foo.com"
}

Result for bar
object(stdClass)#9 (1) {
  ["email"]=&gt;
  string(11) "bar@bar.com"
}

Result for baz
object(stdClass)#11 (1) {
  ["email"]=&gt;
  string(11) "baz@baz.com"
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="atomic-operations"><a class="anchor" href="#atomic-operations"></a>Atomic Operations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The PHP Couchbase SDK supports several operations that allow one-step, atomic changes to documents.
These operations include <code class="api">counter</code>, <code class="api">prepend</code>, and <code class="api">append</code> functions.</p>
</div>
<div class="paragraph">
<p>The <code class="api">counter()</code> method enables you to use an <a href="core-operations.html#devguide_kvcore_counter_generic" class="page">atomic counter</a>.
The first argument is the document ID, and the second argument is the <em>delta</em> indicating by what amount the counter should be changed.
You may also pass an array of options as the third argument:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code class="param">initial</code>: Initialize the counter to this value if the counter does not yet exist</p>
</li>
<li>
<p><code class="param">expiry</code>: Set the <a href="core-operations.html#expiry" class="page">document expiration</a> time</p>
</li>
<li>
<p><code class="param">persist_to</code>, <code class="param">replicate_to</code>: Specify <a href="durability.html" class="page">durability requirements</a></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">$result = $bucket-&gt;counter('counterId', 50, array('initial' =&gt; 100));
echo 'Current counter value is ' . $result-&gt;value . "\n";</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="core-operations.html#devguide_kvcore_append_prepend_generic" class="page">Atomic byte concatenations</a> can be performed using the <code class="api">append()</code> and <code class="api">prepend()</code> methods.
These operations are potentially destructive.
Refer to the API documentation for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="operating-with-sub-documents"><a class="anchor" href="#operating-with-sub-documents"></a>Operating with sub-documents</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Sub-Document API is available starting Couchbase Server version 4.5.
See <a href="subdocument-operations.html" class="page">Sub-Document Operations</a> for an overview.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sub-document operations save network bandwidth by allowing you to specify <em>paths</em> of a document to be retrieved or updated.
The document is parsed on the server and only the relevant sections (indicated by <em>paths</em>) are transferred between client and server.
You can execute <a href="subdocument-operations.html" class="page">sub-document</a> operations in the PHP SDK using the <code class="api">retrieveIn</code>, <code class="api">lookupIn</code>, and <code class="api">mutateIn</code> methods.</p>
</div>
<div class="paragraph">
<p>Each of these methods accepts an <code class="param">id</code> as its mandatory first argument and return builders <code class="api">CouchbaseLookupInBuilder</code> and <code class="api">CouchbaseMutateInBuilder</code></p>
</div>
<div class="paragraph">
<p>The builders have API to accumulate <em>command specifications</em> and run the full pipeline by the <code class="api">execute()</code> call.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">$res = $bucket-&gt;lookupIn('docid')
              -&gt;get('path.to.get')
              -&gt;exists('check.path.exists')
              -&gt;execute();

$res = $bucket-&gt;mutateIn('docid')
              -&gt;upsert('path.to.upsert', $value, true)
              -&gt;remove('path.to.del')
              -&gt;execute();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For simply retrieving a list of paths, you may use the <code class="api">retrieveIn</code> convenience method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">$res = $bucket-&gt;retrieveIn('docid', 'path1', 'path2', 'path3')</code></pre>
</div>
</div>
<div class="paragraph">
<p>All sub-document operations return a special <code class="api">CouchbaseDocumentFragment</code> object.
In contrast with a normal <code class="api">CouchbaseMetaDoc</code> object, a <code class="api">CouchbaseDocumentFragment</code> object contains multiple results with multiple statuses, one result/status pair for every input operation.
You can access an individual result/status pair by addressing the <code class="var">value</code> of <code class="api">CouchbaseDocumentFragment</code> object as a mapping, and then using index position of the operation as the key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">$res = $bucket-&gt;lookupIn('docid')
              -&gt;get('foo')
              -&gt;exists('bar')
              -&gt;exists('baz')
              -&gt;execute();

# First result
$res-&gt;value[0]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="non-json-documents-and-transcoders"><a class="anchor" href="#non-json-documents-and-transcoders"></a>Non-JSON Documents and Transcoders</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See <a href="nonjson.html" class="page">Non-JSON Documents</a> for a general overview of using non-JSON documents with Couchbase
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All PHP objects which can be represented as JSON may be passed unmodified to a storage function, and be received via the get method without any additional modifications, with only note that by default JSON encoder configured to produce <code class="api">stdClass</code> instances instead of arrays.
This behavior can be changed by modifying <code class="api">$COUCHBASE_DEFAULT_DECOPTS</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">echo("default JSON decoder options: ");
var_dump($COUCHBASE_DEFAULT_DECOPTS);

$res = $bucket-&gt;get('foo');
var_dump($res-&gt;value);

echo("setting 'jsonassoc' to true\n");
$COUCHBASE_DEFAULT_DECOPTS['jsonassoc'] = true;

$res = $bucket-&gt;get('foo');
var_dump($res-&gt;value);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>default JSON decoder options: array(1) {
  ["jsonassoc"]=&gt;
  bool(false)
}
object(stdClass)#4 (1) {
  ["email"]=&gt;
  string(11) "foo@foo.com"
}
setting 'jsonassoc' to true
array(1) {
  ["email"]=&gt;
  string(11) "foo@foo.com"
}</pre>
</div>
</div>
<div class="paragraph">
<p>You can modify the default JSON encoders used by the PHP SDK using the <code class="api">setTranscoders</code> function.
This function accepts a pair of encode and decode functions which are expected transform the raw document depending on the document flags.</p>
</div>
<div class="paragraph">
<p>The following is an example of a transcoder which will unconditionally transcode all documents as UTF-8 encoded JSON documents.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">$bucket-&gt;setTranscoders(
  function($value) {
    return array(json_encode($value), 0, 0);
  },
  function($value, $flags, $datatype) {
    return json_decode($value, true);
  }
);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To make migration from 1.x SDK easier, use the JSON serializer.
You may do this with settings in <code>php.ini</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ini hljs" data-lang="ini">; make sure that the JSON extension is loaded before couchbase
extension=json.so
extension=couchbase.so
; select default serializer
couchbase.serializer = json</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, the serializer may be selected programmatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-php hljs" data-lang="php">$bucket = new Couchbase("localhost:8091", "", "", "default");
$bucket-&gt;setOption(COUCHBASE::OPT_SERIALIZER, COUCHBASE::SERIALIZER_JSON);</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/logo.svg" alt="Couchbase">
          </a>
        </div>
        <div class="contact">
          <p class="address">2440 West El Camino Real
Mountain View, CA 94040
United States</p>
          <a href="https://www.couchbase.com/contact" class="btn white-btn">Contact Us</a>
          <a class="tel" href="tel:1-650-417-7500">1-650-417-7500</a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Company</span></li>
          <li><a href="https://www.couchbase.com/about">About</a></li>
          <li><a href="https://www.couchbase.com/leadership">Leadership</a></li>
          <li><a href="https://www.couchbase.com/news-and-press-releases">News &amp; Press</a></li>
          <li><a href="https://www.couchbase.com/careers">Careers</a></li>
          <li><a href="https://www.couchbase.com/resources/events">Events</a></li>
          <li><a href="https://www.couchbase.com/contact">Contact Us</a></li>
          <li><a href="https://www.couchbase.com/request-pricing">Pricing</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Support</span></li>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://www.couchbase.com/services">Professional Services</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support Login</a></li>
          <li><a href="https://training.couchbase.com" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Quicklinks</span></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://training.couchbase.com/online" target="_blank" rel="noopener">Online Training</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
          <li><a href="https://www.couchbase.com/nosql-resources/why-nosql">Why NoSQL</a></li>
          <li><a href="https://www.couchbase.com/resources/security">Security</a></li>
          <li><a href="https://www.couchbase.com/resources/gdpr">GDPR</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://plus.google.com/+CouchbaseServer" class="icon">
              <svg width="50px" height="50px" viewBox="36.72 225.573 542.326 343.67"><path d="m209.02 363.05v68.732h93.212c-15.065 44.252-37.662 68.732-93.212 68.732-56.492 0-100.74-46.135-100.74-102.63s44.252-102.63 100.74-102.63c30.129 0 48.96 10.357 66.849 25.422 14.123-14.123 13.182-16.006 48.96-49.902-31.071-28.246-71.557-45.194-115.81-45.194-95.096-0.94-172.3 76.266-172.3 171.36s77.206 172.3 172.3 172.3c142.17 0 177.01-124.28 165.71-206.2-33.896-1e-3 -165.71-1e-3 -165.71-1e-3zm310.71 3.766v-59.317h-42.369v59.317h-61.2v42.369h61.2v61.2h42.369v-61.2h59.317v-42.369h-59.317z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2018 COUCHBASE All rights reserved.</span>
      <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
      <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
      <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
      <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
