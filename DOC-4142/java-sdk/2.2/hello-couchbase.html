<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Hello Couchbase Example | Couchbase Docs (Staging)</title>
    <link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-4142/java-sdk/2.7/start-using-sdk.html">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="schema.dcterms" href="https://purl.org/dc/terms/">
    <meta name="dcterms.subject" content="java-sdk">
    <meta name="dcterms.identifier" content="2.2">
    <meta name="generator" content="Antora 1.1.1">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" id="topbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://www.couchbase.com"><img src="../../_/img/logo.svg" alt="Couchbase"></a>
        <button class="navbar-burger" data-target="topbar-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="topbar-menu" class="navbar-menu">
        <div class="navbar-start">
          <div class="navbar-item has-dropdown">
            <a class="navbar-link" href="https://simon-dew.github.io/docs-site/DOC-4142">Docs</a>
            <div class="navbar-dropdown explore">
              <div class="title">Couchbase Documentation Overview</div>
              <div class="cols">
                <ul>
                  <li class="heading"><a href="../../server/5.5/introduction/intro.html">Server</a></li>
                  <li><a href="../../server/5.5/n1ql/n1ql-language-reference/index.html">N1QL</a></li>
                  <li><a href="../../server/5.5/fts/full-text-intro.html">Full Text Search</a></li>
                  <li><a href="../../server/5.5/analytics/introduction.html">Analytics <small>(Developer Preview)</small></a></li>
                  <li><a href="../../server/5.5/eventing/eventing-overview.html">Eventing</a></li>
                  <li><a href="../../operator/1.1/overview.html">Autonomous Operator</a></li>
                </ul>
                <ul>
                  <li class="heading">Mobile</li>
                  <li><a href="../../couchbase-lite/2.1/index.html">Lite</a></li>
                  <li><a href="../../sync-gateway/2.1/index.html">Sync Gateway</a></li>
                </ul>
                <ul class="two-cols">
                  <li class="heading"><a href="../../server/5.5/sdk/overview.html">SDKs</a></li>
                  <li><a href="../../c-sdk/2.8/start-using-sdk.html">C</a></li>
                  <li><a href="../../dotnet-sdk/2.6/start-using-sdk.html">.NET</a></li>
                  <li><a href="../../go-sdk/1.4/start-using-sdk.html">Go</a></li>
                  <li><a href="../../java-sdk/2.6/start-using-sdk.html">Java</a></li>
                  <li><a href="../../nodejs-sdk/2.5/start-using-sdk.html">Node.js</a></li>
                  <li><a href="../../php-sdk/2.4/start-using-sdk.html">PHP</a></li>
                  <li><a href="../../python-sdk/2.4/start-using-sdk.html">Python</a></li>
                </ul>
                <ul>
                  <li class="heading"><a href="../../server/5.5/connectors/intro.html">Connectors</a></li>
                  <li><a href="../../elasticsearch-connector/3.0/index.html">Elasticsearch</a></li>
                  <li><a href="../../server/5.5/connectors/hadoop-1.2/hadoop.html">Hadoop</a></li>
                  <li><a href="../../kafka-connector/3.4/index.html">Kafka</a></li>
                  <li><a href="../../spark-connector/2.2/index.html">Spark</a></li>
                  <li><a href="../../talend-connector/index.html">Talend</a></li>
                  <li><a href="../../server/5.5/connectors/odbc-jdbc-drivers.html">ODBC/JDBC</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="navbar-item has-dropdown">
            <a class="navbar-link component" href="java-intro.html"><span class="title">Java SDK</span> <span class="version">2.2</span></a>
            <div class="navbar-dropdown versions">
              <div class="cols">
                <ul>
                  <li><a class="navbar-item" href="../2.7/start-using-sdk.html">Java SDK 2.7</a></li>
                  <li><a class="navbar-item" href="../2.6/start-using-sdk.html">Java SDK 2.6</a></li>
                  <li><a class="navbar-item" href="../2.5/start-using-sdk.html">Java SDK 2.5</a></li>
                  <li><a class="navbar-item" href="../2.4/start-using-sdk.html">Java SDK 2.4</a></li>
                  <li><a class="navbar-item" href="../2.3/start-using-sdk.html">Java SDK 2.3</a></li>
                  <li><a class="navbar-item" href="../2.1/hello-couchbase.html">Java SDK 2.1</a></li>
                </ul>
                <ul class="related">
                  <li><a class="navbar-item" href="../../c-sdk/2.8/hello-couchbase.html">C SDK</a></li>
                  <li><a class="navbar-item" href="../../dotnet-sdk/2.6/hello-couchbase.html">.NET SDK</a></li>
                  <li><a class="navbar-item" href="../../go-sdk/1.4/hello-couchbase.html">Go SDK</a></li>
                  <li><a class="navbar-item" href="../../nodejs-sdk/2.5/hello-couchbase.html">Node.js SDK</a></li>
                  <li><a class="navbar-item" href="../../php-sdk/2.4/hello-couchbase.html">PHP SDK</a></li>
                  <li><a class="navbar-item" href="../../python-sdk/2.4/hello-couchbase.html">Python SDK</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <a class="btn red-btn" href="https://www.couchbase.com/downloads">Downloads</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body container">
<nav class="nav">
<div class="nav-menu">
<ul class="nav-list">
  <li class="nav-item is-current-path is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="java-intro.html">Java SDK 2.2</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="overview.html">Overview</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="download-links.html">Download and API reference</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="migrate.html">Migrating from Java SDK 1.4.x to 2.x</a>
    </span>
  </li>
  <li class="nav-item is-current-path is-active" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="getting-started.html">Getting started with the Java SDK</a>
    </span>
<ul class="nav-list">
  <li class="nav-item is-current-page is-active" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="hello-couchbase.html">Hello Couchbase Example</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="tutorial4.html">Java SDK tutorial</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="managing-connections.html">Managing connections</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="managing-cluster.html">Managing clusters</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="env-config.html">Configuring the environment</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="documents.html">Working with documents</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="documents-basics.html">Document basics</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="documents-creating.html">Creating documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="documents-updating.html">Updating documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="documents-retrieving.html">Retrieving documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="documents-deleting.html">Deleting documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="documents-atomic.html">Atomic operations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="documents-bulk.html">Bulk operations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="durability.html">Durability requirements</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="querying.html">Querying buckets</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="managing-views.html">Managing views</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="querying-views.html">Working with views</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="querying-n1ql.html">Working with N1QL</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="rxjava.html">RxJava and reactive programming</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="observables.html">Mastering Observables</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="reactive-apps.html">Writing resilient reactive applications</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="event-bus-metrics.html">Production considerations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="logging.html">Setting up logging</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="release-notes.html">Release notes</a>
    </span>
  </li>
</ul>
  </li>
</ul>
</div>
</nav>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
<main class="article" data-ceiling="topbar">
  <div class="article-banner">
    <p>A newer version of this documentation is available.</p>
    <a class="btn" href="../2.7/start-using-sdk.html">View Latest</a>
  </div>
  <div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="java-intro.html">Java SDK</a></li>
    <li class="crumb"><a href="java-intro.html">Java SDK 2.2</a></li>
    <li class="crumb"><a href="getting-started.html">Getting started with the Java SDK</a></li>
    <li class="crumb"><a href="hello-couchbase.html">Hello Couchbase Example</a></li>
  </ul>
</nav>
<div class="tools" role="navigation">
  <ul>
    <li class="tool edit"><a href="https://github.com/couchbase/docs-sdk-java/edit/release/2.2/modules/ROOT/pages/hello-couchbase.adoc" title="Edit Page" target="_blank" rel="noopener">Edit</a></li>
  </ul>
</div>
  </div>
<article class="doc">
<h1 class="page">Hello Couchbase Example</h1>
<div class="quoteblock abstract">
<blockquote>
Now that you added the SDK dependency to your project, you can proceed and implement the classic "Hello World" example.
</blockquote>
</div>
<div class="paragraph">
<p>Some important aspects are also covered along the way that will help you later.</p>
</div>
<div class="paragraph">
<p>The first thing you need to do is connect to the cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Cluster cluster = CouchbaseCluster.create();</code></pre>
</div>
</div>
<div class="paragraph">
<p>With no other arguments provided, this connection will logically bind to a cluster where the cluster is reachable on <code>localhost</code>.
This type of connection is a reasonable default to get started during development, but in production you should pass in more seed nodes like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Cluster cluster = CouchbaseCluster.create("192.168.56.101", "192.168.56.102");</code></pre>
</div>
</div>
<div class="paragraph">
<p>You do not need to pass in all nodes of the cluster, just a few seed nodes so that the client can establish the initial contact.
The actual process of connecting to a bucket (that is, opening sockets and everything related) happens when you call the <code>openBucket</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Bucket bucket = cluster.openBucket();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will connect to the <code>default</code> bucket and return a <code>Bucket</code> reference.</p>
</div>
<div class="paragraph">
<p>If you want to connect to a different bucket (also with a password), you can do it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Bucket bucket = cluster.openBucket("bucket", "password");</code></pre>
</div>
</div>
<div class="paragraph">
<p>When your application shuts down, you need to make sure to disconnect properly from the cluster to free all resources (sockets, threads, and so on).
The following code shuts down the client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">cluster.disconnect();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This disconnects all buckets and makes the associated resources available.</p>
</div>
<div class="paragraph">
<p>You now have a reference to the <code>Bucket</code>, so you can begin working with it.
The SDK comes with built-in handling for JSON documents, which you can use right away.
First, create a <code>JsonObject</code>, which contains information for a user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">JsonObject user = JsonObject.empty()
    .put("firstname", "Walter")
    .put("lastname", "White")
    .put("job", "chemistry teacher")
    .put("age", 50);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>JsonObject</code> works very much like a <code>Map</code>, but it is designed to only let you insert values that can be stored as valid JSON (including nested objects and arrays).
The resulting document looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "firstname":"Walter",
    "job":"chemistry teacher",
    "age":50,
    "lastname":"White"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To store the document, you can use the <code>upsert</code> method on the <code>bucket</code>.
Because a document on the server has more properties than just the content, you need to give it at least a unique document ID (for example, <code>walter</code>).
The container for all this information is called a <code>Document</code> and because you are dealing with JSON you need to create a <code>JsonDocument</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">JsonDocument doc = JsonDocument.create("walter", user);
JsonDocument response = bucket.upsert(doc);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Document</code> is automatically converted into JSON and stored on the cluster.
If the document (identified by its unique ID) already exists, it is replaced.</p>
</div>
<div class="paragraph">
<p>If you replace <code>upsert</code> with <code>insert</code> and try to insert the same document twice (with the same ID), you see the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Exception in thread "main" com.couchbase.client.java.error.DocumentAlreadyExistsException
    at com.couchbase.client.java.CouchbaseAsyncBucket$12.call(CouchbaseAsyncBucket.java:425)
    at com.couchbase.client.java.CouchbaseAsyncBucket$12.call(CouchbaseAsyncBucket.java:409)
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This provides an important clue:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>insert</code>, unlike <code>upsert</code> fails if the document already exists on the server (very much like the SQL <code>INSERT</code> statement).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Not surprisingly, you can also retrieve a <code>Document</code> from the database.
You do this by providing its ID:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">JsonDocument walter = bucket.get("walter");
System.out.println("Found: " + walter);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This prints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Found: JsonDocument{id='walter', cas=16976883046781, expiry=0, content={"firstname":"Walter","job":"chemistry teacher","age":50,"lastname":"White"}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to print only the age, you can reach into the content (much like you would access a <code>Map</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">System.out.println("Age: " + walter.content().getInt("age"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can combine both commands to implement something that is needed very often: loading a document, modifying its content and then storing the modified document.</p>
</div>
<div class="paragraph">
<p>First, here is one of the possible way to do it synchronously:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">JsonDocument loaded = bucket.get("walter");
if (loaded == null) {
    System.err.println("Document not found!");
} else {
    loaded.content().put("age", 52);
    JsonDocument updated = bucket.replace(loaded);
    System.out.println("Updated: " + updated.id());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code uses the <code>get</code> method to load the <code>Document</code> and then waits until it arrives from the server (returns <code>null</code> as the default value if it does not exist).
If it is not null, the content is modified and the document is stored again through the synchronous <code>replace</code> method.
You can think of <code>replace</code> as the opposite of <code>insert</code>—if the document does not already exist, the call will fail with a <code>DocumentDoesNotExistException</code>.</p>
</div>
<div class="paragraph">
<p>The code shown above is completely synchronous, which means that your main thread will wait all the time until a response comes back from the server.
It waits for network IO to happen while instead it could perform valuable work.
Instead of waiting and "pulling" the data out of the SDK, you can just keep going forward in your application flow and let the SDK notify you once it&#8217;s done with work.</p>
</div>
<div class="paragraph">
<p><code>Observable</code>s provide a large range of methods and functionality to create, combine and transform asynchronous workflows and make them look synchronous (while they aren&#8217;t).
Other approaches quickly get you into "callback hell" and are complicated dealing with futures, especially if you want to chain more than one asynchronous operation together, let alone proper error handling.</p>
</div>
<div class="paragraph">
<p>Here is the very same example, but completely non-blocking (note that you want to keep your main thread alive with a <code>Thread.sleep()</code> for now or use <code>CountDownLatch</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">bucket
    .async()
    .get("walter")
    .flatMap(new Func1&lt;JsonDocument, Observable&lt;JsonDocument&gt;&gt;() {
        @Override
        public Observable&lt;JsonDocument&gt; call(final JsonDocument loaded) {
            loaded.content().put("age", 52);
            return bucket.async().replace(loaded);
        }
    })
    .subscribe(new Action1&lt;JsonDocument&gt;() {
        @Override
        public void call(final JsonDocument updated) {
            System.out.println("Updated: " + updated.id());
        }
    });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how you can get access to the underlying asynchronous interfaces by using the <code>async()</code> method on the bucket.</p>
</div>
<div class="paragraph">
<p>Without going too much in-depth about how <code>Observables</code> work just yet, it is not too hard to guess what is happening.
The document is loaded through the <code>get</code> method, and after it is done, the <code>flatMap</code> method is executed.
This method changes the content and calls the <code>replace</code> method.
After the replace is done, the <code>Subscriber</code> is called, and the line is printed.
You do not need to check for <code>null</code> here because the whole chain is just not executed if the document is not found in the first place.</p>
</div>
<div class="paragraph">
<p>The style shown above is Java6/7 with anonymous classes.
If you are already using Java 8, you can replace the same code with lambdas to make it much nicer and succinct:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">bucket
    .async()
    .get("walter")
    .flatMap(loaded -&gt; {
        loaded.content().put("age", 52);
        return bucket.async().replace(loaded);
    })
    .subscribe(updated -&gt; System.out.println("Updated: " + updated.id()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because this flow is asynchronous, every "callback" is run in a specific thread, different from the one you were executing the call (at this point most likely <code>main</code>).
Since this one-off example is different from long-running server applications (which are not shut down after one operation), it is a good idea to synchronize and wait after the last operation is finished.</p>
</div>
<div class="paragraph">
<p>A naive way is to add a <code>Thread.sleep(1000)</code> after the last call to keep the current thread alive for a second and hope that the operation is done:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">bucket
    .async()
    .get("walter")
    .flatMap(loaded -&gt; {
        loaded.content().put("age", 52);
        return bucket.async().replace(loaded);
    })
    .subscribe(updated -&gt; System.out.println("Updated: " + updated.id()));

Thread.sleep(1000);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually, it takes a shorter amount of time, so you are just wasting time.
And in the unlikely case that it takes longer, it doesn&#8217;t work properly.
So a better way is the use of a <code>CountDownLatch</code>, which ships with the JDK.
One thread counts it down and the other waits until its counted down:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">final CountDownLatch latch = new CountDownLatch(1);
bucket
    .async()
    .get("walter")
    .flatMap(loaded -&gt; {
        loaded.content().put("age", 52);
        return bucket.async().replace(loaded);
    })
    .subscribe(
        System.out::println,
        err -&gt; {
            err.printStackTrace();
            latch.countDown();
        },
        latch::countDown
    );

latch.await();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example shows a better, if not a perfect solution.
Because your subscriber (the callbacks) is called from a different thread, without more changes on your side, you do not have access to either the computed values or the error that is thrown.
You can work around that by using atomic variables from the concurrent package, but thankfully RxJava has you covered as well.
You can use the <code>toBlocking</code> methods, which will return you the result(s) in a blocking fashion, as well as propagate any errors of the flow as exceptions to your calling thread:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">JsonDocument result = bucket
    .async()
    .get("walter")
    .flatMap(loaded -&gt; {
        loaded.content().put("age", 52);
        return bucket.async().replace(loaded);
    })
    .toBlocking()
    .single();</code></pre>
</div>
</div>
<div class="paragraph">
<p>So remember that instead of using latches, always use <code>toBlocking</code> and its different ways to extract the data.
You can learn more about that in <a href="observables.html" class="page">Mastering Observables</a>.</p>
</div>
<div class="paragraph">
<p>In <code>Couchbase 4.0</code>, a new query language has been introduced: N1QL.
Since it is a superset of SQL, we can write a Hello World example using N1QL.
Make sure to have the query service activated in your cluster and a primary index created on your bucket.
See <a href="#">4.1@server:developer-guide:querying.adoc</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">String statement = "SELECT firstname FROM `default` WHERE age BETWEEN 49 AND 59";
N1qlQuery query = N1qlQuery.simple(statement);
N1qlQueryResult result = bucket.query(query);
System.out.println("Hello, users in their fifties: ");
for (N1qlQueryRow row : result)
{ String firstName = row.value().getString("firstname"); System.out.println(firstName + "!"); }
//prints:
// "Hello, users in their fifties:
// Walter!"</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the statement, you can alternatively use the DSL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Statement statement = Select.select(x("firstname")).from(i("default"))
	.where(x("age").between(49).and(59));
N1qlQuery query = N1qlQuery.simple(statement);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Congratulations, you&#8217;ve completed your first steps towards Couchbase mastery!
At this point, you can either proceed with the complete tutorial application or browse through the rest of the documentation as you see fit.</p>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/logo.svg" alt="Couchbase">
          </a>
        </div>
        <div class="contact">
          <p class="address">2440 West El Camino Real
Mountain View, CA 94040
United States</p>
          <a href="https://www.couchbase.com/contact" class="btn white-btn">Contact Us</a>
          <a class="tel" href="tel:1-650-417-7500">1-650-417-7500</a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Company</span></li>
          <li><a href="https://www.couchbase.com/about">About</a></li>
          <li><a href="https://www.couchbase.com/leadership">Leadership</a></li>
          <li><a href="https://www.couchbase.com/news-and-press-releases">News &amp; Press</a></li>
          <li><a href="https://www.couchbase.com/careers">Careers</a></li>
          <li><a href="https://www.couchbase.com/resources/events">Events</a></li>
          <li><a href="https://www.couchbase.com/contact">Contact Us</a></li>
          <li><a href="https://www.couchbase.com/request-pricing">Pricing</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Support</span></li>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://www.couchbase.com/services">Professional Services</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support Login</a></li>
          <li><a href="https://training.couchbase.com" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Quicklinks</span></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://training.couchbase.com/online" target="_blank" rel="noopener">Online Training</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
          <li><a href="https://www.couchbase.com/nosql-resources/why-nosql">Why NoSQL</a></li>
          <li><a href="https://www.couchbase.com/resources/security">Security</a></li>
          <li><a href="https://www.couchbase.com/resources/gdpr">GDPR</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://plus.google.com/+CouchbaseServer" class="icon">
              <svg width="50px" height="50px" viewBox="36.72 225.573 542.326 343.67"><path d="m209.02 363.05v68.732h93.212c-15.065 44.252-37.662 68.732-93.212 68.732-56.492 0-100.74-46.135-100.74-102.63s44.252-102.63 100.74-102.63c30.129 0 48.96 10.357 66.849 25.422 14.123-14.123 13.182-16.006 48.96-49.902-31.071-28.246-71.557-45.194-115.81-45.194-95.096-0.94-172.3 76.266-172.3 171.36s77.206 172.3 172.3 172.3c142.17 0 177.01-124.28 165.71-206.2-33.896-1e-3 -165.71-1e-3 -165.71-1e-3zm310.71 3.766v-59.317h-42.369v59.317h-61.2v42.369h61.2v61.2h42.369v-61.2h59.317v-42.369h-59.317z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2018 COUCHBASE All rights reserved.</span>
      <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
      <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
      <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
      <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
