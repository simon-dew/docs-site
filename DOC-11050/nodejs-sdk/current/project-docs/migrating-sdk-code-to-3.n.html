<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv=content-security-policy content="default-src 'none'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https:; img-src 'self' data: https:; connect-src 'self' https:; worker-src blob:;">
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://metrics.couchbase.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MVPNN2');</script>
<!-- End Google Tag Manager -->
<title>Migrating to SDK API 3 | Couchbase Docs (Preview)</title>
<link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-11050/nodejs-sdk/current/project-docs/migrating-sdk-code-to-3.n.html">
<link rel="stylesheet" href="../../../_/css/site.css">
<script src="../../../_/js/vendor/jquery.js"></script>
<meta name="description" content="The SDK API 3 (used in Node.js SDK 3.x and 4.x) introduces breaking changes to the previous SDK API 2 APIs (used in Node.js SDK 2.x) in order to provide a number of improvements. Collections and Scopes are introduced.">
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">


<meta name="dcterms.subject" content="nodejs-sdk">
<meta name="dcterms.identifier" content="4.1">
<meta name="page-url" content="/nodejs-sdk/current/project-docs/migrating-sdk-code-to-3.n.html">
<meta name="page-nav-header-levels" content="0">
<meta name="generator" content="Antora 3.1.4">
<link rel="icon" href="../../../_/img/favicon.svg" type="image/svg+xml">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon" sizes="any">
</head>
<body class="article">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MVPNN2" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://simon-dew.github.io/docs-site/DOC-11050/home/index.html">
                    <img src="../../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://simon-dew.github.io/docs-site/DOC-11050/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../cloud/index.html">
                      Capella
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a class="btn btn-primary btn-grey-reverse" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                  <i class="far fa-arrow-to-bottom fa-fw"></i>
                </a>
                <a href="https://cloud.couchbase.com/sign-up" class="btn btn-primary" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  Start Free Trial
                  <i class="far fa-cloud fa-fw"></i>
                </a>

              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<aside class="nav left-sidebar">
  <div class="nav-container">
    <a href="#" class="menu-expand-toggle"><span>Navigation</span><i class="fas fa-times-circle"></i><i class="fas fa-chevron-circle-left"></i></a>
  </div>
</aside>
<aside class="toc sidebar"
      data-title="Contents"
      data-levels="1">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="https://github.com/couchbase/docs-sdk-nodejs/edit/release/4.1/modules/project-docs/pages/migrating-sdk-code-to-3.n.adoc" title="Edit Page" target="_blank" rel="noopener" class="remove-ext-icon">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="../hello-world/overview.html">Node.js SDK</a></li>
<li class="crumb">Project Docs</li>
<li class="crumb"><a href="compatibility.html">Compatibility</a></li>
<li class="crumb"><a href="migrating-sdk-code-to-3.n.html">Migrating to SDK 3 API</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Migrating to SDK API 3</h1>
<div class="labels">
<ul>
<li class="concept"><span><i class="far fa-lightbulb"></i> concept</span></li>
</ul>
</div>


</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
The SDK API 3 (used in Node.js SDK 3.x and 4.x) introduces breaking changes to the previous SDK API 2 APIs (used in Node.js SDK 2.x) in order to provide a number of improvements. Collections and Scopes are introduced.
The Document class and structure has been completely removed from the API, and the returned value is now <code>Result</code>.
Retry behavior is more proactive, and lazy bootstrapping moves all error handling to a single place.
</blockquote>
</div>
<div class="paragraph">
<p>The current Node.js SDK 4.0 is also based on the <a href="compatibility.html#sdk3.2" class="xref page">SDK API 3.2 specification</a>, and offers an entirely new backend (couchbase++) with better support for upcoming features like Distributed ACID Transactions.
We have increased the major version to reflect the importance of this implementation change as per <a href="https://semver.org/">semantic versioning</a>.</p>
</div>
<div class="paragraph">
<p>The intent of this migration guide is to provide detail information on the changes and what to look for while upgrading the SDK.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if you are an existing Node.js SDK 3.<em>x</em> user considering migrating to SDK 4.0,
you may wish to skip to the <a href="#sdk4-specifics">SDK 4.0 specifics</a> below.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="api-version"><a class="anchor" href="#api-version"></a>API Version</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This release of the SDK is written to version 3.3 of the SDK API specification (and matching the features available in Couchbase 7.1 and earlier).
For most developers, just using the latest version will be all that matters, and few will need to look at another of our SDKs.
Just for those few that do, the table below shows each Couchbase SDK release version that matches the API version.</p>
</div>
<div class="paragraph">
<p>Whilst these two numbers match for the C, .NET, Java, and Ruby SDKs, this is not the case for the others, as version numbers for individual SDKs are bumped up in line with <a href="https://semver.org/">Semantic Versioning</a>&#8201;&#8212;&#8201;check the <a href="#sdk-release-notes">release notes</a> of each SDK for individual details.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. SDK API Versions</caption>
<colgroup>
<col style="width: 27.5862%;">
<col style="width: 13.7931%;">
<col style="width: 13.7931%;">
<col style="width: 13.7931%;">
<col style="width: 17.2413%;">
<col style="width: 13.7932%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">API 2.7</th>
<th class="tableblock halign-left valign-top">API 3.0</th>
<th class="tableblock halign-left valign-top">API 3.1</th>
<th class="tableblock halign-left valign-top">API 3.2</th>
<th class="tableblock halign-left valign-top">API 3.3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C (libcouchbase)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.NET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Go</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5 &amp; 1.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0 &amp; 2.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.3 &amp; 2.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kotlin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node.js</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.2 &amp; 4.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PHP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Python</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ruby</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scala</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>SDK API 3.3</strong>: Introduced alongside Couchbase Server 7.1, adds Management API for Eventing and Index Management for Scopes &amp; Collections; extends Bucket Management API to support Custom Conflict Resolution and Storage Options; adds new platform support for Linux Alpine OS, Apple M1, and AWS Graviton2; provides improved error messages for better error handling. and an upgraded Spark Connector that runs on Spark 3.0 &amp; 3.1 Platform.</p>
</div>
<div class="paragraph">
<p><strong>SDK API 3.2</strong>: Introduced alongside Couchbase Server 7.0, provides features in support of Scopes and Collections, extends capabilities around Open Telemetry API to instrument telemetry data, enhanced client side field level encryption to add an additional layer of security to protect sensitive data, adds new platform support such as Ubuntu 20.04 LTS.</p>
</div>
<div class="paragraph">
<p><strong>SDK API 3.1</strong>: Introduced alongside Couchbase Server 6.6,  focuses on Bucket Management API, adds capabilities around Full Text Search features such-as  Geo-Polygon support, Flex Index, and Scoring.</p>
</div>
<div class="paragraph">
<p><strong>SDK API 3.0</strong>: Introduced alongside Couchbase Server 6.5,  is a major overhaul from its predecessor, has simplified surface area, removed long-standing bugs and deprecated/removed old API, introduces new programming languages Scala and Ruby, written in anticipation to support Scopes and Collections.</p>
</div>
<div class="paragraph">
<p><strong>SDK API 2.7</strong>: Introduced alongside Couchbase Server 6.0, with support for its new features such as the Analytics Service, improvements to Full Text Search, and support for more complex network configurations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fundamentals"><a class="anchor" href="#fundamentals"></a>Fundamentals</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before this guide dives into the language-specific technical component of the migration, it is important to understand the high level changes first.
As a migration guide, this document assumes you are familiar with the previous generation of the SDK and does not re-introduce SDK API 2 concepts.
We recommend familiarizing yourself with the new SDK first by reading at least the <a href="../hello-world/start-using-sdk.html" class="xref page">getting started guide</a>, and browsing through the other chapters a little.</p>
</div>
<div class="sect2">
<h3 id="terminology"><a class="anchor" href="#terminology"></a>Terminology</h3>
<div class="paragraph">
<p>The concept of a <code>Cluster</code> and a <code>Bucket</code> remain the same, but a fundamental new layer is introduced into the API: <code>Collections</code> and their <code>Scopes</code>.
Collections are logical data containers inside a Couchbase bucket that let you group similar data just like a <em>Table</em> does in a relational database&#8201;&#8212;&#8201;although documents inside a collection do not need to have the same structure.
Scopes allow the grouping of collections into a namespace, which is very usfeul when you have multilpe tenants acessing the same bucket.
Couchbase Server includes support for collections as a <a href="#6.5@server:developer-preview:preview-mode.adoc" class="xref unresolved">developer preview</a> in version 6.5, and as a first class concept of the programming model from <a href="#7.1@server:learn:data/scopes-and-collections.adoc" class="xref unresolved">version 7.0.</a></p>
</div>
<div class="paragraph">
<p>Note that the SDKs include the feature from SDK 3.0, to allow easier migration.</p>
</div>
<div class="paragraph">
<p>In the previous SDK generation, particularly with the <code>KeyValue</code> API, the focus has been on the codified concept of a <code>Document</code>.
Documents were read and written and had a certain structure, including the <code>id</code>/<code>key</code>, content, expiry (<code>ttl</code>), and so forth.
While the server still operates on the logical concept of documents, we found that this model in practice didn&#8217;t work so well for client code in certain edge cases.
As a result we have removed the <code>Document</code> class/structure completely from the API.
The new API follows a clear scheme: each command takes required arguments explicitly, and an option block for all optional values.
The returned value is always of type <code>Result</code>.
This avoids method overloading bloat in certain languages, and has the added benefit of making it easy to grasp APIs evenly across services.</p>
</div>
<div class="paragraph">
<p>As an example here is a KeyValue document fetch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/kv-operations.js#L113-L114">const result = await collection.get(key);
document = result.value;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compare this to a SQL++ (formerly N1QL) query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/n1ql-queries.js#L34-L49">async function queryNamed() {
  const query = `
    SELECT airportname, city FROM \`travel-sample\` 
    WHERE type=$TYPE 
      AND city=$CITY;
  `
  const options = { parameters: { TYPE: 'airport', CITY: 'Reno' } }

  try {
    let result = await cluster.query(query, options)
    console.log("Result:", result)
    return result
  } catch (error) {
    console.error('Query failed: ', error)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since documents also fundamentally handled the serialization aspects of content, two new concepts are introduced: the <code>Serializer</code> and the <code>Transcoder</code>.
Out of the box the SDKs ship with a JSON serializer which handles the encoding and decoding of JSON.
You&#8217;ll find the serializer exposes the options for methods like N1QL queries and KeyValue subdocument operations,.</p>
</div>
<div class="paragraph">
<p>The KV API extends the concept of the serializer to the <code>Transcoder</code>.
Since you can also store non-JSON data inside a document, the <code>Transcoder</code> allows the writing of binary data as well.
It handles the object/entity encoding and decoding, and if it happens to deal with JSON makes uses of the configured <code>Serializer</code> internally.
See the <em>Serialization and Transcoding</em> section below for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="what-to-look-out-for"><a class="anchor" href="#what-to-look-out-for"></a>What to look out for</h3>
<div class="paragraph">
<p>The SDKs are more proactive in retrying with certain errors and in certain situations, within the timeout budget given by the user&#8201;&#8212;&#8201;as an example, temporary failures or locked documents are now being retried by default&#8201;&#8212;&#8201;making it even easier to program against certain error cases.
This behavior is customizable in a <code>RetryStrategy</code>, which can be overridden on a per operation basis for maximum flexibility if you need it.</p>
</div>
<div class="paragraph">
<p>Note, most of the bootstrap sequence is now lazy (happening behind the scenes).
For example, opening a bucket is not raising an error anymore, but it will only show up once you perform an actual operation.
The reason behind this is to spare the application developer the work of having to do error handling in more places than needed.
A bucket can go down 2ms after you opened it, so you have to handle request failures anyway.
By delaying the error into the operation result itself, there is only one place to do the error handling.
There will still be situations why you want to check if the resource you are accessing is available before continuing the bootstrap;
for this, we have the diagnostics and ping commands at each level which allow you to perform those checks eagerly.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="language-specifics"><a class="anchor" href="#language-specifics"></a>Language Specifics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that you are familiar with the general theme of the migration, the next sections dive deep into the specifics.
First, installation and configuration are covered, then we talk about exception handling, and then each service (i.e. Key/Value, Query,&#8230;&#8203;) is covered separately.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation-and-configuration"><a class="anchor" href="#installation-and-configuration"></a>Installation and Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Node.js SDK 3.<em>x</em> and 4.<em>x</em> are available through <code>npm</code>, just like the previous generation.
Please see the <a href="sdk-release-notes.html" class="xref page">Release Notes</a> for up-to-date information.</p>
</div>
<div class="paragraph">
<p>The Node.js SDK 3.2 has the following dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">  "dependencies": {
    "bindings": "^1.5.0",
    "debug": "^4.3.2",
    "nan": "^2.15.0",
    "parse-duration": "^1.0.0",
    "prebuild-install": "^6.1.4"
  },</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Node.js SDK 4.0 additionally requires Node 12+ (the oldest supported maintenance LTS release).</p>
</div>
<div class="sect2">
<h3 id="connection-to-the-cluster"><a class="anchor" href="#connection-to-the-cluster"></a>Connection to the Cluster</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/migrating.js#L43-L46">const options = { username:"Administrator", password:"password"};
cluster = await couchbase.connect( "http://127.0.0.1", options);
bucket = cluster.bucket("travel-sample");
collection = bucket.scope("inventory").collection("airport");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar to SDK API 2, if you create your own <code>ClusterEnvironment</code> the SDK will not shut it
down for you&#8201;&#8212;&#8201;you need to do this manually at the end of the program lifetime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/migrating.js#L262">cluster.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Connection String Url Query Parameters</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/migrating.js#L67-L68">const options = { username:"Administrator", password:"password"};
cluster = await couchbase.connect( "http://127.0.0.1/?query_timeout=2000", options);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="authentication"><a class="anchor" href="#authentication"></a>Authentication</h3>
<div class="paragraph">
<p>Connecting with certificate-based authentication.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/connecting-cert-auth.js#L5-L18">// see sdk-examples/etc for creation of certificates
const here = process.cwd();
const truststorepath = here + "/" + '../etc/x509-cert/SSLCA/clientdir/trust.pem';
const certpath = here + "/" + '../etc/x509-cert/SSLCA/clientdir/client.pem';
const keypath = here + "/" + '../etc/x509-cert/SSLCA/clientdir'; // gets /client.key from cluster.bucket()

// Setup Cluster Connection Object
const options = {username: 'testuser', password: 'password'};
var cluster = new couchbase.Cluster(
    'couchbases://127.0.0.1/travel-sample' +
    '?truststorepath=' + truststorepath +
    '&amp;certpath=' + certpath +
    '&amp;keypath=' + keypath, options);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please see the <a href="../howtos/sdk-authentication.html" class="xref page">documentation on certificate-based authentication</a> for detailed information on how to configure this properly.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="connection-lifecycle"><a class="anchor" href="#connection-lifecycle"></a>Connection Lifecycle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From a high-level perspective, bootstrapping and shutdown is very similar to the SDK API 2.<em>x</em>.
One notable difference is that the <code>Collection</code> is introduced and that the individual methods like <code>bucket</code> immediately return, and do not throw an exception.
Compare SDK API 2: the <code>openBucket</code> method would not work if it could not open the bucket.</p>
</div>
<div class="paragraph">
<p>The reason behind this change is that even if a bucket can be opened, a millisecond later it may not be available any more.
All this state has been moved into the actual operation so there is only a single place where the error handling needs to take place.
This simplifies error handling and retry logic for an application.</p>
</div>
<div class="paragraph">
<p>In SDK API 2, you connected, opened a bucket, performed a KV op, and disconnected like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const cluster = new couchbase.Cluster("127.0.0.1");
cluster.authenticate("user", "pass");
const bucket = cluster.openBucket("travel-sample");

const getResult = bucket.get("airline_10");

cluster.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the SDK API 3 equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/migrating.js">const options = { username:"Administrator", password:"password"};
cluster = await couchbase.connect( "http://127.0.0.1", options);
bucket = cluster.bucket("travel-sample");
collection = bucket.scope("inventory").collection("airport");

const getResult = await collection.get("airport_1254");

cluster.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Collections</code> is generally available from Couchbase Server 7.0 release, but the SDK already encoded it in its API to be future-proof.
If you are using a Couchbase Server version which does not support <code>Collections</code>, always use the <code>defaultCollection()</code> method to access the KV API; it will map to the full bucket.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You&#8217;ll notice that <code>bucket(String)</code> returns immediately, even if the bucket resources are not completely opened.
This means that the subsequent <code>get</code> operation may be dispatched even before the socket is open in the background.
The SDK will handle this case transparently, and reschedule the operation until the bucket is opened properly.
This also means that if a bucket could not be opened (say, because no server was reachable) the operation will time out.
Please check the logs to see the cause of the timeout (in this case, you&#8217;ll see socket connect rejections).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Also note, you will now find Query, Search, and Analytics at the <code>Cluster</code> level.
This is where they logically belong.
If you are using Couchbase Server 6.5 or later, you will be able to perform cluster-level queries even if no bucket is open.
If you are using an earlier version of the cluster you must open at least one bucket, otherwise cluster-level queries will fail.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serialization-and-transcoding"><a class="anchor" href="#serialization-and-transcoding"></a>Serialization and Transcoding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In SDK API 2 the main method to control transcoding was through providing different <code>Document</code> instances (which in turn had their own transcoder associated), such as the <code>JsonDocument</code>.
This only worked for the KV APIs though&#8201;&#8212;&#8201;Query, Search, Views, and other services exposed their JSON rows/hits in different ways.
All of this has been unified in SDK API 3 under a single concept: serializers and transcoders.</p>
</div>
<div class="paragraph">
<p>By default, all KV APIs transcode to and from JSON&#8201;&#8212;&#8201;you can also provide Javascript objects which you couldn&#8217;t in the past.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/migrating.js#L109-L111">const  upsertResult = await collection.upsert("mydoc-id", { myvalue: "me"});
const getResult = await collection.get("mydoc-id");
console.log(getResult);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to write binary data, you can use a <code>new RawBinaryTranscoder()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/migrating.js#L118-L125">const content = Buffer.from("some data to become binary");
const  upsertResult = await collection.upsert(
  "mydoc-id",
  content,
  {transcoder:new RawBinaryTranscoder()}
);
const getResult = await collection.get("mydoc-id");
console.log(getResult);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exception-handling"><a class="anchor" href="#exception-handling"></a>Exception Handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>How to <em>handle</em> exceptions is unchanged from SDK API 2.
You should still use <code>try/catch</code> on the blocking APIs and the corresponding reactive/async methods on the other APIs.
There have been changes made in the following areas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Exception hierarchy and naming.</p>
</li>
<li>
<p>Proactive retry where possible.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="exception-hierarchy"><a class="anchor" href="#exception-hierarchy"></a>Exception hierarchy</h3>
<div class="paragraph">
<p>The exception hierarchy is now flat and unified under a <code>CouchbaseError</code>.
Each <code>CouchbaseError</code> has an associated <code>ErrorContext</code> which is populated with as much info as possible and then dumped alongside the stack trace if an error happens.</p>
</div>
<div class="paragraph">
<p>Here is an example of the error context if a SQL++ query is performed with an invalid syntax (i.e. <code>select 1= from</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Exception in thread "main" com.couchbase.client.core.error.ParsingFailedException: Parsing of the input failed {"completed":true,"coreId":1,"errors":[{"code":3000,"message":"syntax error - at from"}],"idempotent":false,"lastDispatchedFrom":"127.0.0.1:62253","lastDispatchedTo":"127.0.0.1:8093","requestId":3,"requestType":"QueryRequest","retried":11,"retryReasons":["ENDPOINT_TEMPORARILY_NOT_AVAILABLE","BUCKET_OPEN_IN_PROGRESS"],"service":{"operationId":"9111b961-e585-42f2-9cab-e1501da7a40b","statement":"select 1= from","type":"query"},"timeoutMs":75000,"timings":{"dispatchMicros":15599,"totalMicros":1641134}}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proactive-retry"><a class="anchor" href="#proactive-retry"></a>Proactive Retry</h3>
<div class="paragraph">
<p>One reason why the APIs do not expose a long list of exceptions is that the SDK now retries as many operations as it can if it can do so safely.
This depends on the type of operation (idempotent or not), in which state of processing it is (already dispatched or not), and what the actual response code is if it arrived already.
As a result, many transient cases&#8201;&#8212;&#8201;such as locked documents, or temporary failure&#8201;&#8212;&#8201;are now retried by default and should less often impact applications.
It also means, when migrating to SDK API 3, you may observe a longer period of time until an error is returned by default.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Operations are retried by default as described above with the default <code>BestEffortRetryStrategy</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migrating-services"><a class="anchor" href="#migrating-services"></a>Migrating Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following section discusses each service in detail and covers specific bits that have not been covered by the more generic sections above.</p>
</div>
<div class="sect2">
<h3 id="key-value"><a class="anchor" href="#key-value"></a>Key Value</h3>
<div class="paragraph">
<p>The Key/Value (KV) API is now located under the <code>Collection</code> interface, so even if you do not use collections, the <code>defaultCollection()</code> needs to be opened in order to access it.</p>
</div>
<div class="paragraph">
<p>The following table describes the SDK API 2 KV calls and where they are now located in SDK API 3:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. KV API Changes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">SDK API 2</th>
<th class="tableblock halign-left valign-top">SDK API 3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.upsert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.upsert</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.get</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.get</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.exists</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.exists</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.getFromReplica</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.getAnyReplica</code> and <code>collection.getAllReplicas</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.getAndLock</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.getAndLock</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.getAndTouch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.getAndTouch</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.insert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.insert</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.upsert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.upsert</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.replace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.replace</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.remove</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.remove</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.unlock</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.unlock</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.touch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.touch</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.lookupIn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.lookupIn</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.mutateIn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.mutateIn</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.counter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>binarycollection.increment</code> and <code>binarycollection.decrement</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.append</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>binarycollection.append</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.prepend</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>binarycollection.prepend</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition, the datastructure APIs have been renamed and moved:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Datastructure API Changes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">SDK API 2</th>
<th class="tableblock halign-left valign-top">SDK API 3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.mapAdd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.map</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.mapGet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.map</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.mapRemove</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.map</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.mapSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.map</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.listGet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.list</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.listAppend</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.list</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.listRemove</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.list</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.listPrepend</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.list</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.listSet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.list</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.listSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.list</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.setAdd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.set</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.setContains</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.set</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.setRemove</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.set</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.setSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.set</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.queuePush</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.queue</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucket.queuePop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collection.queue</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are two important API changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On the request side, overloads have been reduced and moved under a <code>Options</code> block</p>
</li>
<li>
<p>On the response side, the return types have been unified.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The signatures now look very similar.
The concept of the <code>Document</code> as a type is gone in SDK API 3 and instead you need to pass in the properties explicitly.
This makes it very clear what is returned, especially on the response side.</p>
</div>
<div class="paragraph">
<p>Thus, the <code>get</code> method does not return a <code>Document</code> but a <code>GetResult</code> instead, and the <code>upsert</code> does not return a <code>Document</code> but a <code>MutationResult</code>.
Each of those results only contains the field that the specific method can actually return, making it impossible to accidentally try to access the <code>expiry</code> on the <code>Document</code> after a mutation, for example.</p>
</div>
<div class="paragraph">
<p>Instead of having many overloads, all optional params are now part of the <code>Option</code> block.
All required params are still part of the method signature, making it clear what is required and what is not (or has default values applied if not overridden).</p>
</div>
<div class="paragraph">
<p>The timeout can be overridden on every operation and now takes a <code>Duration</code> from java 8.
Compare SDK API 2 and SDK API 3 custom timeout setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">// SDK API 2 custom timeout
bucket.get("mydoc-id", 5000);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/migrating.js#L132-L133">// SDK API 3 custom timeout
const getResult = await collection.get( "airport_1254", {timeout : 2000});</code></pre>
</div>
</div>
<div class="paragraph">
<p>In SDK API 2, the <code>getFromReplica</code> method had a <code>ReplicaMode</code> argument which allowed to customize its behavior on how many replicas should be reached.
We have identified this as a potential source of confusion and as a result split it up in two methods that simplify usage significantly.
There is now a <code>getAllReplicas</code> method and a <code>getAnyReplica</code> method.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getAllReplicas</code> asks the active node and all available replicas and returns the results as a stream.</p>
</li>
<li>
<p><code>getAnyReplica</code> uses <code>getAllReplicas</code>, and returns the first result obtained.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unless you want to build some kind of consensus between the different replica responses, we recommend <code>getAnyReplica</code> for a fallback to a regular <code>get</code> when the active node times out.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Operations which cannot be performed on JSON documents have been moved to the <code>binarycollection</code>, accessible through <code>Collection.binary()</code>.
These operations include <code>append</code>, <code>prepend</code>, <code>increment</code>, and <code>decrement</code> (previously called <code>counter</code> in SDK API 2).
These operations should only be used against non-json data.
Similar functionality is available through <code>mutateIn</code> on JSON documents.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="query"><a class="anchor" href="#query"></a>Query</h3>
<div class="paragraph">
<p>SQL++ querying is now available at the <code>Cluster</code> level instead of the bucket level, because you can also write SQL++ queries that span multiple buckets. Compare a simple SQL++ query from SDK API 2 with its SDK API 3 equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">// SDK API 2 simple query
queryResult = await bucket.query(
      couchbase.N1qlQuery.fromString('SELECT * FROM `travel-sample` WHERE city=$1 LIMIT 10'),
      [ 'Paris' ]);

queryResult.rows.forEach((row)=&gt;{
      console.log(row);
   });</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/migrating.js#L141-L145">// SDK API 3 simple query
const queryResult = await cluster.query("SELECT * FROM `travel-sample` WHERE city=$1 LIMIT 10", { parameters: ['Paris']});
queryResult.rows.forEach((row)=&gt;{
   console.log(row);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that there is no <code>N1qlQuery.fromString</code> any more&#8201;&#8212;&#8201;and query parameters argument has been moved to the options parameter for consistency reasons.
The following shows how to do named and positional parameters in SDK API 3:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/migrating.js#L152-L161">// SDK API 3 named parameters
const queryResultNamed = await cluster.query("SELECT * FROM `travel-sample` WHERE city=$CITY LIMIT 10", { parameters: {CITY:'Paris'}});
queryResultNamed.rows.forEach((row)=&gt;{
   console.log(row);
});
// SDK API 3 positional parameters
const queryResultPositional = await cluster.query("SELECT * FROM `travel-sample` WHERE city=$1 LIMIT 10", { parameters: ['Paris']});
queryResultPositional.rows.forEach((row)=&gt;{
   console.log(row);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Much of the non-row metadata has been moved into a specific <code>QueryMetaData</code> section:</p>
</div>
<div class="paragraph">
<p>It is no longer necessary to check for a specific error in the stream: if an error happened during processing it will throw an exception at the top level of the query.
The reactive streaming API will terminate the rows' <code>Flux</code> with an exception as well as soon as it is discovered.
This makes error handling much easier in both the blocking and non-blocking cases.</p>
</div>
<div class="paragraph">
<p>While in SDK API 2 you had to manually check for errors (otherwise you&#8217;d get an empty row collection):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">const queryResult = bucket.query(N1qlQuery.simple("select 1="));
if (!queryResult.errors.isEmpty()) {
  // errors contain [{"msg":"syntax error - at end of input","code":3000}]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In SDK API 3 the top level <code>query</code> method will throw an exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Parsing of the input failed {"completed":true,"coreId":1,"errors":[{"code":3000,"message":"syntax error - at end of input"}],"idempotent":false,"lastDispatchedFrom":"127.0.0.1:51703","lastDispatchedTo":"127.0.0.1:8093","requestId":5,"requestType":"QueryRequest","retried":0,"service":{"operationId":"1c623a77-196a-4890-96cd-9d4f3f596477","statement":"select 1=","type":"query"},"timeoutMs":75000,"timings":{"dispatchMicros":13798,"totalMicros":70789}}
	at com.couchbase.client.java.AsyncUtils.block(AsyncUtils.java:51)
	at com.couchbase.client.java.Cluster.query(Cluster.java:225)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Not only does it throw a <code>CouchbaseError</code>, it also tries to map it to a specific exception type and include extensive contextual information for a better troubleshooting experience.</p>
</div>
</div>
<div class="sect2">
<h3 id="analytics"><a class="anchor" href="#analytics"></a>Analytics</h3>
<div class="paragraph">
<p>Analytics querying, like SQL++, is also moved to the <code>Cluster</code> level: it is now accessible through the <code>Cluster.analyticsQuery</code> method.
As with the Query service, parameters for the Analytics queries have moved into the <code>AnalyticsOptions</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/migrating.js#L168-L172">// SDK API 3 simple analytics query
const analyticsResult = await cluster.analyticsQuery("select * from `travel-dataset` LIMIT 10");
analyticsResult.rows.forEach((row)=&gt;{
   console.log(row);
});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/migrating.js#L179-L195">// SDK API 3 named parameters for analytics
const analyticsResult1 = await cluster.analyticsQuery(
  "select * from `travel-sample` where city = $CITY LIMIT 10",
  { parameters : { CITY : "Paris"}}
).catch((e)=&gt;{console.log(e); throw e;});
analyticsResult1.rows.forEach((row)=&gt;{
   console.log(row);
});

// SDK API 3 positional parameters for analytics
const analyticsResult2 = await cluster.analyticsQuery(
  "select * from `travel-sample` where city = $1 LIMIT 10",
  { parameters : [ "airport" ] }
);
analyticsResult2.rows.forEach((row)=&gt;{
   console.log(row);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, errors will now be thrown as top level exceptions and it is no longer necessary to explicitly check for errors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// SDK API 2 error check
AnalyticsQueryResult analyticsQueryResult = b1.query(AnalyticsQuery.simple("select * from foo"));
if (!analyticsQueryResult.errors().isEmpty()) {
  // errors contain [{"msg":"Cannot find dataset foo in dataverse Default nor an alias with name foo! (in line 1, at column 15)","code":24045}]
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="search"><a class="anchor" href="#search"></a>Search</h3>
<div class="paragraph">
<p>The Search API has changed a bit in SDK API 3 so that it aligns with the other query APIs.
The type of queries have stayed the same, but all optional parameters moved into <code>SearchOptions</code>.
Also, similar to the other query APIs, it is now available at the <code>Cluster</code> level.</p>
</div>
<div class="paragraph">
<p>Here is a SDK API 2 Search query with some options, and its SDK API 3 equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">//  SDK API 2 search query
const searchResult = bucket.query(
  "airports"",
  { indexName : "airport_view", limit:5, fields : [ "a", "b", "c"]}
  2000,
);
searchResult.rows.forEach((row)=&gt;{
      console.log(row);
  });
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/migrating.js#L202-L217">    // SDK API 3 search query
    const ftsQuery =  couchbase.SearchQuery.match("airport");
    const searchResult = await cluster.searchQuery(
      "hotels",
      ftsQuery,
      { timeout:2000,
        limit:5,
        fields : ["a", "b", "c"] },
      (err, res) =&gt; {
if(err) console.log(err);
if(res) console.log(res);
      }
    );
    searchResult.rows.forEach((row)=&gt;{
       console.log(row);
    });</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to be absolutely sure that you didn&#8217;t get only partial data, you can check the error map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/migrating.js#L224-L236">const ftsQuery =  couchbase.SearchQuery.match("airport");
const searchResult = await cluster.searchQuery(
  "hotels",
  ftsQuery,
  { timeout:2000,
    limit:5}
).catch((e)=&gt;{console.log(e); throw e;});
console.log(searchResult);
if (searchResult.meta.status.failed == 0) {
  searchResult.rows.forEach((row)=&gt;{
     console.log(row);
  });
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="views"><a class="anchor" href="#views"></a>Views</h3>
<div class="paragraph">
<p>Views have stayed at the <code>Bucket</code> level, because it does not have the concept of collections and is scoped at the bucket level on the server as well.
The API has stayed mostly the same, the most important change is that <code>staleness</code> is unified under the <code>ViewConsistency</code> enum.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. View Staleness Mapping</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">SDK API 2</th>
<th class="tableblock halign-left valign-top">SDK API 3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Stale.TRUE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>QueryScanConsistency.NotBounded</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Stale.FALSE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>QuerywScanConsistency.RequestPlus</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Stale.UPDATE_AFTER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>removed</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Compare this SDK API 2 view query with its SDK API 3 equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">// SDK API 2 view query
const query = async bucket.query(
  "design", "view", {limit:5, skip:2},
  10000
);
query.rows.forEach((row)=&gt;{
      console.log(row);
  });
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript" data-source-url="https://github.com/couchbase/docs-sdk-nodejs/blob/d18efa4b9ae49708fca897fd35947d8c5fb7ee24/modules/devguide/examples/nodejs/migrating.js#L243-L251">// SDK API 3 view query
const viewResult = await bucket.viewQuery(
  "dev_airports",
  "airport_view",
  { limit:5, skip:2, timeout:10000 }
).catch((e)=&gt;{console.log(e); throw e;});
viewResult.rows.forEach((row)=&gt;{
   console.log(row);
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="management-apis"><a class="anchor" href="#management-apis"></a>Management APIs</h3>
<div class="paragraph">
<p>In SDK API 2, the management APIs were centralized in the <code>clustermanager</code> at the cluster level and the <code>bucketmanager</code> at the bucket level.
Since SDK API 3 provides more management APIs, they have been split up in their respective domains.
So for example when in SDK API 2 you needed to remove a bucket you would call <code>clustermanager.removeBucket</code> you will now find it under <code>bucketmanager.dropBucket</code>.
Also, creating a SQL++ index now lives in the <code>queryindexmanager</code>, which is accessible through the <code>cluster</code>.</p>
</div>
<div class="paragraph">
<p>The following table provides a mapping from the SDK API 2 management APIs to those of SDK API 3:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. <code>clustermanager</code> changes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">SDK API 2</th>
<th class="tableblock halign-left valign-top">SDK API 3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clustermanager.info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">removed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clustermanager.getBuckets</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.getAllBuckets</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clustermanager.getBucket</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.getBucket</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clustermanager.hasBucket</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">removed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clustermanager.insertBucket</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.createBucket</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clustermanager.updateBucket</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.updateBucket</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clustermanager.removeBucket</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.dropBucket</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clustermanager.upsertUser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>usermanager.upsertUser</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clustermanager.removeUser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>usermanager.dropUser</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clustermanager.getUsers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>usermanager.getAllUsers</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clustermanager.getUser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>usermanager.getUser</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clustermanager.apiClient</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">removed</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. <code>bucketmanager</code> changes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">SDK API 2</th>
<th class="tableblock halign-left valign-top">SDK API 3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">removed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.flush</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.flushBucket</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.getDesignDocuments</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>viewindexmanager.getAllDesignDocuments</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.getDesignDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>viewindexmanager.getDesignDocument</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.insertDesignDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>viewindexmanager.upsertDesignDocument</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.upsertDesignDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>viewindexmanager.upsertDesignDocument</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.removeDesignDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>viewindexmanager.dropDesignDocument</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.publishDesignDocument</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>viewindexmanager.publishDesignDocument</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.listN1qlIndexes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>queryindexmanager.getAllIndexes</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.createN1qlIndex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>queryindexmanager.createIndex</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.createN1qlPrimaryIndex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>queryindexmanager.createPrimaryIndex</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.dropN1qlIndex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>queryindexmanager.dropIndex</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.dropN1qlPrimaryIndex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>queryindexmanager.dropPrimaryIndex</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.buildN1qlDeferredIndexes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>queryindexmanager.buildDeferredIndexes</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bucketmanager.watchN1qlIndexes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>queryindexmanager.watchIndexes</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="encryption"><a class="anchor" href="#encryption"></a>Encryption</h3>
<div class="paragraph">
<p>Due to a change in algorithms and API, SDK API 2 cannot read fields encrypted by SDK API 3.
Learn more in the <a href="../howtos/encrypting-using-sdk.html#migrating-from-2" class="xref page">encryption guide</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sdk4-specifics"><a class="anchor" href="#sdk4-specifics"></a>SDK 4.x specifics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Node.js SDK 4.0 implements the SDK API 3 spec, so all the steps above also apply to a migration from a Node.js SDK 2.x directly to Node.js SDK 4.0.</p>
</div>
<div class="paragraph">
<p>Additionally, the Node.js SDK 4.0 offers a new backend (Couchbase++) with support for
<a href="../howtos/distributed-acid-transactions-from-the-sdk.html" class="xref page">multi-document ACID transactions</a>,
as well as the capabilities required for upcoming features.
You should be aware of the following considerations arising from this new backend implementation.</p>
</div>
<div class="paragraph">
<p>The following features are unsupported in 4.0.
They are available in 3.2, and will be available in a later 4.x release.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../concept-docs/response-time-observability.html" class="xref page">Response Time Availability</a></p>
</li>
<li>
<p><a href="../concept-docs/durability-replication-failure-considerations.html#older-server-versions" class="xref page">Legacy durability</a></p>
</li>
<li>
<p>Log forwarding</p>
</li>
<li>
<p>Replica reads</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The required minimum version of Node.js is now v12 (the oldest supported maintenance LTS release).</p>
</li>
<li>
<p>Ping error entries are now typed.</p>
</li>
<li>
<p><code>get</code> requests on locked documents now retry rather than fast-fail.</p>
</li>
<li>
<p>The changes to <a href="../ref/client-settings.html" class="xref page">Client Settings</a> are documented in the <a href="https://docs.couchbase.com/sdk-api/couchbase-node-client-4.1.3/interfaces/ConnectOptions.html">API reference</a>.</p>
</li>
<li>
<p>The changes to <a href="../howtos/managing-connections.html#connection-strings" class="xref page">Connection Strings</a> are documented in the <a href="https://docs.couchbase.com/sdk-api/couchbase-node-client-4.1.3/functions/connect.html">API reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="comparing-older-documentation"><a class="anchor" href="#comparing-older-documentation"></a>Comparing Older Documentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You may want to visit documentation for older versions of the SDK, to help to understand application code that you are migrating.
Versions that have reached end of life can be found in the <a href="https://docs-archive.couchbase.com/home/index.html">archive</a>.
In the release notes pages of these older docs, you will also find links to the API reference for each no-longer-supported release.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../_/img/couchbase-logo.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2023 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site-navigation-data.js"></script>
<script id="page-navigation-group" type="application/json">
{"title":"SDKs","components":["dotnet-sdk","java-sdk","nodejs-sdk","python-sdk","sdk-extensions"],"url":"/home/sdk.html","latestVersions":{"dotnet-sdk":"3.3","java-sdk":"3.3","nodejs-sdk":"4.1","python-sdk":"4.0","sdk-extensions":"master"}}
</script>
<template id="run-code-panel">
<div class="action-panel">
  <form class="action-panel-control" method="POST" action="https://couchbase.live/run" target="run-code-output">
    <input type="hidden" name="lang">
    <input type="hidden" name="code">
    <input type="hidden" name="from" value="docs">
    <div class="controls">
      <button class="control-button rerun" type="submit"><i class="fas fa-redo"></i></button>
      <span class="shell-name control-label">Output</span>
      <button class="control-button close"><i class="fas fa-times"></i> Close</button>
    </div>
  </form>
  <iframe class="run-code-output" name="run-code-output"></iframe>
</div>
</template>
<script id="site-script" src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/tabs.js" data-sync-storage-key="preferred-tab"></script>
<script defer src="../../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script defer src="../../../_/js/vendor/fontawesome.js" data-search-pseudo-elements="true"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
</body>
</html>
