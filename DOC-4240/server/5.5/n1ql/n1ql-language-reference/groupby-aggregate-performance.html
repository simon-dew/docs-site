<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Group By and Aggregate Performance | Couchbase Docs (Staging)</title>
    <link rel="canonical" href="https://simon-dew.github.io/docs-site/DOC-4240/server/6.5/index.html">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="schema.dcterms" href="https://purl.org/dc/terms/">
    <meta name="dcterms.subject" content="server">
    <meta name="dcterms.identifier" content="5.5">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar" id="topbar">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="https://www.couchbase.com"><img src="../../../../_/img/logo.svg" alt="Couchbase"></a>
        <button class="navbar-burger" data-target="topbar-menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
      <div id="topbar-menu" class="navbar-menu">
        <div class="navbar-start">
          <div class="navbar-item has-dropdown">
            <a class="navbar-link" href="https://simon-dew.github.io/docs-site/DOC-4240">Docs</a>
            <div class="navbar-dropdown explore">
              <div class="title">Couchbase Documentation Overview</div>
              <div class="cols">
                <ul>
                  <li class="heading"><a href="../../../6.5/index.html">Server</a></li>
                  <li><a href="../../../../server/6.5/n1ql/n1ql-language-reference/index.html">N1QL</a></li>
                  <li><a href="../../../../server/6.5/fts/full-text-intro.html">Full Text Search</a></li>
                  <li><a href="../../../../server/6.5/analytics/introduction.html">Analytics</a></li>
                  <li><a href="../../../../server/6.5/eventing/eventing-overview.html">Eventing</a></li>
                  <li><a href="#">Autonomous Operator</a></li>
                </ul>
                <ul>
                  <li class="heading">Mobile</li>
                  <li><a href="#">Lite</a></li>
                  <li><a href="#">Sync Gateway</a></li>
                </ul>
                <ul class="two-cols">
                  <li class="heading"><a href="../../../../server/6.5/sdk/overview.html">SDKs</a></li>
                  <li><a href="#">C</a></li>
                  <li><a href="#">.NET</a></li>
                  <li><a href="#">Go</a></li>
                  <li><a href="#">Java</a></li>
                  <li><a href="#">Node.js</a></li>
                  <li><a href="#">PHP</a></li>
                  <li><a href="#">Python</a></li>
                  <li><a href="#">Scala</a></li>
                </ul>
                <ul>
                  <li class="heading"><a href="../../../../server/6.5/connectors/intro.html">Connectors</a></li>
                  <li><a href="#">Elasticsearch</a></li>
                  <li><a href="../../../../server/6.5/connectors/hadoop-1.2/hadoop.html">Hadoop</a></li>
                  <li><a href="#">Kafka</a></li>
                  <li><a href="#">Spark</a></li>
                  <li><a href="#">Talend</a></li>
                  <li><a href="../../../../server/6.5/connectors/odbc-jdbc-drivers.html">ODBC/JDBC</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="navbar-item has-dropdown">
            <a class="navbar-link component" href="../../introduction/intro.html"><span class="title">server</span> <span class="version">5.5</span></a>
            <div class="navbar-dropdown versions">
              <div class="cols">
                <ul>
                  <li><a class="navbar-item" href="../../../6.5/index.html">server 6.5</a></li>
                  <li><a class="navbar-item" href="../../../6.0/index.html">server 6.0</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="navbar-end">
          <div class="navbar-item">
            <a class="btn red-btn" href="https://www.couchbase.com/downloads">Downloads</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body container">
<nav class="nav">
<div class="nav-menu">
<ul class="nav-list">
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Introduction</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../introduction/intro.html">Why Couchbase?</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../introduction/whats-new.html">What&#8217;s New?</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../introduction/editions.html">Couchbase Server Editions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../introduction/contact-couchbase.html">Contact Couchbase</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Getting Started</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../getting-started/start-here.html">Start Here!</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../getting-started/do-a-quick-install.html">Do a Quick Install</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../getting-started/look-at-the-results.html">Explore the Server Configuration</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../getting-started/try-a-query.html">Run Your First N1QL Query</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../getting-started/choose-your-next-steps.html">Choose Your Next Steps</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-path is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Developers</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../sdk/development-intro.html">Developer&#8217;s Intro</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../sdk/overview.html">SDKs</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="#">c-sdk::start-using-sdk.adoc</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="#">dotnet-sdk::start-using-sdk.adoc</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="#">go-sdk::start-using-sdk.adoc</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="#">java-sdk::start-using-sdk.adoc</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="#">nodejs-sdk::start-using-sdk.adoc</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="#">php-sdk::start-using-sdk.adoc</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="#">python-sdk::start-using-sdk.adoc</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../getting-started/starter-kits.html">Starter Kits</a>
    </span>
  </li>
  <li class="nav-item is-current-path is-active" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">N1QL Reference</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="index.html">N1QL Language Reference</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="n1ql-error-codes.html">N1QL Error Codes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../n1ql-intro/queriesandresults.html">N1QL Queries and Results</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../n1ql_application_continuity.html">N1QL Application Continuity</a>
    </span>
  </li>
  <li class="nav-item is-current-page is-active" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="groupby-aggregate-performance.html">Group By and Aggregate Performance</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../settings/query-settings.html">Query Settings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../n1ql-intro/sysinfo.html">Getting System Information</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../n1ql-intro/cbq.html">Running N1QL Queries from a Command Line</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="conventions.html">Conventions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="reservedwords.html">Reserved Words</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="datatypes.html">Data Types</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="literals.html">Literals</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="identifiers.html">Identifiers</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="n1ql-auditing.html">N1QL Auditing</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Operators</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="operators.html">Operators Overview</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="arithmetic.html">Arithmetic Operators</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="collectionops.html">Collection Operators</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="comparisonops.html">Comparison Operators</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="conditionalops.html">Conditional Operators</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="constructionops.html">Construction Operators</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="logicalops.html">Logical Operators</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="nestedops.html">Nested Operators and Expressions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="stringops.html">String Operators</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Functions</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="functions.html">Functions Overview</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="aggregatefun.html">Aggregate Functions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="arrayfun.html">Array Functions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="bitwisefun.html">Bitwise Functions in N1QL</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="comparisonfun.html">Comparison Functions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="condfununknown.html">Conditional Functions for Unknowns</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="condfunnum.html">Conditional Functions for Numbers</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="datefun.html">Date Functions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="jsonfun.html">JSON Functions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="metafun.html">Miscellaneous Utility Functions</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="curl.html">CURL Function</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="numericfun.html">Number Functions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="objectfun.html">Object Functions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="patternmatchingfun.html">Pattern-matching Functions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="stringfun.html">String Functions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="tokenfun.html">Token Functions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="typefun.html">Type Functions</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="subqueries.html">Subqueries</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="correlated-subqueries.html">Correlated Subqueries</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="subquery-examples.html">Examples</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="booleanlogic.html">Boolean Logic</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Statements</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="alterindex.html">ALTER INDEX</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="build-index.html">BUILD INDEX</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="createindex.html">CREATE INDEX</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="indexing-arrays.html">Array Indexing</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../indexes/covering-indexes.html">Covering Indexes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="adaptive-indexing.html">Adaptive Index</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="indexing-meta-info.html">Indexing Metadata Information</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="index-partitioning.html">Index Partitioning</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="createprimaryindex.html">CREATE PRIMARY INDEX</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="delete.html">DELETE</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="dropindex.html">DROP INDEX</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="dropprimaryindex.html">DROP PRIMARY INDEX</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="execute.html">EXECUTE</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="explain.html">EXPLAIN</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="grant.html">GRANT</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="infer.html">INFER</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="insert.html">INSERT</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="merge.html">MERGE</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="prepare.html">PREPARE</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="revoke.html">REVOKE</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">SELECT</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="selectintro.html">Overview</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="select-syntax.html">SELECT Syntax</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="selectclause.html">SELECT Clause</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="from.html">FROM clause</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="hints.html">USE INDEX clause</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="let.html">LET clause</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="where.html">WHERE clause</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="groupby.html">GROUP BY clause</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="union.html">UNION, INTERSECT, and EXCEPT</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="orderby.html">ORDER BY clause</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="limit.html">LIMIT clause</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="offset.html">OFFSET clause</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="update.html">UPDATE</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="upsert.html">UPSERT</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../fts/full-text-intro.html">Full Text Search: Fundamentals</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../fts/fts-performing-searches.html">Performing Searches</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../fts/fts-searching-from-the-ui.html">Searching from the UI</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../fts/fts-searching-with-the-rest-api.html">Searching with the REST API</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../fts/fts-demonstration-indexes.html">Demonstration Indexes</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fts/fts-creating-indexes.html">Creating Indexes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fts/fts-using-analyzers.html">Understanding Analyzers</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../fts/fts-queries.html">Understanding Queries</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../fts/fts-query-types.html">Query Types</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../fts/query-string-queries.html">Query String Queries</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../fts/fts-geospatial-queries.html">Geospatial Queries</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../fts/fts-sorting.html">Sorting Query Results</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../fts/fts-response-object-schema.html">Handling Response Objects</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../fts/fts-troubleshooting.html">Troubleshooting and FAQs</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../eventing/eventing-overview.html">Eventing Service: Fundamentals</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../eventing/eventing-Terminologies.html">Terminology</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../eventing/eventing-language-constructs.html">Language Constructs</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../eventing/eventing-adding-function.html">Adding a Couchbase Function</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../eventing/eventing-examples.html">Examples: Using the Eventing Service</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../eventing/eventing-debugging-and-diagnosability.html">Debugging and Diagnosability</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../eventing/eventing-statistics.html">Statistics</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../eventing/troubleshooting-best-practices.html">Troubleshooting and Best Practices</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../eventing/eventing-faq.html">Frequently Asked Questions</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Couchbase Analytics Service (Developer Preview)</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/introduction.html">Introduction</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Using Analytics</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/run-query.html">Running Queries</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/rest-analytics.html">Analytics REST API</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/config.html">Configuration Parameters</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/primer-beer.html">Tutorial</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">SQL++ Language Reference</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/1_intro.html">What&#8217;s SQL++?</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/2_expr.html">Expressions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/3_query.html">Queries</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/4_error.html">Errors</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/5_ddl.html">Data Definition Language (DDL)</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/6_n1ql.html">Differences from N1QL</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/7_using_index.html">Using Indexes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/8_builtin.html">Builtin Functions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/9_data_type.html">Data Types</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/appendix_1_keywords.html">Appendix 1: Reserved Keywords</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/appendix_2_parameters.html">Appendix 2: Performance Tuning</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../analytics/appendix_3_resolution.html">Appendix 3: Variable Bindings and Name Resolution</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Managing Clusters</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../admin/admin-intro.html">Administration Tools</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../admin/ui-intro.html">Couchbase Web Console</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../clustersetup/server-setup.html">Cluster Operations</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/adding-nodes.html">Adding a Node</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/remove-nodes.html">Removing a Node</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../clustersetup/failover.html">Failing over a Node</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/setup-failover-graceful.html">Using Graceful Failover</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/hard-failover.html">Using Hard Failover</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/automatic-failover.html">Using Automatic Failover</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/rebalance.html">Rebalancing a Cluster</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/rejoin-cluster.html">Recovering a Node</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/manage-groups.html">Managing Server Groups</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/logging.html">Logging</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../clustersetup/bucket-setup.html">Setting Up Buckets</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/create-bucket.html">Create a Bucket</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/change-settings-bucket.html">Change Bucket Settings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/bucket-flush.html">Flush a Bucket</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/delete-bucket.html">Delete a Bucket</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../indexes/indexing-overview.html">Indexing</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../views/views-intro.html">View Indexes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../indexes/gsi-for-n1ql.html">Global Secondary Indexes</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../indexes/index-replication.html">Index Replication and High Availability</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../indexes/storage-modes.html">Index Storage Modes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../indexes/performance-consistency.html">Performance and Consistency</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Settings</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../settings/backfill.html">Backfill Support for N1QL</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../settings/cluster-settings.html">Cluster</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../settings/update-notificatioin.html">Software Updates</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../settings/change-failover-settings.html">Node Availability</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../settings/configure-alerts.html">Email Alerts</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../settings/configure-compact-settings.html">Auto-Compaction</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../settings/install-sample-buckets.html">Sample Buckets</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../xdcr/xdcr-intro.html">Cross Datacenter Replication (XDCR)</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../xdcr/xdcr-create.html">Managing XDCR</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../xdcr/xdcr-recover-partitions.html">XDCR-Based Data Recovery</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../xdcr/xdcr-tuning-performance.html">Tune XDCR Performance</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../xdcr/xdcr-managing-security.html">XDCR Security</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../xdcr/xdcr-conflict-resolution.html">XDCR Conflict Resolution</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../xdcr/xdcr-timestamp-based-conflict-resolution.html">Timestamp-based Conflict Resolution</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/deployments-xdcr.html">XDCR in Cloud Deployments</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../security/security-intro.html">Security</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../security/security-authentication.html">Authentication</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-certs-auth.html">Certificate-Based Authentication</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-pw-auth.html">Password-Based Authentication</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../security/security-ldap-new.html">LDAP-Based Authentication</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-saslauthd-new.html">Setting up saslauthd</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-pam-auth.html">PAM-Based Authentication</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../security/security-authorization.html">Authorization</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-roles.html">Roles</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../security/security-rbac-user-management.html">RBAC User Management</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-rbac-for-admins-and-apps.html">Creating and Managing Users with the UI</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-resources-under-access-control.html">Resources Under Access Control</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-rbac-upgrade.html">Upgrading to RBAC</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../security/security-auditing.html">Auditing</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-audit-events.html">Audit Events</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../security/security-audit-targets.html">Audit Targets</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-json-fields-new.html">Audit File Details</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../security/security-encryption.html">Encryption</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-data-encryption.html">Encryption at Rest</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../security/security-comm-encryption.html">Encryption on the Wire</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-x509certsintro.html">X.509 for TLS</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-in-applications.html">Encryption in Applications</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/secret-mgmt.html">Secret-Management</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../security/security-best-practices.html">Security Best Practices</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-passwords.html">Couchbase Passwords</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-bucket-protection.html">Bucket Protection</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-iptables.html">Network and ACLs</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-access-logs.html">Access Logs</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-user-input.html">User Input Validation</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-session-timeouts.html">Session Timeouts</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-acls-new.html">Network ACLs and Security Groups</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../security/security-report-vulnerability.html">Reporting a Security Vulnerability</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Monitoring and Troubleshooting</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../monitoring/monitor-intro.html">Monitoring</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../monitoring/monitoring-rest.html">Monitor Using the REST API</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../monitoring/monitoring-cli.html">Monitor Using the cbstats Utility</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../monitoring/ui-monitoring-statistics.html">Monitoring Statistics</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../xdcr/xdcr-monitor-timestamp-conflict-resolution.html">Monitoring XDCR Timestamp-based Conflict Resolution</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../monitoring/monitoring-stats-configuration.html">Monitoring Management</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../monitoring/monitoring-n1ql-query.html">Monitoring N1QL Queries</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../troubleshooting/troubleshooting-intro.html">Troubleshooting</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../troubleshooting/troubleshooting-general-tips.html">General Tips</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/ui-logs.html">Using Logs</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../troubleshooting/troubleshooting-common-errors.html">Common Errors</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../troubleshooting/core-files.html">Core Files</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../backup-restore/backup-restore.html">Backup and Restore</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../backup-restore/enterprise-backup-restore.html">cbbackupmgr Tool</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="#">backup-restore:cbbackupmgr-strategies.adoc</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="#">backup-restore:cbbackupmgr-tutorial.adoc</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="#">backup-restore:cbbackupmgr-archivelayout.adoc</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../backup-restore/incremental-backup.html">cbbackup and cbrestore Tools</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Tuning &amp; Performance</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Query Performance</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../performance/indexing-and-query-perf.html">Indexing JSON Documents and Query Performance</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../performance/index-scans.html">Understanding Index Scans in Couchbase N1QL Query</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../performance/index_pushdowns.html">Index Pushdown Optimizations</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Installing &amp; Upgrading</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../install/get-started.html">Couchbase Server Deployment Options</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../install/plan-for-production.html">System Requirements</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/install-platforms.html">Supported Operating Systems</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/pre-install.html">System Resource Requirements</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/install-browsers.html">Supported Web Browsers</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../install/install-ports.html">Network and Firewall Requirements</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../install/ipv6-setup.html">Using IPv6 With Couchbase</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../install/install-production-deployment.html">Deployment Guidelines</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../install/sizing-general.html">Sizing Guidelines</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/services-mds.html">Multidimensional Scaling (MDS)</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/synchronize-clocks-using-ntp.html">Clock Sync with NTP</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/thp-disable.html">Disabling Transparent Huge Pages (THP)</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/install-swap-space.html">Swap Space and Kernel Swappiness</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/install-client-server.html">Couchbase Client Deployment Strategies</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/install-security-bp.html">Security Considerations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/best-practices-vm.html">Deployment Considerations for Virtual Machines and Containers</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/deployment-considerations-lt-3nodes.html">About Deploying Clusters With Less Than Three Nodes</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../install/install-intro.html">Installing the Couchbase Server Cluster</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../install/install-linux.html">Installing on Linux</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../install/rhel-suse-install-intro.html">Red Hat and CentOS Installation</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../install/ubuntu-debian-install.html">Ubuntu/Debian Installation</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../install/install_suse.html">SUSE Enterprise Linux installation</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../install/install-oracle.html">Oracle Enterprise Linux installation</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../install/rhel-multiple-instances.html">Installing Multiple Instances on Linux Platforms</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/install-package-windows.html">Installing on Windows</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/macos-install.html">Installing on Mac OS X</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/testing.html">Verifying the Couchbase Server Installation</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../install/init-setup.html">Initializing the Cluster</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../clustersetup/file-locations.html">File Locations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../install/hostnames.html">Using Hostnames</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/startup-shutdown.html">Couchbase Server Startup and Shutdown</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/install-uninstalling.html">Uninstalling Couchbase Server</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../install/running-couchbase-in-containers.html">Deploying Couchbase Server in Containers</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/getting-started-docker.html">Running Couchbase Server Using Docker</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../cloud/couchbase-cloud-deployment.html">Deploying Couchbase in the Cloud</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../cloud/couchbase-aws.html">Amazon Web Services (AWS) and Couchbase</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cloud/couchbase-aws-marketplace.html">Deploying Couchbase from AWS Marketplace</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cloud/couchbase-aws-best-practices.html">Best Practices for Deploying Couchbase on AWS</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../cloud/couchbase-azure.html">Microsoft Azure and Couchbase</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cloud/couchbase-azure-marketplace.html">Deploying Couchbase from Azure Marketplace</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cloud/couchbase-azure-best-practices.html">Best Practices for Deploying Couchbase on Microsoft Azure</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../cloud/couchbase-gcp.html">Google Cloud Platform and Couchbase</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cloud/couchbase-gcp-cloud-launcher.html">Deploying Couchbase on Google Cloud Launcher</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cloud/couchbase-gcp-best-practices.html">Best Practices for Deploying Couchbase on Google Cloud Platform</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../install/upgrade.html">Upgrading Couchbase Server</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/upgrade-strategies.html">Upgrade Options</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/upgrade-online.html">Performing the Rolling Online Upgrade</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/upgrade-offline.html">Performing the Offline Upgrade</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/upgrade-individual-nodes.html">Performing the Single Node Upgrade</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/upgrade-strategy-for-features.html">Upgrading to Couchbase Server 5.5</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Migrating</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/migration.html">Enabling Timestamp-based Conflict Resolution for Migrated Data</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/migrate-couchdb.html">Migrating from Apache CouchDB</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../install/migrate-mysql.html">Migrating from Relational Databases</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Understanding Couchbase</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/understanding-couchbase.html">Overview</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/data/data.html">Data</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/data/document-data-model.html">The Couchbase Data Model</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/data/extended-attributes-fundamentals.html">Extended Attributes</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/buckets-memory-and-storage/buckets-memory-and-storage.html">Buckets, Memory, and Storage</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/buckets-memory-and-storage/buckets.html">Buckets</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/buckets-memory-and-storage/vbuckets.html">vBuckets</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/buckets-memory-and-storage/compression.html">Compression</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/buckets-memory-and-storage/expiration.html">Expiration</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/buckets-memory-and-storage/memory-and-storage.html">Memory and Storage</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/buckets-memory-and-storage/memory.html">Memory</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/buckets-memory-and-storage/storage.html">Storage</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/services-and-indexes/services-and-indexes.html">Services and Indexes</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/services-and-indexes/services/services.html">Services</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/services-and-indexes/services/data-service.html">Data Service</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/services-and-indexes/services/query-service.html">Query Service</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/services-and-indexes/services/index-service.html">Index Service</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/services-and-indexes/services/search-service.html">Search Service</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/services-and-indexes/services/analytics-service.html">Analytics Service</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/services-and-indexes/services/eventing-service.html">Eventing Service</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/services-and-indexes/indexes/indexes.html">Indexes</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/services-and-indexes/indexes/global-secondary-indexes.html">Global Secondary Indexes</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/services-and-indexes/indexes/index-replication.html">Index Availability and Performance</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/services-and-indexes/indexes/storage-modes.html">Index Storage Settings</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/views/views-intro.html">Views</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/views/views-basics.html">View Concepts</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-streaming.html">Stream-based Views</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-operation.html">View Operations</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-store-data.html">Views and Stored Data</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-development.html">Development Views</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-production.html">Production Views</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/views/views-mapreduce-intro.html">MapReduce Views</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/views/views-writing.html">Writing MapReduce Views</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-writing-views.html">Views Best Practices</a>
    </span>
  </li>
  <li class="nav-item" data-depth="6">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-writing-map.html">Map Function</a>
    </span>
  </li>
  <li class="nav-item" data-depth="6">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-writing-reduce.html">Reduce Function</a>
    </span>
  </li>
  <li class="nav-item" data-depth="6">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-writing-utility.html">Built-in Utility Functions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="6">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-writing-count.html">Built-in _count Function</a>
    </span>
  </li>
  <li class="nav-item" data-depth="6">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-writing-sum.html">Built-in _sum Function</a>
    </span>
  </li>
  <li class="nav-item" data-depth="6">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-writing-stats.html">Built-in _stats Function</a>
    </span>
  </li>
  <li class="nav-item" data-depth="6">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-writing-rewriting.html">Re-writing Built-in Reduce Functions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="6">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-writing-custom-reduce.html">Custom Reduce Functions</a>
    </span>
  </li>
  <li class="nav-item" data-depth="6">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-writing-rereduce.html">Re-reduce Argument</a>
    </span>
  </li>
  <li class="nav-item" data-depth="6">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-writing-nonjson.html">Views for Non-JSON Objects</a>
    </span>
  </li>
  <li class="nav-item" data-depth="6">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-trans-sql.html">Translating SQL to MapReduce</a>
    </span>
  </li>
  <li class="nav-item" data-depth="6">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-schemaless.html">Views in a Schema-less Database</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/views/views-querying.html">Querying MapReduce Views</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/views-query-samples.html">View and Query Examples</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/views/sv-writing-views.html">Writing Spatial Views</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/sv-writing-views-keys.html">Keys in Spatial View Functions</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/views/sv-query-parameters.html">Querying Spatial Views</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/sv-queries-open-range.html">Open Range Queries</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/sv-queries-closed-range.html">Closed Range Queries</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/sv-queries-bbox.html">Bounding Box Queries</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/views/sv-example1.html">Playing with GeoJSON Polygons</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/sv-ex1-create.html">Creating a Spatial View Function</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/sv-ex1-query-all.html">Querying All Data</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/sv-ex1-query-east.html">Querying on the East</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/sv-ex1-query-area.html">Querying on the Area</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/sv-ex1-query-nonintersect.html">Querying on Non-intersect</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/sv-example2.html">Playing with Non-geographic Spatial Views</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/views/view-indexes-for-n1ql.html">View Indexes for N1QL</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/clusters-and-availability/clusters-and-availability.html">Clusters and Availability</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/clusters-and-availability/cluster-manager.html">Cluster Manager</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/clusters-and-availability/connectivity-architecture.html">Connectivity</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../understanding-couchbase/clusters-and-availability/replication-architecture.html">Availability</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../understanding-couchbase/clusters-and-availability/groups.html">Server Group Awareness</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Integrations</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../connectors/intro.html">Connector Guides</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="#">elasticsearch-connector::index.adoc</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../connectors/hadoop-1.2/hadoop.html">Hadoop Connector</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="#">kafka-connector::index.adoc</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="#">spark-connector::index.adoc</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="#">talend-connector::index.adoc</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../connectors/odbc-jdbc-drivers.html">Couchbase ODBC and JDBC Drivers</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Tools &amp; API References</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../cli/cli-intro.html">CLI Reference</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbanalyze-core-tool.html">cbanalyze-core</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../cli/cbbackup-tool.html">cbbackup</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/backup-cbbackup.html">Backing up with cbbackup</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbbackup-wrapper.html">cbbackupwrapper and cbrestorewrapper</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbcollect-info-tool.html">cbcollect_info</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbdocloader-tool.html">cbdocloader</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../cli/cbepctl-intro.html">cbepctl</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbepctl/set-checkpoint_param.html">set checkpoint_param</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbepctl/set-flush_param.html">set flush_param</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbepctl/set-tap_param.html">set tap_param</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbft-bleve-dump.html">cbft-bleve-dump</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbft-bleve-query.html">cbft-bleve-query</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbq-tool.html">cbq</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbrecovery.html">cbrecovery</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../cli/cbrestore-tool.html">cbrestore</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/restore-cbrestore.html">Restoring with cbrestore</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbrestore-tween-opsys.html">rehash=1</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../cli/cbstats-intro.html">cbstats</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-all.html">all</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-allocator.html">allocator</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-checkpoint.html">checkpoint</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-config.html">config</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-dcp.html">dcp</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-dcpagg.html">dcpagg</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-dcp-vbtakeover.html">dcp-vbtakeover</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-diskinfo.html">diskinfo</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-dispatcher-job.html">dispatcher</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-failovers.html">failovers</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-hash.html">hash</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-items.html">items</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-key.html">key</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-kvstore.html">kvstore</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-kvtimings.html">kvtimings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-memory.html">memory</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-prev-vbucket.html">prev-vbucket</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-raw.html">raw</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-reset.html">reset</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-responses.html">responses</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-runtimes.html">runtimes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-scheduler.html">scheduler</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-slabs.html">slabs</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-tap-vbtakeover.html">tap-vbtakeover</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-tasks.html">tasks</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-timing.html">timings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-uuid.html">uuid</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-vbucket.html">vbucket</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-vbucket-details.html">vbucket-details</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-vbucket-seqno.html">vbucket-seqno</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-vkey.html">vkey</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-warmup.html">warmup</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbstats/cbstats-workload.html">workload</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbtransfer-tool.html">cbtransfer</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/cbworkloadgen-tool.html">cbworkloadgen</a>
    </span>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../cli/mctimings.html">mctimings</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../rest-api/rest-intro.html">REST API reference</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../rest-api/rest-endpoints-all.html">REST API endpoint list</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../rest-api/rest-cluster-intro.html">Cluster API</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-node-provisioning.html">Creating a new cluster</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-cluster-get.html">Retrieving Cluster Information</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-cluster-details.html">Viewing Cluster Details</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-cluster-addnodes.html">Adding Nodes to Clusters</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-cluster-joinnode.html">Joining Nodes into Clusters</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-cluster-removenode.html">Removing Nodes from Clusters</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-cluster-rebalance.html">Rebalancing Nodes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-get-internal-setting.html">Viewing Internal Settings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../rest-api/rest-cluster-autofailover-intro.html">Managing Auto-Failover</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-cluster-autofailover-settings.html">Retrieving Auto-Failover Settings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-cluster-autofailover-enable.html">Enabling and Disabling Auto-Failover</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-cluster-autofailover-reset.html">Resetting Auto-Failover</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-cluster-disable-query.html">Disabling Consistent View Query Results on Rebalance</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-cluster-email-notifications.html">Setting Email Notifications</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../rest-api/rest-server-nodes.html">Server Nodes API</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-node-get-info.html">Getting Server Node Information</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-node-services.html">Enabling Couchbase Server Services</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-node-failover.html">Failing over Nodes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-node-recovery-incremental.html">Setting Recovery Type</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-failover-graceful.html">Setting Graceful Failover</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-node-hostname.html">Setting Hostnames</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-node-set-username.html">Setting Usernames and Passwords</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-node-memory-quota.html">Setting Memory Quota</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-node-index-path.html">Setting Index Paths</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-node-retrieve-stats.html">Retrieving Statistics</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../rest-api/rest-rza.html">Server Groups API</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-servergroup-get.html">Getting Server Group Information</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-servergroup-post-create.html">Creating Server Groups</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-servergroup-post-add.html">Adding Servers to Server Groups</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-servergroup-put.html">Renaming Server Groups</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-servergroup-put-membership.html">Updating Server Group Memberships</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-servergroup-delete.html">Deleting Server Groups</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../rest-api/rest-bucket-intro.html">Buckets API</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-buckets-summary.html">Getting all Bucket Information</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-bucket-info.html">Getting Single Bucket Information</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-bucket-stats.html">Getting Bucket Statistics</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-buckets-streamingURI.html">Getting Bucket Streaming URI</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-bucket-create.html">Creating and Editing Buckets</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-bucket-set-priority.html">Setting Disk I/O Priority</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-bucket-metadata-ejection.html">Setting Metadata Ejection</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-bucket-parameters.html">Changing Bucket Parameters</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-bucket-memory-quota.html">Changing Bucket Memory Quota</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-bucket-delete.html">Deleting Buckets</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-bucket-flush.html">Flushing Buckets</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../rest-api/compaction-rest-api.html">Compaction API</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-compact-post.html">Compacting Buckets</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-compact-spatialviews.html">Compacting Spatial Views</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-autocompact-get.html">Getting Auto-Compaction Settings</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../rest-api/rest-index-service.html">Index Service API</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/get-settings-indexes.html">Retrieve GSI Settings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/post-settings-indexes.html">Set GSI Settings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/get-status-indexes.html">Retrieve GSI Status</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/get-statement-indexes.html">Retrieve a GSI Statement</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../n1ql-rest-api/index.html">N1QL REST API</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../n1ql-rest-api/examplesrest.html">Examples</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../n1ql-rest-api/exsuccessful.html">Successful request</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../n1ql-rest-api/expositional.html">Request with positional parameters</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../n1ql-rest-api/exnamed.html">Request with Named Parameters</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../n1ql-rest-api/extimeout.html">Request Timeout</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../n1ql-rest-api/exrequesterror.html">Request error</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../n1ql-rest-api/exserviceerror.html">Service error</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../n1ql-rest-api/exn1qlerror.html">N1QL error</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../n1ql-rest-api/exunsupportedhttp.html">Unsupported HTTP method</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../n1ql-rest-api/exauthhttp.html">Request with authentication - HTTP header</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../n1ql-rest-api/exauthrequest.html">Request with authentication - request parameter</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../rest-api/rest-fts.html">Full Text Search API</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-fts-node.html">Node Configuration</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-fts-indexing.html">Indexes</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-fts-advanced.html">Advanced</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../eventing/eventing-api.html">Functions REST API</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../rest-api/rest-views-intro.html">Views API</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-ddocs-get.html">Getting Design Doc Information</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-ddocs-create.html">Creating Design Documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-ddocs-delete.html">Deleting Design Documents</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-views-get.html">Getting Views Information</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-views-requests.html">Limiting Views Requests</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../rest-api/rest-xdcr-intro.html">XDCR API</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-xdcr-create-replication.html">Creating XDCR Replications</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-xdcr-get-ref.html">Getting a Destination Cluster Reference</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-xdcr-create-ref.html">Setting Destination Cluster References</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-xdcr-delete-ref.html">Deleting a Destination Cluster Reference</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-xdcr-data-encrypt.html">Managing XDCR Data Encryption</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-xdcr-delete-replication.html">Deleting XDCR Replications</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-xdcr-adv-settings.html">Managing Advanced XDCR Settings</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-xdcr-pause-resume.html">Pausing XDCR Replication Streams</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-xdcr-statistics.html">Getting XDCR Stats</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../rest-api/logs-rest-api.html">Logs API</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-logs-get.html">Retrieving Log Information</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-client-logs.html">Creating Client Logs</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../rest-api/rest-security.html">Security API</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-auditing.html">Auditing API</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../rest-api/rest-authorization.html">Authorization API</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rbac.html">Role Based Admin Access (RBAC)</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-user-create.html">Create a Read-Only Administrator</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-user-getname.html">Retrieve the Read-Only Administrator&#8217;s Name</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-user-password-put.html">Change the Read-Only Administrator&#8217;s Password</a>
    </span>
  </li>
  <li class="nav-item" data-depth="5">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-user-delete.html">Delete the Read-Only Administrator</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/security-encrypted-access.html">Using REST for Encrypted Access</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-encryption.html">Encryption On-the-Wire API</a>
    </span>
  </li>
  <li class="nav-item" data-depth="4">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/rest-secret-mgmt.html">Secret Management API</a>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <a class="nav-link" href="../../rest-api/api-explorer.html">Admin API Explorer</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../tools/tools-ref.html">Couchbase Server Tools</a>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Query Tools</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../tools/cbq-shell.html">cbq: The Command Line Shell for N1QL</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../tools/query-workbench.html">Query Workbench</a>
    </span>
  </li>
  <li class="nav-item" data-depth="3">
    <span class="nav-line">
    <a class="nav-link" href="../../tools/query-monitoring.html">Query Monitoring</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-line">
    <span class="nav-text">Data Import/Export Tools</span>
    </span>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Release Notes &amp; Licenses</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../release-notes/relnotes.html">Release Notes for Couchbase Server 5.5.x</a>
    </span>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../third-party-licenses.html">Licenses for Third-Party Components</a>
    </span>
  </li>
</ul>
  </li>
  <li class="nav-item is-active" data-depth="0">
    <span class="nav-line">
    <button class="nav-toggle"></button>
    <span class="nav-text">Contributing</span>
    </span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <span class="nav-line">
    <a class="nav-link" href="../../../../home/contribute/index.html">Contribute to the Documentation</a>
    </span>
  </li>
</ul>
  </li>
</ul>
</div>
</nav>
<aside class="toc sidebar">
  <div class="toc-menu"></div>
</aside>
<main class="article" data-ceiling="topbar">
  <div class="article-banner">
    <p>A newer version of this documentation is available.</p>
    <a class="btn" href="../../../6.5/index.html">View Latest</a>
  </div>
  <div class="article-header">
<button class="nav-control"></button>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../../introduction/intro.html">Couchbase Server</a></li>
    <li class="crumb">Developers</li>
    <li class="crumb">N1QL Reference</li>
    <li class="crumb"><a href="groupby-aggregate-performance.html">Group By and Aggregate Performance</a></li>
  </ul>
</nav>
<div class="tools" role="navigation">
  <ul>
    <li class="tool edit"><a href="file:///Users/simondew/GitHub/simon-dew/docs-server/modules/n1ql/pages/n1ql-language-reference/groupby-aggregate-performance.adoc" title="Edit Page" target="_blank" rel="noopener">Edit</a></li>
  </ul>
</div>
  </div>
<article class="doc">
<h1 class="page">Group By and Aggregate Performance</h1>
<div class="labels">
  <ul>
    <li class="edition"><a href="https://www.couchbase.com/products/editions">enterprise edition</a></li>
    <li class="status"><span>Couchbase Server 5.5</span></li>
  </ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
N1QL Pushdowns optimize the performance of N1QL queries by supporting GROUP BY and Aggregate expressions.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Overview"><a class="anchor" href="#Overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This features improves performance of N1QL queries with aggregations and GROUP BY execution.</p>
</div>
<div class="paragraph">
<p>After the optimizer selects an index for a query block, it attempts the two optimizations below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pagination optimization, by pushing the OFFSET and LIMIT parameters to the index scan.</p>
</li>
<li>
<p>Grouping and aggregation pushdown to the indexer (introduced in Couchbase 5.5).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Prior to Couchbase 5.5, even when a query with aggregate and/or GROUP BY is covered by an index, the query fetched all relevant data from the indexer and group the data within the query engine.
With this enhancement, the query intelligently requests the indexer to perform grouping and aggregation in addition to range scan.
The Indexer has been enhanced to perform grouping, COUNT(), SUM(), MIN(), MAX(), AVG(), and related operations.</p>
</div>
<div class="paragraph">
<p>This requires no changes to the user query, but a good index design to cover the query and order the keys is required.
Not every query will benefit from this optimization, and not every index can accelerate every grouping and aggregation.
Understanding the right patterns will help you to design your indexes and queries.
Aggregate Pushdown to the global secondary index is supported on both storage engines: Standard GSI and Memory Optimized GSI (MOI).</p>
</div>
<div class="paragraph">
<p>This reduction step of performing the GROUP BY and Aggregation on the indexer reduces the amount of data transfer and disk I/O, resulting in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Improved query response time</p>
</li>
<li>
<p>Improved resource utilization</p>
</li>
<li>
<p>Low latency</p>
</li>
<li>
<p>High scalability</p>
</li>
<li>
<p>Low TCO</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, let&#8217;s compare the previous vs.
current performance of using GROUP BY and examine the EXPLAIN plan of the following query that is defined in the Couchbase <code>travel-sample</code> index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX `def_type` ON `travel-sample`(`type`)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Consider the query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT type, COUNT(type)
FROM `travel-sample`
WHERE type IS NOT MISSING
GROUP BY type;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before Couchbase version 5.5, this query engine fetched relevant data from the indexer and group the data within the query engine and then aggregate.
This simple query takes about 250 ms.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/n1ql-language-reference/GBAP_Ex0_QP_before55.png" alt="GBAP Ex0 QP before55">
</div>
</div>
<div class="paragraph">
<p>Now, in Couchbase version 5.5, this query use the same <code>def_type</code> index, but executes in under 70 ms.
In the explain below, you can see fewer steps and the lack of the grouping step after the index scan because the index scan step does the grouping and aggregation as well.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/n1ql-language-reference/GBAP_Ex0_QP_after55.png" alt="GBAP Ex0 QP after55">
</div>
</div>
<div class="paragraph">
<p>As the data and query complexity grows, the performance benefit (both latency and throughput) will grow as well.</p>
</div>
<div class="paragraph">
<p>For example, consider the query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT type, COUNT(type)
FROM `travel-sample`
WHERE type IS NOT MISSING
GROUP BY type;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The text explain plan shows the accelerated aggregation details.
For details, see <a href="#section_bpf_wjf_ycb">Appx 1 - Query Plan Fields</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">...
        "index_group_aggs": {
          "aggregates": [
            {
              "aggregate": "COUNT",
              "expr": "1",
              "id": 2,
              "keypos": -1
            }
          ],
          "depends": [
            0
          ],
          "group": [
            {
              "depends": [
                0
              ],
              "expr": "cover ((`travel-sample`.`type`))",
              "id": 0,
              "keypos": 0
            }
          ]
        },
        "index_id": "c5bbb792c69c1704",
        "index_projection": {
          "entry_keys": [
            0,
            2
          ]
        },
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Heres is how this query executes when the indexer executes the GROUP BY and aggregation.
The query engine does not fetch any data from the data service (KV service), as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/n1ql-language-reference/GBAP_55execution.png" alt="GBAP 55execution" width="700">
</div>
</div>
<div class="paragraph">
<p>For your reference, this is how the same query executed before 5.5.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/n1ql-language-reference/GBAP_pre55execution.png" alt="GBAP pre55execution" width="700">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples-for-indexer-group-by-and-aggregation"><a class="anchor" href="#examples-for-indexer-group-by-and-aggregation"></a>Examples for Indexer GROUP BY and Aggregation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lets consider a composite index to explore some scenarios:</p>
</div>
<div class="listingblock">
<div class="title">Example A</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_a ON `travel-sample` (geo.alt, geo.lat, geo.lon, id) WHERE type = "airport"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lets consider sample queries that can benefit from this optimization and the queries that cannot.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Positive Case examples of queries that use indexing grouping and aggregation</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>SELECT COUNT(*) FROM `travel-sample` WHERE geo.alt &gt; 10 AND type="airport";</code></p>
</li>
<li>
<p><code>SELECT COUNT(geo.alt) FROM `travel-sample` WHERE geo.alt BETWEEN 10 AND 30 AND type = "airport";</code></p>
</li>
<li>
<p><code>SELECT COUNT(geo.lat) FROM `travel-sample` WHERE geo.alt BETWEEN 10 AND 30 AND geo.lat = 40 AND type = "airport";</code></p>
</li>
<li>
<p><code>SELECT geo.alt, AVG(id), SUM(id), COUNT(geo.alt), MIN (geo.lon), MAX(ABS(geo.lon)) FROM `travel-sample` WHERE geo.alt &gt; 100 AND type = "airport" GROUP BY geo.alt;</code></p>
</li>
<li>
<p><code>SELECT lat_count, SUM(id) FROM `travel-sample` WHERE geo.alt &gt; 100 AND type = "airport" GROUP BY geo.alt LETTING lat_count = COUNT(geo.lat) HAVING lat_count &gt; 1;</code></p>
</li>
<li>
<p><code>SELECT AVG(DISTINCT geo.lat) FROM `travel-sample` WHERE geo.alt &gt; 100 AND type = "airport" GROUP BY geo.alt;</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Negative Case examples</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>SELECT COUNT(*) FROM `travel-sample` WHERE geo.lat &gt; 20 AND type = "airport";</code></p>
<div class="paragraph">
<p>This query has no predicate on the leading key <code>geo.alt</code>.
The index <code>idx_a</code> cannot be used.</p>
</div>
</li>
<li>
<p><code>SELECT COUNT(*) FROM `travel-sample`;</code></p>
<div class="paragraph">
<p>This query has no predicate at all.</p>
</div>
</li>
<li>
<p><code>SELECT COUNT(v1) FROM `travel-sample` LET v1 = ROUND(geo.lat) WHERE geo.lat &gt; 10 AND type = "airport";</code></p>
<div class="paragraph">
<p>The aggregate depends on <code>LET</code> variable.</p>
</div>
</li>
<li>
<p><code>SELECT ARRAY_AGG(geo.alt) FROM `travel-sample` WHERE geo.alt &gt; 10 AND type = "airport";</code></p>
<div class="paragraph">
<p><code>ARRAY_AGG</code> is not supported.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="positive-query-examples-with-group-by-on-leading-index-keys"><a class="anchor" href="#positive-query-examples-with-group-by-on-leading-index-keys"></a>Positive query examples with GROUP BY on leading index keys</h3>
<div class="paragraph">
<p>Consider the following index:</p>
</div>
<div class="listingblock">
<div class="title">Example B</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_b ON `travel-sample`(geo.alt, geo.lat, geo.lon, id)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following query, the GROUP BY keys <code>(geo.alt, geo.lat)</code> are the leading keys of the index, so the index is naturally ordered and grouped by the order of the index key definition.
Therefore, the query below is suitable for indexer to handle grouping and aggregation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT geo.alt, geo.lat, SUM(geo.lon), AVG(id), COUNT(DISTINCT geo.lon)
FROM `travel-sample`
WHERE geo.alt BETWEEN 10 AND 30
AND type = "airport"
GROUP BY geo.alt, geo.lat
HAVING SUM(geo.lon) &gt; 1000;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s the executed query plan showing that index scan handled grouping and aggregation:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/n1ql-language-reference/GBAP_ExB_Plan.png" alt="GBAP ExB Plan" width="70%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="positive-query-examples-with-group-by-on-non-leading-index-keys"><a class="anchor" href="#positive-query-examples-with-group-by-on-non-leading-index-keys"></a>Positive query examples with GROUP BY on non-leading index keys</h3>
<div class="paragraph">
<p>Consider the following index and query:</p>
</div>
<div class="listingblock">
<div class="title">Example C</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_c ON `travel-sample`(geo.alt, geo.lat, geo.lon, id)
 WHERE type = "airport"

SELECT geo.lat, id, SUM(geo.lon)
FROM `travel-sample`
WHERE geo.alt BETWEEN 10 AND 30
AND type = "airport"
GROUP BY geo.lat, id
HAVING SUM(geo.lon) &gt; 1000;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is a bottom-up rendering of the execution plan for easier viewing.
In this case, the indexer sends partial group aggregation, which the query merges to create the final group and aggregation.
In this scenario (when the grouping is on non-leading keys), any query with aggregation and DISTINCT modifier cannot be accelerated by the indexer, such as <code>COUNT(DISTINCT id)</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/n1ql-language-reference/GBAP_ExC_Plan.png" alt="GBAP ExC Plan" width="50%">
</div>
</div>
</div>
<div class="sect2">
<h3 id="positive-query-examples-on-array-indexes-with-group-by-on-leading-index-keys"><a class="anchor" href="#positive-query-examples-on-array-indexes-with-group-by-on-leading-index-keys"></a>Positive query examples on array indexes with GROUP BY on leading index keys</h3>
<div class="paragraph">
<p>Consider the following index and query:</p>
</div>
<div class="listingblock">
<div class="title">Example D</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_d ON `travel-sample` (geo.lat, geo.lon, DISTINCT public_likes, id) WHERE type = "hotel"

SELECT geo.lat, geo.lon, SUM(id), AVG(id)
FROM `travel-sample`
WHERE geo.lat BETWEEN 10 AND 30
 AND geo.lon &gt; 50
 AND type = "hotel"
 AND ANY v IN public_likes SATISFIES  v = %a% END
GROUP BY geo.lat, geo.lon
HAVING SUM(id) &gt; 100;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the predicates are on the leading keys up to and including the array key.
Therefore, indexer can efficiently do the grouping as seen by the optimal plan below.
Its important to note the array index key is created with a <code>DISTINCT</code> modifier (not the <code>ALL</code> modifier) to get this optimization and that the <code>SATISFIES</code> clause in the <code>ANY</code> predicate must be that of equality (that is, <code>v = %a%</code>).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/n1ql-language-reference/GBAP_ExD_Plan.png" alt="GBAP ExD Plan" width="70%">
</div>
</div>
<div class="paragraph">
<p>On the other hand, if theres a predicate missing on <code>geo.lon</code>&#8201;&#8212;&#8201;which is prior to the array key&#8201;&#8212;&#8201;while using the same <code>idx_d</code> index as above, then the grouping is done by the old method:</p>
</div>
<div class="listingblock">
<div class="title">Example D2</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT geo.lat, geo.lon, SUM(id), AVG(id)
FROM `travel-sample`
WHERE geo.lat BETWEEN 10 AND 30
 AND type = "hotel"
 AND ANY v IN public_likes SATISFIES  v = %a% END
GROUP BY geo.lat, geo.lon
HAVING SUM(id) &gt; 100;</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/n1ql-language-reference/GBAP_ExD2_Plan.png" alt="GBAP ExD2 Plan">
</div>
</div>
<div class="paragraph">
<p>Consider the index and query:</p>
</div>
<div class="listingblock">
<div class="title">Example E</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_e ON `travel-sample` (ALL public_likes, geo.lat, geo.lon, id) WHERE type = "hotel"

SELECT un, t.geo.lat, COUNT(un), AVG(t.geo.lat)
FROM `travel-sample` AS t
 UNNEST t.public_likes AS un
WHERE un &gt; "J"
AND t.type = "hotel"
GROUP BY un, t.geo.lat;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the <code>UNNEST</code> operation can use the index because the leading <code>ALL</code> array key is the array being unwound.
Note, the unwound operation repeats the parent document (<code>travel-sample</code>) and the <code>t.geo.lat</code> reference would have duplicates compared to the original <code>travel-sample</code> documents.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/n1ql-language-reference/GBAP_ExE_Plan.png" alt="GBAP ExE Plan" width="50%">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-qualification-and-pushdown"><a class="anchor" href="#query-qualification-and-pushdown"></a>Query Qualification and Pushdown</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Not every GROUP BY and aggregate query can be handled by the indexer.
Following are some simple rules that will help you to write the proper queries and design the required indexes to get the most of this feature.</p>
</div>
<div class="paragraph">
<p>The following are necessary in order for an indexer to execute GROUP BY and aggregates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All the query predicates are able to convert into ranges and able to push to indexer.</p>
</li>
<li>
<p>The whole query must be covered by an index.</p>
<div class="ulist">
<ul>
<li>
<p>For a query to be covered by an index, every attribute referenced in the query should be in one index.</p>
</li>
<li>
<p>Query should not have operations such as joins, subquery, or derived table queries.</p>
</li>
</ul>
</div>
</li>
<li>
<p>GROUP BY keys and Aggregate expressions must be one of the following:</p>
<div class="ulist">
<ul>
<li>
<p>Index keys or document key</p>
</li>
<li>
<p>An expression based on index keys or document key</p>
</li>
</ul>
</div>
</li>
<li>
<p>GROUP BY and aggregate expressions must be simple.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scenarios-for-group-by-and-aggregation"><a class="anchor" href="#scenarios-for-group-by-and-aggregation"></a>Scenarios for Group By and Aggregation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Like any feature in a query language, there are subtle variations between each query and index that affects this optimization.
We use the <code>travel-sample</code> dataset to illustrate both positive and negative use cases.</p>
</div>
<div class="paragraph">
<p>The following table lists the scenarios and requirements for queries to request the indexer to do the grouping and acceleration.
When the requirements are unmet, the query will fetch the relevant data and then do the grouping and acceleration as usual.
No application changes are necessary.
The query plan generated reflects this decision.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">GROUP BY Scenarios</dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#group-by-on-leading-keys">GROUP BY on leading keys</a></p>
</li>
<li>
<p><a href="#group-by-on-non-leading-keys">GROUP BY on non-leading keys</a></p>
</li>
<li>
<p><a href="#group-by-keys-in-different-order">GROUP BY keys in different CREATE INDEX order</a></p>
</li>
<li>
<p><a href="#group-by-on-expression">GROUP BY on expression</a></p>
</li>
<li>
<p><a href="#heterogeneous-data-types">Heterogeneous data types for GROUP BY key</a></p>
</li>
<li>
<p><a href="#group-by-meta-id">GROUP BY META().ID Primary Index</a></p>
</li>
<li>
<p><a href="#limit-with-group-by">LIMIT with GROUP BY on leading keys</a></p>
</li>
<li>
<p><a href="#offset-with-group-by">OFFSET with GROUP BY on leading keys</a></p>
</li>
</ol>
</div>
</dd>
<dt class="hdlist1">Aggregate Scenarios</dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#aggregate-without-group-by">Aggregate without GROUP BY key</a></p>
</li>
<li>
<p><a href="#expression-in-aggregate-function">Expression in Aggregate function</a></p>
</li>
<li>
<p><a href="#sum-count-min-max-avg">SUM, COUNT, MIN, MAX, or AVG Aggregate functions</a></p>
</li>
<li>
<p><a href="#distinct-aggregates">DISTINCT aggregates</a></p>
</li>
<li>
<p><a href="#having-with-aggregate-function">HAVING with an aggregate function inside</a></p>
</li>
<li>
<p><a href="#letting-with-aggregate-function">LETTING with an aggregate function inside</a></p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="group-by-on-leading-keys"><a class="anchor" href="#group-by-on-leading-keys"></a>GROUP BY on leading keys</h3>
<div class="paragraph">
<p>One of the common cases is to have both predicates and GROUP BY on leading keys of the index.
First create the index so that the query is covered by the index.
You can then think about the order of the keys.</p>
</div>
<div class="paragraph">
<p>The query requires a predicate on leading keys to consider an index.
The simplest predicate is <code>IS NOT MISSING</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_expr ON Keyspace_ref (a, b, c);

SELECT a, b, Aggregate_Function(c)  <i class="conum" data-value="1"></i><b>(1)</b>
FROM Keyspace_ref
WHERE a IS NOT MISSING <i class="conum" data-value="2"></i><b>(2)</b>
GROUP BY a, b;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Where <code>Aggregate_Function(c)</code> is <code>MIN(c)</code>, <code>MAX(c)</code>, <code>COUNT(c)</code>, or <code>SUM(c)</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>1st index field must be in a WHERE clause</td>
</tr>
</table>
</div>
<div id="ex1" class="exampleblock">
<div class="title">Example 1. List the cities with the landmarks with the highest latitude</div>
<div class="content">
<div class="paragraph">
<p>Use the <code>MAX()</code> aggregate to find the highest landmark latitude in each state, group the results by <code>country</code> and <code>state</code>, and then sort in reverse order by the highest latitudes per <code>state</code>.</p>
</div>
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx1 ON `travel-sample`(country, state, geo.lat)
WHERE type="landmark";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT country, state, MAX(ROUND(geo.lat)) AS Max_Latitude
FROM `travel-sample`
WHERE country IS NOT MISSING
AND type = "landmark"
GROUP BY country, state
ORDER BY Max_Latitude DESC;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this query, we need to give the predicate <code>country IS NOT MISSING</code> (or any WHERE clause) to ensure this index is selected for the query.
Without a matching predicate, the query will use the primary index.</p>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Max_Latitude": 60,
    "country": "United Kingdom",
    "state": null
  },
  {
    "Max_Latitude": 51,
    "country": "United Kingdom",
    "state": "England"
  },
  {
    "Max_Latitude": 50,
    "country": "France",
    "state": "Picardie"
  },
...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Explain Plan</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "plan": {
    "#operator": "Sequence",
    "~children": [
      {
        "#operator": "Sequence",
        "~children": [
          {
            "#operator": "IndexScan3",
            "covers": [
              "cover ((`travel-sample`.`country`))",
              "cover ((`travel-sample`.`state`))",
              "cover (((`travel-sample`.`geo`).`lat`))",
              "cover ((meta(`travel-sample`).`id`))",
              "cover (count(cover ((`travel-sample`.`country`))))",
              "cover (min(round(cover (((`travel-sample`.`geo`).`lat`)))))"
            ],
            "filter_covers": {
              "cover ((`travel-sample`.`type`))": "landmark"
            },
            "index": "idx1",
            "index_group_aggs": {
              "aggregates": [
                {
                  "aggregate": "MAX",
                  "depends": [
                    2
                  ],
                  "expr": "round(cover (((`travel-sample`.`geo`).`lat`)))",
                  "id": 4,
                  "keypos": -1
                }
              ],
              "depends": [
                0,
                1,
                2
              ],
              "group": [
                {
                  "depends": [
                    0
                  ],
                  "expr": "cover ((`travel-sample`.`country`))",
                  "id": 0,
                  "keypos": 0
                },
                {
                  "depends": [
                    1
                  ],
                  "expr": "cover ((`travel-sample`.`state`))",
                  "id": 1,
                  "keypos": 1
                }
              ]
            },
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The EXPLAIN Plan shows that <code>GROUP BY</code> is executed by the indexer.
This is detailed in <a href="#table_bw2_nrf_ycb">Table 2</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="group-by-on-non-leading-keys"><a class="anchor" href="#group-by-on-non-leading-keys"></a>GROUP BY on non-leading keys</h3>
<div class="paragraph">
<p>When using GROUP BY on a non-leading key:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The indexer will return <em>pre-aggregated</em> results.</p>
</li>
<li>
<p>Results can have duplicate or out-of-order groups.
The N1QL indexer will do 2nd level of aggregation and compute the final result.</p>
</li>
<li>
<p>The N1QL indexer can pushdown only if the leading key has a predicate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use Aggregate Pushdown, use the following syntax for the index and query statements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_expr ON Keyspace_ref (a, b, c);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Syntax A</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT Aggregate_Function(a), b, Aggregate_Function(c)
FROM Keyspace_ref
WHERE a IS NOT MISSING
GROUP BY b;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Syntax B</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT Aggregate_Function(a), Aggregate_Function(b), c
FROM Keyspace_ref
WHERE a IS NOT MISSING
GROUP BY c;</code></pre>
</div>
</div>
<div id="ex2-a" class="exampleblock">
<div class="title">Example 2. List the states with their total number of landmarks and the lowest latitude of any landmark</div>
<div class="content">
<div class="paragraph">
<p>Use the <code>COUNT()</code> operator to find the total number of landmarks and use the <code>MIN()</code> operator to find the lowest landmark latitude in each state, group the results by <code>state</code>, and then sort in order by the lowest latitudes per <code>state</code>.</p>
</div>
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx2 ON `travel-sample`(country, state, ROUND(geo.lat))
WHERE type="landmark";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT COUNT(country) AS Total_landmarks, state, MIN(ROUND(geo.lat)) AS Min_Latitude
FROM `travel-sample`
WHERE country IN ["France", "United States", "United Kingdom"]
AND type = "landmark"
GROUP BY state
ORDER BY Min_Latitude;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Explain Plan</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "plan": {
    "#operator": "Sequence",
    "~children": [
      {
        "#operator": "Sequence",
        "~children": [
          {
            "#operator": "IndexScan3",
            "covers": [
              "cover ((`travel-sample`.`country`))",
              "cover ((`travel-sample`.`state`))",
              "cover (((`travel-sample`.`geo`).`lat`))",
              "cover ((meta(`travel-sample`).`id`))",
              "cover (count(cover ((`travel-sample`.`country`))))",
              "cover (min(round(cover (((`travel-sample`.`geo`).`lat`)))))"
            ],
            "filter_covers": {
              "cover ((`travel-sample`.`type`))": "landmark"
            },
            "index": "idx2",
            "index_group_aggs": {
              "aggregates": [
                {
                  "aggregate": "COUNT",
                  "depends": [
                    0
                  ],
                  "expr": "cover ((`travel-sample`.`country`))",
                  "id": 4,
                  "keypos": 0
                },
                {
                  "aggregate": "MIN",
                  "depends": [
                    2
                  ],
                  "expr": "round(cover (((`travel-sample`.`geo`).`lat`)))",
                  "id": 5,
                  "keypos": -1
                }
              ],
              "depends": [
                0,
                1,
                2
              ],
              "group": [
                {
                  "depends": [
                    1
                  ],
                  "expr": "cover ((`travel-sample`.`state`))",
                  "id": 1,
                  "keypos": 1
                }
              ],
              "partial": true <i class="conum" data-value="1"></i><b>(1)</b>
            },
...</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/n1ql-language-reference/GBAP_Ex2A_EP.png" alt="GBAP Ex2A EP">
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Min_Latitude": 33,
    "Total_landmarks": 1900,
    "state": "California"
  },
  {
    "Min_Latitude": 41,
    "Total_landmarks": 8,
    "state": "Corse"
  },
  {
    "Min_Latitude": 43,
    "Total_landmarks": 6,
    "state": "Languedoc-Roussillon"
  },
...</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>"partial": true</code> line means it was pre-aggregated.</td>
</tr>
</table>
</div>
<div id="ex2-b" class="exampleblock">
<div class="title">Example 3. List the number of landmarks by latitude and the state it&#8217;s in</div>
<div class="content">
<div class="paragraph">
<p>Use <code>COUNT(country)</code> for the total number of landmarks at each latitude.
At a particular latitude, the <code>state</code> will be the same; but an aggregate function on it is needed, so <code>MIN()</code> or <code>MAX()</code> is used to return the original value.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT COUNT(country) Num_Landmarks, MIN(state) State_Name, ROUND(geo.lat) Latitude
FROM `travel-sample`
WHERE country IS NOT MISSING
AND type = "landmark"
GROUP BY ROUND(geo.lat)
ORDER BY ROUND(geo.lat);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Latitude": 33,
    "Num_Landmarks": 227,
    "State_Name": "California"
  },
  {
    "Latitude": 34,
    "Num_Landmarks": 608,
    "State_Name": "California"
  },
  {
    "Latitude": 35,
    "Num_Landmarks": 27,
    "State_Name": "California"
  },
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="group-by-keys-in-different-order"><a class="anchor" href="#group-by-keys-in-different-order"></a>GROUP BY keys in different CREATE INDEX order</h3>
<div class="paragraph">
<p>When using GROUP BY on keys in a different order than they appear in the CREATE INDEX statement, use the following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_expr ON Keyspace_ref(a, b, c);

SELECT Aggregate_Function(c)
FROM Keyspace_ref
WHERE a IS NOT MISSING
GROUP BY b, a;</code></pre>
</div>
</div>
<div id="ex3" class="exampleblock">
<div class="title">Example 4. List the landmarks with the lowest longitude</div>
<div class="content">
<div class="paragraph">
<p>Like <a href="#ex1">Example 1</a> with the GROUP BY fields swapped.</p>
</div>
<div class="paragraph">
<p>Use the <code>MIN()</code> operator to find the lowest landmark longitude in each city, group the results by <code>activity</code> and <code>city</code>, and then sort in reverse order by the lowest longitudes per <code>activity</code>.</p>
</div>
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx3 ON `travel-sample`(activity, city, geo.lon)
WHERE type="landmark";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT activity, city, MIN(ROUND(geo.lon)) AS Max_Longitude
FROM `travel-sample`
WHERE country IS NOT MISSING
AND type = "landmark"
GROUP BY activity, city
ORDER BY Min_Longitude;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Min_Longitude": -124,
    "activity": "buy",
    "city": "Eureka"
  },
  {
    "Min_Longitude": -123,
    "activity": "drink",
    "city": "Glen Ellen"
  },
  {
    "Min_Longitude": -123,
    "activity": "do",
    "city": "Santa Rosa"
  },
  {
    "Min_Longitude": -123,
    "activity": "eat",
    "city": "Moss Beach"
  },
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="group-by-on-expression"><a class="anchor" href="#group-by-on-expression"></a>GROUP BY on expression</h3>
<div class="paragraph">
<p>When grouping on an expression or operation, the indexer will return pre-aggregated results whenever the GROUP BY and leading index keys are not an exact match.</p>
</div>
<div class="paragraph">
<p>To use Aggregate Pushdown and avoid pre-aggregated results, use one of the two following syntaxes for the index and query statements:</p>
</div>
<div class="listingblock">
<div class="title">Syntax A: Field with an expression&#8201;&#8212;&#8201;GROUP BY and Index keys match</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_expr ON Keyspace_ref(a+b, b, c);

SELECT Aggregate_Function(c)
FROM Keyspace_ref
WHERE a IS NOT MISSING
GROUP BY a+b;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Syntax B: Operation on a field&#8201;&#8212;&#8201;GROUP BY and Index keys match</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_operation ON Keyspace_ref (LOWER(a), b, c);

SELECT Aggregate_Function(c)
FROM Keyspace_ref
WHERE a IS NOT MISSING
GROUP BY LOWER(a);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For comparison, the below index and query combination will yield pre-aggregated results.</p>
</div>
<div class="listingblock">
<div class="title">Pre-aggregated Syntax&#8201;&#8212;&#8201;the GROUP BY and Index keys don&#8217;t match</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_operation ON Keyspace_ref (a, b, c);

SELECT Aggregate_Function(c)
FROM Keyspace_ref
WHERE a IS NOT MISSING
GROUP BY UPPER(a);</code></pre>
</div>
</div>
<div id="ex4-a" class="exampleblock">
<div class="title">Example 5. A field with an expression</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s say the distance of a flight feels like "nothing" when it&#8217;s direct, but feels like the true distance when there is one layover.
Then we can list and group by flight distances by calculating the distance multiplied by the stops it makes.</p>
</div>
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx4_expr
ON `travel-sample`(ROUND(distance*stops), ROUND(distance), sourceairport)
WHERE type="route";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT ROUND(distance*stops) AS Distance_Feels_Like,
       MAX(ROUND(distance)) AS Distance_True,
       COUNT(sourceairport) Number_of_Airports
FROM `travel-sample`
WHERE ROUND(distance*stops) IS NOT MISSING
AND type = "route"
GROUP BY ROUND(distance*stops);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Explain Plan</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">...
        "index_group_aggs": {
          "aggregates": [
            {
              "aggregate": "COUNT",
              "depends": [
                2
              ],
              "expr": "cover ((`travel-sample`.`sourceairport`))",
              "id": 4,
              "keypos": 2
            },
            {
              "aggregate": "MAX",
              "depends": [
                1
              ],
              "expr": "cover (round((`travel-sample`.`distance`)))",
              "id": 5,
              "keypos": 1
            }
          ],
          "depends": [
            0,
            1,
            2
          ],
          "group": [
            {
              "depends": [
                0
              ],
              "expr": "cover (round(((`travel-sample`.`distance`) * (`travel-sample`.`stops`))))",
              "id": 0,
              "keypos": 0
            }
          ]
...</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/n1ql-language-reference/GBAP_Ex4A_VP.png" alt="GBAP Ex4A VP" width="50%">
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Distance_Feels_Like": 1055,
    "Distance_True": 1055,
    "Number_of_Airports": 1
  },
  {
    "Distance_Feels_Like": 1806,
    "Distance_True": 1806,
    "Number_of_Airports": 2
  },
  {
    "Distance_Feels_Like": 0,
    "Distance_True": 13808,
    "Number_of_Airports": 24018
  },
...</code></pre>
</div>
</div>
</div>
</div>
<div id="ex4-b" class="exampleblock">
<div class="title">Example 6. An operation on a field</div>
<div class="content">
<div class="paragraph">
<p>Let&#8217;s say the distance of a flight feels like "nothing" when it&#8217;s direct, but feels like the true distance when there is one layover.
Then we can list and group by the uppercase of the airport codes and listing the flight distances by calculating the distance multiplied by the stops it makes along with the total distance.</p>
</div>
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx4_oper
ON `travel-sample`(sourceairport, ROUND(distance*stops), distance)
WHERE type="route";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT UPPER(sourceairport) AS Airport_Code,
       MIN(ROUND(distance*stops)) AS Distance_Feels_Like,
       SUM(ROUND(distance)) AS Total_Distance
FROM `travel-sample`
WHERE sourceairport IS NOT MISSING
AND type = "route"
GROUP BY UPPER(sourceairport);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Airport_Code": "ESU",
    "Distance_Feels_Like": 0,
    "Total_Distance": 6223
  },
  {
    "Airport_Code": "QSF",
    "Distance_Feels_Like": 0,
    "Total_Distance": 3285
  },
  {
    "Airport_Code": "LHW",
    "Distance_Feels_Like": 0,
    "Total_Distance": 13837
  },
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="heterogeneous-data-types"><a class="anchor" href="#heterogeneous-data-types"></a>Heterogeneous data types for GROUP BY key</h3>
<div class="paragraph">
<p>When a field has a mix of data types for the GROUP BY key:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NULLS</code> and <code>MISSING</code> are two separate groups.</p>
</li>
</ul>
</div>
<div id="ex5" class="exampleblock">
<div class="title">Example 7. Heterogeneous data types</div>
<div class="content">
<div class="paragraph">
<p>To see a separate grouping of <code>MISSING</code> and <code>NULL</code>, we need to <code>GROUP BY</code> a field we know exists in one document but not in another document while both documents have another field in common.</p>
</div>
<div class="listingblock">
<div class="title">Create Documents</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">INSERT INTO `travel-sample` VALUES("01",{"type":1, "email":"abc","xx":3});
INSERT INTO `travel-sample` VALUES("01",{"type":1, "email":"abc","xx":null});
INSERT INTO `travel-sample` VALUES("02",{"type":1, "email":"abcd"});</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT type, xx, MIN(email) AS Min_Email
FROM `travel-sample`
WHERE type IS NOT NULL
GROUP BY type, xx;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Min_Email": "abc",
    "type": 1,
    "xx": 3
  },
  {
    "Min_Email": "abc",
    "type": 1,
    "xx": null
  },
  {
    "Min_Email": "abcd",
    "type": 1 <i class="conum" data-value="1"></i><b>(1)</b>
  },
  {
    "Min_Email": null,
    "type": "airline"
  },
...</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is a separate result since field <code>xx</code> is MISSING</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="group-by-meta-id"><a class="anchor" href="#group-by-meta-id"></a>GROUP BY META().ID Primary Index</h3>
<div class="paragraph">
<p>If there is no filter, then pushdown is supported for an expression on the Document ID <code>META().id</code> in the <code>GROUP BY</code> clause.</p>
</div>
<div class="paragraph">
<p>To use Aggregate Pushdown, use the following syntax for the index and query statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE PRIMARY INDEX idx_expr ON named_keyspace_ref;

SELECT COUNT(1)
FROM named_keyspace_ref
GROUP BY SUBSTR(META().id, 0, 10);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If there is a filter on the Document ID, then the primary index can be used as a secondary scan.
</td>
</tr>
</table>
</div>
<div id="ex6" class="exampleblock">
<div class="title">Example 8. List the number of countries that are in each decile of the <code>META().id</code> field</div>
<div class="content">
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE PRIMARY INDEX idx6 ON `travel-sample`;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT COUNT(1) AS Cnt, SUBSTR(META().id,0,9) AS Meta_Group
FROM `travel-sample`
GROUP BY SUBSTR(META().id,0,9);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Meta_Group": "airport_9",
    "Number_of_Country": 121
  },
  {
    "Meta_Group": "airport_1",
    "Number_of_Country": 187
  },
  {
    "Meta_Group": "airport_3",
    "Number_of_Country": 482
  },
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="limit-with-group-by"><a class="anchor" href="#limit-with-group-by"></a>LIMIT with GROUP BY on leading keys</h3>
<div class="paragraph">
<p>To use Aggregate Pushdown when there is a LIMIT clause and a GROUP BY clause on one or more leading keys, use the following example of the index and query statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_expr ON named_keyspace_ref (k0, k1);

SELECT k0, COUNT(k1)
FROM named_keyspace_ref
WHERE k0 IS NOT MISSING
GROUP BY k0
LIMIT n;</code></pre>
</div>
</div>
<div id="ex7" class="exampleblock">
<div class="title">Example 9. LIMIT with GROUP BY on the leading key</div>
<div class="content">
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx7 ON `travel-sample` (city, name)
WHERE type = "landmark";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT city AS City, COUNT(DISTINCT name) AS Landmark_Count
FROM `travel-sample`
WHERE city IS NOT MISSING
AND type = "landmark"
GROUP BY city
LIMIT 4;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Explain Plan</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "plan": {
    "#operator": "Sequence",
    "~children": [
      {
        "#operator": "Sequence",
        "~children": [
          {
            "#operator": "IndexScan3",
            "covers": [
              "cover ((`travel-sample`.`city`))",
              "cover ((`travel-sample`.`name`))",
              "cover ((meta(`travel-sample`).`id`))",
              "cover (count(distinct cover ((`travel-sample`.`name`))))"
            ],
            "filter_covers": {
              "cover ((`travel-sample`.`type`))": "landmark"
            },
            "index": "idx7",
            "index_group_aggs": {
              "aggregates": [
                {
                  "aggregate": "COUNT",
                  "depends": [
                    1
                  ],
                  "distinct": true,
                  "expr": "cover ((`travel-sample`.`name`))",
                  "id": 3,
                  "keypos": 1
                }
              ],
              "depends": [
                0,
                1
              ],
              "group": [
                {
                  "depends": [
                    0
                  ],
                  "expr": "cover ((`travel-sample`.`city`))",
                  "id": 0,
                  "keypos": 0
                }
              ]
            },
            "index_id": "7852b5e2c07281f3",
            "index_projection": {
              "entry_keys": [
                0,
                3
              ]
            },
            "keyspace": "travel-sample",
            "limit": "4", <i class="conum" data-value="1"></i><b>(1)</b>
            "namespace": "default",
...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "City": null,
    "Landmark_Count": 15
  },
  {
    "City": "Abbeville",
    "Landmark_Count": 1
  },
  {
    "City": "Abbots Langley",
    "Landmark_Count": 19
  },
  {
    "City": "Aberdeenshire",
    "Landmark_Count": 6
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>limit</code> is pushed to the indexer because the GROUP BY key matched with the leading index key.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="offset-with-group-by"><a class="anchor" href="#offset-with-group-by"></a>OFFSET with GROUP BY on leading keys</h3>
<div class="paragraph">
<p>To use Aggregate Pushdown when there is an OFFSET clause and a GROUP BY clause on one or more leading keys, use the following example of the index and query statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_expr ON named_keyspace_ref (k0, k1);

SELECT k0, COUNT(k1)
FROM named_keyspace_ref
WHERE k0 IS NOT MISSING
GROUP BY k0
OFFSET n;</code></pre>
</div>
</div>
<div id="ex8" class="exampleblock">
<div class="title">Example 10. OFFSET with GROUP BY on a leading key</div>
<div class="content">
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx8 ON `travel-sample` (city, name)
WHERE type = "landmark";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT city AS City, COUNT(DISTINCT name) AS Landmark_Count
FROM `travel-sample`
WHERE city IS NOT MISSING
AND type = "landmark"
GROUP BY city
OFFSET 4;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Explain Plan</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "plan": {
    "#operator": "Sequence",
    "~children": [
      {
        "#operator": "Sequence",
        "~children": [
          {
            "#operator": "IndexScan3",
            "covers": [
              "cover ((`travel-sample`.`city`))",
              "cover ((`travel-sample`.`name`))",
              "cover ((meta(`travel-sample`).`id`))",
              "cover (count(distinct cover ((`travel-sample`.`name`))))"
            ],
            "filter_covers": {
              "cover ((`travel-sample`.`type`))": "landmark"
            },
            "index": "idx7",
            "index_group_aggs": {
              "aggregates": [
                {
                  "aggregate": "COUNT",
                  "depends": [
                    1
                  ],
                  "distinct": true,
                  "expr": "cover ((`travel-sample`.`name`))",
                  "id": 3,
                  "keypos": 1
                }
              ],
              "depends": [
                0,
                1
              ],
              "group": [
                {
                  "depends": [
                    0
                  ],
                  "expr": "cover ((`travel-sample`.`city`))",
                  "id": 0,
                  "keypos": 0
                }
              ]
            },
            "index_id": "7852b5e2c07281f3",
            "index_projection": {
              "entry_keys": [
                0,
                3
              ]
            },
            "keyspace": "travel-sample",
            "namespace": "default",
            "offset": "4", <i class="conum" data-value="1"></i><b>(1)</b>
            "spans": [
...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "City": "Aberdour",
    "Landmark_Count": 4
  },
  {
    "City": "Aberdulais",
    "Landmark_Count": 1
  },
  {
    "City": "Abereiddy",
    "Landmark_Count": 1
  },
  {
    "City": "Aberfeldy",
    "Landmark_Count": 2
  },
...</code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>offset</code> is pushed to the indexer because the GROUP BY key matched with the leading index key.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="aggregate-without-group-by"><a class="anchor" href="#aggregate-without-group-by"></a>Aggregate without GROUP BY key</h3>
<div class="paragraph">
<p>This is a case of aggregation over a range without groups.
If the index can be used for computing the aggregate, the indexer will return a single aggregate value.
To use Aggregate Pushdown, use the following syntax for index and queries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_expr ON named_keyspace_ref (a, b, c);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Q1</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT Aggregate_Function(c)
FROM named_keyspace_ref
WHERE a IS NOT MISSING;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Q2</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT SUM(a)
FROM named_keyspace_ref
WHERE a IS NOT MISSING;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Q3</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT SUM(a), COUNT(a), MIN(a)
FROM named_keyspace_ref
WHERE a IS NOT MISSING;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Q4</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT SUM(a), COUNT(b), MIN(c)
FROM named_keyspace_ref
WHERE a IS NOT MISSING;</code></pre>
</div>
</div>
<div id="ex9-q1" class="exampleblock">
<div class="title">Example 11. Multiple Aggregate without GROUP BY key&#8201;&#8212;&#8201;Q1</div>
<div class="content">
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx9
ON `travel-sample`(ROUND(distance), stops, sourceairport)
WHERE type = "airport";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT SUM(ROUND(distance)) AS Total_Distance,
       SUM(stops) AS Total_Stops,
       COUNT(sourceairport) AS Total_Airports
FROM `travel-sample`
WHERE distance IS NOT MISSING
AND type = "airport";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Total_Airports": 24024,
    "Total_Distance": 53538071,
    "Total_Stops": 6
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div id="ex9-q2" class="exampleblock">
<div class="title">Example 12. Aggregate without GROUP BY key&#8201;&#8212;&#8201;Q2</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT SUM(ROUND(distance)) AS Total_Distance
FROM `travel-sample`;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Total_Distance": 53538071
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div id="ex9-q3" class="exampleblock">
<div class="title">Example 13. Multiple Aggregate without GROUP BY key&#8201;&#8212;&#8201;Q3</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT SUM(ROUND(distance)) AS Total_Distance,
       COUNT(ROUND(distance)) AS Count_of_Distance,
       MIN(ROUND(distance)) AS Min_of_Distance
FROM `travel-sample`
WHERE distance IS NOT MISSING;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Count_of_Distance": 24024,
    "Min_of_Distance": 3,
    "Total_Distance": 53538071
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div id="ex9-q4" class="exampleblock">
<div class="title">Example 14. Multiple Aggregate without GROUP BY key&#8201;&#8212;&#8201;Q4</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT SUM(ROUND(distance)) AS Total_Distance,
       COUNT(stops) AS Count_of_Stops,
       MIN(sourceairport) AS Min_of_Airport
FROM `travel-sample`
WHERE distance IS NOT MISSING;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Count_of_Stops": 24024,
    "Min_of_Airport": "AAE",
    "Total_Distance": 53538071
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="expression-in-aggregate-function"><a class="anchor" href="#expression-in-aggregate-function"></a>Expression in Aggregate function</h3>
<div class="paragraph">
<p>Aggregations with scalar expressions can be speeded up even if the index key does not have the matching expression on the key.
To use Aggregate Pushdown, use the following syntax for the index and query statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_expr ON named_keyspace_ref (a,b,c);

SELECT Aggregate_Function1(Expression(c))
FROM named_keyspace_ref
WHERE a IS NOT MISSING
GROUP BY a,b;</code></pre>
</div>
</div>
<div id="ex10" class="exampleblock">
<div class="title">Example 15. List the landmarks with the highest latitude</div>
<div class="content">
<div class="paragraph">
<p>Use the <code>MAX()</code> operator to find the highest landmark latitude in each state, group the results by <code>country</code> and <code>state</code>, and then sort in reverse order by the highest latitudes.</p>
</div>
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx10 ON `travel-sample`(country, state, ABS(ROUND(geo.lat)))
WHERE type="landmark";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT country, state, SUM(ABS(ROUND(geo.lat))) AS SumAbs_Latitude
FROM `travel-sample`
WHERE country IS NOT MISSING
AND type = "landmark"
GROUP BY country, state
ORDER BY SumAbs_Latitude DESC;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Explain Plan</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "plan": {
    "#operator": "Sequence",
    "~children": [
      {
        "#operator": "Sequence",
        "~children": [
          {
            "#operator": "IndexScan3",
            "covers": [
              "cover ((`travel-sample`.`country`))",
              "cover ((`travel-sample`.`state`))",
              "cover (abs(round(((`travel-sample`.`geo`).`lat`))))",
              "cover ((meta(`travel-sample`).`id`))",
              "cover (sum(cover (abs(round(((`travel-sample`.`geo`).`lat`))))))"
            ],
            "filter_covers": {
              "cover ((`travel-sample`.`type`))": "landmark"
            },
            "index": "idx10",
            "index_group_aggs": {
              "aggregates": [
                {
                  "aggregate": "SUM",
                  "depends": [
                    2
                  ],
                  "expr": "cover (abs(round(((`travel-sample`.`geo`).`lat`))))",
                  "id": 4,
                  "keypos": 2
                }
              ],
              "depends": [
                0,
                1,
                2
              ],
              "group": [
                {
                  "depends": [
                    0
                  ],
                  "expr": "cover ((`travel-sample`.`country`))",
                  "id": 0,
                  "keypos": 0
                },
                {
                  "depends": [
                    1
                  ],
                  "expr": "cover ((`travel-sample`.`state`))",
                  "id": 1,
                  "keypos": 1
                }
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Explain Plan shows that Aggregates are executed by the indexer.
This is detailed in <a href="#docs-internal-guid-facfdbc0-bb3d-b00f-2ec0-6bee4921dabc">Table 3</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/n1ql-language-reference/GBAP_Ex10_VP.png" alt="GBAP Ex10 VP" width="70%">
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "SumAbs_Latitude": 117513,
    "country": "United Kingdom",
    "state": null
  },
  {
    "SumAbs_Latitude": 68503,
    "country": "United States",
    "state": "California"
  },
  {
    "SumAbs_Latitude": 10333,
    "country": "France",
    "state": "le-de-France"
  },
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sum-count-min-max-avg"><a class="anchor" href="#sum-count-min-max-avg"></a>SUM, COUNT, MIN, MAX, or AVG Aggregate functions</h3>
<div class="paragraph">
<p>Currently, the only aggregate functions that are supported are SUM(), COUNT(), MIN(), MAX(), and AVG() with or without the DISTINCT modifier.</p>
</div>
<div class="paragraph">
<p>To use Aggregate Pushdown, use the below syntax for the index and query statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_expr ON named_keyspace_ref (a,b,c,d);

SELECT Aggregate_Function(a), Aggregate_Function(b),
       Aggregate_Function(c), Aggregate_Function(d)
FROM named_keyspace_ref
WHERE a IS NOT MISSING
GROUP BY a;</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 16. Aggregate functions</div>
<div class="content">
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx11 ON `travel-sample`(ROUND(geo.lat), geo.alt, city, ROUND(geo.lon))
       WHERE type = "airport";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT MIN(ROUND(geo.lat)) AS Min_Lat,
       SUM(geo.alt) AS Sum_Alt,
       COUNT(city) AS Count_City,
       MAX(ROUND(geo.lon)) AS Max_Lon
FROM `travel-sample`
WHERE geo.lat IS NOT MISSING
AND type = "airport"
GROUP BY (ROUND(geo.lat))
ORDER BY (ROUND(geo.lat)) DESC;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Count_City": 1,
    "Max_Lon": 43,
    "Min_Lat": 72,
    "Sum_Alt": 149
  },
  {
    "Count_City": 3,
    "Max_Lon": -157,
    "Min_Lat": 71,
    "Sum_Alt": 120
  },
  {
    "Count_City": 6,
    "Max_Lon": -144,
    "Min_Lat": 70,
    "Sum_Alt": 292
  },
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="distinct-aggregates"><a class="anchor" href="#distinct-aggregates"></a>DISTINCT aggregates</h3>
<div class="paragraph">
<p>There are four cases when DISTINCT aggregates can use this feature:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the DISTINCT aggregate is on the leading GROUP BY key(s).</p>
</li>
<li>
<p>If the DISTINCT aggregate is on the leading GROUP By key(s) + 1 (the immediate next key).</p>
</li>
<li>
<p>If the DISTINCT aggregate is on a constant expression (GROUP BY can be on any key).</p>
</li>
<li>
<p>If there is no GROUP BY and the DISTINCT aggregate is on the first key only or in a constant expression.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To use Aggregate Pushdown, use one of the following syntaxes of the index and query statements:</p>
</div>
<div class="sect3">
<h4 id="case-1"><a class="anchor" href="#case-1"></a>Case 1</h4>
<div class="paragraph">
<p>If the DISTINCT aggregate is on the leading GROUP BY key(s).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_expr ON named_keyspace_ref (a, b, c);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Syntax A</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT SUM(DISTINCT a)
FROM named_keyspace_ref
WHERE a IS NOT MISSING
GROUP BY a;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Syntax B</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT COUNT(DISTINCT a), SUM(DISTINCT b)
FROM named_keyspace_ref
WHERE a IS NOT MISSING
GROUP BY a, b;</code></pre>
</div>
</div>
<div id="ex12-1-a" class="exampleblock">
<div class="title">Example 17. DISTINCT aggregate&#8201;&#8212;&#8201;Case 1, Syntax A</div>
<div class="content">
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx12_1 ON `travel-sample`(ROUND(geo.lat), ROUND(geo.lon), country)
WHERE type = "airport";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT SUM(DISTINCT ROUND(geo.lat)) AS Sum_Lat
FROM `travel-sample`
WHERE geo.lat IS NOT MISSING
AND type = "airport"
GROUP BY ROUND(geo.lat);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Sum_Lat": 27
  },
  {
    "Sum_Lat": 36
  },
  {
    "Sum_Lat": 71
  },
...</code></pre>
</div>
</div>
</div>
</div>
<div id="ex12-1-b" class="exampleblock">
<div class="title">Example 18. DISTINCT aggregate&#8201;&#8212;&#8201;Case 1, Syntax B</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT COUNT(DISTINCT ROUND(geo.lat)) AS Count_Lat,
       SUM(DISTINCT ROUND(geo.lon)) AS Sum_Lon
FROM `travel-sample`
WHERE geo.lat IS NOT MISSING
AND type = "airport"
GROUP BY ROUND(geo.lat), ROUND(geo.lon);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Count_Lat": 1,
    "Sum_Lon": -166
  },
  {
    "Count_Lat": 1,
    "Sum_Lon": -107
  },
  {
    "Count_Lat": 1,
    "Sum_Lon": -159
  },
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="case-2"><a class="anchor" href="#case-2"></a>Case 2</h4>
<div class="paragraph">
<p>If the DISTINCT aggregate is on the leading GROUP BY key(s) + 1 (the next key).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_expr ON named_keyspace_ref (a, b, c);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Syntax A</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT SUM(DISTINCT b)
FROM named_keyspace_ref
WHERE a IS NOT MISSING
GROUP BY a;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Syntax B</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT COUNT(DISTINCT c)
FROM named_keyspace_ref
WHERE a IS NOT MISSING
GROUP BY a, b;</code></pre>
</div>
</div>
<div id="ex12-2-a" class="exampleblock">
<div class="title">Example 19. DISTINCT aggregate&#8201;&#8212;&#8201;Case 2, Syntax A</div>
<div class="content">
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx12_2 ON `travel-sample`(country, ROUND(geo.lat), ROUND(geo.lon))
WHERE type = "airport";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT COUNT(DISTINCT country) AS Count_Country,
       SUM(DISTINCT ROUND(geo.lat)) AS Sum_Lat
FROM `travel-sample`
WHERE country IS NOT MISSING
AND type = "airport"
GROUP BY country;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Count_Country": 1,
    "Sum_Lat": 483
  },
  {
    "Count_Country": 1,
    "Sum_Lat": 2290
  },
  {
    "Count_Country": 1,
    "Sum_Lat": 591
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div id="ex12-2-b" class="exampleblock">
<div class="title">Example 20. DISTINCT aggregate&#8201;&#8212;&#8201;Case 2, Syntax B</div>
<div class="content">
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT COUNT(DISTINCT country) AS Count_Country,
       SUM(DISTINCT ROUND(geo.lat)) AS Sum_Lat,
       COUNT(DISTINCT ROUND(geo.lon)) AS Count_Lon
FROM `travel-sample`
WHERE country IS NOT MISSING
AND type = "airport"
GROUP BY country, ROUND(geo.lat);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Count_Country": 1,
    "Count_Lon": 16,
    "Sum_Lat": 483
  },
  {
    "Count_Country": 1,
    "Count_Lon": 103,
    "Sum_Lat": 2290
  },
  {
    "Count_Country": 1,
    "Count_Lon": 13,
    "Sum_Lat": 591
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="case-3"><a class="anchor" href="#case-3"></a>Case 3</h4>
<div class="paragraph">
<p>If the DISTINCT aggregate is on a constant expression&#8201;&#8212;&#8201;GROUP BY can be on any key.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_expr ON named_keyspace_ref (a, b, c);

SELECT a, COUNT(DISTINCT 1)
FROM named_keyspace_ref
WHERE a IS NOT MISSING
GROUP BY b;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The results will be pre-aggregated if the <code>GROUP BY</code> key is non-leading, as in this case and example.
</td>
</tr>
</table>
</div>
<div id="ex12-3" class="exampleblock">
<div class="title">Example 21. DISTINCT aggregate&#8201;&#8212;&#8201;Case 3</div>
<div class="content">
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx12_3 ON `travel-sample`(country, geo.lat, geo.lon)
WHERE type = "airport";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT MIN(country) AS Min_Country,
       COUNT(DISTINCT 1) AS Constant_Value,
       MIN(ROUND(geo.lon)) AS Min_Logitude
FROM `travel-sample`
WHERE country IS NOT MISSING
AND type = "airport"
GROUP BY geo.lat;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Constant_Value": 1,
    "Min_Country": "United States",
    "Min_Longitude": -75
  },
  {
    "Constant_Value": 1,
    "Min_Country": "United States",
    "Min_Longitude": -169
  },
  {
    "Constant_Value": 1,
    "Min_Country": "United States",
    "Min_Longitude": -165
  },
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="case-4"><a class="anchor" href="#case-4"></a>Case 4</h4>
<div class="paragraph">
<p>If the DISTINCT aggregate is on the first key only or in a constant expression, and there is no GROUP BY clause.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_expr ON named_keyspace_ref (a, b, c);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Q1</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT SUM(DISTINCT a)
FROM named_keyspace_ref; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Q2</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT COUNT(DISTINCT 1)
FROM named_keyspace_ref; <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Q3</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT SUM(DISTINCT c)
FROM named_keyspace_ref; <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>OK</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>OK</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Not OK</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>All other cases of DISTINCT pushdown will return an error.</p>
</div>
<div id="ex12-4-q1" class="exampleblock">
<div class="title">Example 22. DISTINCT aggregate&#8201;&#8212;&#8201;Case 4, Q1</div>
<div class="content">
<div class="paragraph">
<p>A DISTINCT aggregate on the first key only or in a constant expression, where there is no GROUP BY clause.</p>
</div>
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx12_4 ON `travel-sample`(geo.alt, geo.lat, geo.lon)
WHERE type = "airport";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT SUM(DISTINCT ROUND(geo.alt)) AS Sum_Alt
FROM `travel-sample`
WHERE geo.alt IS NOT MISSING
AND type = "airport";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Sum_Alt": 1463241
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div id="ex12-4-q2" class="exampleblock">
<div class="title">Example 23. DISTINCT aggregate&#8201;&#8212;&#8201;Case 4, Q2</div>
<div class="content">
<div class="paragraph">
<p>Another query with index <code>idx12_4</code>.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT COUNT(DISTINCT 1) AS Const_expr
FROM `travel-sample`
WHERE type = "airport";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Const_expr": 1
  }
]</code></pre>
</div>
</div>
</div>
</div>
<div id="ex12-4-q3" class="exampleblock">
<div class="title">Example 24. DISTINCT aggregate&#8201;&#8212;&#8201;Case 4, Q3</div>
<div class="content">
<div class="paragraph">
<p>Another query with index <code>idx12_4</code>, which will not push down the aggregate to the indexer.</p>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT SUM(DISTINCT ROUND(geo.lon)) AS Sum_Lon
FROM `travel-sample`
WHERE geo.alt IS NOT MISSING
AND type = "airport";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "Sum_Lon": -11412
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="having-with-aggregate-function"><a class="anchor" href="#having-with-aggregate-function"></a>HAVING with an aggregate function inside</h3>
<div class="paragraph">
<p>To use Aggregate Pushdown when a HAVING clause has an aggregate function inside, use the following syntax of index and query statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_expr ON named_keyspace_ref (k0, k1);

SELECT k0, COUNT(k1)
FROM named_keyspace_ref
WHERE k0 IS NOT MISSING
GROUP BY k0
HAVING Aggregate_Function(k1);</code></pre>
</div>
</div>
<div id="ex13" class="exampleblock">
<div class="title">Example 25. HAVING with an aggregate function inside</div>
<div class="content">
<div class="paragraph">
<p>List the cities that have more than 180 landmarks.</p>
</div>
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx13 ON `travel-sample` (city, name)
WHERE type = "landmark";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT city AS City, COUNT(DISTINCT name) AS Landmark_Count
FROM `travel-sample`
WHERE city IS NOT MISSING
AND type = "landmark"
GROUP BY city
HAVING COUNT(DISTINCT name) &gt; 180;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "City": "London",
    "Landmark_Count": 443
  },
  {
    "City": "Los Angeles",
    "Landmark_Count": 284
  },
  {
    "City": "San Diego",
    "Landmark_Count": 197
  },
  {
    "City": "San Francisco",
    "Landmark_Count": 797
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="letting-with-aggregate-function"><a class="anchor" href="#letting-with-aggregate-function"></a>LETTING with an aggregate function inside</h3>
<div class="paragraph">
<p>To use Aggregate Pushdown when a LETTING clause has an aggregate function inside, use the following syntax of the index and query statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx_expr ON named_keyspace_ref (k0, k1);

SELECT k0, COUNT(k1)
FROM named_keyspace_ref
WHERE k0 IS NOT MISSING
GROUP BY k0
LETTING var_expr = Aggregate_Function(k1)
HAVING var_expr;</code></pre>
</div>
</div>
<div id="ex14" class="exampleblock">
<div class="title">Example 26. LETTING with an aggregate function inside</div>
<div class="content">
<div class="paragraph">
<p>List cities that have more than half of all landmarks.</p>
</div>
<div class="listingblock">
<div class="title">Index</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">CREATE INDEX idx14 ON `travel-sample` (city, name)
WHERE type = "landmark";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Query</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">SELECT city AS City, COUNT(DISTINCT name) AS Landmark_Count
FROM `travel-sample`
WHERE city IS NOT MISSING
AND type = "landmark"
GROUP BY city
LETTING MinimumThingsToSee = COUNT(DISTINCT name)
HAVING MinimumThingsToSee &gt; 180;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Results</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "City": "London",
    "Landmark_Count": 443
  },
  {
    "City": "Los Angeles",
    "Landmark_Count": 284
  },
  {
    "City": "San Diego",
    "Landmark_Count": 197
  },
  {
    "City": "San Francisco",
    "Landmark_Count": 797
  }
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="limitations"><a class="anchor" href="#limitations"></a>Limitations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following are currently not supported and not pushed to the indexer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HAVING</code> or <code>LETTING</code> clauses, unless there is an aggregate function inside.</p>
</li>
<li>
<p><code>ORDER BY</code> clauses.</p>
</li>
<li>
<p><code>ARRAY_AGG()</code> or any facility to add new Aggregate function, such as Median.</p>
</li>
<li>
<p><code>LIMIT</code> pushdown with <code>GROUP BY</code> on non-leading keys.</p>
</li>
<li>
<p><code>OFFSET</code> pushdown with <code>GROUP BY</code> on non-leading keys.</p>
</li>
<li>
<p>A subquery in a <code>GROUP BY</code> or Aggregate pushdown.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Aggregate Comparison</caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 18.1818%;">
<col style="width: 18.1818%;">
<col style="width: 18.1818%;">
<col style="width: 18.1819%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Item</th>
<th class="tableblock halign-center valign-top">Aggregate on Non-Array Index Field</th>
<th class="tableblock halign-center valign-top">Aggregate on Array Index Field</th>
<th class="tableblock halign-center valign-top">DISTINCT Aggregate on Non-Array Index Field</th>
<th class="tableblock halign-center valign-top">DISTINCT Aggregate on Array Index Field</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Supports <code>MIN()</code> and <code>MAX()</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong></strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong></strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Supports <code>SUM()</code> and <code>COUNT()</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong></strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong></strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Supports <code>AVG()</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong></strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong></strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong></strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Supports <code>ARRAY_AGG()</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="section_bpf_wjf_ycb"><a class="anchor" href="#section_bpf_wjf_ycb"></a>Appx 1 - Query Plan Fields</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consider the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-n1ql hljs" data-lang="n1ql">EXPLAIN SELECT type, COUNT(type)
FROM `travel-sample`
WHERE type IS NOT MISSING
GROUP BY type;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the query plan:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>plan.`~children`[0.covers]</code> shows that the index covers the query.</p>
</li>
<li>
<p><code>plan.`~children`[0.index_group_aggs]</code> shows the aggregation and groupings done by the indexer.</p>
</li>
<li>
<p><code>index_group_aggs</code> object has details on the aggregate, index key position, expression dependency, and group expressions handled by the indexer.
This object is present in the plan only when the indexer handles the grouping and aggregation.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 41.6666%;">
<col style="width: 41.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Explain Text in This Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aggregates</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of Aggregate objects, and each object represents one aggregate function.
The absence of this item means there is no Aggregate function.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aggregates</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... aggregate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aggregate operation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COUNT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... depends</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of index key positions the GROUP BY expression depends on, starting with 0.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p>
<p class="tableblock">(because it&#8217;s the 1st item)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... expr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group expression or an aggregate expression.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"cover ((`travel-sample`.`type`))"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique ID given internally and will be used in <code>index_projection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... keypos</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Key Position to use the Index expr or the query expr.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A value &gt; -1 means the group key exactly matches the corresponding index keys, where 0 is the 1st index key.</p>
</li>
<li>
<p>A value of -1 means the group key does not match the index key and uses the query expression instead.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p>
<p class="tableblock">(because it matches the 1st index key)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>depends</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of index key positions the GROUP BY expression depends on, starting with 0.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p>
<p class="tableblock">(because it&#8217;s the 1st item)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of GROUP BY objects, and each object represents one group key.
The absence of this item means there is no GROUP BY clause.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... depends</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Index key position of a single GROUP BY expression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p>
<p class="tableblock">(because it&#8217;s the 1st GROUP BY key)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... expr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single GROUP BY expression.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"cover ((`travel-sample`.`type`))"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique ID given internally and will be used in <code>index_projection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... keypos</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Key Position to use the Index expr or the query expr.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A value &gt; -1 means the group key exactly matches the corresponding index keys, where 0 is the 1st index key.</p>
</li>
<li>
<p>A value of -1 means the group key does not match the index key and uses the query expression instead.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p>
<p class="tableblock">(because it matches the 1st key in the index expression)</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "plan": {
    "#operator": "Sequence",
    "~children": [
      {
        "#operator": "IndexScan3",
        "covers": [
          "cover ((`travel-sample`.`name`))",
          "cover ((meta(`travel-sample`).`id`))",
          "cover (count(1))"
        ],
        "index": "idx_name",
        "index_group_aggs": { <i class="conum" data-value="1"></i><b>(1)</b>
          "aggregates": [
            {
              "aggregate": "COUNT",
              "expr": "1",
              "id": 2,
              "keypos": -1
            }
          ],
          "depends": [
            0
          ],
          "group": [
            {
              "depends": [
                0
              ],
              "expr": "cover ((`travel-sample`.`name`))",
              "id": 0,
              "keypos": 0
            }
          ]
        },
        "index_id": "5dfe130db88b4ec",
        "index_projection": {
          "entry_keys": [
            0,
            2
          ]
        },
        "keyspace": "travel-sample",
        "namespace": "default",
        "spans": [
          {
            "exact": true,
            "range": [
              {
                "inclusion": 1,
                "low": "null"
              }
            ]
          }
        ],
        "using": "gsi"
      },
      {
        "#operator": "Parallel",
        "~child": {
          "#operator": "Sequence",
          "~children": [
            {
              "#operator": "InitialProject",
              "result_terms": [
                {
                  "expr": "cover ((`travel-sample`.`name`))"
                },
                {
                  "expr": "cover (count(1))"
                }
              ]
            },
            {
              "#operator": "FinalProject"
            }
          ]
        }
      }
    ]
  },
  "text": "select name, count(1)\nfrom `travel-sample` use index (idx_name)\nwhere name is not missing\ngroup by name;"
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When the <code>index_group_aggs</code> section is present, it means that the query is using Index Aggregations.</td>
</tr>
</table>
</div>
<table id="table_bw2_nrf_ycb" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. GROUP BY Query Plan</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 41.6666%;">
<col style="width: 41.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">EXPLAIN Text in <a href="#ex1">Example 1</a> (GROUP BY)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aggregates</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of Aggregate objects, and each object represents one aggregate function.
The absence of this item means there is no Aggregate function.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aggregates</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... aggregate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aggregate operation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MAX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... depends</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of index key positions the GROUP BY expression depends on, starting with 0.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p>
<p class="tableblock">(because it&#8217;s the 3rd item)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... expr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group expression or an aggregate expression.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>round(cover (((`travel-sample`.
`geo`).`lat`)))</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique ID given internally and will be used in <code>index_projection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... keypos</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Key Position to use the Index expr or the query expr.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A value &gt; -1 means the group key exactly matches the corresponding index keys, where 0 is the 1st index key.</p>
</li>
<li>
<p>A value of -1 means the group key does not match the index key and uses the query expression instead.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code></p>
<p class="tableblock">(because the index has the field <code>geo.lat</code> but the query adds the <code>ROUND()</code> function to <code>geo.lat</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>depends</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of index key positions the GROUP BY expression depends on, starting with 0.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0, 1, 2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of GROUP BY objects, and each object represents one group key.
The absence of this item means there is no GROUP BY clause.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... depends</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Index key position of a single GROUP BY expression, starting with 0.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p>
<p class="tableblock">(because it&#8217;s the 1st GROUP BY key)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... expr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single GROUP BY expression.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>`travel-sample`.`country`</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique ID given internally and will be used in <code>index_projection.</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... keypos</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Key Position to use the Index expr or the query expr.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A value &gt; -1 means the group key exactly matches the corresponding index keys, where 0 is the 1st index key.</p>
</li>
<li>
<p>A value of -1 means the group key does not match the index key and uses the query expression instead.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p>
<p class="tableblock">(because it matches the first key in the index expression)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The Query Plan sections of an Aggregate pushdown are slightly different than those used in a GROUP BY.</p>
</div>
<table id="docs-internal-guid-facfdbc0-bb3d-b00f-2ec0-6bee4921dabc" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Aggregate Query Plan</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 41.6666%;">
<col style="width: 41.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">EXPLAIN Text in <a href="#ex10">Example 15</a> (Aggregate)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aggregates</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of Aggregate objects, and each object represents one aggregate function.
The absence of this item means there is no Aggregate function.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>aggregates</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... aggregate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aggregate operation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... depends</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of index key positions the GROUP BY expression depends on, starting with 0.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p>
<p class="tableblock">(because it&#8217;s the 3rd item)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... expr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group expression or an aggregate expression.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"abs(round(cover (((`travel-sample`.`geo`).`lat`))))"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique ID given internally and will be used in <code>index_projection</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... keypos</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Key Position to use the Index expr or the query expr.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A value &gt; -1 means the group key exactly matches the corresponding index keys, where 0 is the 1st index key.</p>
</li>
<li>
<p>A value of -1 means the group key does not match the index key and uses the query expression instead.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p>
<p class="tableblock">(because the query&#8217;s 3rd key exactly matches the index&#8217;s 3rd key)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>depends</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of index key positions the GROUP BY expression depends on, starting with 0.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0, 1, 2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of GROUP BY objects, and each object represents one group key.
The absence of this item means there is no GROUP BY clause.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... depends</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Index key position of a single GROUP BY expression, starting with 0.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p>
<p class="tableblock">(because it&#8217;s the 1st GROUP BY key)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... expr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single GROUP BY expression.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"cover ((`travel-sample`.`state`))"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique ID given internally and will be used in <code>index_projection.</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... keypos</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Key Position to use the Index expr or the query expr.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A value &gt; -1 means the group key exactly matches the corresponding index keys, where 0 is the 1st index key.</p>
</li>
<li>
<p>A value of -1 means the group key does not match the index key and uses the query expression instead.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p>
<p class="tableblock">(because it matches the 1st  key in the index expression)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... depends</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Index key position of a single GROUP BY expression, starting with 0.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p>
<p class="tableblock">(because it&#8217;s the 1st GROUP BY key)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... expr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single GROUP BY expression.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"cover ((`travel-sample`.`state`))"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique ID given internally and will be used in <code>index_projection.</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>... keypos</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Key Position to use the Index expr or the query expr.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A value &gt; -1 means the group key exactly matches the corresponding index keys, where 0 is the 1st index key.</p>
</li>
<li>
<p>A value of -1 means the group key does not match the index key and uses the query expression instead.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p>
<p class="tableblock">(because it matches the 2nd key in the index expression)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../../../_/img/logo.svg" alt="Couchbase">
          </a>
        </div>
        <div class="contact">
          <p class="address">3250 Olcott Street
Santa Clara, CA 95054
United States</p>
          <a href="https://www.couchbase.com/contact" class="btn white-btn">Contact Us</a>
          <a class="tel" href="tel:1-650-417-7500">1-650-417-7500</a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Company</span></li>
          <li><a href="https://www.couchbase.com/about">About</a></li>
          <li><a href="https://www.couchbase.com/leadership">Leadership</a></li>
          <li><a href="https://www.couchbase.com/news-and-press-releases">News &amp; Press</a></li>
          <li><a href="https://www.couchbase.com/careers">Careers</a></li>
          <li><a href="https://www.couchbase.com/resources/events">Events</a></li>
          <li><a href="https://www.couchbase.com/contact">Contact Us</a></li>
          <li><a href="https://www.couchbase.com/request-pricing">Pricing</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Support</span></li>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://www.couchbase.com/services">Professional Services</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support Login</a></li>
          <li><a href="https://learn.couchbase.com/store" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><span class="heading">Quicklinks</span></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Online Training</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
          <li><a href="https://www.couchbase.com/nosql-resources/why-nosql">Why NoSQL</a></li>
          <li><a href="https://www.couchbase.com/resources/security">Security</a></li>
          <li><a href="https://www.couchbase.com/resources/gdpr">GDPR</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <a href="https://www.facebook.com/Couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="26.363 116.363 560.215 560.215"><path d="m586.58 209.58c0-48.96-44.252-93.212-93.212-93.212h-373.79c-48.96 0-93.212 44.252-93.212 93.212v373.79c0 48.96 44.252 93.212 93.212 93.212h186.42v-211.85h-68.732v-93.212h68.732v-36.72c0-63.083 47.077-119.58 105.45-119.58h75.323v93.212h-75.323c-8.474 0-17.889 10.357-17.889 25.422v37.662h93.212v93.212h-93.212v211.85h99.803c48.96 0 93.212-44.252 93.212-93.212v-373.79z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://twitter.com/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="32.012 176.622 542.326 437.815"><path d="m574.34 227.46c-19.772 8.474-41.428 15.065-64.025 17.889 22.597-14.123 40.486-35.778 48.96-61.2-21.655 13.182-45.194 21.655-70.615 27.305-20.714-21.655-48.96-34.837-80.972-34.837-61.2 0-111.1 49.902-111.1 111.1 0 8.474 0.942 16.948 2.825 25.422-92.271-5.649-174.18-49.902-229.74-117.69-9.415 16.006-15.065 35.778-15.065 55.551 0 38.603 19.772 72.498 49.902 92.271-17.889-0.942-35.778-5.649-50.843-14.123v0.942c0 53.668 38.603 98.862 89.446 109.22-9.415 2.825-18.831 3.766-29.188 3.766-7.532 0-14.123-0.942-20.714-1.883 14.123 44.252 55.551 76.265 103.57 77.206-37.662 30.129-85.68 48.018-138.41 48.018-9.415 0-17.889-0.941-26.363-1.883 48.96 32.012 107.34 49.902 170.42 49.902 204.31 0 316.36-169.48 316.36-316.36v-14.123c21.656-14.125 40.487-33.897 55.551-56.494z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://www.linkedin.com/company/couchbase" class="icon">
              <svg width="50px" height="50px" viewBox="31.071 119.188 539.537 540.443"><path d="m531.97 119.19h-461.35c-21.655 0-39.545 16.948-39.545 38.603v463.24c0 21.655 17.889 38.603 39.545 38.603h460.41c21.655 0 39.545-16.948 39.545-38.603v-463.24c0.942-21.656-16.947-38.603-38.603-38.603zm-337.07 451.94h-81.914v-243.86h81.914v243.86zm-40.486-276.81c-28.246 0-46.135-18.831-46.135-42.369s17.889-42.369 46.135-42.369 45.194 17.889 45.194 42.369c0.942 23.538-16.948 42.369-45.194 42.369zm335.19 276.81h-81.914v-129.93c0-32.954-12.24-55.551-41.428-55.551-22.597 0-35.778 15.065-41.428 30.129-1.883 5.649-2.825 12.24-2.825 19.772v136.52h-81.914s0.942-221.26 0-243.86h81.914v34.837c11.298-16.948 30.129-40.486 73.44-40.486 53.668 0 94.154 34.837 94.154 110.16l1e-3 138.41zm-168.54-208.08s0.941-0.941 0 0z"/></svg>
            </a>
          </li>
          <li>
            <a href="https://plus.google.com/+CouchbaseServer" class="icon">
              <svg width="50px" height="50px" viewBox="36.72 225.573 542.326 343.67"><path d="m209.02 363.05v68.732h93.212c-15.065 44.252-37.662 68.732-93.212 68.732-56.492 0-100.74-46.135-100.74-102.63s44.252-102.63 100.74-102.63c30.129 0 48.96 10.357 66.849 25.422 14.123-14.123 13.182-16.006 48.96-49.902-31.071-28.246-71.557-45.194-115.81-45.194-95.096-0.94-172.3 76.266-172.3 171.36s77.206 172.3 172.3 172.3c142.17 0 177.01-124.28 165.71-206.2-33.896-1e-3 -165.71-1e-3 -165.71-1e-3zm310.71 3.766v-59.317h-42.369v59.317h-61.2v42.369h61.2v61.2h42.369v-61.2h59.317v-42.369h-59.317z"/></svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <span>2018 COUCHBASE All rights reserved.</span>
      <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
      <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
      <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
      <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
    </div>
  </div>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
